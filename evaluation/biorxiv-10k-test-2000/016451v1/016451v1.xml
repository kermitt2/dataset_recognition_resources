<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">BIORXIV</journal-id>
<journal-title-group>
<journal-title>bioRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/016451</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="author-type">
<subject>Regular Article</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>New Results</subject>
</subj-group>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Biophysics</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Low cost, high performance processing of single particle cryo-electron microscopy data in the cloud</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<name>
<surname>Cianfrocco</surname>
<given-names>Michael A.</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="corresp" rid="cor1">&#x002A;</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Leschziner</surname>
<given-names>Andres E.</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Department of Molecular and Cellular Biology, Harvard University</institution>, Cambridge, MA, 02138 <country>USA</country></aff>
<aff id="a2"><label>2</label><institution>Department of Cell Biology, Harvard Medical School</institution>, Boston, MA, 02115, <country>USA</country></aff>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>&#x002A;</label>Corresponding author: <email>mcianfrocco@fas.harvard.edu</email></corresp>
</author-notes>
<pub-date pub-type="epub">
<year>2015</year>
</pub-date>
<elocation-id>016451</elocation-id>
<history>
<date date-type="received">
<day>11</day>
<month>3</month>
<year>2015</year>
</date>
<date date-type="accepted">
<day>14</day>
<month>3</month>
<year>2015</year>
</date>
</history>
<permissions>
<copyright-statement>&#x00A9; 2015, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2015</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="016451.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract>
<title>ABSTRACT</title>
<p>The advent of a new generation of electron microscopes and direct electron detectors has realized the potential of single particle cryo-electron microscopy (cryo-EM) as a technique to generate high-resolution structures. However, calculating these structures requires high performance computing clusters, a resource that may be limiting to many likely cryo-EM users. To address this limitation and facilitate the spread of cryo-EM, we developed a publicly available &#x2018;off-the-shelf&#x2019; computing environment on Amazon&#x2019;s elastic cloud computing infrastructure. This environment provides users with single particle cryo-EM software packages and the ability to create computing clusters that can range in size from 16 to 480&#x002B; CPUs. Importantly, these computing clusters are also cost-effective, as we illustrate here by determining a near-atomic resolution structure of the 80S yeast ribosome for &#x0024;28.89 USD in &#x007E;10 hours.</p>
</abstract>
<counts>
<page-count count="20"/>
</counts>
</article-meta>
</front>
<body>
<sec id="s1">
<title>Introduction</title>
<p>Cryo-electron microscopy (cryo-EM) has long served as an important tool to provide structural insights into biological samples. Recent advances in cryo-EM data collection and analysis, however, have transformed single particle cryo-EM (<xref ref-type="bibr" rid="c4">Bai et al., 2015</xref>; <xref ref-type="bibr" rid="c13">Kuhlbrandt, 2014</xref>), allowing it to achieve resolutions better than 5 &#x00C5; for samples ranging in molecular weight from the 4 MDa eukaryotic ribosome (<xref ref-type="bibr" rid="c3">Bai et al., 2013</xref>) to the 170 kDa membrane protein &#x03B3;-secretase (<xref ref-type="bibr" rid="c15">Lu et al., 2014</xref>). These high-resolution structures are the result of a new generation of cameras that detect electrons directly without the need of a scintillator, which results in a dramatic increase in the signal-to-noise ratio relative to CCD cameras, the previous most commonly used device (<xref ref-type="bibr" rid="c17">McMullan et al., 2009</xref>). In addition to direct electron detection, the high frame rate of these cameras allows each image to be recorded as a &#x2018;movie&#x2019;, dividing it into multiple frames. These fractionated images can be used to correct for sample movement during the exposure, further increasing the quality of the cryo-EM images (<xref ref-type="bibr" rid="c5">Campbell et al., 2012</xref>; <xref ref-type="bibr" rid="c14">Li et al., 2013</xref>; <xref ref-type="bibr" rid="c22">Scheres, 2014</xref>).</p>
<p>In addition to these technological developments in the detectors, improvements to computer software packages have played an equally important role in moving cryo-EM into the high-resolution era. Atomic or near-atomic structures have been obtained with software packages such as EMAN2 (<xref ref-type="bibr" rid="c25">Tang et al., 2007</xref>), Sparx (<xref ref-type="bibr" rid="c9">Hohn et al., 2007</xref>), FREALIGN (<xref ref-type="bibr" rid="c8">Grigorieff, 2007</xref>), Spider (<xref ref-type="bibr" rid="c7">Frank et al., 1996</xref>), and Relion (<xref ref-type="bibr" rid="c21">Scheres, 2012</xref>, <xref ref-type="bibr" rid="c22">2014</xref>). In general, obtaining these structures involved computational approaches that sorted out the data into homogenous classes that could then be refined to high resolution.</p>
<p>While these advances in microscopy and analysis have been essential for the recent breakthroughs in cryo-EM, their implementation is computationally intensive and requires high-performance computing clusters. A recent survey (<xref ref-type="bibr" rid="c22">Scheres, 2014</xref>) of high-resolution single particle cryo-EM structures showed that refinement of these structures required processing times &#x003E; 1,000 CPU-hours (<xref ref-type="table" rid="tbl1">Table 1</xref>). Therefore, computational time (i.e. access to high-performance clusters) may represent a significant barrier to determining high-resolution structures by single particle cryo-EM.</p>
<table-wrap id="tbl1" orientation="portrait" position="float">
<label>Table 1:</label>
<caption><p>Overview of 3D refinement processing times for recent near-atomic cryo-EM structures.</p></caption>
<graphic xlink:href="016451_tbl1.tif"/>
</table-wrap>
<p>In order to expand the computational resources available to the structural biology community, we investigated the performance of Amazon&#x2019;s elastic cloud computing (EC2) infrastructure in processing cryo-EM data. We found that the Amazon&#x2019;s EC2 environment was very amenable to and affordable for the analysis of large cryo-EM datasets; we were able to determine a 4.6 &#x00C5; structure of the 80S ribosome using a published dataset (<xref ref-type="bibr" rid="c3">Bai et al., 2013</xref>) for &#x0024;28.89 USD in &#x007E;10 hours using 128 CPUs. To help others utilize this resource, we compiled an &#x2018;off-the-shelf&#x2019; software environment that allows new users to start up a cluster of Amazon CPUs preinstalled with cryo-EM software (Relion, EMAN2, Sparx, FREALIGN, Spider, EMAN, and XMIPP).</p>
</sec>
<sec id="s2">
<title>Elastic cloud computing through Amazon Web Services</title>
<p>Amazon Web Services (AWS) is a division of Amazon that offers a variety of cloud-based solutions for website hosting and high-performance computing, amongst other services. Many different types of privately held companies take advantage of Amazon&#x2019;s computing infrastructure because of its affordability, flexibility, and security. Of note, global biotechnology companies such as Novartis, Bristol-Myers-Squibb, and Pfizer have utilized the computing power of Amazon for scientific data processing. Many academic researchers have also begun to use Amazon&#x2019;s EC2 resources for analyzing such datasets as super-resolution light microscopy images (<xref ref-type="bibr" rid="c10">Hu et al., 2013</xref>), genomics (<xref ref-type="bibr" rid="c12">Krampis et al., 2012</xref>; <xref ref-type="bibr" rid="c27">Yazar et al., 2014</xref>), and proteomics (<xref ref-type="bibr" rid="c19">Mohammed et al., 2012</xref>; <xref ref-type="bibr" rid="c26">Trudgian and Mirzaei, 2012</xref>).</p>
<p>The overall workflow starts with users logging into a virtual machine (&#x2018;instance&#x2019;) on AWS (<xref ref-type="fig" rid="fig1">Figure 1</xref>). AWS offers a variety of instance types that have been configured for different computing tasks. For example, instances have been optimized for computing performance, GPU-based calculations, or memory-intensive calculations. After logging onto an instance, storage drives are mounted onto the instance, allowing data to be transferred onto the storage drive that can be encrypted for data security (<xref ref-type="fig" rid="fig1">Figure 1</xref>).</p>
<fig id="fig1" position="float" orientation="portrait" fig-type="figure">
<label>Figure 1:</label>
<caption><title>Workflow for analyzing cryo-EM data on Amazon&#x2019;s cloud computing infrastructure</title>
<p>After collecting cryo-EM data (Step 1), particles are extracted from the micrographs and prepared for further analysis (Step 2). After logging into an &#x2018;instance&#x2019; (Step 3), data are uploaded to a storage server (elastic block storage) (Step 4). At this point, a STARcluster can be configured to launch a cluster of 2 &#x2013; 30 instances that is mounted with the data from the storage volume (Step 5). A detailed protocol can be found at an accompanying Google site: <ext-link ext-link-type="uri" xlink:href="http://goo.gl/AIwZJz">http://goo.gl/AIwZJz</ext-link>.</p></caption>
<graphic xlink:href="016451_fig1.tif"/>
</fig>
<p>While users can utilize a single instance for calculations, the maximum number of CPU cores per instance is 18. Therefore, creating a computing cluster on AWS requires additional steps. The Software Tools for Academics and Researchers (STAR) group at Massachusetts Institute of Technology developed a straightforward package that allows users to group individual AWS instances into a cluster. The STARcluster program is a python-based, open source package that automatically creates a cluster preconfigured with the necessary software to manage a computer cluster (<xref ref-type="bibr" rid="c11">Ivica et al., 2009</xref>). This package allows users to specify the number of instances to be included in the clusters as well as the instance type. By taking advantage of this tool, private clusters can be built with sizes ranging from 16 to 480 CPUs (<xref ref-type="fig" rid="fig1">Figure 1</xref>).</p>
</sec>
<sec id="s3">
<title>EM-packages-in-the-Cloud: A pre-configured software environment for single-particle cryo-EM image analysis</title>
<p>We have taken advantage of the ease with which larger numbers of CPUs can be accessed on AWS to compile an off-the-shelf software environment preconfigured with STARcluster and the following cryo-EM software packages: Relion (<xref ref-type="bibr" rid="c21">Scheres, 2012</xref>, <xref ref-type="bibr" rid="c22">Scheres 2014</xref>), FREALIGN (<xref ref-type="bibr" rid="c8">Grigorieff, 2007</xref>), EMAN2 (<xref ref-type="bibr" rid="c25">Tang et al., 2007</xref>), Sparx (<xref ref-type="bibr" rid="c9">Hohn et al., 2007</xref>), Spider (<xref ref-type="bibr" rid="c7">Frank et al., 1996</xref>), EMAN (<xref ref-type="bibr" rid="c16">Ludtke et al., 1999</xref>), and XMIPP (<xref ref-type="bibr" rid="c24">Sorzano et al., 2004</xref>). We have made this environment publicly available by saving it within Amazon as an &#x2018;Amazon Machine Image&#x2019; (AMI), under the name &#x2018;EM-packages-in-the-Cloud.&#x2019; In addition to the EM-packages-in-the-Cloud AMI, we also created a second AMI, &#x2018;EM-packages-in-the-Cloud-Node&#x2019;, which is preconfigured with the necessary STARcluster software required for the cluster nodes. These two publicly available AMIs allows users to boot up a cluster in a few short steps. The protocols describing this can be found on a Google site that is being launched in conjunction with this article: <ext-link ext-link-type="uri" xlink:href="http://goo.gl/AIwZJz">http://goo.gl/AIwZJz</ext-link>. In addition to detailed instructions, the site includes a help forum to facilitate a conversation on cloud computing for single particle cryo-EM.</p>
<p>To test the performance of a cloud-based cluster of Amazon instances, we performed 3D classification and refinement of a previously published 80S <italic>Saccharomyces cerevisiae</italic> ribosome dataset (<xref ref-type="bibr" rid="c3">Bai et al., 2013</xref>) on a variety of cluster configurations using Relion. Due to the large memory requirements for Relion&#x2019;s 3D classification, we ran our performance tests on clusters of high-memory instances &#x2014; 256 GiB RAM and 16 CPUs per instance, using the &#x2018;r3.8xlarge&#x2019; instance-type. Comparison of performance across cluster sizes showed that 256 CPUs had the fastest overall time and the highest speedup relative to a single CPU for both 3D classification and refinement (<xref ref-type="fig" rid="fig2">Figure 2A &#x0026; 2B</xref>). Despite this, cluster sizes of 128 and 64 CPUs were the most cost effective for 3D classification and refinement, respectively, as these were the cluster configurations where the price per speedup increase reached a maximum (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). Importantly, the average time required to boot up these STARclusters was &#x2264; 10 minutes for all cluster sizes (<xref ref-type="fig" rid="fig2">Figure 2D</xref>) and, once booted up, the clusters do not have any associated job wait times. Therefore, these tests showed that Amazon&#x2019;s EC2 infrastructure was amenable to the analysis of single particle cryo-EM data using Relion.</p>
<fig id="fig2" position="float" orientation="portrait" fig-type="figure">
<label>Figure 2:</label>
<caption><title>Relion performance on STARcluster configurations of Amazon instances</title>
<p>(A) Processing times (minutes) for Relion to perform 3D Classification or 3D refinement on 80S ribosome dataset. (B) Speedup for each cluster size relative to a single CPU (black line) shown alongside performance estimate for a perfectly parallel cluster using Amdahl&#x2019;s Law (curve labeled &#x201C;Theoretical limit&#x201D;). For cluster sizes &#x2264; 64 CPUs, the Relion exhibits near-perfect performance on STARcluster configurations, while cluster sizes &#x003E; 64 show that Relion&#x2019;s performance reaches a maximum at 256 CPUs for both 3D classification and 3D refinement. (C) Speedup/Cost is plotted against cluster size, where Speedup/Cost is defined as the speedup observed divided by the cost associated with Amazon&#x2019;s pricing at &#x0024;0.35/hr/16 CPUs. (D) Average STARcluster boot up time (&#x002B;/- s.d.) was measured for clusters of increasing size (n &#x003D; 5).</p></caption>
<graphic xlink:href="016451_fig2.tif"/>
</fig>
<p>Further analysis of the 80S ribosome dataset on a 128 CPU cluster (8 x 16 CPUs; using the r3.8xlarge instance) highlighted the cost-effectiveness of Amazon&#x2019;s EC2 infrastructure. After 3D classification, a homogenous group of particles was refined to an overall resolution of 4.6 &#x00C5; (<xref ref-type="fig" rid="fig3">Figure 3A &#x002D; C</xref>). This structure, which involved 3D classification and refinement, required a total of &#x007E;10 hours on a 128 CPU cluster. By bidding on unused instances (&#x2018;spot instances&#x2019;), each 16 CPU instance cost &#x0024;0.35/hr instead of &#x0024;2.80/hr, saving 87.5&#x0025; per instance. At this price, the 4.6 &#x00C5; ribosome structure had an overall cost of &#x0024;28.89 (8 instances x &#x0024;0.35/hr x 10.3 hrs). Thus, even though obtaining this structure required 1,321 total CPU-hours, Amazon&#x2019;s EC2 computing infrastructure provided the resources to calculate it to near-atomic resolution within &#x007E;10 hours, with a total cost of &#x0024;28.89.</p>
<fig id="fig3" position="float" orientation="portrait" fig-type="figure">
<label>Figure 3:</label>
<caption><title>Cryo-EM structure of 80S ribosome at an overall resolution of 4.6 &#x00C5;.</title>
<p>(A) Overall view of 80S reconstruction filtered to 4.6 &#x00C5; while applying a negative B-factor of -116 &#x00C5;<sup>2</sup>. (B) Gold standard FSC curve. (C) Selected regions from the 60S subunit filtered at 4.3 &#x00C5;. Cryo-EM maps were visualized with UCSF Chimera (<xref ref-type="bibr" rid="c20">Pettersen et al., 2004</xref>).</p>
<p><bold>Source data:</bold> A detailed description of each step of the image processing is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/mcianfrocco/Cianfrocco-and-Leschziner-2014-EMCloudProcessing/wiki">https://github.com/mcianfrocco/Cianfrocco-and-Leschziner-2014-EMCloudProcessing/wiki</ext-link>. Associated computing scripts and data files have been uploaded to Github (<ext-link ext-link-type="uri" xlink:href="https://github.com/mcianfrocco/Cianfrocco-and-Leschziner-2014-EMCloudProcessing">https://github.com/mcianfrocco/Cianfrocco-and-Leschziner-2014-EMCloudProcessing</ext-link>) and Dryad Digital Repository (<ext-link ext-link-type="uri" xlink:href="http://datadryad.org/review?doi&#x003D;doi:10.5061/dryad.9mb54">http://datadryad.org/review?doi&#x003D;doi:10.5061/dryad.9mb54</ext-link>) (Cianfrocco and Leschziner), respectively.</p></caption>
<graphic xlink:href="016451_fig3.tif"/>
</fig>
</sec>
<sec id="s4">
<title>Cloud computing as a tool to facilitate high-resolution cryo-EM</title>
<p>Recent advances in single particle cryo-EM have drawn the interest of the broader scientific community. In addition to technical advances in electron optics, the new direct electron detectors and data analysis software have dramatically improved the resolutions that can be achieved for a variety of structural targets. In contrast to the other high-resolution techniques (X-ray crystallography, NMR), structure determination by cryo-EM is extremely computationally intensive. The publicly available &#x2018;EM-packages-in-the-Cloud&#x2019; environment we have presented and characterized here will help remove some of the limitations imposed by these computational requirements. Comparisons of predicted refinement costs for published structures showed that Amazon&#x2019;s cloud computing network is a powerful, cost-effective tool for analyzing cryo-EM data (<xref ref-type="table" rid="tbl1">Table 1</xref>).</p>
<p>We believe that cloud-based approaches will impact the future of cryo-EM image processing in two fronts: 1) new cryo-EM users / laboratories across the globe will have immediate access to a high performance cluster, and 2) existing labs will have a dramatic increase in productivity. As the number of laboratories using cryo-EM increases, and as existing laboratories begin to pursue high-resolution cryo-EM, gaining immediate access to a high performance cluster may become difficult. For instance, while there are government-funded high performance clusters in the United States (e.g. XSEDE STAMPEDE), it may take up to a month for a user application to be reviewed (Rogelio Hernandez-Lopez, personal communication). Assuming that the application is approved, these clusters may not have appropriate software installed, which further delays cluster usage. Finally, the user will have a set limit for the number of CPU hours available per project, requiring a new application to be submitted to access the cluster again. All of these problems are circumvented by using Amazon&#x2019;s EC2 infrastructure, which provides immediate, cost-effective access to hundreds of CPUs for users around the globe.</p>
<p>While many research laboratories have previously bought and maintained private clusters (200 &#x2013; 500 CPUs), we believe that Amazon&#x2019;s EC2 infrastructure will provide more processing per lab member at reduced costs. The price of a high performance private cluster with 320 CPUs costs &#x007E;&#x0024;50,000, which does not include costs associated with housing and maintaining the cluster. Even after setting up the private cluster, it will likely be shared across a laboratory of 5 &#x2013; 10 people, reducing the effective number of CPUs available per lab member. Therefore, considering the price of using Amazon&#x2019;s EC2 infrastructure, laboratories will be able to have 300&#x002B; CPUs per lab member for much less than it would cost to buy and maintain a private cluster.</p>
<p>By minimizing computational time and increasing global accessibility, high-performance cloud computing can help usher in the era when high-resolution cryo-EM becomes a routine structural biology tool.</p>
</sec>
<sec id="s5">
<title>Materials and Methods</title>
<sec id="s5a">
<title>Setting up a cluster on Amazon EC2 with spot instances</title>
<p>In order to minimize costs, STARclusters were assembled from &#x2018;spot instances,&#x2019; which are unused instances that are open to a bidding process in order to be reserved. The spot instances are different from &#x2018;on-demand&#x2019; instances: on-demand instances provide users with guaranteed access while spot instances are reserved until there is a higher bid, at which point the user is logged out of the spot instance. For example, while the on-demand rate for r3.8xlarge instances is &#x0024;2.80/hr, the minimum bidding price for a spot instance of r3.8xlarge is &#x0024;0.25/hr. This means that a user could reserve a spot instance for as little &#x0024;0.25/hr, as long as no other users bid &#x003E;&#x0024;0.25/hr.</p>
<p>Throughout our experience on Amazon&#x2019;s EC2 (2 months), we found that the average spot instance price for r3.8xlarge was &#x0024;0.25 - &#x0024;0.28/hr. This meant that bidding &#x0024;0.28 - &#x0024;0.30/hr provided near-guaranteed access to the spot instances in the US East Region (N. Virginia), where we have only been kicked off the instances twice. A protocol describing the necessary steps to set up a cluster has been detailed on an accompanying website: <ext-link ext-link-type="uri" xlink:href="http://goo.gl/AIwZJz">http://goo.gl/AIwZJz</ext-link>.</p>
</sec>
<sec id="s5b">
<title>CPUs vs. vCPUs</title>
<p>In selecting an instance type, new users should be aware of the differences between CPUs and vCPUs on Amazon&#x2019;s EC2 network. Namely, that there are two vCPUs per physical CPU on Amazon. This means that while r3.8xlarge instances have 32 vCPUs, there are actually only 16 physical CPU cores in each instance, with each CPU having two hyperthreads. Practically, this means that Amazon&#x2019;s instances have higher performance than a 16 CPU machine and less performance than a 32 CPU machine. To account for this difference, all numbers reported here were CPU numbers that were converted from vCPUs.</p>
</sec>
<sec id="s5c">
<title>Image processing</title>
<p>Micrographs from the 80S <italic>Saccharomyces cerevisiae</italic> ribosome dataset (<xref ref-type="bibr" rid="c3">Bai et al., 2013</xref>) were downloaded from the EMPIAR database for electron microscopy data (EMPIAR 10002). The SWARM feature of EMAN2 (<xref ref-type="bibr" rid="c25">Tang et al., 2007</xref>) was used to pick particles semi-automatically. Micrograph defocus was estimated using CTFFIND3 (<xref ref-type="bibr" rid="c18">Mindell and Grigorieff, 2003</xref>). The resulting particle coordinates and defocus information were used for particle extraction by Relion-v1.3 (<xref ref-type="bibr" rid="c21">Scheres, 2012</xref>, <xref ref-type="bibr" rid="c22">2014</xref>). The particle stacks and associated data files were then uploaded to an elastic block storage volume on Amazon&#x2019;s EC2 processing environment at a speed of 10 MB/sec (24 minutes total upload time).</p>
<p>Initial 3D classification was performed on 62,022 80S Ribosome particles (1.77 &#x00C5;/pixel). These were classified into 4 groups (T&#x003D;4) for 13 iterations using a ribosome map downloaded from the Electron Microscopy Data Bank (EMDB-1780) that was low pass filtered to 60 &#x00C5;. Further 3D classification using a local search of 10&#x00B0; and an angular sampling of 1.8&#x00B0; continued for 13 iterations. At this point, two classes were identified as belonging to the same structural state and were selected for high-resolution refinement (32,533 particles). Refinement of these selected particles continued for 31 iterations using <italic>3D auto-refine</italic> in Relion. The final resolution was determined to be 4.6 &#x00C5; using <italic>Post process</italic> in Relion, applying a mask to the merged half volumes and a negative B-factor of &#x002D;116 &#x00C5;<sup>2</sup>.</p>
</sec>
<sec id="s5d">
<title>Performance Analysis</title>
<p>80S ribosome data were reanalyzed on clusters of increasing size using both 3D classification and 3D refinement. The time points collected involved running 3D classification for 2 rounds and 3D refinement for 6 rounds, using the same number of particles and box sizes listed above: 62,022 particles for classification and 32,533 particles for refinement with box sizes of 240 &#x0078; 240 pixels. The Relion commands were identical to the commands used above and the calculations were terminated after the specified iteration.</p>
<p>From these time points, the speedup of each cluster size was calculated relative to a single CPU. Speedup (<italic>S</italic>) was calculated as
<disp-formula>
<alternatives><graphic xlink:href="016451_ueqn1.gif"/>
</alternatives>
</disp-formula></p>
<p>The measured speedup values were then compared to the speedup expected for a perfectly parallel algorithm (<italic><bold>P</bold></italic> &#x003D; 1) using Amdahl&#x2019;s law (<xref ref-type="bibr" rid="c1">Amdahl, 1967</xref>):
<disp-formula>
<alternatives><graphic xlink:href="016451_ueqn2.gif"/>
</alternatives>
</disp-formula></p>
<p>Where <italic><bold>P</bold></italic> is the fraction of an algorithm that is parallel and <italic>n</italic> is the number of processors. The calculation time for 3D classification on a single CPU were calculated by using 1 CPU on a 16 CPU r3.8xlarge instance. For calculating a 3D refinement on a single CPU, (or two vCPUs), the refinement was run on 4 vCPUs and then converted to a single CPU (or two vCPUs) by multiplying the calculation time by 2. For cost analysis, the measured speedup was divided by the cost to run the job on spot instances of r3.8xlarge at a price of &#x0024;0.35/hr. Cluster boot up times were calculated from the elapsed time between submitting the STARcluster command and the STARcluster fully booting up.</p>
</sec>
</sec>
<sec id="s6">
<title>Data Accession Information</title>
<p>Further information regarding &#x2018;EM-Packages-in-the-Cloud&#x2019; can be found at an associated Google Site: <ext-link ext-link-type="uri" xlink:href="http://goo.gl/AIwZJz">http://goo.gl/AIwZJz</ext-link>. The final 80S yeast ribosome structure at 4.6 &#x00C5; has been submitted to the EM Databank as EMDB 2858. A detailed description of each step of the image processing is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/mcianfrocco/Cianfrocco-and-Leschziner-2014-EMCloudProcessing/wiki">https://github.com/mcianfrocco/Cianfrocco-and-Leschziner-2014-EMCloudProcessing/wiki</ext-link>. Associated computing scripts and data files have been uploaded to Github (<ext-link ext-link-type="uri" xlink:href="https://github.com/mcianfrocco/Cianfrocco-and-Leschziner-2014-EMCloudProcessing">https://github.com/mcianfrocco/Cianfrocco-and-Leschziner-2014-EMCloudProcessing</ext-link>) and Dryad Digital Repository (<ext-link ext-link-type="uri" xlink:href="http://datadryad.org/review?doi&#x003D;doi:10.5061/dryad.9mb54">http://datadryad.org/review?doi&#x003D;doi:10.5061/dryad.9mb54</ext-link>) (Cianfrocco and Leschziner), respectively.</p>
</sec>
</body>
<back>
<ack>
<title>Acknowledgements</title>
<p>We would like to thank all the members of the Leschziner and Reck-Peterson labs for critical discussions. We would like to especially thank Rogelio Hernandez-Lopez, Anthony Roberts, and Daniel Cianfrocco for critical feedback on the development of this Amazon computing environment. We also would like to thank the Structural Biology Consortium (SBGrid) for pricing information on cluster and file server sizes. M.A.C. is an HHMI fellow of the Damon Runyon Cancer Research Foundation and A.E.L is supported by NIH/NIGMS (R01 GM107214 and R01 GM092895A).</p>
<sec id="s7">
<title>Competing financial interests statement</title>
<p>The authors do not have any competing financial interests.</p>
</sec>
</ack>
<ref-list>
<title>References</title>
<ref id="c1"><mixed-citation publication-type="confproc"><string-name><surname>Amdahl</surname>, <given-names>G.M.</given-names></string-name> (<year>1967</year>). <article-title>Validity of the single processor approach to achieving large scale computing capabilities</article-title>. In <conf-name>Proceedings of the April 18-20, 1967, spring joint computer conference (Atlantic City, New Jersey: ACM)</conf-name>, pp. <fpage>483</fpage>&#x2013;<lpage>485</lpage>.</mixed-citation></ref>
<ref id="c2"><mixed-citation publication-type="journal"><string-name><surname>Amunts</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Brown</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Bai</surname>, <given-names>X.C.</given-names></string-name>, <string-name><surname>Llacer</surname>, <given-names>J.L.</given-names></string-name>, <string-name><surname>Hussain</surname>, <given-names>T.</given-names></string-name>, <string-name><surname>Emsley</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Long</surname>, <given-names>F.</given-names></string-name>, <string-name><surname>Murshudov</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name>, and <string-name><surname>Ramakrishnan</surname>, <given-names>V.</given-names></string-name> (<year>2014</year>). <article-title>Structure of the yeast mitochondrial large ribosomal subunit</article-title>. <source>Science (New York, NY)</source> <volume>343</volume>, <fpage>1485</fpage>&#x2013;<lpage>1489</lpage>.</mixed-citation></ref>
<ref id="c3"><mixed-citation publication-type="journal"><string-name><surname>Bai</surname>, <given-names>X.C.</given-names></string-name>, <string-name><surname>Fernandez</surname>, <given-names>I.S.</given-names></string-name>, <string-name><surname>McMullan</surname>, <given-names>G.</given-names></string-name>, and <string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name> (<year>2013</year>). <article-title>Ribosome structures to near-atomic resolution from thirty thousand cryo-EM particles</article-title>. <source>eLife</source> <volume>2</volume>, <fpage>e00461</fpage>.</mixed-citation></ref>
<ref id="c4"><mixed-citation publication-type="journal"><string-name><surname>Bai</surname>, <given-names>X.C.</given-names></string-name>, <string-name><surname>McMullan</surname>, <given-names>G.</given-names></string-name>, and <string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name> (<year>2015</year>). <article-title>How cryo-EM is revolutionizing structural biology</article-title>. <source>Trends in biochemical sciences</source> <volume>40</volume>, <fpage>49</fpage>&#x2013;<lpage>57</lpage>.</mixed-citation></ref>
<ref id="c5"><mixed-citation publication-type="journal"><string-name><surname>Campbell</surname>, <given-names>M.G.</given-names></string-name>, <string-name><surname>Cheng</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Brilot</surname>, <given-names>A.F.</given-names></string-name>, <string-name><surname>Moeller</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Lyumkis</surname>, <given-names>D.</given-names></string-name>, <string-name><surname>Veesler</surname>, <given-names>D.</given-names></string-name>, <string-name><surname>Pan</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Harrison</surname>, <given-names>S.C.</given-names></string-name>, <string-name><surname>Potter</surname>, <given-names>C.S.</given-names></string-name>, <string-name><surname>Carragher</surname>, <given-names>B.</given-names></string-name>, <etal>et al.</etal> (<year>2012</year>). <article-title>Movies of ice-embedded particles enhance resolution in electron cryo-microscopy</article-title>. <source>Structure (London, England: 1993)</source> <volume>20</volume>, <fpage>1823</fpage>&#x2013;<lpage>1828</lpage>.</mixed-citation></ref>
<ref id="c6"><mixed-citation publication-type="journal"><string-name><surname>Cianfrocco</surname>, <given-names>M.A.</given-names></string-name>, and <string-name><surname>Leschziner</surname>, <given-names>A.E.</given-names></string-name> <article-title>Data from: Single particle cryo-electron microscopy image processing in the cloud: High performance at low cost (Dryad Data Repository)</article-title>.</mixed-citation></ref>
<ref id="c7"><mixed-citation publication-type="journal"><string-name><surname>Frank</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Radermacher</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Penczek</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Zhu</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Li</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Ladjadj</surname>, <given-names>M.</given-names></string-name>, and <string-name><surname>Leith</surname>, <given-names>A.</given-names></string-name> (<year>1996</year>). <article-title>SPIDER and WEB: processing and visualization of images in 3D electron microscopy and related fields</article-title>. <source>Journal of structural biology</source> <volume>116</volume>, <fpage>190</fpage>&#x2013;<lpage>199</lpage>.</mixed-citation></ref>
<ref id="c8"><mixed-citation publication-type="journal"><string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2007</year>). <article-title>FREALIGN: high-resolution refinement of single particle structures</article-title>. <source>Journal of structural biology</source> <volume>157</volume>, <fpage>117</fpage>&#x2013;<lpage>125</lpage>.</mixed-citation></ref>
<ref id="c9"><mixed-citation publication-type="journal"><string-name><surname>Hohn</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Tang</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Goodyear</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Baldwin</surname>, <given-names>P.R.</given-names></string-name>, <string-name><surname>Huang</surname>, <given-names>Z.</given-names></string-name>, <string-name><surname>Penczek</surname>, <given-names>P.A.</given-names></string-name>, <string-name><surname>Yang</surname>, <given-names>C.</given-names></string-name>, <string-name><surname>Glaeser</surname>, <given-names>R.M.</given-names></string-name>, <string-name><surname>Adams</surname>, <given-names>P.D.</given-names></string-name>, and <string-name><surname>Ludtke</surname>, <given-names>S.J.</given-names></string-name> (<year>2007</year>). <article-title>SPARX, a new environment for Cryo-EM image processing</article-title>. <source>Journal of structural biology</source> <volume>157</volume>, <fpage>47</fpage>&#x2013;<lpage>55</lpage>.</mixed-citation></ref>
<ref id="c10"><mixed-citation publication-type="journal"><string-name><surname>Hu</surname>, <given-names>Y.S.</given-names></string-name>, <string-name><surname>Nan</surname>, <given-names>X.</given-names></string-name>, <string-name><surname>Sengupta</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Lippincott-Schwartz</surname>, <given-names>J.</given-names></string-name>, and <string-name><surname>Cang</surname>, <given-names>H.</given-names></string-name> (<year>2013</year>). <article-title>Accelerating 3B single-molecule super-resolution microscopy with cloud computing</article-title>. <source>Nature methods</source> <volume>10</volume>, <fpage>96</fpage>&#x2013;<lpage>97</lpage>.</mixed-citation></ref>
<ref id="c11"><mixed-citation publication-type="confproc"><string-name><surname>Ivica</surname>, <given-names>C.</given-names></string-name>, <string-name><surname>Riley</surname>, <given-names>J.T.</given-names></string-name>, and <string-name><surname>Shubert</surname>, <given-names>C.</given-names></string-name> (<year>2009</year>). <article-title>StarHPC - Teaching parallel programming within elastic compute cloud</article-title>. <conf-name>Paper presented at: Information Technology Interfaces, 2009 ITI &#x2019;09 Proceedings of the ITI 2009 31st International Conference on</conf-name>.</mixed-citation></ref>
<ref id="c12"><mixed-citation publication-type="journal"><string-name><surname>Krampis</surname>, <given-names>K.</given-names></string-name>, <string-name><surname>Booth</surname>, <given-names>T.</given-names></string-name>, <string-name><surname>Chapman</surname>, <given-names>B.</given-names></string-name>, <string-name><surname>Tiwari</surname>, <given-names>B.</given-names></string-name>, <string-name><surname>Bicak</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Field</surname>, <given-names>D.</given-names></string-name>, and <string-name><surname>Nelson</surname>, <given-names>K.E.</given-names></string-name> (<year>2012</year>). <article-title>Cloud BioLinux: pre-configured and on-demand bioinformatics computing for the genomics community</article-title>. <source>BMC bioinformatics</source> <volume>13</volume>, <fpage>42</fpage>.</mixed-citation></ref>
<ref id="c13"><mixed-citation publication-type="journal"><string-name><surname>Kuhlbrandt</surname>, <given-names>W.</given-names></string-name> (<year>2014</year>). <article-title>Cryo-EM enters a new era</article-title>. <source>eLife</source> <volume>3</volume>, <fpage>e03678</fpage>.</mixed-citation></ref>
<ref id="c14"><mixed-citation publication-type="journal"><string-name><surname>Li</surname>, <given-names>X.</given-names></string-name>, <string-name><surname>Mooney</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Zheng</surname>, <given-names>S.</given-names></string-name>, <string-name><surname>Booth</surname>, <given-names>C.R.</given-names></string-name>, <string-name><surname>Braunfeld</surname>, <given-names>M.B.</given-names></string-name>, <string-name><surname>Gubbens</surname>, <given-names>S.</given-names></string-name>, <string-name><surname>Agard</surname>, <given-names>D.A.</given-names></string-name>, and <string-name><surname>Cheng</surname>, <given-names>Y.</given-names></string-name> (<year>2013</year>). <article-title>Electron counting and beam-induced motion correction enable near-atomic-resolution single-particle cryo-EM</article-title>. <source>Nature methods</source> <volume>10</volume>, <fpage>584</fpage>&#x2013;<lpage>590</lpage>.</mixed-citation></ref>
<ref id="c15"><mixed-citation publication-type="journal"><string-name><surname>Lu</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Bai</surname>, <given-names>X.C.</given-names></string-name>, <string-name><surname>Ma</surname>, <given-names>D.</given-names></string-name>, <string-name><surname>Xie</surname>, <given-names>T.</given-names></string-name>, <string-name><surname>Yan</surname>, <given-names>C.</given-names></string-name>, <string-name><surname>Sun</surname>, <given-names>L.</given-names></string-name>, <string-name><surname>Yang</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Zhao</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Zhou</surname>, <given-names>R.</given-names></string-name>, <string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name>, <etal>et al.</etal> (<year>2014</year>). <article-title>Three-dimensional structure of human gamma-secretase</article-title>. <source>Nature</source> <volume>512</volume>, <fpage>166</fpage>&#x2013;<lpage>170</lpage>.</mixed-citation></ref>
<ref id="c16"><mixed-citation publication-type="journal"><string-name><surname>Ludtke</surname>, <given-names>S.J.</given-names></string-name>, <string-name><surname>Baldwin</surname>, <given-names>P.R.</given-names></string-name>, and <string-name><surname>Chiu</surname>, <given-names>W.</given-names></string-name> (<year>1999</year>). <article-title>EMAN: semiautomated software for high-resolution single-particle reconstructions</article-title>. <source>Journal of structural biology</source> <volume>128</volume>, <fpage>82</fpage>&#x2013;<lpage>97</lpage>.</mixed-citation></ref>
<ref id="c17"><mixed-citation publication-type="journal"><string-name><surname>McMullan</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Faruqi</surname>, <given-names>A.R.</given-names></string-name>, <string-name><surname>Henderson</surname>, <given-names>R.</given-names></string-name>, <string-name><surname>Guerrini</surname>, <given-names>N.</given-names></string-name>, <string-name><surname>Turchetta</surname>, <given-names>R.</given-names></string-name>, <string-name><surname>Jacobs</surname>, <given-names>A.</given-names></string-name>, and <string-name><surname>van Hoften</surname>, <given-names>G.</given-names></string-name> (<year>2009</year>). <article-title>Experimental observation of the improvement in MTF from backthinning a CMOS direct electron detector</article-title>. <source>Ultramicroscopy</source> <volume>109</volume>, <fpage>1144</fpage>&#x2013;<lpage>1147</lpage>.</mixed-citation></ref>
<ref id="c18"><mixed-citation publication-type="journal"><string-name><surname>Mindell</surname>, <given-names>J.A.</given-names></string-name>, and <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2003</year>). <article-title>Accurate determination of local defocus and specimen tilt in electron microscopy</article-title>. <source>Journal of structural biology</source> <volume>142</volume>, <fpage>334</fpage>&#x2013;<lpage>347</lpage>.</mixed-citation></ref>
<ref id="c19"><mixed-citation publication-type="journal"><string-name><surname>Mohammed</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Mostovenko</surname>, <given-names>E.</given-names></string-name>, <string-name><surname>Henneman</surname>, <given-names>A.A.</given-names></string-name>, <string-name><surname>Marissen</surname>, <given-names>R.J.</given-names></string-name>, <string-name><surname>Deelder</surname>, <given-names>A.M.</given-names></string-name>, and <string-name><surname>Palmblad</surname>, <given-names>M.</given-names></string-name> (<year>2012</year>). <article-title>Cloud parallel processing of tandem mass spectrometry based proteomics data</article-title>. <source>Journal of proteome research</source> <volume>11</volume>, <fpage>5101</fpage>&#x2013;<lpage>5108</lpage>.</mixed-citation></ref>
<ref id="c20"><mixed-citation publication-type="journal"><string-name><surname>Pettersen</surname>, <given-names>E.F.</given-names></string-name>, <string-name><surname>Goddard</surname>, <given-names>T.D.</given-names></string-name>, <string-name><surname>Huang</surname>, <given-names>C.C.</given-names></string-name>, <string-name><surname>Couch</surname>, <given-names>G.S.</given-names></string-name>, <string-name><surname>Greenblatt</surname>, <given-names>D.M.</given-names></string-name>, <string-name><surname>Meng</surname>, <given-names>E.C.</given-names></string-name>, and <string-name><surname>Ferrin</surname>, <given-names>T.E.</given-names></string-name> (<year>2004</year>). <article-title>UCSF Chimera--a visualization system for exploratory research and analysis</article-title>. <source>Journal of computational chemistry</source> <volume>25</volume>, <fpage>1605</fpage>&#x2013;<lpage>1612</lpage>.</mixed-citation></ref>
<ref id="c21"><mixed-citation publication-type="journal"><string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name> (<year>2012</year>). <article-title>RELION: implementation of a Bayesian approach to cryo-EM structure determination</article-title>. <source>Journal of structural biology</source> <volume>180</volume>, <fpage>519</fpage>&#x2013;<lpage>530</lpage>.</mixed-citation></ref>
<ref id="c22"><mixed-citation publication-type="journal"><string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name> (<year>2014</year>). <article-title>Beam-induced motion correction for sub-megadalton cryo-EM particles</article-title>. <source>eLife</source> <volume>3</volume>, <fpage>e03665</fpage>.</mixed-citation></ref>
<ref id="c23"><mixed-citation publication-type="journal"><string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name>, and <string-name><surname>Chen</surname>, <given-names>S.</given-names></string-name> (<year>2012</year>). <article-title>Prevention of overfitting in cryo-EM structure determination</article-title>. <source>Nature methods</source> <volume>9</volume>, <fpage>853</fpage>&#x2013;<lpage>854</lpage>.</mixed-citation></ref>
<ref id="c24"><mixed-citation publication-type="journal"><string-name><surname>Sorzano</surname>, <given-names>C.O.</given-names></string-name>, <string-name><surname>Marabini</surname>, <given-names>R.</given-names></string-name>, <string-name><surname>Velazquez-Muriel</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Bilbao-Castro</surname>, <given-names>J.R.</given-names></string-name>, <string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name>, <string-name><surname>Carazo</surname>, <given-names>J.M.</given-names></string-name>, and <string-name><surname>Pascual-Montano</surname>, <given-names>A.</given-names></string-name> (<year>2004</year>). <article-title>XMIPP: a new generation of an open-source image processing package for electron microscopy</article-title>. <source>Journal of structural biology</source> <volume>148</volume>, <fpage>194</fpage>&#x2013;<lpage>204</lpage>.</mixed-citation></ref>
<ref id="c25"><mixed-citation publication-type="journal"><string-name><surname>Tang</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Peng</surname>, <given-names>L.</given-names></string-name>, <string-name><surname>Baldwin</surname>, <given-names>P.R.</given-names></string-name>, <string-name><surname>Mann</surname>, <given-names>D.S.</given-names></string-name>, <string-name><surname>Jiang</surname>, <given-names>W.</given-names></string-name>, <string-name><surname>Rees</surname>, <given-names>I.</given-names></string-name>, and <string-name><surname>Ludtke</surname>, <given-names>S.J.</given-names></string-name> (<year>2007</year>). <article-title>EMAN2: an extensible image processing suite for electron microscopy</article-title>. <source>Journal of structural biology</source> <volume>157</volume>, <fpage>38</fpage>&#x2013;<lpage>46</lpage>.</mixed-citation></ref>
<ref id="c26"><mixed-citation publication-type="journal"><string-name><surname>Trudgian</surname>, <given-names>D.C.</given-names></string-name>, and <string-name><surname>Mirzaei</surname>, <given-names>H.</given-names></string-name> (<year>2012</year>). <article-title>Cloud CPFP: a shotgun proteomics data analysis pipeline using cloud and high performance computing</article-title>. <source>Journal of proteome research</source> <volume>11</volume>, <fpage>6282</fpage>&#x2013;<lpage>6290</lpage>.</mixed-citation></ref>
<ref id="c27"><mixed-citation publication-type="journal"><string-name><surname>Yazar</surname>, <given-names>S.</given-names></string-name>, <string-name><surname>Gooden</surname>, <given-names>G.E.</given-names></string-name>, <string-name><surname>Mackey</surname>, <given-names>D.A.</given-names></string-name>, and <string-name><surname>Hewitt</surname>, <given-names>A.W.</given-names></string-name> (<year>2014</year>). <article-title>Benchmarking undedicated cloud computing providers for analysis of genomic datasets</article-title>. <source>PloS one</source> <volume>9</volume>, <fpage>e108490</fpage>.</mixed-citation></ref>
</ref-list>
</back>
</article>