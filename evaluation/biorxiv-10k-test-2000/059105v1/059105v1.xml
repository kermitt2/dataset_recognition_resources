<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">BIORXIV</journal-id>
<journal-title-group>
<journal-title>bioRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/059105</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="author-type">
<subject>Regular Article</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>New Results</subject>
</subj-group>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Evolutionary Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Bayesian inference of ancestral recombination graphs for bacterial populations</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<name><surname>Vaughan</surname><given-names>Timothy G.</given-names></name>
<xref ref-type="aff" rid="a1">&#x002A;</xref>
<xref ref-type="corresp" rid="cor1">1</xref>
</contrib>
<contrib contrib-type="author">
<name><surname>Welch</surname><given-names>David</given-names></name>
<xref ref-type="aff" rid="a1">&#x002A;</xref>
</contrib>
<contrib contrib-type="author">
<name><surname>Drummond</surname><given-names>Alexei J.</given-names></name>
<xref ref-type="aff" rid="a1">&#x002A;</xref>
</contrib>
<contrib contrib-type="author">
<name><surname>Biggs</surname><given-names>Patrick J.</given-names></name>
<xref ref-type="aff" rid="a2">&#x00A7;</xref>
</contrib>
<contrib contrib-type="author">
<name><surname>George</surname><given-names>Tessy</given-names></name>
<xref ref-type="aff" rid="a2">&#x00A7;</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<name><surname>French</surname><given-names>Nigel P.</given-names></name>
<xref ref-type="aff" rid="a2">&#x00A7;</xref>
</contrib>
<aff id="a1"><label>&#x002A;</label><institution>Centre for Computational Evolution and Department of Computer Science, University of Auckland</institution>, Auckland, <country>New Zealand</country>,</aff>
<aff id="a2"><label>&#x00A7;</label><institution>mEpiLab, Infectious Disease Research Centre, Hopkirk Research Institute, Massey University</institution>, Palmerston North, <country>New Zealand</country></aff>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>1</label><email>tgvaughan@gmail.com</email></corresp>
</author-notes>
<pub-date pub-type="epub"><year>2016</year></pub-date>
<elocation-id>059105</elocation-id>
<history>
<date date-type="received">
<day>14</day>
<month>6</month>
<year>2016</year>
</date>
<date date-type="accepted">
<day>15</day>
<month>6</month>
<year>2016</year>
</date>
</history>
<permissions>
<copyright-statement>&#x00A9; 2016, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2016</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="059105.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract>
<title>Abstract</title>
<p>Homologous recombination is a central feature of bacterial evolution, yet confounds traditional phylogenetic methods. While a number of methods specific to bacterial evolution have been developed, none of these permit joint inference of a bacterial recombination graph and associated parameters. In this paper, we present a new method which addresses this shortcoming. Our method uses a novel Markov chain Monte Carlo algorithm to perform phylogenetic inference under the ClonalOrigin model of <xref rid="c8" ref-type="bibr">Didelot et al. (Genetics, 2010)</xref>. We demonstrate the utility of our method by applying it to rMLST data sequenced from pathogenic and non-pathogenic <italic>Escherichia coli</italic> serotype O157 and O26 isolates collected in rural New Zealand. The method is implemented as an open source BEAST 2 package, Bacter, which is available via the project web page at <ext-link ext-link-type="uri" xlink:href="http://tgvaughan.github.io/bacter">tgvaughan.github.io/bacter</ext-link></p></abstract>
<kwd-group kwd-group-type="author">
<title>KEYWORDS</title>
<kwd>bacterial evolution</kwd>
<kwd>recombination</kwd>
<kwd>phylogenetic inference</kwd>
</kwd-group>
<counts>
<page-count count="11"/>
</counts>
</article-meta>
</front>
<body>
<p>RECOMBINATION plays a crucial role in the molecular evolution of many bacteria, in spite of the clonal nature of bacterial reproduction. Indeed, for a large number of species surveyed in recent studies (<xref rid="c24" ref-type="bibr">Vos and Didelot 2009</xref>; <xref ref-type="bibr" rid="c11">Fearnhead <italic>et al.</italic> 2015</xref>), homologous recombination was found to account for a similar or greater number of nucleotide changes than point mutation.</p>
<p>Yet many traditional phylogenetic methods (<xref ref-type="bibr" rid="c18">Huelsenbeck and Ronquist 2001</xref>; <xref rid="c10" ref-type="bibr">Drummond et <italic>al.</italic> 2002</xref>; <xref rid="c14" ref-type="bibr">Guindon and Gas-cuel 2003</xref>) do not account for recombination. This is regrettable for several reasons. First, ignoring recombination is known to bias phylogenetic analyses in various ways such as by overestimating the number of mutations along branches, artificially degrading the molecular clock hypothesis, and introducing apparent exponential population growth (<xref ref-type="bibr" rid="c23">Schierup and Hein 2000</xref>). Second, much of modern computational phylogenetics extends beyond the inference of phylogenetic relationships and instead focuses on the parametric and non-parametric inference of the dynamics governing the population from which the genetic data is sampled. In this context, the phylogeny is merely the glue that ties the data to the underlying population dynamics. Recombination events contain a strong phylogenetic signal so incorporating recombination into the phylogenetic model can significantly improve analyses. For instance, <xref ref-type="bibr" rid="c22">Li and Durbin (2011)</xref> used a recombination-aware model to recover detailed ancestral population dynamics from pairs of human autosomes, a feat which would have been impossible without the additional signal provided by the recombination process.</p>
<p>The standard representation of the phylogenetic relationship between ancestral lineages when recombination is present is the Ancestral Recombination Graph (ARG <xref ref-type="bibr" rid="c13">Griffiths 1981;</xref> <xref ref-type="bibr" rid="c17">Hudson 1983</xref>), a timed phylogenetic network describing the reticulated ancestry of a set of sampled taxa. Several inference methods based on the ARG concept have been developed, many of which (<xref ref-type="bibr" rid="c25">Wang and Rannala 2008</xref>; <xref ref-type="bibr" rid="c3">Bloomquist and Suchard 2010</xref>; <xref ref-type="bibr" rid="c22">Li and Durbin 2011</xref>) assume a symmetry between the contributions of genetic material from the parent individuals contributing to each recombination event, as is the expected result of the crossover resolution of the Holliday junction in eukaryotic recombination. This assumption, which is often anchored in the choice to base the inference on the coalescent with recombination (<xref ref-type="bibr" rid="c27">Wiuf and Hein 1999</xref>), is not generally appropriate for bacterial recombination, where there is usually a strong asymmetry between the quantity of genetic material contributed from each &#x2018;parent&#x2019;.</p>
<p>Alternatively, a series of methods introduced by Didelot and coauthors (<xref ref-type="bibr" rid="c7">Didelot and Falush 2007</xref>; <xref rid="c8" ref-type="bibr">Didelot et <italic>al.</italic> 2010</xref>; <xref ref-type="bibr" rid="c9">Didelot and Wilson 2015</xref>) directly target bacterial recombination by employing models based on the coalescent with gene conversion (<xref ref-type="bibr" rid="c17">Hudson 1983</xref>; <xref ref-type="bibr" rid="c26">Wiuf 2000</xref>; <xref rid="c28" ref-type="bibr">Wiuf and Hein 2000</xref>). These models acknowledge that the asymmetry present in the bacterial context allows for the definition of a precisely defined clonal genealogy-the <italic>clonal frame</italic>-which represents not only the true reproductive genealogy of a given set of bacterial samples, but also the ancestry of the majority of their genetic material.</p>
<p>In the first paper, <xref ref-type="bibr" rid="c7">Didelot and Falush (2007)</xref> presented a method for performing inference under a model of molecular evolution which, in combination with a standard substitution model, includes effects similar to those resulting from gene conversion; instantaneous events which simultaneously produce character state changes at multiple sites within a randomly positioned conversion tract. This model does not consider the origin of these changes: it dispenses entirely with the ARG and can be considered a rather peculiar substitution model applied to evolution of sequences down the clonal frame. Despite this, it does allow the MCMC algorithm implemented in the associated Clon-alFrame software package to jointly infer the bacterial clonal frame, conversion rate and tract length parameters, neatly avoiding the branch length bias described by <xref ref-type="bibr" rid="c23">Schierup and Hein (2000)</xref>. <xref ref-type="bibr" rid="c9">Didelot and Wilson (2015)</xref> introduced a maximum likelihood method for performing inference under the same model, making it possible to infer clonal frames from whole bacterial genomes as opposed to the short seqeunces that the earlier Bayesian method could handle.</p>
<p>In a second paper, <xref ref-type="bibr" rid="c8">Didelot <italic>et al.</italic> (2010)</xref> present a different approximation to the coalescent with gene conversion which retains the ARG but assumes that the ARG has the form of a tree-based network (<xref ref-type="bibr" rid="c29">Zhang 2015</xref>) with the clonal frame taking on the role of the base tree. While acknowledging that their model could be applied to jointly infer the clonal frame and the conversions, the algorithm they present is limited to performing inference of the gene conversion ARG given a separately-inferred clonal frame. This choice permitted the application of their model to relatively large genomic data sets.</p>
<p>This model was also used recently by <xref ref-type="bibr" rid="c1">Ansari and Didelot (2014)</xref>, who exploit the Markov property of the model with regard to the active conversions at each site along an aligned set of sequences to enable rapid simulation under the model. These simulations were used in an approximate Bayesian computation scheme (<xref ref-type="bibr" rid="c2">Beaumont <italic>et al.</italic> 2002</xref>) to infer the homologous recombination rate, tract lengths and scaled mutation rate from full genome data, as well as to assess the degree to which the recombination process favours DNA from donors closely related to the recipient. As with the earlier study, this method requires that the clonal frame be separately inferred.</p>
<p>In this paper we present a Bayesian method for jointly reconstructing the ARG, the homologous conversion events, the expected conversion rate and tract lengths and the population history from genetic sequence data. Our approach assumes the ClonalOrigin model of <xref ref-type="bibr" rid="c8">Didelot <italic>et al.</italic> (2010)</xref>, extended to allow for the piecewise constant or piecewise linear variations in population size. It relies upon a novel Markov Chain Monte Carlo (MCMC) algorithm which uses a carefully designed set of proposal distributions in order to make traversing the vast state space of the model tractable for practical applications. Unlike earlier methods, our algorithm jointly infers the clonal frame, meaning that the inference is a single-step process.</p>
<p>In addition to the inference method itself, we present a basic technique for summarising the sampled ARG posterior. Our approach is an extension of the Maximum Clade Credibility tree approach (as described by <xref ref-type="bibr" rid="c16">Heled and Bouckaert 2013</xref>) to summarising phylogenetic tree posteriors in which a summary of the clonal frame is annotated with well-supported conversion events.</p>
<p>We demonstrate that our method can accurately infer known parameters from simulated data and apply it to a set of <italic>Escherichia coli</italic> rMLST (ribosomal multi-locus sequence typing, <xref ref-type="bibr" rid="c19">Jolley <italic>et al.</italic> 2012</xref>) sequences derived from isolates collected from in and around the Manawatu region in New Zealand. The method reveals details of previously unobserved gene flow between pathogenic and non-pathogenic populations belonging to the serotype O157.</p>
<p>A software implementation of our method is distributed as a publicly-available BEAST 2 (<xref ref-type="bibr" rid="c4">Bouckaert <italic>et al.</italic> 2014</xref>) package. This gives the sampler a substantial amount of flexibility, allowing it to be used in combination with complex substitution models and a wide variety of prior distributions. Details on how to obtain and use this package are given on the project website at <ext-link ext-link-type="uri" xlink:href="http://tgvaughan.github.io/bacter">tgvaughan.github.io/bacter</ext-link></p>
<sec id="s1">
<title>The ClonalOrigin genealogical model</title>
<p>In contrast to eukaryotes where recombination primarily occurs during meiosis, bacteria generally undergo recombination due to mechanisms that are not directly related to the process of genome replication. These mechanisms generally only result in the transfer of small fragments of genetic material. A result of this is that every homologous recombination event in bacteria is comparable to a gene conversion event, regardless of the underlying molecular biology. A good model for the genealogy of bacterial genomes is therefore the coalescent with gene conversion: a straight-forward extension to the Kingman <italic>n</italic>-coalescent (<xref rid="c20" ref-type="bibr">Kingman 1982a</xref>,<xref rid="c21" ref-type="bibr">b</xref>) in which (a) lineages may bifurcate as well as coalesce and (b) lineages are associated with a subset of sites on each of the sampled genetic sequences to which they are ancestral. At each bifurcation event, a contiguous range of sites is chosen for &#x201C;conversion&#x201D; by selecting a starting site uniformly at random and a tract length from a geometric distribution. The ancestry of the converted sites follows one parental lineage, while that of the unconverted sites follows the other.</p>
<p>The ClonalOrigin model is a simplification of the coalescent with gene conversion in which lineages are labeled as either clonal or non-clonal, with non-clonal lineages assumed to be free from conversion events (i.e. they may not bifurcate) and pairs of these lineages forbidden from coalescing. As <xref ref-type="bibr" rid="c8">Didelot <italic>et al.</italic> (2010)</xref> argue, this simplified process is a good approximation to the full model in the limit of small expected tract length (relative to genome length) and low recombination rate. It also possesses features that make it an attractive basis for practical inference methods. First among these is that, conditional on the clonal frame (CF), the conversion events are completely independent. In our context, this simplifies the process of computing the probability of a given ARG and proposing the modifications necessary when exploring ARG-space using MCMC.</p>
<p>We briefly reiterate the mathematical details of the model described in <xref ref-type="bibr" rid="c8">Didelot <italic>et al.</italic> (2010)</xref> using terminology more appropriate for our purposes. We define the ClonalOrigin recombination graph <italic>G</italic> &#x003D; (<italic>C</italic>, <italic>R</italic>) where <italic>C</italic> represents the clonal frame and <italic>R</italic> is a set of recombinant edges connecting pairs of points on C. The CF is assumed to be generated by an unstructured coalescent process governed by a time-dependent effective population size <italic>N</italic>(<italic>t</italic>), where <italic>t</italic> measures time before the present. That is, the probability density of <italic>C</italic> can be written
<disp-formula id="eqn1"><alternatives><graphic xlink:href="059105_eqn1.gif"/></alternatives></disp-formula>
Here <italic>Y</italic> is the set of internal (coalescent) nodes between edges of <italic>C</italic>, including the root node o, and {<italic>t</italic><sub><italic>j</italic></sub>|<italic>i</italic> &#x03F5; <italic>Y</italic>} are the ages of these nodes. The term <italic>k</italic>(<italic>t</italic>) represents the number of CF lineages extant at time <italic>t</italic>.</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1</label>
<caption><p>Schematic representation of a recombination graph <italic>G</italic> for a single locus <italic>b</italic>, with clonal frame <italic>C</italic> and |<italic>R</italic>| &#x003D; 1 conversion <italic>r</italic>. The conversion attaches to <italic>C</italic> at points <italic>l</italic> and <italic>u</italic> and affects sites <italic>x</italic> through <italic>y</italic> of the <italic>L<sub>b</sub></italic> sites belonging to locus <italic>b</italic>. The horizontal bars represent ancestral sequences belonging to each lineage and colors are used to denote which samples each site is ancestral to, with white indicating sites ancestral to no samples. The graph on the right displays the associated clonal frame lineages-through-time function <italic>k</italic>(<italic>t</italic>), together with the times used in computing <italic>f</italic> (<italic>G</italic>|<italic>N</italic>, <italic>&#x03B4;</italic>, <italic>&#x03C1;</italic>, <italic>B</italic>). These include the conversion attachment times <italic>t<sub>l</sub></italic>; and <italic>t<sub>u</sub></italic>, together with ages of coalescent nodes <italic>i</italic> and <italic>i</italic>&#x2032;. (Here <italic>i</italic>&#x2032; &#x003D; <italic>o</italic>.)</p></caption>
<graphic xlink:href="059105_fig1.tif"/>
</fig>
<p>Conversion events <italic>r</italic> &#x03F5; <italic>R</italic> appear at a constant rate on each lineage of <italic>C</italic> and thus their number |<italic>R</italic>| is Poisson-distributed with mean <italic>T</italic>&#x03A3;<sub><italic>b</italic>&#x03F5;<italic>B</italic></sub>(<italic>&#x03C1;L</italic><sub><italic>b</italic></sub>&#x002B; <italic>&#x03B4;</italic> &#x2212; 1), with <italic>T</italic> being the sum of all branch lengths in <italic>C</italic>. Here <italic>&#x03C1;</italic> is the per site per unit time rate of homologous gene conversion, <italic>&#x03B4;</italic> is the expected conversion tract length and <italic>b</italic> &#x03f5; <italic>B</italic> are the loci for which length <italic>L<sub>b</sub></italic> sequence alignments are available. Each conversion is defined by <italic>r</italic> &#x003D; (<italic>l, u, b, x, y</italic>) where <italic>l</italic> and <italic>u</italic> identify points on <italic>C</italic> at which the recombinant lineage attaches, with the age of <italic>l</italic> less than that of <italic>u</italic>. The element <italic>b</italic> indicates the locus to which the conversion applies, and <italic>x</italic> and <italic>y</italic> identify the start and end respectively of the range of sites affected by the conversion. The point <italic>l</italic> &#x007E; <italic>f</italic> (<italic>l</italic>|<italic>C</italic>) is chosen uniformly over <italic>C</italic>, while <italic>u</italic> is drawn from the conditional coalescent distribution<disp-formula id="eqn2"><alternatives><graphic xlink:href="059105_eqn2.gif"/></alternatives></disp-formula> where <italic>t</italic><sub><italic>l</italic></sub> and <italic>t</italic><sub><italic>u</italic></sub> are the ages of points <italic>l</italic> and <italic>u</italic> respectively. The locus <italic>b</italic> is chosen with probability <italic>P</italic>(<italic>b</italic>|<italic>B</italic>,<italic>&#x03B4;</italic>) &#x003D; (<italic>L<sub>b</sub></italic> &#x002B; <italic>&#x03B4;</italic> &#x2212;1)/&#x03A3;<sub><italic>b</italic>&#x2032; &#x03F5; <italic>B</italic></sub>(<italic>L</italic><sub><italic>b</italic>&#x2032;</sub> &#x002B; <italic>&#x03B4;</italic> &#x2212; 1), the site <italic>x</italic> is drawn from the distribution <italic>P</italic>(<italic>x</italic>|<italic>b</italic>, <italic>&#x03B4;</italic>) &#x003D; (<italic>I</italic>(<italic>x</italic> &#x003D; 1) / (<italic>l</italic> &#x002B; <italic>&#x03B4;</italic> &#x2212;), and the site <italic>y</italic> is drawn from <italic>P</italic>(<italic>y</italic>|<italic>x</italic>, <italic>b</italic>, <italic>&#x03B4;</italic>) &#x003D; <italic>&#x03B4;</italic><sup>&#x2212;1</sup>(1 &#x2212; <italic>&#x03B4;</italic><sup>&#x2212;1</sup>)<sup><italic>y</italic> &#x2212; <italic>x</italic></sup> &#x002B; <italic>I</italic>(<italic>y</italic> &#x003D; <italic>L<sub>b</sub></italic>)(1 &#x2212; <italic>&#x03B4;</italic><sup>&#x2212;1</sup>)<sup><italic>L<sub>b</sub></italic> &#x2212; <italic>x</italic></sup>. (In these equations <italic>I</italic>(&#x2027;) is the indicator function.)</p>
<p>The full probability density for a ClonalOrigin ARG is then simply the product:<disp-formula id="eqn3"><alternatives><graphic xlink:href="059105_eqn3.gif"/></alternatives></disp-formula> where the |<italic>R</italic>|&#x0021; accounts for independence with respect to label permutations of the recombination set <italic>R</italic>. <xref ref-type="fig" rid="fig1">Figure 1</xref> illustrates the various elements of the ClonalOrigin model and associated notation.</p>
</sec>
<sec id="s2">
<title>Bayesian inference</title>
<p>Performing Bayesian inference under the ClonalOrigin model shares many similarities with the process of performing inference under the standard coalescent. The goal is to characterise the joint posterior density:<disp-formula id="eqn4"><alternatives><graphic xlink:href="059105_eqn4.gif"/></alternatives></disp-formula> where <italic>D</italic> represents multiple sequence alignments for each locus in <italic>B</italic> and <italic>&#x03BC;</italic> represents one or more parameters of the chosen substitution model. The distributions on the right-hand side include <italic>P</italic><sub>lik</sub>, the likelihood of the recombination graph, <italic>f<sub>CO</sub></italic>, the probability density of the graph under the ClonalOrigin model discussed above, and <italic>f</italic><sub>prior</sub>, the joint prior density of the model parameters.</p>
<p>To define the ARG likelihood, first consider that every ARG may be mapped onto a set <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline1.gif"/></alternatives></inline-formula> of &#x201C;local&#x201D; trees describing the ancestry of contiguous ranges of completely linked sites in the alignment. The likelihood of <italic>G</italic> is expressed in terms of local trees as the following product<disp-formula id="eqn5"><alternatives><graphic xlink:href="059105_eqn5.gif"/></alternatives></disp-formula>where <italic>D<sub>i</sub></italic> is the portion of the alignment whose ancestry is described by local tree <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline2.gif"/></alternatives></inline-formula> and <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline3.gif"/></alternatives></inline-formula> is the standard phylogenetic tree likelihood (<xref ref-type="bibr" rid="c12">Felsenstein 2003</xref>).</p>
<p>Since it is possible for conversions to have no effect on <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline4.gif"/></alternatives></inline-formula>, there is no one-to-one correspondence between <italic>G</italic> and <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline5.gif"/></alternatives></inline-formula>. This suggests that certain features of <italic>G</italic> may be strictly non-identifiable in terms of the likelihood function. As Bayesian inference deals directly with the posterior distribution, this non-identifiability will not invalidate any analysis provided that f<sub>prior</sub> is proper. However, the existence of non-identifiability has practical implications for the design of sampling algorithms, as we discuss in the following section.</p>
<sec id="s2a">
<title>Markov chain Monte Carlo (MCMC)</title>
<p>We use MCMC to sample from the joint posterior given in <xref ref-type="disp-formula" rid="eqn4">eq. (4)</xref>. This algorithm explores the state space of <italic>x</italic> &#x003D; (<italic>G</italic>, <italic>N</italic>, <italic>&#x03B4;</italic>, <italic>&#x03C1;</italic>, <italic>&#x03BC;</italic>) (or some subspace thereof) using a random walk in which steps from <italic>x</italic> to <italic>x</italic>&#x2032; are drawn from some proposal distribution <italic>q</italic>(<italic>x</italic>&#x2032;|<italic>x</italic>) and accepted with a probability that depends on the relative posterior densities at <italic>x</italic>&#x2032; and <italic>x</italic>.</p>
<p>In practice, <italic>q</italic>(<italic>x</italic>&#x2032;|<italic>x</italic>) is often expressed as a weighted sum of proposal densities <italic>q<sub>i</sub></italic> (<italic>x</italic>&#x2032;|<italic>x</italic>) (also known as <italic>proposals</italic> or <italic>moves</italic>) which individually propose alterations to some small part of <italic>x</italic>. While there is considerable freedom in choosing a set of moves, their precise form can dramatically influence the convergence and efficiency of the sampling algorithm. Proposals should not generate new states that are too bold (accepted with very low frequency) nor too timid (accepted with very high frequency): both extremes tend to lead to chains with long autocorrelationperiods. In this section we present an informal outline of the moves used in our algorithm. (Refer to the Appendix for a detailed description.)</p>
<p>For the sub-space made up of the continuous model parameters <italic>&#x03B4;</italic>, <italic>&#x03C1;</italic>, <italic>&#x03BC;</italic>, and <italic>N</italic>, choosing appropriate proposals is relatively trivial as standard proposals for sampling from &#x211D;<sup><italic>n</italic></sup> are sufficient. In our algorithm we use the univariate scaling operator described by <xref ref-type="bibr" rid="c10">Drummond <italic>et al</italic>. (2002)</xref>, which can be made more or less bold simply by altering the size of the scaling operation.</p>
<p>For the ARG itself, assembling an appropriate set of moves is more difficult. Even determining exactly what constitutes a timid or bold move in G space is hard to determine without detailed knowledge of the target density. Our general approach here is to design proposals that (a) only minimally affect the likelihood of <italic>G</italic> where possible and (b) draw any significant changes from the prior that the ClonalOrigin model places on <italic>G</italic>. The design of these proposals is assisted by our knowledge of the identifiability issue considered in the previous section: there is a many-to-one mapping from <italic>G</italic> to the local tree set <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline6.gif"/></alternatives></inline-formula>, and the ARG likelihood depends only on <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline7.gif"/></alternatives></inline-formula>. Thus, ARG proposals that minimally effect the likelihood are those that propose a <italic>G&#x2032;</italic> that maps to the same or similar <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline8.gif"/></alternatives></inline-formula>.</p>
<p>The proposals for <italic>G</italic> fall into two groups, the first of which deals exclusively with the set of conversions <italic>R</italic>. These include all three moves described by <xref ref-type="bibr" rid="c8">Didelot <italic>et al.</italic> (2010)</xref> (we consider the conversion add/remove pair to be two halves of a single proposal), along with six additional simple moves aimed at quickly exploring the ARG state space conditional on <italic>C</italic>. Examples include a conversion merge/split proposal that merges pairs of conversions between the same pair of edges on the CF that affect nearby ranges of sites or splits single conversions into such pairs, a proposal which reversibly replaces a single conversion between two edges with a pair involving a third intermediate edge, and a proposal which adds or removes conversions that do not alter the topology of the CF.</p>
<p>Proposals in the second group propose joint updates to both the clonal frame <italic>C</italic> and the conversions <italic>R</italic>. Some of these moves are quite bold (and thus tend to be accepted rarely), but are very important for dealing with topological uncertainty in the clonal frame. The general strategy for each move is to apply one of the tree proposals from <xref ref-type="bibr" rid="c10">Drummond <italic>et al.</italic> (2002)</xref> to <italic>C</italic> and to simultaneously modify the conversions in <italic>R</italic> to ensure both compatibility with the <italic>C</italic>&#x2032; and to minimise the effect of the proposal on both the likelihood and the ARG prior. The changes to <italic>C</italic> can for the most part be decomposed into primitive operations that involve selecting a subtree, deleting the edge <italic>e</italic> attaching that subtree to the rest of the CF at time <italic>t<sub>i</sub></italic>, then reconnecting the subtree via a new edge <italic>e</italic>&#x2032; to a new point on <italic>C</italic> at time <italic>t</italic>&#x2032;<sub>i</sub>. Modification of <italic>R</italic> is done using an approach (depicted in <xref ref-type="fig" rid="fig2">figure 2</xref>) which consists of two distinct forms. The first form, the &#x201C;collapse&#x201D;, is applied whenever <italic>t</italic>&#x2032;<sub><italic>i</italic></sub> &#x003C; <italic>t<sub>i</sub></italic>; and involves finding conversions for which <italic>u</italic> or <italic>v</italic> are on the edge above the subtree and attach at times <italic>t<sub>l</sub></italic> or <italic>t<sub>u</sub></italic> greater than <italic>t&#x2032;<sub>i</sub></italic>. These attachment points are moved from their original position to contemporaneous points on the <italic>C</italic> lineage ancestral to <italic>e</italic>&#x2032;. The second form, the &#x201C;expansion&#x201D;, is applied when <italic>t&#x2032;<sub>i</sub></italic> &#x003E; <italic>t<sub>i</sub></italic> and is the inverse of the first: conversion attachments <italic>u</italic> or <italic>v</italic> at times <italic>t<sub>i</sub></italic> &#x003C; <italic>t<sub>&#x007B;l,u&#x007D;</sub></italic> &#x003C; <italic>t&#x2032;<sub>i</sub></italic> are moved with some probability to contemporaneous positions on <italic>e</italic>&#x2032;.</p>
<p>In concert, these proposals allow us to effectively explore the entire state space of <italic>x</italic>.</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2.</label>
<caption><p>Schematic representation of the collapse/expand strategy used by the MCMC algorithm to update conversions following the movement of a clonal frame edge. Sub-figure (a) illustrates a proposal to replace the thick black edge portion of the clonal frame edge joined to <italic>p</italic> with the thick grey edge portion joint to <italic>q</italic>. Since <italic>t<sub>q</sub></italic> &#x003C; <italic>t<sub>p</sub></italic> the &#x201C;collapse&#x201D; procedure is applied by moving affected conversion attachment points, highlighted with solid circles, to contemporaneous points on the lineage ancestral to <italic>q</italic>. Any conversion with a new arrival point above the root is deleted from the new ARG. Sub-figure
(b) illustrates the reverse situation, where a CF edge attached at q is reattached at <italic>p</italic>. Since <italic>t<sub>p</sub></italic> &#x003E; <italic>t<sub>q</sub></italic> the &#x201C;expand&#x201D; procedure is applied by moving any attachment points contemporaneous with a point on the newly extended portion of the CF edge to that point with some probability. Since <italic>p</italic> becomes the new CF root, new conversions with arrival points on the new CF edge at times older than the previous CF root are drawn from the ClonalOrigin prior.</p></caption>
<graphic xlink:href="059105_fig2.tif"/>
</fig>
</sec>
<sec id="s2b">
<label>A.</label>
<title>Summarizing the ARG posterior</title>
<p>Bayesian MCMC algorithms produce samples from posterior distributions rather than point estimates of inferred quantities. These approaches are superior because they give us the means to directly quantify the uncertainty inherent in the inference. For the very high dimensional state space that ARGs (even the ClonalOrigin model&#x2032;s tree-based networks) occupy, actually visualising this uncertainty and extracting an overall picture of the likely ancestral history of the sequence data is non-trivial.</p>
<p>A similar problem exists for Bayesian phylogenetic tree inference. Given the maturity of that field, it should not be surprising that a large number of solutions exist. The majority of these solutions involve the assembly of some kind of summary or consensus tree (see chapter 30 of <xref ref-type="bibr" rid="c12">Felsenstein (2003)</xref> for an overview or <xref ref-type="bibr" rid="c16">Heled and Bouckaert (2013)</xref> for a recent discussion). While conceptually appealing, the replacement of a posterior distribution with a single tree can very easily lead to the appearance of signal where there is none, so care must be taken. At least one method exists that avoids this problem: the DensiTree software (<xref ref-type="bibr" rid="c5">Bouckaert 2010</xref>) simply draws all of the trees in a given set with some degree of transparency, making it possible to actually visualize the distribution directly.</p>
<p>Unfortunately, the approach taken by DensiTree cannot be easily applied to ARGs, since the recombinant edges introduce significant visual noise making patterns difficult to discern. Nor can any of the standard summary methods be applied directly.</p>
<p>Instead, we use a summary of the CF posterior as a starting point to produce summary ARGs, as described in algorithm 1. In the algorithm, MCC refers to the Maximal Clade Credibility tree (see, for instance, <xref ref-type="bibr" rid="c16">Heled and Bouckaert 2013</xref>), and the value of <italic>&#x03B1;</italic> in step 3(c) imposes a threshold on the posterior support necessary for a conversion to appear in the summary. The relationship between the sampled conversions and the summary conversions is illustrated in <xref ref-type="fig" rid="fig3">figure 3</xref>.</p>
<fig id="ufig1" position="float" fig-type="figure">
<label>Algorithm 1</label>
<caption><p>Method used to summarize samples <italic>G</italic>(<sup><italic>s</italic></sup>) for <italic>s</italic> &#x03F5; [1,M] from the marginal posterior for <italic>G</italic>.</p></caption>
<graphic xlink:href="059105_ufig1.tif"/>
</fig>
<p>Testing with simulated data demonstrates that the method is capable of recovering useful summaries. However, one significant drawback is that the algorithm only groups together sampled conversions that appear between identical (in the sense described in the algorithm) pairs of CF edges. This means that a single conversion with significant uncertainty in either of its attachment points <italic>u</italic> or <italic>l</italic> may appear as multiple conversions in the summary. As a result, we still consider the problem of how best to summarize the posterior distribution over ARGs a target for future research.</p>
</sec>
</sec>
<sec id="s3">
<title>Implementation and validation</title>
<p>The methods described here are implemented as a BEAST 2 package. This allows the large number of substitution models, priors and other phylogenetic inference methods already present in BEAST 2 to be used with the ClonalOrigin model.</p>
<p>Despite the reuse of an existing phylogenetic toolkit, the implementation is still complex. As such, the importance of validating the implementation cannot be overstated. Our validation procedure involved two distinct phases: sampling from the ARG prior and performing inference of known parameter values from simulated data.</p>
<sec id="s3a">
<title>Sampling from the ARG prior</title>
<p>This first phase of the validation involves using the MCMC algorithm to generate samples from <italic>f<sub>CO</sub></italic>(<italic>G</italic>|<italic>N</italic>, <italic>&#x03C1;</italic>, <italic>&#x03B4;</italic>), i.e. the prior distribution over ARG-space implied by the ClonalOrigin model. Unlike the full posterior density, we can also sample from this distribution via direct simulation of ARGs. Statistical comparisons between these two distributions should yield perfect agreement. Assuming that errors in both the MCMC algorithm implementation or the ARG simulation algorithm are unlikely to produce identically erroneous results, this is a stringent test of all aspects of our implementation besides calculation of the ARG likelihood.</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3.</label>
<caption><p>This diagram illustrates the way that conversions are summarized by algorithm 1. The solid tree on the left depicts the MCC summary of the clonal frame, <italic>C</italic>&#x0304;, with each node labeled by its set of descendent leaves. The dashed edges represent distinct conversions <italic>Q</italic>&#x0304;;<sub><italic>i,j,b</italic></sub> that exist between a given pair of edges <italic>i</italic> and <italic>j</italic> in ARGs sampled from the posterior (with overlapping pairs of conversions persent on single ARGs merged). The horizontal boxes on the right indicate the site regions affected by each conversion, with the graph above showing the fraction of sampled ARGs posessing conversions at each site. A summary conversion is recorded only when this fraction exceeds the threshold <italic>&#x03B1;</italic>.</p></caption>
<graphic xlink:href="059105_fig3.tif"/>
</fig>
<p><xref ref-type="fig" rid="fig4">Figure 4</xref> displays a comparison between the histograms for a number of summary statistics computed from ARGs with 5 (non-contemporaneous) leaves sampled using our implementation of each method. The MCMC chain was allowed to run for 10<sup>8</sup> iterations with ARGs sampled every 10<sup>4</sup> steps, while the simulation method was used to generate 10<sup>5</sup> independent ARGs. The close agreement between the two sets of histograms is very strong evidence that our implementation of both algorithms is correct.</p>
</sec>
<sec id="s3b">
<title>Inference from simulated data</title>
<p>A common way to determine the validity and usefulness of an inference algorithm is to assess its ability to recover known truths from simulated data. In contrast with sampling from the prior, inference from simulated data is sensitive to the implementation of the ARG likelihood. We use here a well calibrated (<xref ref-type="bibr" rid="c6">Dawid 1982</xref>) form of the test, which requires that known true values fall within the estimated 95&#x0025; highest posterior density (HPD) interval 95&#x0025; of the time.</p>
<p>The details of the validation procedure are as follows. Firstly, 100 distinct 10-leaf ARGs of were simulated under the ClonalO-rigin model with parameters <italic>&#x03C1;</italic> &#x003D; 0.01, <italic>&#x03B4;</italic> &#x003D; 500 and <italic>N</italic> &#x003D; 0.05. These ARGs were then used to produce an equivalent number of two-locus alignments, with each locus containing 5 &#x2A2F; 10<sup>3</sup> sites. Finally, each simulated alignment was used as the basis for inference of the ARG using the MCMC algorithm described above, conditional on the known true parameters.</p>
<p>The circles in the graphs shown as <xref ref-type="fig" rid="fig5">Figure 5</xref> display the fraction of the sampled marginal MCMC posteriors for the CF tM-RCA (time to most recent common ancestor) and recombination event count which included the known true values as a function of the relative HPD interval width. The dashed lines indicate the fractions expected of a well-calibrated analysis. This close agreement therefore suggests that our analysis method is internally consistent in this regard, a result which strongly implies that our implementation is correct.</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4.</label>
<caption><p>Comparison between distributions of summary statistics computed from ARGs simulated directly under the model (gray lines) and ARGs sampled using the MCMC algorithm (black lines). These include (a) the age of the CF root node, (b) the number of recombinations, and the average length of the recombinant (c) edges and (d) tracts on each sampled ARG. Exact agreement for each summary suggests that both algorithms are correct.</p></caption>
<graphic xlink:href="059105_fig4.tif"/>
</fig>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5.</label>
<caption><p>Coverage fraction versus HPD interval width for (a) the clonal frame tMRCA and (b) the recombination event count posteriors inferred from simulated sequence data. The circles represent the observed coverage fraction, while the dashed lines indicate the coverage fraction to be expected from a well-calibrated analysis.</p></caption>
<graphic xlink:href="059105_fig5.tif"/>
</fig>
</sec>
</sec>
<sec id="s4">
<title>Example: Escherichia coli</title>
<p>We applied our new method to the analysis of sequence data collected from a set of 23 <italic>E. coli</italic> isolates. The isolates were derived from from both humans and cattle and include both STEC (Shiga toxin-producing <italic>E. coli</italic>) and non-STEC representatives of the O26 and O157 serotypes. The analysis focused on the 53 loci targeted by ribosomal multi-locus sequence typing (rMLST, <xref ref-type="bibr" rid="c19">Jolley <italic>et al.</italic> 2012</xref>).</p>
<p>The analysis was performed under the assumption of a constant population, the size of which was given a log normal prior ln<italic>N</italic>(0,2). The HKY substitution model (<xref ref-type="bibr" rid="c15">Hasegawa <italic>et al.</italic> 1985</xref>) was used, with uniform priors placed on the relative site frequencies and a log normal prior ln <italic>N</italic>(1,1.25) placed on the transition/transversion relative rate parameter <italic>k</italic>. For the relative recombination rate <italic>&#x03C1;</italic>/<italic>&#x03BC;</italic> we use an informative log normal prior of ln<italic>N</italic>(&#x2212;2.3,1.5) which includes a previously published 95&#x0025; credibility interval of 0.03&#x2013;2.0 (<xref ref-type="bibr" rid="c24">Vos and Didelot 2009</xref>). The expected tract length parameter was fixed at <italic>&#x03B4;</italic> &#x003D; 10<sup>3</sup> sites.</p>
<p>Six unique instances of the MCMC algorithm were run in parallel. Five of these were run for 2.5 &#x2A2F; 10<sup>7</sup> iterations while the sixth was run for 5 &#x2A2F; 10<sup>7</sup> iterations. Comparison of the posteriors sampled by each of these chains demonstrated that convergence had been achieved. Final results were obtained by removing the first 10&#x0025; of samples from each chain to account for burn-in and then concatenating the results. Once complete, the effective sample size for every model parameter and summary ARG statistic recorded surpassed 200.</p>
<p>The final results of this analysis are presented as <xref ref-type="fig" rid="fig6">figure 6</xref>. Firstly, <xref ref-type="fig" rid="fig6">figure 6a</xref> displays a summary ARG produced from the sampled ARG posterior using a conversion posterior cutoff threshold of 0.4. This summary shows that four conversion events have posterior support exceeding this threshold. Three of these depict gene conversion events that transfer nucleotides between lineages ancestral to samples with O157 serotype. More specifically, the conversions result in gene flow from lineages ancestral to pathogenic (&#x002B;STEC) samples to lineages ancestral to non-pathogenic (&#x2212;STEC) samples. The remaining conversion event is indicative of a recent introgression from the O26 serotype into &#x2212;STEC O157.</p>
<fig id="fig6" position="float" fig-type="figure">
<label>Figure 6.</label>
<caption><p>(a) Summary ARG produced by applying our method to sequences obtained from 23 <italic>E. col; isolates</italic>. Dashed edges represent summary conversions, with the numbers giving the estimated posterior support values. Conversions originating from the root edge of the clonal frame have been omitted.(b) Posterior distributions over nucleotides transferred between lineages ancestral to &#x002B;STEC and &#x002D;STEC O157 samples. (c) Posterior and prior distributions for the relative recombination rate, <italic>&#x03C1;</italic>/<italic>&#x03BC;</italic>.</p></caption>
<graphic xlink:href="059105_fig6.tif"/>
</fig>
<p>This overall pattern is also reflected in <xref ref-type="fig" rid="fig6">figure 6b</xref> which displays the posterior distributions for the total number of nucleotides transferred by conversion events between &#x002B;/&#x2212;STEC O157 ancestral lineages: the gene flow from &#x002B;STEC to &#x2212;STEC O157 is on average greater than that in the reverse direction. This asymmetry is, however, very slight&#x2014;a fact which may be attributed to the presence of a large number of &#x201C;background&#x201D; conversions which individually lack the posterior support to be included in the summary but which nevertheless contribute to the particular gene flow metric we have chosen.</p>
<p>Finally, <xref ref-type="fig" rid="fig6">figure 6c</xref> displays the posterior distribution for the relative recombination rate parameter, giving a 95&#x0025; HPD interval of [0.21,1.44]. The log-normal prior density for the recombination rate is also shown and indicates that the data are informative for this parameter.</p>
<p>The data and BEAST 2 XML files needed to replicate both this analysis and the validation studies are provided as part of the online supplementary material.</p>
</sec>
<sec id="s5">
<title>Discussion</title>
<p>Dealing appropriately with recombination in a phylogenetic setting is a difficult task for a number of reasons. Firstly, the progressive bifurcation of lineages with increasing age steadily decrease the signal for these features in a given dataset. Furthermore, the possibility of these bifurcations drastically increases the size of the state space occupied by the genealogy. Indeed, even for a small number of aligned sequences, the upper bound of the number of coalescent events influencing the evolution of those sequences is potentially huge: the total number of nucleotide sites in the alignment. Considering that the super-exponential rate at which the number of binary trees grows as a function of sample size already presents complexity problems for computational phylogenetics, it is no surprise that models that explicitly consider recombination are not as widely used in genealogical inference.</p>
<p>Despite these challenges, Didelot and coauthors have shown repeatedly that traditional coalescent-based phylogenetic inference methods can be applied to such models, by applying carefully chosen simplifications to the coalescent with gene conversion which reduce the state space while maintaining sufficient realism in the important context of bacterial evolution. In our paper we have sought to continue in this tradition, and have demonstrated that one can indeed perform full joint inference of tree-based ARGs using a carefully constructed MCMC algorithm. In contrast with previous methods (as implemented in ClonalOrigin), this approach more accurately characterizes the posterior for the ARG and should yield more accurate estimates of statistical uncertainty.</p>
<p>Also, in our effort to narrow the technological gap between inference using the ClonalOrigin model and Bayesian inference performed using common non-recombination-aware models, we have introduced a means of summarizing sampled tree-based ARG posteriors that is reminiscent of the methods often employed to summarize sampled tree posteriors.</p>
<p>We must emphasize, however, that despite making significant headway we do not consider either the ClonalOrigin inference problem nor the problem of summarizing posterior distributions over tree-based networks to be in any way &#x201C;solved&#x201D;. In the case of the inference problem, computational challenges relating to the way the algorithm scales with increasing frequency of recombination remain. These relate most directly to the large computational complexity of the ARG likelihood (<xref ref-type="disp-formula" rid="eqn5">eq. (5)</xref>). (This is often the most computationally expensive calculation even in standard phylogenetic analyses, and recombination only multiplies this burden.) It may be the case that improving this situation will require replacing the mathematically exact likelihood evaluation under a given substitution model with a carefully chosen approximation, but the feasibility and usefulness of this approach has yet to be fully investigated.</p>
<p>The problem of summarizing posterior distributions over tree-based networks would seem to be a fruitful line of future research. The algorithm presented here does seem to perform relatively well from an empirical standpoint, and to our knowledge is the first of its kind. However, it does have drawbacks relating to its propensity to misclassify conversions for which topological uncertainty exists (i.e. uncertainty in the CF edge to which one or both of its end-points attach) as multiple distinct conversions with a proportionally smaller posterior support. Solving this problem would seem to be non-trivial, as it requires the algorithm to identify a conversion in one sampled ARG with a conversion in a second ARG even when those conversions join distinct pairs of edges on the clonal frame. However, we feel that tackling these and other related problems is a worthwhile endeavor and one which should encourage mainstream adoption of recombination-aware Bayesian phylogenetic inference methods.</p>
</sec>
</body>
<back>
<ref-list>
<title>Literature Cited</title>
<ref id="c1"><mixed-citation publication-type="journal"><string-name><surname>Ansari</surname>, <given-names>M. A.</given-names></string-name> and <string-name><given-names>X.</given-names> <surname>Didelot</surname></string-name>, <year>2014</year> <article-title>Inference of the properties of the recombination process from whole bacterial genomes</article-title>. <source>Genetics</source> <volume>196</volume>: <fpage>253</fpage>&#x2013;<lpage>265</lpage>.</mixed-citation></ref>
<ref id="c2"><mixed-citation publication-type="journal"><string-name><surname>Beaumont</surname>, <given-names>M. A.</given-names></string-name>, <string-name><given-names>W.</given-names> <surname>Zhang</surname></string-name>, and <string-name><given-names>D. J.</given-names> <surname>Balding</surname></string-name>, <year>2002</year> <article-title>Approximate bayesian computation in population genetics</article-title>. <source>Genetics</source> <volume>162</volume>: <fpage>2025</fpage>&#x2013;<lpage>2035</lpage>.</mixed-citation></ref>
<ref id="c3"><mixed-citation publication-type="journal"><string-name><surname>Bloomquist</surname>, <given-names>E. W.</given-names></string-name> and <string-name><given-names>M. A.</given-names> <surname>Suchard</surname></string-name>, <year>2010</year> <article-title>Unifying vertical and nonvertical evolution: a stochastic arg-based framework</article-title>. <source>Syst Biol</source> <volume>59</volume>: <fpage>27</fpage>&#x2013;<lpage>41</lpage>.</mixed-citation></ref>
<ref id="c4"><mixed-citation publication-type="journal"><string-name><surname>Bouckaert</surname>, <given-names>R.</given-names></string-name>, <string-name><given-names>J.</given-names> <surname>Heled</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Kuhnert</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Vaughan</surname></string-name>, <string-name><given-names>C.-H.</given-names> <surname>Wu</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Xie</surname></string-name>, <string-name><given-names>M. A.</given-names> <surname>Suchard</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Rambaut</surname></string-name>, and <string-name><given-names>A. J.</given-names> <surname>Drummond</surname></string-name>, <year>2014</year> <article-title>BEAST 2: a software platform for Bayesian evolutionary analysis</article-title>. <source>PLoS Comput Biol</source> <volume>10</volume>: <fpage>e1003537</fpage>.</mixed-citation></ref>
<ref id="c5"><mixed-citation publication-type="journal"><string-name><surname>Bouckaert</surname>, <given-names>R. R.</given-names></string-name>, <year>2010</year> <article-title>Densitree: making sense of sets of phylogenetic trees</article-title>. <source>Bioinformatics</source> <volume>26</volume>: <fpage>1372</fpage>&#x2013;<lpage>1373</lpage>.</mixed-citation></ref>
<ref id="c6"><mixed-citation publication-type="journal"><string-name><surname>Dawid</surname>, <given-names>A. P.</given-names></string-name>, <year>1982</year> <article-title>The well-calibrated Bayesian</article-title>. <source>Journal of the American Statistical Association</source> <volume>77</volume>: <fpage>605</fpage>&#x2013;<lpage>610</lpage>.</mixed-citation></ref>
<ref id="c7"><mixed-citation publication-type="journal"><string-name><surname>Didelot</surname>, <given-names>X.</given-names></string-name> and <string-name><given-names>D.</given-names> <surname>Falush</surname></string-name>, <year>2007</year> <article-title>Inference of bacterial microevolution using multilocus sequence data</article-title>. <source>Genetics</source> <volume>175</volume>: <fpage>1251</fpage>.</mixed-citation></ref>
<ref id="c8"><mixed-citation publication-type="journal"><string-name><surname>Didelot</surname>, <given-names>X.</given-names></string-name>, <string-name><given-names>D.</given-names> <surname>Lawson</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Daarling</surname></string-name>, and <string-name><given-names>D.</given-names> <surname>Falush</surname></string-name>, <year>2010</year> <article-title>Inference of homologous recombination in bacteria using whole-genome sequences</article-title>. <source>Genetics</source> <volume>186</volume>: <fpage>1435</fpage>.</mixed-citation></ref>
<ref id="c9"><mixed-citation publication-type="journal"><string-name><surname>Didelot</surname>, <given-names>X.</given-names></string-name> and <string-name><given-names>D. J.</given-names> <surname>Wilson</surname></string-name>, <year>2015</year> <article-title>ClonalFrameML: efficient inference of recombination in whole bacterial genomes</article-title>. <source>PLoS Comput Biol</source> <volume>11</volume>: <fpage>e1004041</fpage>.</mixed-citation></ref>
<ref id="c10"><mixed-citation publication-type="journal"><string-name><surname>Drummond</surname>, <given-names>A. J.</given-names></string-name>, <string-name><given-names>G. K.</given-names> <surname>Nicholls</surname></string-name>, <string-name><given-names>A. G.</given-names> <surname>Rodrigo</surname></string-name>, and <string-name><given-names>W.</given-names> <surname>Solomon</surname></string-name>, <year>2002</year> <article-title>Estimating mutation parameters, population history and genealogy simultaneously from temporally spaced sequence data</article-title>. <source>Genetics</source> <volume>161</volume>: <fpage>1307</fpage>.</mixed-citation></ref>
<ref id="c11"><mixed-citation publication-type="journal"><string-name><surname>Fearnhead</surname>, <given-names>P.</given-names></string-name>, <string-name><given-names>S.</given-names> <surname>Yu</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Biggs</surname></string-name>, <string-name><given-names>B.</given-names> <surname>Holland</surname></string-name>, and <string-name><given-names>N.</given-names> <surname>French</surname></string-name>, <year>2015</year> <article-title>Estimating the relative rate of recombination to mutation in bacteria from single-locus variants using composite likelihood methods</article-title>. <source>The Annals of Applied Statistics</source> <volume>9</volume>: <fpage>200</fpage>.</mixed-citation></ref>
<ref id="c12"><mixed-citation publication-type="journal"><string-name><surname>Felsenstein</surname>, <given-names>J.</given-names></string-name>, <year>2003</year> <article-title>Inferring PhyZogenies</article-title>. <source>Sinauer Associates, Massachusetts</source>.</mixed-citation></ref>
<ref id="c13"><mixed-citation publication-type="journal"><string-name><surname>Griffiths</surname>, <given-names>R. C.</given-names></string-name>, <year>1981</year> <article-title>Neutral two-locus multiple allele models with recombination</article-title>. <source>J. Theor. Pop. Biol.</source> <volume>19</volume>: <fpage>169</fpage>&#x2013;<lpage>186</lpage>.</mixed-citation></ref>
<ref id="c14"><mixed-citation publication-type="journal"><string-name><surname>Guindon</surname>, <given-names>S.</given-names></string-name> and <string-name><given-names>O.</given-names> <surname>Gascuel</surname></string-name>, <year>2003</year> <article-title>A simple, fast, and accurate algorithm to estimate large phylogenies by maximum likelihood</article-title>. <source>Syst Biol</source> <volume>52</volume>: <fpage>696</fpage>&#x2013;<lpage>704</lpage>.</mixed-citation></ref>
<ref id="c15"><mixed-citation publication-type="journal"><string-name><surname>Hasegawa</surname>, <given-names>M.</given-names></string-name>, <string-name><given-names>H.</given-names> <surname>Kishino</surname></string-name>, and <string-name><given-names>T.</given-names> <surname>Yano</surname></string-name>, <year>1985</year> <article-title>Dating of the human-ape splitting by a molecular clock of mitochondrial DNA</article-title>. <source>J Mol Evol</source> <volume>22</volume>: <fpage>160</fpage>&#x2013;<lpage>174</lpage>.</mixed-citation></ref>
<ref id="c16"><mixed-citation publication-type="journal"><string-name><surname>Heled</surname>, <given-names>J.</given-names></string-name> and <string-name><given-names>R. R.</given-names> <surname>Bouckaert</surname></string-name>, <year>2013</year> <article-title>Looking for trees in the forest: summary tree from posterior samples</article-title>. <source>BMC Evol Biol</source> <volume>13</volume>: <fpage>221</fpage>.</mixed-citation></ref>
<ref id="c17"><mixed-citation publication-type="journal"><string-name><surname>Hudson</surname>, <given-names>R. R.</given-names></string-name>, <year>1983</year> <article-title>Properties of a neutral allele model with intragenic recombination</article-title>. <source>Theor Popul Biol</source> <volume>23</volume>: <fpage>183</fpage>&#x2013;<lpage>201</lpage>.</mixed-citation></ref>
<ref id="c18"><mixed-citation publication-type="journal"><string-name><surname>Huelsenbeck</surname>, <given-names>J. P.</given-names></string-name> and <string-name><given-names>F.</given-names> <surname>Ronquist</surname></string-name>, <year>2001</year> <article-title>Mrbayes: Bayesian inference of phylogenetic trees</article-title>. <source>Bioinformatics</source> <volume>17</volume>: <fpage>754</fpage>&#x2013;<lpage>755</lpage>.</mixed-citation></ref>
<ref id="c19"><mixed-citation publication-type="journal"><string-name><surname>Jolley</surname>, <given-names>K. A.</given-names></string-name>, <string-name><given-names>C. M.</given-names> <surname>Bliss</surname></string-name>, <string-name><given-names>J. S.</given-names> <surname>Bennett</surname></string-name>, <string-name><given-names>H. B.</given-names> <surname>Bratcher</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Brehony</surname></string-name>, <string-name><given-names>F. M.</given-names> <surname>Colles</surname></string-name>, <string-name><given-names>H.</given-names> <surname>Wimalarathna</surname></string-name>, <string-name><given-names>O. B.</given-names> <surname>Harrison</surname></string-name>, <string-name><given-names>S. K.</given-names> <surname>Sheppard</surname></string-name>, <string-name><given-names>A. J.</given-names> <surname>Cody</surname></string-name>, and <string-name><given-names>M. C.</given-names> <surname>J. Maiden</surname></string-name>, <year>2012</year> <article-title>Ribosomal multilocus sequence typing: universal characterization of bacteria from domain to strain</article-title>. <source>Microbiology</source> <volume>158</volume>: <fpage>1005</fpage>&#x2013;<lpage>1015</lpage>.</mixed-citation></ref>
<ref id="c20"><mixed-citation publication-type="journal"><string-name><surname>Kingman</surname>, <given-names>J.</given-names></string-name>, <year>1982a</year> <article-title>The coalescent</article-title>. <source>Stochastic Processes and their Applications</source> <volume>13</volume>: <fpage>235</fpage> &#x2013; <lpage>248</lpage>.</mixed-citation></ref>
<ref id="c21"><mixed-citation publication-type="journal"><string-name><surname>Kingman</surname>, <given-names>J. F. C.</given-names></string-name>, <year>1982b</year> <article-title>On the genealogy of large populations</article-title>. <source>Journal of Applied Probability</source> <volume>19</volume>: <fpage>27</fpage>.</mixed-citation></ref>
<ref id="c22"><mixed-citation publication-type="journal"><string-name><surname>Li</surname>, <given-names>H.</given-names></string-name> and <string-name><given-names>R.</given-names> <surname>Durbin</surname></string-name>, <year>2011</year> <article-title>Inference of human population history from individual whole-genome sequences</article-title>. <source>Nature</source> <volume>475</volume>: <fpage>493496</fpage>.</mixed-citation></ref>
<ref id="c23"><mixed-citation publication-type="journal"><string-name><surname>Schierup</surname>, <given-names>M. H.</given-names></string-name> and <string-name><given-names>J.</given-names> <surname>Hein</surname></string-name>, <year>2000</year> <article-title>Consequences of recombination on traditional phylogenetic analysis</article-title>. <source>Genetics</source> <volume>156</volume>: <fpage>879891</fpage>.</mixed-citation></ref>
<ref id="c24"><mixed-citation publication-type="journal"><string-name><surname>Vos</surname>, <given-names>M.</given-names></string-name> and <string-name><given-names>X.</given-names> <surname>Didelot</surname></string-name>, <year>2009</year> <article-title>A comparison of homologous recombination rates in bacteria and archaea</article-title>. <source>ISME J</source> <volume>3</volume>: <fpage>199</fpage>&#x2013;<lpage>208</lpage>.</mixed-citation></ref>
<ref id="c25"><mixed-citation publication-type="journal"><string-name><surname>Wang</surname>, <given-names>Y.</given-names></string-name> and <string-name><given-names>B.</given-names> <surname>Rannala</surname></string-name>, <year>2008</year> <article-title>Bayesian inference of fine-scale recombination rates using population genomic data</article-title>. <source>Philos Trans R Soc Lond B Biol Sci</source> <volume>363</volume>: <fpage>3921</fpage>&#x2013;<lpage>3930</lpage>.</mixed-citation></ref>
<ref id="c26"><mixed-citation publication-type="journal"><string-name><surname>Wiuf</surname>, <given-names>C.</given-names></string-name>, <year>2000</year> <article-title>A coalescence approach to gene conversion</article-title>. <source>Theor Popul Biol</source> <volume>57</volume>: <fpage>357</fpage>&#x2013;<lpage>367</lpage>.</mixed-citation></ref>
<ref id="c27"><mixed-citation publication-type="journal"><string-name><surname>Wiuf</surname>, <given-names>C.</given-names></string-name> and <string-name><given-names>J.</given-names> <surname>Hein</surname></string-name>, <year>1999</year> <article-title>The ancestry of a sample of sequences subject to recombination</article-title>. <source>Genetics</source> <volume>151</volume>: <fpage>1217</fpage>&#x2013;<lpage>1228</lpage>.</mixed-citation></ref>
<ref id="c28"><mixed-citation publication-type="journal"><string-name><surname>Wiuf</surname>, <given-names>C.</given-names></string-name> and <string-name><given-names>J.</given-names> <surname>Hein</surname></string-name>, <year>2000</year> <article-title>The coalescent with gene conversion</article-title>. <source>Genetics</source> <volume>155</volume>: <fpage>451</fpage>&#x2013;<lpage>462</lpage>.</mixed-citation></ref>
<ref id="c29"><mixed-citation publication-type="journal"><string-name><surname>Zhang</surname>, <given-names>L.</given-names></string-name>, <year>2015</year> <source>On tree based phylogenetic networks</source>. <ext-link ext-link-type="arxiv" xlink:href="http://arxiv.org/abs/arXiv:1509.01663">arXiv:1509.01663</ext-link>.</mixed-citation></ref>
</ref-list>
<app-group>
<app id="app1">
<label>Appendix:</label>
<title>MCMC state proposal distributions</title>
<p>In this appendix we lay out the details of the proposal operators used by the MCMC algorithm implemented described in the paper. To do this, we require some additional nomenclature. We decompose the CF using the tuple <italic>C</italic> &#x003D; (<italic>V</italic>, <italic>E</italic>, <bold>t</bold>). Here <italic>V</italic> &#x003D; <italic>I</italic> &#x22C3; <italic>Y</italic> with <italic>I</italic> being the set of leaf nodes and <italic>Y</italic> being the set of internal nodes, which contains the root node <italic>o</italic>. The set E contains the directed edges between nodes <italic>i</italic>, <italic>j</italic> &#x03F5; <italic>V</italic>, where an edge from <italic>i</italic> to <italic>j</italic> is written &#x2329;<italic>i</italic>, <italic>j</italic>&#x232A;. We use t &#x003D; &#x007B;<italic>t<sub>i</sub></italic> |<italic>i</italic> &#x03F5; <italic>V</italic>} to denote a set of node ages. The direction of an edge &#x2329;<italic>i</italic>, <italic>j</italic>&#x232A; is such that <italic>t<sub>i</sub></italic> &#x003C; <italic>t<sub>j</sub></italic>.</p>
<p>As noted in the manuscript, MCMC is an iterative algorithm for sampling from some target probability density <italic>&#x03C0;</italic>(<italic>x</italic>) by iteratively modifying the state <italic>x</italic>. At each step in the iteration, a specific proposal kernel <italic>q<sub>w</sub></italic>(<italic>x</italic>&#x2032;|<italic>x</italic>) is chosen from a fixed weighted distribution of such kernels, and a new value for the state x<sup>&#x2032;</sup>is drawn using that proposal. This new value is accepted with probability<disp-formula id="eqn6"><alternatives><graphic xlink:href="059105_eqn6.gif"/></alternatives></disp-formula> If the value is accepted it is assigned to <italic>x</italic>, otherwise <italic>x</italic> remains unchanged. The process then repeats. The term <italic>h<sub>w</sub></italic>(<italic>x</italic>&#x2032;|<italic>x</italic>) is a function which we refer to as the <italic>Hastings-Green factor</italic> or HGF for the proposal distribution, and ensures that the Markov chain defined by the MCMC algorithm is reversible. The HGF is uniquely defined by the proposal, but is often non-trivial to derive. Thus, each operator is presented below alongside its corresponding HGF.</p>
</app>
<app id="app1a">
<label>A</label>
<title>ARG scale proposal</title>
<p>This operator selects a scaling factor <italic>f</italic> uniformly at random from [<italic>&#x03B1;</italic>, <italic>&#x03B1;</italic><sup>&#x2212;1</sup>] where <italic>&#x03B1;</italic> &#x03F5; (0,1) is a tuning parameter for which smaller values yield bolder proposals. The age of every entity in the ARG, excluding leaf ages, is scaled by this one factor. The HGF for this proposal is<disp-formula id="eqn7"><alternatives><graphic xlink:href="059105_eqn7.gif"/></alternatives></disp-formula> where <italic>n</italic> is the number of entities scaled by the move.</p>
</app>
<app id="app1b">
<label>B</label>
<title>Conversion add/remove</title>
<p>With probability 1/2 this operator either deletes a randomly selected conversion, or creates a new conversion <italic>r</italic> &#x003D; (<italic>l, u, b, x, y</italic>) drawn directly from the prior<disp-formula id="eqn8"><alternatives><graphic xlink:href="059105_eqn8.gif"/></alternatives></disp-formula> where the terms on the right-hand side are those described in the manuscript. The HGF for the deletion form of the proposal is<disp-formula id="eqn9"><alternatives><graphic xlink:href="059105_eqn9.gif"/></alternatives></disp-formula> where <italic>r</italic> is the conversion selected for deletion.</p>
<p>The HGF for the addition form is simply <italic>h</italic><sub>cadd</sub>(<italic>G</italic>&#x2032;|<italic>G</italic>) &#x003D; 1/<italic>h</italic><sub>cdel</sub> (<italic>G</italic>|<italic>G</italic>&#x2032;).</p>
</app>
<app id="app1c">
<label>C.</label>
<title>Detour add/remove</title>
<p>This operator improves mixing by allowing the sampler to transition directly between ARGs that have very similar local tree sets. It does this by proposing the addition or deletion of &#x201C;detours&#x201C;: pairs of conversions (<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>) for which <italic>u</italic><sub>1</sub> and <italic>l</italic><sub>2</sub> lie on the same edge of <italic>C</italic> and for which the attachment times satisfy <italic>t<sub>u1</sub></italic> &#x003C; <italic>t<sub>l2</sub></italic>.</p>
<p>With probability 1/2 either the deletion or the addition form of the operator is selected. For addition, a conversion <italic>r</italic> is selected uniformly at random from <italic>R</italic>. Two times <italic>t<sub>d1</sub></italic> and <italic>t<sub>d2</sub></italic> are drawn from Unif(<italic>t<sub>l</sub></italic>, <italic>t<sub>u</sub></italic>) and labeled so that <italic>t<sub>d1</sub></italic> &#x003C; <italic>t<sub>d2</sub></italic>. A non-root node <italic>i</italic> is then chosen uniformly at random from <italic>V</italic>. Let <italic>i<sub>p</sub></italic> be the parent of <italic>i</italic>. If <italic>u</italic> or <italic>l</italic> lie on &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>&#x232A; or it is not the case that both <italic>t<sub>d1</sub></italic>, <italic>t<sub>d2</sub></italic> &#x03F5; [<italic>t<sub>i</sub></italic>, <italic>t<sub>ip</sub></italic>] then the proposal is immediately rejected. Otherwise, <italic>r</italic> is replaced with a pair of conversions <italic>r</italic>&#x2032;<sub>1</sub> &#x003D; (<italic>l</italic>, <italic>u</italic>&#x2032;, <italic>b</italic>, <italic>x</italic>, <italic>y</italic>) and <italic>r</italic>&#x2032;<sub>2</sub> &#x003D; (<italic>l</italic>&#x2032;, <italic>u</italic>, <italic>b</italic>, <italic>x</italic>&#x2032;, <italic>y</italic>&#x2032;) where <italic>l</italic>&#x2032; and <italic>u</italic>&#x2032; are the points on &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>&#x232A; with times <italic>t<sub>d1</sub></italic> and <italic>t<sub>d2</sub></italic> respectively, and <italic>x</italic>&#x2032; and &#x2032;<italic>y</italic> and <italic>b</italic>&#x2032; are drawn from the affected site region boundary priors <italic>P</italic>(<italic>b</italic>|<italic>B</italic>, <italic>&#x03B4;</italic>), <italic>P</italic>(<italic>x</italic>|<italic>b</italic>, <italic>&#x03B4;</italic>) and <italic>P</italic>(<italic>y</italic>|<italic>x</italic>, <italic>b</italic>, <italic>&#x03B4;</italic>).</p>
<p>For deletion, a non-root node <italic>i</italic> is chosen uniformly at random from <italic>V</italic>, and <italic>i<sub>p</sub></italic> is defined as its parent. A pair of conversions <italic>r</italic><sub>1</sub> and r<sub>2</sub> are chosen uniformly at random satisfying the requirements <italic>u</italic><sub>1</sub> &#x2260; <italic>l</italic><sub>1</sub>, <italic>u</italic><sub>2</sub> &#x2260; <italic>l</italic><sub>2</sub>, <italic>u</italic><sub>1</sub> lies on &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>&#x232A; and <italic>l</italic><sub>2</sub> lies on &#x2329;<italic>i</italic>,<italic><sub>ip</sub></italic>&#x232A;. This pair is replaced by a single conversion <italic>r</italic>&#x2032; &#x003D; (<italic>l</italic><sub>1</sub>,<italic>u</italic><sub>2</sub>,<italic>b</italic><sub>1</sub>,<italic>x</italic><sub>1</sub>,<italic>y</italic><sub>1</sub>). The HGF for the addition form is<disp-formula id="eqn10"><alternatives><graphic xlink:href="059105_eqn10.gif"/></alternatives></disp-formula> where <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline9.gif"/></alternatives></inline-formula> is the number of conversions <italic>r</italic>&#x2032;&#x2032; in <italic>R</italic>&#x2032; where <italic>u</italic>&#x2032;&#x2032; and <italic>l</italic>&#x2032;&#x2032; lie on distinct CF edges and where <italic>u</italic>&#x2032;&#x2032; lies on &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>}. Similarly <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline10.gif"/></alternatives></inline-formula> is the number of conversions with <italic>u</italic>&#x2032;&#x2032; and <italic>l</italic>&#x2032;&#x2032; on distinct edges and where <italic>l</italic>&#x2032;&#x2032; lies on &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>&#x232A;. For the deletion form the HGF is <disp-formula id="eqn11"><alternatives><graphic xlink:href="059105_eqn11.gif"/></alternatives></disp-formula></p>
</app>
<app id="app1d">
<label>D.</label>
<title>Redundant conversion add/remove</title>
<p>This operator adds or removes a conversion that mirrors an existing edge in <italic>C</italic>, meaning that the conversion doesn&#x2032;t introduce a change in the local tree topology. The boldness of the move is adjustable via the tuning parameter <italic>&#x03BB;</italic>.</p>
<p>With probability 1/2 the addition or removal form of the operator is selected. For addition, a non-root node <italic>i</italic> is drawn uniformly at random from <italic>V</italic>, and <italic>i<sub>p</sub></italic> is defined as its parent. A new conversion <italic>r</italic> &#x003D; (<italic>l</italic>, <italic>u</italic>, <italic>b</italic>, <italic>x</italic>, <italic>y</italic>) is created with <italic>x</italic>, <italic>y</italic> and <italic>b</italic> drawn from the prior <italic>P</italic>(<italic>x</italic>, <italic>y</italic>, <italic>b</italic>| <italic>B</italic>, <italic>&#x03B4;</italic>). The departure point <italic>l</italic> is drawn uniformly from the portions of edges around <italic>i</italic> with an age difference of at most <italic>&#x03BB;</italic> from <italic>t<sub>i</sub></italic>. Similarly, <italic>u</italic> is drawn from the portions of edges around <italic>i<sub>p</sub></italic> that differ in age by at most <italic>&#x03BB;</italic> from <italic>t<sub>ip</sub></italic>.</p>
<p>For removal, a non-root node <italic>i</italic> is also drawn uniformly from <italic>V</italic>, with <italic>i<sub>p</sub></italic> again defined as its parent. The sub-set <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline11.gif"/></alternatives></inline-formula> of <italic>R</italic> consisting of those conversions which could have been generated by the addition form of the move applied to the same CF edge &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>&#x232A;with a given <italic>&#x03BB;</italic> is constructed. A member <italic>r</italic> of this set is selected uniformly at random and is deleted.</p>
<p>The HGF for the addition form is<disp-formula id="eqn12"><alternatives><graphic xlink:href="059105_eqn12.gif"/></alternatives></disp-formula>where <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline12.gif"/></alternatives></inline-formula> is the sum of the lengths of the CF edge portions around <italic>i</italic> from which <italic>l</italic> is drawn. Similarly, <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline13.gif"/></alternatives></inline-formula> is the sum of the lengths of the CF edge portions around <italic>i<sub>p</sub></italic> from which <italic>u</italic> is drawn. The primed <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline14.gif"/></alternatives></inline-formula> is the subset of <italic>R</italic>&#x2032; of conversions, including <italic>r</italic>, which could have been produced by this proposal.</p>
<p>For deletion, the HGF is<disp-formula id="eqn13"><alternatives><graphic xlink:href="059105_eqn13.gif"/></alternatives></disp-formula></p>
</app>
<app id="app1e">
<label>E.</label>
<title>Merge/Split conversion</title>
<p>This operator reversibly merges two conversions whose arrival and departure points share the same pair of CF edges.</p>
<p>A locus <italic>b</italic> is drawn from the prior <italic>P</italic>(<italic>b</italic>| <italic>B</italic>, <italic>&#x03B4;</italic>). With probability 1/2 the merge or split form of the operator is selected. For merging, two conversions <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> are sampled without replacement from the subset <italic>R</italic><sub><italic>b</italic></sub> &#x2282; <italic>R</italic> containing only those conversions affecting locus <italic>b</italic>. This pair of conversions is replaced by a new conversion <italic>r</italic>&#x2032; &#x003D;(<italic>l</italic><sub>1</sub>, <italic>u</italic><sub>1</sub>, <italic>b</italic>, <italic>x</italic><sub>1</sub> &#x2228; <italic>x</italic><sub>2</sub>,<italic>y</italic><sub>1</sub> &#x2227; <italic>y</italic><sub>2</sub>).</p>
<p>For splitting, conversion <italic>r</italic> is drawn from <italic>R</italic><sub><italic>b</italic></sub>. Let <italic>i</italic> be the CF node below the edge containing <italic>l</italic> and <italic>j</italic> be the CF node below the edge containing <italic>u</italic>, and define <italic>i<sub>p</sub></italic> and <italic>j<sub>p</sub></italic> to be the parents of these nodes (in the instance that <italic>j</italic> is the root CF node, <italic>j<sub>p</sub></italic> is not defined). Two sites <italic>m</italic><sub>1</sub> and <italic>m</italic><sub>2</sub> are drawn uniformly from the site range [<italic>x</italic>, <italic>y</italic>]. With probability 1/2 we either define <italic>x&#x2032;<sub>1</sub></italic> &#x003D; <italic>x</italic> and <italic>x&#x2032;<sub>2</sub></italic> &#x003D; <italic>m<sub>1</sub></italic> or <italic>x&#x2032;<sub>1</sub></italic> &#x003D; <italic>m<sub>1</sub></italic> and <italic>x</italic>&#x2032;<sub>2</sub> &#x003D; <italic>x</italic>. Similarly, with probability 1/2 we either define <italic>y</italic>&#x2032;<sub>1</sub> &#x003D; <italic>y</italic> and <italic>y</italic>&#x2032;<sub>2</sub> &#x003D; <italic>m</italic><sub>2</sub> or <italic>y</italic>&#x2032;<sub>1</sub> &#x003D; <italic>m</italic><sub>2</sub> and <italic>y</italic>&#x2032;<sub>2</sub> &#x003D; <italic>y</italic>. Additionally, <italic>l</italic>&#x2032;<sub>2</sub> is a uniformly sampled point on the edge &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>&#x232A;. In the case that <italic>j</italic> is not the root, <italic>u</italic>&#x2032;<sub>2</sub>, is sampled uniformly from &#x2329;<italic>j</italic>, <italic>j<sub>p</sub></italic>&#x232A;. Otherwise, the difference between the age of <italic>u</italic>&#x2032;, <italic>t</italic><sub><italic>u</italic>&#x2031;</sub>, and the age of the root, <italic>t</italic><sub>j</sub>, is drawn from the exponential distribution Exp (1/ (<italic>t<sub>u</sub> &#x2212; tj</italic>)). Conversion <italic>r</italic> is then replaced by a pair of conversions <italic>r</italic>&#x2032;<sub>1</sub> &#x003D; (<italic>l</italic>, <italic>u</italic>, <italic>b</italic>, <italic>x</italic>&#x2032;<sub>1</sub>, <italic>y</italic>&#x2032;<sub>1</sub>) and <italic>r</italic>&#x2032;<sub>2</sub> &#x003D; (<italic>l</italic>&#x2032;<sub>2</sub>, <italic>u</italic>&#x2032;<sub>2</sub>, <italic>b</italic>, <italic>x</italic>&#x2032;<sub>2</sub>, <italic>y</italic>&#x2032;<sub>2</sub>).</p>
<p>The HGF for the merge form is<disp-formula id="eqn14"><alternatives><graphic xlink:href="059105_eqn14.gif"/></alternatives></disp-formula> and for the split form is<disp-formula id="eqn15"><alternatives><graphic xlink:href="059105_eqn15.gif"/></alternatives></disp-formula> where <disp-formula id="eqn16"><alternatives><graphic xlink:href="059105_eqn16.gif"/></alternatives></disp-formula></p>
</app>
<app id="app1f">
<label>F.</label>
<title>Converted edge hop</title>
<p>This operator simply repositions the arrival or departure point of a randomly chosen conversion to be a new point on the tree. It proceeds by choosing a conversion <italic>r</italic> uniformly at random from <italic>R</italic>. Then, if <italic>u</italic> is above the root of <italic>C</italic> or with probability 1/2, <italic>l</italic>&#x2032; is drawn from a uniform density over <italic>C</italic> and <italic>u</italic>&#x2032; is set to <italic>u</italic>. Otherwise, <italic>l</italic>&#x2032; is set to <italic>l</italic> and <italic>u</italic>&#x2032; is drawn from a uniform density over <italic>C</italic>. In either case, if <italic>t</italic><sub><italic>u</italic>&#x2032;</sub> &#x003E; <italic>t<sub>l</sub></italic>, then <italic>r</italic> is replaced by a new conversion <italic>r</italic>&#x2032; &#x003D; (<italic>l</italic>&#x2032;, <italic>u</italic>&#x2032;, <italic>b</italic>, <italic>x</italic>, <italic>y</italic>). If this condition is not met, the proposal is rejected.</p>
<p>The HGF for this move is unity.</p>
</app>
<app id="app1G">
<label>G.</label>
<title>Converted edge flip</title>
<p>This is a simple proposal which reverses the direction of gene flow resulting from a given conversion. It is especially useful when this direction is not informed strongly (or at all) by the data. It involves firstly selecting a conversion <italic>r</italic> uniformly from <italic>R</italic> and defining <italic>e<sub>l</sub></italic> as the CF edge containing the departure point <italic>l</italic> and <italic>e<sub>u</sub></italic> as the CF edge containing the arrival point <italic>u</italic>. If <italic>t<sub>u</sub></italic> falls outside of the time interval spanned by <italic>e<sub>l</sub></italic> or <italic>t<sub>l</sub></italic> falls outside of the time interval spanned by <italic>e<sub>u</sub></italic> the proposal is immediately rejected. Otherwise, we then define new departure and arrival points <italic>l</italic>&#x2032; and <italic>u</italic>&#x2032; such that <italic>t<sub>l&#x2032;</sub></italic> &#x003D; <italic>t<sub>l</sub></italic> and <italic>t<sub>u&#x2032;</sub></italic> &#x003D; <italic>t<sub>u</sub></italic> but with <italic>e<sub>l&#x2032;</sub></italic> &#x003D; <italic>e<sub>u</sub></italic> and <italic>e<sub>u&#x2032;</sub></italic> &#x003D; <italic>e<sub>l</sub></italic>. Finally, we replace the conversion <italic>r</italic> with <italic>r</italic>&#x2032; &#x003D; (<italic>l</italic>&#x2032;, <italic>u</italic>&#x2032;, <italic>b</italic>, <italic>x</italic>, <italic>y</italic>).</p>
<p>The HGF for this move is unity.</p>
</app>
<app id="app1H">
<label>H.</label>
<title>Converted edge slide</title>
<p>This proposal &#x2032;slides&#x2032; a randomly selected arrival or departure point up or down the CF, with maximum size of the slide relative to the height of <italic>C</italic>, <italic>t<sub>o</sub></italic>, is fixed by a tuning parameter <italic>&#x03B2;</italic> &#x03F5; (0,1).</p>
<p>Firstly, the conversion is selected uniformly from <italic>R</italic> and a CF attachment point <italic>p</italic> is chosen uniformly from &#x007B;<italic>l</italic>, <italic>u</italic>&#x007D;. An age increment &#x0394;t is then drawn uniformly from [&#x2212;<italic>&#x03B2;t</italic><sub>0</sub>, <italic>&#x03B2;t</italic><sub>0</sub>]. In the instance that &#x0394;<italic>t</italic> &#x003E; 1, the new attachment point <italic>p</italic>&#x2032; (i.e. <italic>l</italic>&#x2032; or <italic>u</italic>&#x2032; depending on the choice of <italic>l</italic> or <italic>u</italic> for <italic>p</italic>) is chosen to be that point on the lineage ancestral to <italic>p</italic> with <italic>t<sub>p&#x2032;</sub></italic> &#x003D; <italic>t<sub>p</sub></italic> &#x002B; &#x0394;<italic>t</italic> (If <italic>p &#x003D; l</italic> and <italic>t<sub>p&#x2032;</sub></italic> &#x003E; <italic>t<sub>u</sub></italic> &#x2227; <italic>t<sub>o</sub></italic> the move is immediately rejected.)</p>
<p>On the other hand, if &#x0394;<italic>t</italic> &#x003C; 0 the new attachment point <italic>p</italic>&#x2032; is chosen to be a point on a descendant lineage with <italic>t<sub>p&#x2032;</sub></italic> &#x003D; <italic>t<sub>p</sub></italic> &#x002B; &#x0394;<italic>t</italic>. (If <italic>p</italic> &#x003D; <italic>u</italic> and <italic>t<sub>p&#x2032;</sub></italic> &#x003C; <italic>t<sub>l</sub></italic> the move is immediately rejected.) In the instance that <italic>t</italic><sub><italic>p</italic>&#x2032;</sub> is smaller than the age of the node below the CF edge containing <italic>p</italic>, there are multiple points on descendant lineages that satisfy this requirement. A particular point is chosen by tracing the CF lineage down from <italic>p</italic> and uniformly selecting the left or right child lineage of any CF node that is passed along the way to the final point <italic>p</italic>&#x2032;. (If a leaf CF node is passed during this procedure the move is rejected immediately.)</p>
<p>In either case, the original conversion <italic>r</italic> is replaced by a new conversion <italic>r</italic>&#x2032; defined as either (<italic>l</italic>&#x2032;, <italic>u</italic>, <italic>b</italic>, <italic>x</italic>, <italic>y</italic>) or (<italic>l</italic>, <italic>u</italic>&#x2032;, <italic>b</italic>, <italic>x</italic>, <italic>y</italic>) depending on whether <italic>p</italic> represents an arrival or departure point, respectively.</p>
<p>The HGF for the move is <disp-formula id="eqn17"><alternatives><graphic xlink:href="059105_eqn17.gif"/></alternatives></disp-formula>where <italic>sgn</italic>(&#x0394;<italic>t</italic>) is the sign of &#x0394;<italic>t</italic> and where <italic>n</italic>(<italic>p</italic>, <italic>p</italic>&#x2032;) is the number of nodes on the CF on the lineage between points <italic>p</italic> and <italic>p</italic>&#x2032;.</p>
</app>
<app id="app1i">
<label>I.</label>
<title>Converted region swap</title>
<p>This proposal simply involves drawing two conversions <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> uniformly without replacement from <italic>R</italic> and swapping the loci and site ranges they affect. That is, the pair is replaced by a new pair <italic>r</italic>&#x2032;<sub>1</sub> &#x003D; (<italic>l</italic><sub>1</sub>, <italic>u</italic><sub>1</sub>, <italic>b</italic><sub>2</sub>, <italic>x</italic><sub>2</sub>, <italic>y</italic><sub>2</sub>) and <italic>r</italic>&#x2032;<sub>2</sub> &#x003D; (<italic>l</italic><sub>2</sub>, <italic>u</italic><sub>2</sub>, <italic>b</italic><sub>1</sub>, <italic>x</italic><sub>1</sub>, <italic>y</italic><sub>1</sub>).</p>
<p>The HGF for this move is unity.</p>
</app>
<app id="app1j">
<label>J.</label>
<title>Converted region (boundary) shift</title>
<p>The converted region shift and converted region boundary shift propose adjustments to the region affected by a given conversion. Both use a tuning parameter <italic>&#x03B3;</italic> that defines maximum size of the adjustment that can be made. The proposals begin by a conversion <italic>r</italic> is selected uniformly at random from <italic>R</italic>. A shift amount &#x0394; is then drawn uniformly from [&#x2212;<italic>l<sub>b</sub>&#x03B3;</italic>/2, <italic>l<sub>b</sub>&#x03B3;</italic>/2]. In the case of the region shift proposal, <italic>x</italic>&#x2032; &#x003D; <italic>x</italic> &#x002B; &#x0394; and <italic>y</italic>&#x2032; &#x003D; <italic>y</italic> &#x002B; &#x0394;. In the case of the region boundary shift proposal, either <italic>x</italic>&#x2032; &#x003D; <italic>x</italic> &#x002B; &#x0394; and <italic>y</italic>&#x2032; &#x003D; <italic>y</italic> or <italic>x</italic>&#x2032; &#x003D; <italic>x</italic> and <italic>y</italic>&#x2032; &#x003D; <italic>y</italic> &#x002B; &#x0394; with probability 1/2 The proposal is immediately rejected if either <italic>x</italic>&#x2032; or <italic>y</italic>&#x2032; lie outside of the allowed site range [1, <italic>l<sub>b</sub></italic>] for locus <italic>b</italic>. The conversion <italic>r</italic> is then replaced by a new conversion <italic>r</italic>&#x2032; &#x003D; (<italic>l</italic>, <italic>u</italic>, <italic>b</italic>, <italic>x</italic>&#x2032;, <italic>y</italic>&#x2032;).</p>
<p>The HGF for this move is unity.</p>
</app>
<app id="app1k">
<label>K.</label>
<title>Clonal frame operators</title>
<p>With the exception of the topology-preserving temporal scaling operator, every move described thus far has proposed changes only to the set of conversions <italic>R</italic> applied to <italic>C</italic>, not <italic>C</italic> itself. Operators which propose changes to <italic>C</italic> are clearly of central importance to an algorithm designed to explore the joint (<italic>R</italic>, <italic>C</italic>) state space. As explained in the main text, our strategy for exploring this space is to employ each of the tree operators described in <xref ref-type="bibr" rid="c10">Drummond <italic>et al.</italic> (2002)</xref> to propose changes to <italic>C</italic>, updating <italic>R</italic> concurrently in order to maintain compatibility between the conversions and the CF. This is managed by expressing each of these operators primarily in terms of two primitive operations: <italic>expand</italic> and <italic>collapse</italic>. Understanding each operation requires considering a non-root node <italic>i</italic>, its parent <italic>i<sub>p</sub></italic>, grandparent <italic>i<sub>g</sub></italic> (if it exists) and sibling <italic>i<sub>s</sub></italic> in <italic>C</italic>, as well as a distinct node <italic>j</italic> and its parent <italic>j<sub>p</sub></italic> (if it exists) in <italic>C</italic> chosen so that <italic>j</italic> &#x2209; &#x007B;<italic>i</italic>, <italic>i<sub>p</sub></italic> &#x007D; and <italic>j</italic> is not included in the subtree below <italic>i</italic>. Each operation involves &#x201C;disconnecting&#x201D; the subtree rooted by <italic>i</italic> from the rest of the clonal frame and &#x201C;reconnecting&#x201D; it to the edge above <italic>j</italic>. That is,<disp-formula id="eqn18"><alternatives><graphic xlink:href="059105_eqn18.gif"/></alternatives></disp-formula>(Edges involving <italic>j<sub>p</sub></italic> and <italic>i<sub>g</sub></italic> are only included if these nodes exist.) This rearrangement is of course only valid if t is also updated so that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline15.gif"/></alternatives></inline-formula> if <italic>j<sub>p</sub></italic> exists or <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline16.gif"/></alternatives></inline-formula> if it <italic>j</italic> is root in <italic>C</italic>. If such a modification is impossible, the proposal invoking the expansion or collapse is rejected immediately.</p>
<p>In terms of their effect on the CF, the only difference between the two operations is the sign of the difference <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline17.gif"/></alternatives></inline-formula>: expansions increase the age of <italic>i<sub>p</sub></italic> while collapses decrease this age. The effects on the set <italic>R</italic> of conversions are quite different, however.</p>
<p>For expansion, the set of conversion connections <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline18.gif"/></alternatives></inline-formula> containing only those connections with <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline19.gif"/></alternatives></inline-formula> is constructed. Each of these attachment points are, with probability 1/2, moved in <italic>R</italic>&#x2032; to the contemporaneous point on the newly lengthened edge &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>&#x232A;. Additionally, in the case that <italic>j</italic> is the root of <italic>C</italic> (making <italic>i<sub>p</sub></italic> the root of <italic>C</italic>), a set Z&#x2032; of new conversions are initiated along edges &#x2329;<italic>j</italic>, <italic>i<sub>p</sub></italic>&#x232A; and &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>&#x232A; with arrival points uniformly distributed amongst the portion of these edges at ages greater than <italic>t<sub>j</sub></italic> &#x2228;<italic>t<sub>ip</sub></italic>. The expansion operation makes the following contribution to the HGF:<disp-formula id="eqn19"><alternatives><graphic xlink:href="059105_eqn19.gif"/></alternatives></disp-formula> where <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline20.gif"/></alternatives></inline-formula> and &#x03A9; &#x003D; &#x03A3;<sub><italic>b&#x03F5;B</italic></sub>(<italic>&#x03C1;L</italic><sub><italic>b</italic></sub> &#x002B; <italic>&#x03B4;</italic> &#x2212; 1).</p>
<p>For collapse, the set of conversion connections <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline21.gif"/></alternatives></inline-formula> containing only those connections which lie on &#x2329;<italic>i</italic>, <italic>i<sub>p</sub></italic>&#x232A; which have <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline22.gif"/></alternatives></inline-formula> is constructed. Note that in the case that <italic>i<sub>p</sub></italic> is the root of <italic>C</italic>, this set omits any attachment points belonging to conversions with arrival points <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline23.gif"/></alternatives></inline-formula>. Such conversions are assigned to the set <italic>Z</italic>, along with conversions with arrival times in the same interval which lie on &#x2329;<italic>i<sub>s</sub></italic>, <italic>i<sub>p</sub></italic>&#x232A;. Each attachment in <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline24.gif"/></alternatives></inline-formula> is moved to the lineage ancestral to <italic>j</italic>. Every conversion in <italic>Z</italic> is removed. The collapse operation makes the following contribution to the HGF:<disp-formula id="eqn20"><alternatives><graphic xlink:href="059105_eqn20.gif"/></alternatives></disp-formula> where <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline25.gif"/></alternatives></inline-formula> and &#x03A9; is as defined above.</p>
<p>We now describe each of the individual CF proposals. Note that with the exception of the CF/conversion swap operator (which is unique to our algorithm) we do not quantitatively describe how each move affects the CF, but instead explain how their operation is implemented in terms of expansions and contractions. Interested readers should refer to <xref ref-type="bibr" rid="c10">Drummond et al. (2002)</xref> to complete the descriptions.</p>
<p><bold>Uniform operator</bold>: This operator proposes a new age <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline26.gif"/></alternatives></inline-formula> for randomly-selected non-root internal node <italic>i<sub>p</sub></italic> within the interval imposed by the maximum age <italic>t<sub>i</sub></italic> &#x2227; <italic>t<sub>is</sub></italic> of its children, <italic>i</italic> and <italic>i<sub>s</sub></italic>, and the age <italic>t</italic><sub><italic>i</italic><sub><italic>g</italic></sub></sub> of its parent, <italic>i<sub>g</sub></italic>. This move is implemented as either a single expansion <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline27.gif"/></alternatives></inline-formula> if <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline28.gif"/></alternatives></inline-formula> or a single collapse <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline29.gif"/></alternatives></inline-formula> if <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline30.gif"/></alternatives></inline-formula>.</p>
<p><bold>Subtree exchange operator</bold>: This operator exchanges two distinct subtrees rooted by non-root nodes <italic>i</italic><sup>(1)</sup> and <italic>i</italic><sup>(2)</sup> and their respective parents, <italic>i</italic><sub><italic>p</italic></sub><sup>(1)</sup> and <italic>i</italic><sub><italic>p</italic></sub><sup>(2)</sup>, and siblings <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline31.gif"/></alternatives></inline-formula> and <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline32.gif"/></alternatives></inline-formula>. The operator is implemented via serial application of two primitive expand/collapse operations, with the type of operation determined by the relative ages of the parent nodes. If <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline33.gif"/></alternatives></inline-formula> the operations are <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline34.gif"/></alternatives></inline-formula> followed by followed by <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline35.gif"/></alternatives></inline-formula>. Otherwise, the operations are <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline36.gif"/></alternatives></inline-formula> followed by <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline37.gif"/></alternatives></inline-formula>.</p>
<p><bold>Wilson-Balding operator</bold>: This operator takes a subtree rooted by the non-root node <italic>i</italic>, detaches it from the rest of the CF, then reattaches it to some other point at time <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline38.gif"/></alternatives></inline-formula> on the edge above a randomly chosen node <italic>j</italic>. (This is essentially the rooted time-tree equivalent of the Nearest Neighbour Interchange or NNI move used in walking the space of unrooted trees.) Besides selecting the nodes involved and the new time, this move involves just a single expand/collapse operation. If <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline39.gif"/></alternatives></inline-formula> operation is <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline40.gif"/></alternatives></inline-formula>, otherwise it is <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline41.gif"/></alternatives></inline-formula>.</p>
<p><bold>CF/conversion swap operator</bold>: This final operator aims to in some sense swap the role of a conversion and a CF edge in describing a particular portion of the ARG topology. To do this, a conversion r is selected at random from the subset of <italic>D</italic> &#x2286; <italic>R</italic> including only those conversions for which the arrival and departure points lie on distinct edges of <italic>C</italic>. The node below the edge containing, is labeled <italic>i</italic>, its sister <italic>i<sub>s</sub></italic>, and the node below the edge containing <italic>u</italic> is labeled <italic>j</italic>. For the purpose of the expand/collapse operation, <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline42.gif"/></alternatives></inline-formula>. The conversion <italic>r</italic> is then replaced by <italic>r</italic>&#x2032; &#x003D; (<italic>l</italic>, <italic>u</italic>&#x2032;, <italic>b</italic>&#x2032;, <italic>x</italic>&#x2032;,<italic>y</italic>&#x2032;), where <italic>u</italic>&#x2032; is the point on the edge above <italic>i<sub>s</sub></italic> with time <italic>t</italic><sub><italic>i</italic><sub><italic>p</italic></sub></sub> and where <italic>b</italic>&#x2032;, <italic>x</italic>&#x2032; and <italic>y</italic>&#x2032; define a new affected site range drawn from the prior <italic>P</italic>(<italic>b</italic>&#x2032;, <italic>x</italic>&#x2032;,<italic>y</italic>&#x2032;|<italic>B</italic>, <italic>&#x03B4;</italic>). Finally, if <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline43.gif"/></alternatives></inline-formula> the expansion <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline44.gif"/></alternatives></inline-formula> is performed, otherwise the collapse <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="059105_inline45.gif"/></alternatives></inline-formula> is performed. The HGF for this proposal is<disp-formula id="eqn21"><alternatives><graphic xlink:href="059105_eqn21.gif"/></alternatives></disp-formula> where <italic>h</italic><sub>op</sub> (<italic>G</italic>&#x2032;|<italic>G</italic>) represents the HGF contribution of the particular expand/collapse operation performed.</p>
</app>
</app-group>
</back>
</article>
