<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">BIORXIV</journal-id>
<journal-title-group>
<journal-title>bioRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/117838</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="author-type">
<subject>Regular Article</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>New Results</subject>
</subj-group>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Bioinformatics</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Probabilistic recovery of cryptic haplotypes from metagenomic data</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4081-065X</contrib-id>
<name>
<surname>Nicholls</surname>
<given-names>Samuel M.</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3351-1758</contrib-id>
<name>
<surname>Aubrey</surname>
<given-names>Wayne</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>de Grave</surname>
<given-names>Kurt</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a4">4</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Schietgat</surname>
<given-names>Leander</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7183-1555</contrib-id>
<name>
<surname>Creevey</surname>
<given-names>Christopher J.</given-names>
</name>
<xref ref-type="aff" rid="a3">3</xref>
<xref ref-type="author-notes" rid="n1">&#x002A;</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-8315-3659</contrib-id>
<name>
<surname>Clare</surname>
<given-names>Amanda</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="author-notes" rid="n1">&#x002A;</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Department of Computer Science, Aberystwyth University</institution>, Aberystwyth, SY23 3DB, <country>United Kingdom</country></aff>
<aff id="a2"><label>2</label><institution>Department of Computer Science, Katholieke Universiteit Leuven</institution>, Celestijnenlaan 200A, 3001 Leuven, <country>Belgium</country></aff>
<aff id="a3"><label>3</label><institution>Institute of Biological, Environmental and Rural Sciences, Aberystwyth University</institution>, Aberystwyth, SY23 3DA, <country>United Kingdom</country></aff>
<aff id="a4"><label>4</label><institution>Flanders Make, Oude Diestersebaan 133, 3920 Lommel</institution>, <country>Belgium</country></aff>
</contrib-group>
<author-notes>
<fn id="n1"><label>&#x002A;</label><p>The authors wish it to be known that in their opinion, the last two authors should be regarded as joint Last Authors.</p></fn>
</author-notes>
<pub-date pub-type="epub">
<year>2017</year>
</pub-date>
<elocation-id>117838</elocation-id>
<history>
<date date-type="received">
<day>17</day>
<month>3</month>
<year>2017</year>
</date>
<date date-type="accepted">
<day>17</day>
<month>3</month>
<year>2017</year>
</date>
</history>
<permissions>
<copyright-statement>&#x00A9; 2017, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2017</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="117838.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract>
<title>Abstract</title>
<p>The cryptic diversity of microbial communities represent an untapped biotechnological resource for biomining, biorefining and synthetic biology. Revealing this information requires the recovery of the exact sequence of DNA bases (or &#x201C;haplotype&#x201D;) that constitutes the genes and genomes of every individual present. This is a computationally difficult problem complicated by the requirement for environmental sequencing approaches (metagenomics) due to the resistance of the constituent organisms to culturing <italic>in vitro.</italic></p>
<p>Haplotypes are identified by their unique combination of DNA variants. However, standard approaches for working with metagenomic data require simplifications that violate assumptions in the process of identifying such variation. Furthermore, current haplotyping methods lack objective mechanisms for choosing between alternative haplotype reconstructions from microbial communities.</p>
<p>To address this, we have developed a novel probabilistic approach for reconstructing haplotypes from complex microbial communities and propose the &#x201C;metahaplome&#x201D; as a definition for the set of haplotypes for any particular genomic region of interest within a metagenomic dataset. Implemented in the twin software tools Hansel and Gretel, the algorithm performs incremental probabilistic haplotype recovery using Naive Bayes &#x2014; an efficient and effective technique.</p>
<p>Our approach is capable of reconstructing the haplotypes with the highest likelihoods from metagenomic datasets without <italic>a priori</italic> knowledge or making assumptions of the distribution or number of variants. Additionally, the algorithm is robust to sequencing and alignment error without altering or discarding observed variation and uses all available evidence from aligned reads. We validate our approach using synthetic metahaplomes constructed from sets of real genes, and demonstrate its capability using metagenomic data from a complex HIV-1 strain mix. The results show that the likelihood framework can allow recovery from microbial communities of cryptic functional isoforms of genes with 100% accuracy.</p>
</abstract>
<counts>
<page-count count="22"/>
</counts>
</article-meta>
</front>
<body>
<p>Genomic research is progressing beyond the use of consensus DNA sequences to represent species, towards the ultimate goal of complete characterisation of the genetic diversity that exists across their populations.</p>
<p>So far, research has focused on characterising specific aspects of this diversity, for example: identifying the entire gene-set of all strains of a species (the pangenome) [<xref ref-type="bibr" rid="c1">1</xref>]; identifying the groups of genes (or genetic variants within) that are inherited together in organisms across entire populations (the haplome) [<xref ref-type="bibr" rid="c2">2</xref>] or in viruses, identifying strains related by mutations in a highly mutagenic environment (the quasispecies) [<xref ref-type="bibr" rid="c3">3</xref>].</p>
<p>However many communities (and especially microbial communities) maintain a fine balance between stability and plasticity that is driven both by their genetic breadth and diversity [<xref ref-type="bibr" rid="c4">4</xref>, <xref ref-type="bibr" rid="c5">5</xref>, <xref ref-type="bibr" rid="c6">6</xref>, <xref ref-type="bibr" rid="c7">7</xref>]. This necessitates a more holistic approach to allow the simultaneous characterisation of all haplotypes of all organisms in a microbial community (the &#x201C;metahaplome&#x201D;).</p>
<p>Complete characterisation of the metahaplome has great biotechnological potential as it would divulge the full repertoire of enzyme isoforms for an organism (or community) and could also guide future antibiotic design [<xref ref-type="bibr" rid="c8">8</xref>]. As DNA sequencing technologies advance to produce increasingly longer reads, the depiction of complete haplotypes of species in mixed communities would also become tractable and provide vital missing information for future synthetic biology needs [<xref ref-type="bibr" rid="c9">9</xref>].</p>
<p>The general problem of haplotyping, first introduced in 2001 as single individual haplotyping (SIH) [<xref ref-type="bibr" rid="c10">10</xref>], has been demonstrated to be computationally difficult (NP-hard) [<xref ref-type="bibr" rid="c11">11</xref>] and so focus has moved towards the use of heuristics to make the generation of approximate solutions to SIH both computationally tractable and accurate [<xref ref-type="bibr" rid="c12">12</xref>, <xref ref-type="bibr" rid="c13">13</xref>, <xref ref-type="bibr" rid="c14">14</xref>, <xref ref-type="bibr" rid="c15">15</xref>, <xref ref-type="bibr" rid="c16">16</xref>].</p>
<p>However, many current approaches have been developed for diploid species or for those with well-defined genomes such as human [<xref ref-type="bibr" rid="c17">17</xref>, <xref ref-type="bibr" rid="c18">18</xref>]. Few are appropriate for organisms where no reference genomes exist or where, in the case of microbes, only a small proportion can be cultured successfully <italic>in vitro.</italic> In these cases, haplotypes must be recovered from DNA isolated and sequenced directly from the environment (metagenomics). Furthermore, in complex datasets such as these, many alternative haplotypes may be possible and there are no methods that can provide the user with an objective function for choosing the best candidates.</p>
<p>The generation of haplotypes from metagenomes is particularly difficult as existing <italic>de novo</italic> analysis pipelines for DNA sequence data generally assume a single individual of origin and, when applied to metagenomic datasets, remove low level variation and produce single consensus sequences [<xref ref-type="bibr" rid="c19">19</xref>]. Even specialised metagenomic assemblers [<xref ref-type="bibr" rid="c19">19</xref>, <xref ref-type="bibr" rid="c20">20</xref>, <xref ref-type="bibr" rid="c21">21</xref>] do not aim to solve the problem of recovering haplotypes.</p>
<p>Whilst researchers have identified the problem that consensus assembly poses for the downstream analysis of variants [<xref ref-type="bibr" rid="c22">22</xref>] and are moving towards alternative assembly approaches, such as graph-based assembly [<xref ref-type="bibr" rid="c23">23</xref>], there is still no method for the recovery of individual haplotypes for regions of a metagenome.</p>
<p>To address this need, we have developed a Bayesian framework capable of recovering and ranking haplotypes using evidence of pairs of Single Nucleotide Polymorphisms (SNPs) observed on sequenced reads. While specifically designed to extract haplotypes from metagenomic data of complex microbial communities, the algorithm is general enough to be applied to any analogous haplotyping problem.</p>
<p>We evaluate our approach on metagenomes from both simulated and real sets of genes and identify the haplotypes with the best likelihoods from Influenza and HIV datasets. We demonstrate how, for the first time, the most likely haplotypes can be recovered with high fidelity from complex metagenomic samples enabling the characterisation of the cryptic diversity in microbial communities.</p>
<sec id="s1">
<title>Results</title>
<sec id="s1a">
<title>The metahaplome</title>
<p>We define the metahaplome as the set of haplotypes for any particular genomic region of interest within a metagenomic data set. A full mathematical definition is available in <xref ref-type="sec" rid="s6">Supplementary Section 1</xref>.</p>
</sec>
<sec id="s1b">
<title>Hansel and Gretel</title>
<p>We have developed <bold>Hansel</bold>, a data structure designed to efficiently store variation observed across sequenced reads, and <bold>Gretel</bold>, an algorithm that leverages <bold>Hansel</bold> for the recovery of haplotypes from a metagenome. Advantages include that our method:
<list list-type="bullet">
<list-item>
<p>recovers haplotypes from metagenomic data</p></list-item>
<list-item>
<p>does not need <italic>a priori</italic> knowledge of the number of haplotypes</p></list-item>
<list-item>
<p>makes no assumptions about the distribution of alleles at any variant site</p></list-item>
<list-item>
<p>does not need to distinguish between sequence error and variation</p></list-item>
<list-item>
<p>uses all available evidence provided by the raw reads</p></list-item>
<list-item>
<p>does not require any user-defined parameters</p></list-item>
<list-item>
<p>does not require bootstrapping, model building or pre-processing</p></list-item>
<list-item>
<p>can confidently rank its own results based on calculated likelihoods</p></list-item>
<list-item>
<p>can be executed on an ordinary computer</p></list-item>
</list></p>
<p>The details of the data structure and algorithm are provided in the Online Methods. We provide open source implementations for the data structure API (<bold>Hansel</bold>) and the haplotype recovery algorithm (<bold>Gretel</bold>) at <ext-link ext-link-type="uri" xlink:href="https://github.com/samstudio8/gretel">https://github.com/samstudio8/gretel</ext-link>.</p>
<p>We show in <italic>silico</italic> that recovery of haplotypes from simple metahaplomes is possible even with data sets consisting of short reads. Recovery success depends on the availability of sufficient read coverage and enough variation to ensure that all pairs of adjacent SNPs are covered by at least one read. The following subsections describe the datasets used to evaluate <bold>Hansel</bold> and <bold>Gretel</bold>, and the results of this evaluation.</p>
</sec>
<sec id="s1c">
<title>Synthetic metahaplomes</title>
<p>We evaluated the fidelity of the haplotype reconstructions from <bold>Hansel</bold> and <bold>Gretel</bold> using synthetic metahaplomes. Each synthetic metahaplome consisted of five 3000 bp haplotypes generated by simulated evolution using <bold>seq-gen</bold> [<xref ref-type="bibr" rid="c24">24</xref>], with a fixed mutation rate and a star phylogeny (see Methods). Five replicates of seven different mutation rates were generated for a total of 35 metahaplomes.</p>
<p>For each of the 35 metahaplomes simulated by <bold>seq-gen</bold>, we generated 180 sets of uniformly distributed pseudo-reads consisting of 10 replicates for each pairing of 3 read sizes and 6 per-haplotype depths. For the purpose of read alignment and variant calling, we aligned each read set against the 3000 nt starting sequence initially provided to <bold>seq-gen</bold>. Variants were called by assuming any heterogeneous genomic position over the aligned reads was a SNP.</p>
<p>A single run of <bold>Gretel</bold> will repeatedly recover haplotypes until the stopping criteria specified is met (see Methods). For each synthetic metahaplome replicate, we evaluated the fidelity of haplotypes reconstructed by <bold>Gretel</bold> though comparison with the input sequences used to generate the data. The reconstructed haplotype sequence with the greatest proportion of heterozygous positions in agreement with each of the original simulated sequences were determined. We present this recovery rate for the seven mutation rates in combination with the 3 read sizes and 6 per-haplotype read depths used (<xref ref-type="fig" rid="fig1">Fig. 1</xref>).</p>
<fig id="fig1" position="float" orientation="portrait" fig-type="figure">
<label>Figure 1:</label>
<caption><p>Boxplots summarising the proportion of variants on an input haplotype correctly recovered (y-axes) from groups of synthetic metahaplomes by <bold>Gretel</bold>. Single boxplots present recoveries from a set of five metahaplomes generated with some per-haplotype mutation rate (column facets), over 10 different synthetic read sets with varying read length (row facets) and per-haplotype read depth (colour fill). Each box-with-whiskers summarises the proportion of correctly recovered variants over the 250 best recovered haplotypes (yielded from 50 <bold>Gretel</bold> runs (5 metahaplome replicates &#x00D7; 10 read sets), each returning 5 best outputs). We demonstrate better haplotype recoveries can be achieved with longer reads and more dense coverage, as well as the limitations of recovery on data exhibiting fewer SNPs/hb. This figure may be used as a naive lookup table to assess potential recovery rates for one&#x0027;s own data by estimating the level of variation, with the average read length and per-haplotype depth.</p></caption>
<graphic xlink:href="117838_fig1.tif"/>
</fig>
<p>We found that haplotype recovery improves with longer reads and greater coverage. We also observed potential lower bounds on our ability to recover haplotypes from a data set, as the facets with no successful recoveries show. Unsuccessful recoveries are a result of at least one pair of adjacent variants failing to be covered by any read, which is a requirement imposed on <bold>Gretel</bold> for recovery (see Methods). For shorter reads, low-level variation is more of a problem. 0.01 SNPs per haplotype base (hb) over 100 bp would yield just one SNP on average - insufficient evidence for <bold>Gretel</bold>.</p>
<p>Although one might expect high levels of variation to make the recovery of haplotypes more challenging, an abundance of variation actually provides more information for <bold>Gretel</bold>. We observe successful recoveries from data sets with high variation (0.1 SNPs/hb over five haplotypes of 3000 nt yields &#x2248; 1500 SNPs [<xref ref-type="table" rid="tbl4">Table 4</xref>]). With enough coverage (&#x2265; 7x per-haplotype depth), recoveries at a high level of variation are more accurate than those in data sets with fewer SNPs.</p>
<p>For realistic levels of variation (0.01&#x2212;0.02 SNPs/hb) [<xref ref-type="bibr" rid="c25">25</xref>], with per-haplotype read depth of &#x2265; 7x, we can recover haplotypes at a median accuracy of 80%. With higher per-haplotype depth (&#x2265; 25x), <bold>Gretel</bold> is capable of recovering haplotypes with 100% accuracy (<xref ref-type="fig" rid="fig1">Fig. 1</xref>).</p>
</sec>
<sec id="s1d">
<title>Metahaplomes from real genes</title>
<p>To extend validation to data derived from real genes, and assess the robustness of the likelihood rankings of reconstructed haplotypes, we created a metahaplome consisting of five dihydrofolate reductase (<italic>DHFR</italic>) genes from multiple species (<xref ref-type="table" rid="tbl1">Table 1</xref>).</p>
<table-wrap id="tbl1" orientation="portrait" position="float">
<label>Table 1:</label>
<caption><p>The chosen `pseudo-reference' (EU145592.1) and the five genes that constitute the synthetic DHFR meta-haplome. Genes with decreasing similarity to the reference were selected to pose a more challenging recovery problem. <xref ref-type="fig" rid="fig3">Figure 3</xref> presents our recovery results for each gene.</p></caption>
<graphic xlink:href="117838_tbl1.tif"/>
</table-wrap>
<p><italic>DHFR</italic> is an essential enzyme in nucleic and amino acid synthesis and is an important therapeutic target for infectious diseases such as malaria [<xref ref-type="bibr" rid="c26">26</xref>]. Identifying <italic>DHFR</italic> haplotypes can help researchers understand how sequence variation contributes to drug resistance.</p>
<p>In a real metagenomic data set, we would use an assembly as a pseudo-reference to align sequenced reads against a genomic region of interest. For simulating the problem of discovering the variants across <italic>DHFR</italic> genes from many organisms in a metagenome, we selected an arbitrary <italic>DHFR</italic> gene (EU145592.1) to serve as the pseudo-reference (<xref ref-type="table" rid="tbl1">Table 1</xref>). This reference is not used by <bold>Gretel</bold> for the recovery of haplotypes, but is currently a necessary step to produce an alignment from which to call for SNPs.</p>
<p>Our methodology for testing follows that of the previous section. From the five chosen <italic>DHFR</italic> genes we generated 100 replicates of pseudo-reads for each of the 6 different per-haplotype read depths and 2 read lengths.</p>
<p>The reads were then aligned to the pseudo-reference and the haplotypes recovered using <bold>Gretel</bold>.</p>
<p><xref ref-type="fig" rid="fig3">Figure 3</xref> presents the proportion of correctly recovered SNPs for each of the five input sequences listed in <xref ref-type="table" rid="tbl1">Table 1</xref>. <bold>Gretel</bold> achieves excellent recovery of <italic>BC070280</italic> and <italic>XR_634888</italic> with reads of just 50 bp. <xref ref-type="fig" rid="fig3">Figure 3</xref> also shows that while the accuracy of the reconstruction is influenced by the similarity to the reference used, this can be overcome with longer reads or greater read depth.</p>
<p><bold>Gretel</bold> scores the haplotypes it recovers with a likelihood, representing the probability of the data observed in the <bold>Hansel</bold> matrix, given the existence of that haplotype. In general, the best reconstructed DHFR haplotypes had the highest likelihoods (<xref ref-type="fig" rid="fig2">Fig. 2</xref>). This also improved as the similarity to the reference increased or when there was greater read length or depth.</p>
<fig id="fig2" position="float" orientation="portrait" fig-type="figure">
<label>Figure 2:</label>
<caption><p><bold>Gretel</bold> recovery rates (x-axes) against haplotype rank ratio (y-axes) for each gene of the <italic>DHFR</italic> data set (column facets) across the 1200 read sets. Each haplotype recovered has an associated likelihood as scored by <bold>Gretel</bold>. Haplotypes are sorted by their likelihood to obtain rankings. The rank is divided by the total number of recovered haplotypes (for that read set) to produce a rank ratio. A rank ratio of 0 shows a haplotype has the best likelihood awarded by <bold>Gretel</bold>. We present recovery rates against rank ratio, separating the read sets by their read length (row facets) and coverage (colour fill and symbol). <bold>Gretel</bold> is capable of discerning accurate haplotypes, awarding higher rankings to haplotypes with the most identity to real genes.</p>
</caption>
<graphic xlink:href="117838_fig2.tif"/>
</fig>
<fig id="fig3" position="float" orientation="portrait" fig-type="figure">
<label>Figure 3:</label>
<caption><p>Boxplots summarising the proportion of variants correctly recovered (y-axes) for each input <italic>DHFR</italic> gene (column facets) by <bold>Gretel</bold>. We generated reads from the <italic>DHFR</italic> metahaplome at 6 different per-haplotype read depths (x-axes) between 3 and 50x, 2 read lengths (50 bp and 150 bp row facets) with 100 replicates. Individual box-with-whiskers summarise the recovery rate for a given gene, from reads of a per-haplotype depth and size, over the 100 replicate read sets. Input genes are sorted by decreasing identity to the pseudo-reference left to right. Note that there are a few cases where recovery is not possible at the lowest depth.</p>
</caption>
<graphic xlink:href="117838_fig3.tif"/>
</fig>
<p>We observed that reads from more divergent haplotypes are more readily discarded during alignment to the pseudo-reference, denying <bold>Gretel</bold> the evidence necessary to call these SNPs and hence recover these sequences (<xref ref-type="fig" rid="figS2">Supplementary Fig. 2</xref>). Additionally, as some of the haplotypes are more similar to each other, there possibly exists more evidence for the variation shared by those haplotypes, increasing their recovery rate.</p>
<p>Despite this, with sufficient depth and read length, more dissimilar haplotypes can still be recovered with very high accuracy. We observe a similar trend even with increased numbers of input haplotypes (<xref ref-type="sec" rid="s6k">Supplementary Section 11</xref>). We encountered an upper limit on the accuracy of recoveries that could not be overcome with additional coverage or increase the read size (<xref ref-type="fig" rid="figS3">Supplementary Fig. 3</xref>). This is potentially due to one or more of:
<list list-type="bullet">
<list-item>
<p>Shared variation between highly similar haplotypes causing paths in the real metahaplome to converge, making it harder to disentangle the real variation</p></list-item>
<list-item>
<p>Reads discarded during alignment causing pairwise SNP evidence to be withheld from <bold>Gretel</bold></p></list-item>
<list-item>
<p>Reads discarded during alignment removing evidence for the existence of a heterogeneous site</p></list-item>
</list></p>
<p>Despite this, our results show that <bold>Gretel</bold> is capable of recovering haplotypes from synthetic readsets with high accuracy given sufficient read depth, read length or similarity to the reference chosen.</p>
</sec>
<sec id="s1e">
<title>Metahaplomes from real reads: HIV 5 strain mix</title>
<p>Finally we apply our approach to a set of real reads (<italic>ENA:SRR961514</italic>) consisting of five distinct HIV strains mixed <italic>in vitro</italic> and sequenced on an Illumina MiSeq [<xref ref-type="bibr" rid="c27">27</xref>]. Although the sequences of the five strains were known prior to mixing, the strains are likely to have mutated prior to the sequencing of the samples, introducing cryptic diversity [<xref ref-type="bibr" rid="c27">27</xref>]. Furthermore, the sequencing process can add additional noise through sequencing error. This provides a challenging data set for haplotype recovery. For the five longest genes on the HIV-1 genome (gag, pol, vif, env and nef) we used <bold>Gretel</bold> to recover all haplotypes present using the real sequencing reads from this experiment.</p>
<p><xref ref-type="table" rid="tbl2">Table 2</xref> shows, for each gene from each original HIV strain, the similarity of the nearest matching reconstructed haplotype. We found that the <italic>env</italic> gene had the most novel diversity, with the closest matching haplotypes to the original HIV strains only occurring in the top 25 most likely reconstructions. This is in contrast to <italic>pol,</italic> where the closest matching haplotypes to the original HIV strains were in the top 6 most likely reconstructions. This likely represents differing numbers of novel cryptic haplotypes of these genes and correlates well with their known mutation rates <italic>in vivo</italic> [<xref ref-type="bibr" rid="c28">28</xref>].</p>
<table-wrap id="tbl2" orientation="portrait" position="float">
<label>Table 2:</label>
<caption><p>For each gene from each original HIV strain, the percentage similarity of the nearest matching reconstructed haplotype. Results are presented for each of the five longest genes of the HIV-1 genome (<italic>gag, pol, vif, nef, env</italic>). The bracketed figure indicates the rank of the best haplotype for the strain amongst all recovered haplotypes, according to its likelihood score. We also report the total number of haplotypes recovered by <bold>Gretel</bold> for each gene. &#x002A;Recovery of 89.6 <italic>env</italic> gene has just one incorrect SNP (2567 SNPs recovered). &#x2020;Number of haplotypes returned after conservative &#x2212;1000 <italic>log</italic><sub>l0</sub> likelihood cutoff.</p>
</caption>
<graphic xlink:href="117838_tbl2.tif"/>
</table-wrap>
<p>For all of the recovered HIV-1 haplotypes, <xref ref-type="fig" rid="fig4">Figure 4</xref> plots the scaled <bold>BLAST</bold> bitscores against the <bold>Gretel</bold> likelihood score. Each recovered haplotype is matched to its closest strain. Our results show that ordering the recovered haplotypes by their likelihood scores can be used as a method to find the best recoveries amongst the recovered sequences.</p>
<fig id="fig4" position="float" orientation="portrait" fig-type="figure">
<label>Figure 4:</label>
<caption>
<p>Scaled <bold>BLAST</bold> bitscores (x-axes) against scaled <bold>Gretel</bold> likelihoods (y-axes). (Left) Bitscores against likelihoods for all recovered HIV-1 gene haplotypes, coloured by strain, (Right) Plot facets show the bitscores against likelihood for all recovered haplotypes, separated by gene (column facets) and strain (row facets and colours). <bold>Gretel</bold> consistently awards higher likelihoods to recovered haplotypes that are better matches to a real haplotype.</p>
</caption>
<graphic xlink:href="117838_fig4.tif"/>
</fig>
<p>As reported in <xref ref-type="table" rid="tbl2">Table 2</xref>, haplotypes were discarded if they did not meet a conservative threshold of &#x2212;1000 <italic>log</italic><sub>10</sub> likelihood. Manual inspection indicated that these discarded haplotypes showed over selection of deletions, an artifact arising from <bold>Gretel</bold> exhausting non-deleterious evidence in <bold>Hansel</bold> before terminating. Such haplotypes yield no significant <bold>BLAST</bold> hits against the NCBI nr database [<xref ref-type="bibr" rid="c29">29</xref>] and our likelihoods provided a clear distinction between noise and useful recoveries.</p>
<p>Beyond the alignment, <bold>Gretel</bold> does not require read processing, parameter bootstrapping or error correction. Despite thousands of heterogeneous sites (primarily caused by sequencing error and alignment noise) <bold>Gretel</bold> is still capable of recovering known haplotypes with 100% accuracy and biologically relevant cryptic haplotypes from metagenomic data.</p>
</sec>
</sec>
<sec id="s2">
<title>Discussion</title>
<p>We offer the term <bold>metahaplome</bold> to represent the set of haplotypes for any particular region of interest within a metagenomic data set. The elucidation of the sequences of the individuals within the metahaplome provides a rich resource of information, enabling detailed study of microbial communities. Synthetic exploitation of the variation observed can be used to improve industrial processes such as biorefining, biomining and synthetic biology [30, 31].</p>
<p>We introduced <bold>Hansel</bold>, a novel data structure which stores the variation observed over reads from a sequenced metagenome. <bold>Hansel</bold> permits traversal of that variation like a graph, yet features probabilistically weighted edges, allowing the current haplotype recovered so far to influence the variants that will be selected next. We also introduced <bold>Gretel</bold>, an algorithm that builds upon <bold>Hansel</bold> for the recovery of genuine haplotypes from a metahaplome constructed from the raw reads of a metagenomic data set.</p>
<p>Together <bold>Hansel</bold> and <bold>Gretel</bold> form a new framework for the recovery of haplotypes in metagenomes, allowing data sets where short read length has previously restricted effective analysis.</p>
<sec id="s2a">
<title>Performance and tractability</title>
<p>We have evaluated <bold>Hansel</bold> and <bold>Gretel</bold> on haplotypes generated by <bold>seq-gen</bold> in order to measure performance with regard to mutation rate, read length and coverage (<xref ref-type="fig" rid="fig1">Fig. 1</xref>). We demonstrate very high recovery rates, even in the presence of many SNPs.</p>
<p>We also evaluated our approach with synthetic reads generated from metahaplomes consisting of mixtures of real genes and demonstrated it is possible to recover accurate haplotypes even from short read data (<xref ref-type="fig" rid="fig3">Fig. 3</xref>). Successful recoveries can be made with our framework even in the presence of many haplotypes as demonstrated by the high recovery rates from the Flu-A7 metahaplomes, containing short reads generated from 24 diverse influenza sequences (<xref ref-type="fig" rid="figS3">Supplementary Fig. 3</xref>).</p>
<p>Finally, we applied our work to a data set consisting of real sequencing reads: the HIV 5 mix metahaplome. We have shown that we can recover long (&#x003E;2000bp) genes from this complex community with 100% accuracy (<xref ref-type="table" rid="tbl2">Table 2</xref>).</p>
<p>Our approach is sensitive to the quality of the alignments of reads against the pseudo-reference, and the choice of pseudo-reference itself. We observed small fluctuations in recovery accuracy across the 24 haplotypes of the Flu-A7 data set depending on the selected reference. During testing of both the DHFR and Flu-A7 data set, we found this sensitivity was because many of the synthetic reads yielded from less similar sequences would not align back to the pseudo-reference (<xref ref-type="fig" rid="figS2">Supplementary Fig. 2</xref>), regardless of chosen alignment software.</p>
<p>This does raise an important caveat to our work: both assemblers and aligners will exert influence over the tractability of how many and how accurately haplotypes in a given metagenome can be recovered. Here, the discarding of reads during alignment denies <bold>Gretel</bold> access to critical evidence required to reconstruct those particular haplotypes.</p>
<p>It should be noted that the pseudo-reference is not used by <bold>Hansel</bold> or <bold>Gretel</bold>, it serves only as a common sequence against which to align raw reads. Sequences that happen to share identity with the pseudo-reference are recovered by <bold>Gretel</bold> from the evidence in the <bold>Hansel</bold> matrix, the reference confers no advantage over any other haplotype. Very high recovery rates on sequences that share identity with the pseudo-reference are a reflection of the strength of our approach, and not a trivial recovery. A reference-free method for SNP calling, or a method that constructs or amends the reference from the SNPs [<xref ref-type="bibr" rid="c32">32</xref>] would be equally useful to us.</p>
<p>Perhaps most significantly, the tractability of the problem is bound by the quality of the data available. As stated by Lancia [<xref ref-type="bibr" rid="c10">10</xref>], it is entirely possible that, even without error, there are scenarios where data is insufficient to successfully recover haplotypes and the problem is rendered impossible.</p>
<p>Our framework has been designed for the recovery of haplotypes from a region of interest in a metagenome (such as variants of a gene involved in a catalytic reaction of interest, e.g. degradation of biomass), but given sufficient coverage of SNPs, our approach could work on regions significantly longer than that of a gene if desired and with data consisting of significantly longer reads.</p>
<p>Regarding time and resource requirements, <bold>Hansel</bold> and <bold>Gretel</bold> is designed to work on all reads from a metagenome that align to some region of interest on the pseudo-reference. Typically these subsets are small (on the order of 10-100K reads) and so our framework can be run on an ordinary desktop in minutes, without significant demands on disk, memory or CPU. Run-times on data with very deep coverage, or many thousands of SNPs, such as the HIV 5-mix, run on the order of hours, but can still be executed on an ordinary desktop computer.</p>
</sec>
<sec id="s2b">
<title>Methodological comparison of our approach</title>
<p>In contrast to other methods, <bold>Gretel</bold> aims to make as few assumptions as possible. More importantly, our framework requires no configuration, has no parameters and is designed for metagenomic data sets where the number of haplotypes is unknown.</p>
<p>Most SNP calling algorithms discard SNP sites that feature three or more alleles (i.e. non bi-allelic sites) as errors, or under the assumption that input data represents sequenced reads from a diploid species [<xref ref-type="bibr" rid="c33">33</xref>]. Although <bold>ParticleHap</bold> [<xref ref-type="bibr" rid="c33">33</xref>] relaxes this assumption, it is to reduce the risk of erroneously called genotypes preventing reconstruction of the two haplotypes for a diploid genome.</p>
<p>Many existing methods rely on discarding or altering observed SNPs until a pair of haplotypes can be determined [<xref ref-type="bibr" rid="c13">13</xref>]. <bold>Hansel</bold> and <bold>Gretel</bold> use all available pairwise observations and work to recover the most likely haplotypes. Unlike other methods, we do not assume that the observed evidence must be contaminant or sequencing error that needs discarding or altering to recover the real haplotypes. Errors will be poorly supported by read data (and so will have a low probability) and are unlikely to be selected by <bold>Gretel</bold> to become part of a haplotype during traversal.</p>
<p>Most haplotype reconstruction tools are designed specifically for diploid resolution. Some, such as <bold>HapCompass</bold> [<xref ref-type="bibr" rid="c18">18</xref>] are designed to identify haplotypes for a single polyploid organism. Such alternatives require prior knowledge of the number of expected haplotypes [<xref ref-type="bibr" rid="c34">34</xref>], or other properties of the environment, which are unknowns for metagenomic data sets.</p>
<p>There have been several recent probabilistic approaches targeting the challenge of more complex scenarios such as viral quasispecies assembly [<xref ref-type="bibr" rid="c35">35</xref>, <xref ref-type="bibr" rid="c36">36</xref>]. <bold>QuasiRecomb</bold> [<xref ref-type="bibr" rid="c37">37</xref>] uses a hidden Markov model solution taking into account recombination events. We tested <bold>QuasiRecomb</bold> on the <italic>gag</italic> region of the HIV dataset, and it predicted over 9000 haplotypes. Optimizing its set of parameters is non-trivial. <bold>PredictHaplo</bold> [<xref ref-type="bibr" rid="c38">38</xref>] is also capable of performing full recoveries of the HIV-1 non-<bold>env</bold> genes, but has been shown to recover conservatively outside of HIV-1. [<xref ref-type="bibr" rid="c39">39</xref>, <xref ref-type="bibr" rid="c40">40</xref>]. <bold>PredictHaplo</bold> no longer appears to be maintained and we were unable to execute the software on data other than its own test data. The more recent <bold>ViQuaS</bold> [<xref ref-type="bibr" rid="c40">40</xref>] reports higher recall than <bold>PredictHaplo</bold>, as expected for an algorithm based on an overlap assembler. However its precision is influenced by the quality of the available reference for the post-assembly filtering step, making <bold>ViQuaS</bold> less suitable for the analysis of a metagenome, where a good reference is unavailable.</p>
<p>With the advent of long-read technology, <bold>ProbHap</bold> recognised a niche in applying computationally expensive dynamic programming solutions to low coverage long-reads [<xref ref-type="bibr" rid="c41">41</xref>]. These solutions are inappropriate for high-depth short read data sets as the run time increases exponentially with coverage.</p>
<p><bold>Lens</bold> [<xref ref-type="bibr" rid="c9">9</xref>] is a greedy algorithm for the assembly of long-reads from overlapping short reads, with an algorithm similar to that of <bold>FastHare</bold> [<xref ref-type="bibr" rid="c42">42</xref>]. <bold>Lens</bold> uses a straightforward overlap assembly approach that can be used for haplotype resolution as it makes few assumptions. <bold>Lens</bold> generates a large number of unordered haplotypes, including many false positives, but for clean enough datasets this approach may be quick and sufficient. In our tests on the HIV data, <bold>Lens</bold> produced 206 haplotypes for the <italic>env</italic> region and 147 for <italic>pol</italic> without any information on their ranking.</p>
<p>Algorithms that find the correct set of haplotypes from sequence data have the same evaluation issues as information retrieval algorithms. As well as measuring the per-base haplotype similarities, the amount of false positives and false negatives are also important. A brute force algorithm for the production of all possible haplotypes would produce perfect retrieval of the real haplotypes, but would also retrieve many false positives. <bold>Gretel</bold> overcomes this problem by ranking the haplotypes it returns based on the likelihood of that haplotype given the evidence in the <bold>Hansel</bold> matrix at the time that haplotype was completed.</p>
<p>The likelihoods output by <bold>Gretel</bold> are amenable to further statistical analyses such as likelihood ratio testing, or model selection tests using Akaike or Bayesian information criterion [<xref ref-type="bibr" rid="c43">43</xref>] to test the fit of complex combinations of haplotypes as descriptions of the sequencing read data.</p>
</sec>
<sec id="s2c">
<title>Future work</title>
<p>Although we demonstrate <bold>Gretel</bold>&#x2019;s capability to make perfect recoveries of haplotypes, there exists room for further work. We intend to revisit the following aspects of our approach:</p>
<sec id="s2c1">
<label>&#x2022;</label>
<title>Reweighting</title>
<p><bold>Gretel</bold> is a deterministic algorithm. The pairwise SNP observation that contributed to the most recent path are reweighted in the <bold>Hansel</bold> matrix to encourage new paths to be discovered. We found that our current choice of reweighting scheme explains some mismatches made by <bold>Gretel</bold> on the <italic>DHFR</italic> and <italic>Flu-A</italic>7 data sets. Other choices of reweighting scheme are possible and we are investigating their potential.</p>
</sec>
<sec id="s2c2">
<label>&#x2022;</label>
<title>Naive insertion handling</title>
<p>Due to a size constraint on the <bold>Hansel</bold> matrix, further thought is needed to devise a practical methodology that permits the proper consideration of insertions. However, unlike many other approaches <bold>Gretel</bold> does not discard reads containing insertions.</p>
</sec>
<sec id="s2c3">
<label>&#x2022;</label>
<title>Greediness</title>
<p><bold>Gretel</bold>&#x2019;s algorithm involves a greedy bias: We assume the &#x201C;best&#x201D; haplotype is the most likely haplotype, and that it can be recovered by selecting the edge with the highest probability at each SNP. However it is possible that <bold>Gretel</bold> could locate solutions whose overall likelihood may be higher with an alternative search strategy.</p>
</sec>
<sec id="s2c4">
<label>&#x2022;</label>
<title>Stopping Criterion</title>
<p><bold>Gretel</bold> will generate haplotypes until a dead end in the <bold>Hansel</bold> matrix is encountered, from which there is no evidence for any further transitions. Although we found that our approach can yield low-quality haplotypes before this time, they will have lower likelihoods.</p>
</sec>
<sec id="s2c5">
<label>&#x2022;</label>
<title>Unused Evidence</title>
<p>There remain sources of evidence not currently used by our algorithm &#x2013; namely paired end reads and alignment base quality scores. Such data will certainly provide useful co-occurrence and confidence information for SNPs that span some known insert, however careful consideration on how to integrate this data to our approach is necessary.</p>
</sec>
</sec>
</sec>
<sec id="s3">
<title>Conclusion</title>
<p>In this work we have introduced a definition for the <bold>metahaplome</bold> and provide an implementation of a novel data structure for the storage and manipulation of the evidence supporting the haplotypes within <bold>Hansel</bold>. This tool has value outside of this work, and can provide future algorithms a means to interact with the variation observed in a set of sequenced reads. We also provide <bold>Gretel</bold>, an algorithm for the recovery of metagenomic haplotypes from the <bold>Hansel</bold> data structure. Together they represent a framework for the reconstruction of the haplotypes with the maximum likelihoods from metagenomic datasets without <italic>a priori</italic> knowledge or making assumptions of the distribution or number of variants. Additionally, the algorithm is robust to sequencing and alignment error without altering or discarding observed variation and uses all available evidence from aligned reads.</p>
<p>Existing bioinformatics tools for the processing and analysis of sequencing data make assumptions that are inappropriate for the analysis of haplotypes from metagenomes [<xref ref-type="bibr" rid="c44">44</xref>, <xref ref-type="bibr" rid="c19">19</xref>]. Indeed, our own work still relies on alignment to a common reference in order to call SNPs, which can affect recovery rate, as was seen with the synthetic metahaplomes. We would like to investigate methodologies to abandon the requirement for a common reference (that is, in our terminology the assembly or pseudo-reference) and work solely with read data. This would offer opportunities for introducing fewer assumptions and maintaining the integrity of variants observed across metagenomic data before they reach a framework such as <bold>Hansel</bold> and <bold>Gretel</bold>. However, such approaches are not in widespread use or are still under development [<xref ref-type="bibr" rid="c23">23</xref>, <xref ref-type="bibr" rid="c45">45</xref>].</p>
<p>In lieu of this, and despite these issues, a metagenomic assembly provides both a convenient proxy for the raw reads and a pseudo-reference against which to align reads and call for SNPs. This does not diminish the ability to accurately recover and rank haplotypes from metahaplomes constructed from both contrived and real data sets. Rather, we demonstrate that our likelihood framework can allow recovery and ranking of haplotypes from microbial communities with 100% accuracy.</p>
<p><bold>Hansel</bold> and <bold>Gretel</bold> have the potential for the discovery of novel biological insights from microbiomes. This is not a trivial task; many existing <italic>in silico</italic> and <italic>in vitro</italic> techniques such as rational design have struggled to achieve this goal. Applied to metagenomic data from appropriate microbial communities, our approach will reconstruct the cryptic haplotypes within and allow the characterisation of target proteins responsible for catalytic reactions of biotechnological importance.</p>
</sec>
<sec id="s4" sec-type="data_availability">
<title>Code Availability and Data Access</title>
<p>Our <bold>Hansel</bold> and <bold>Gretel</bold> framework is freely available, open source software available online at <ext-link ext-link-type="uri" xlink:href="https://github.com/samstudio8/hansel">https://github.com/samstudio8/hansel</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://github.com/samstudio8/gretel">https://github.com/samstudio8/gretel</ext-link>, respectively.</p>
<p>The code used to generate metahaplomes and synthetic reads for both the randomly generated and real gene haplotypes, and the testing data used to evaluate our methods is also available online via <ext-link ext-link-type="uri" xlink:href="https://github.com/samstudio8/gretel-test">https://github.com/samstudio8/gretel-test</ext-link></p>
</sec>
</body>
<back>
<ack>
<title>Acknowledgments</title>
<p>CJC was funded by the Biotechnology and Biological Sciences Research Council (BBSRC) Institute Strategic Programme Grant, Rumen Systems Biology, (BB/E/W/10964A01). WA is funded through the Coleg Cymraeg Cenedlaethol Academic staffing scheme. SN is funded via the Aberystwyth University Doctoral Career Development Scholarship and the IBERS Doctoral Programme.</p>
</ack>
<sec>
<title>Disclosure Declaration</title>
<p>The authors have no conflict of interest to declare.</p>
</sec>
<sec>
<title>Author contributions</title>
<p>All authors discussed and defined the theoretical problem and its solutions, SMN wrote the code and documentation and executed experiments, SMN, WA, CJC and AC chose data and designed experiments, all authors analyzed and interpreted the results and wrote the manuscript.</p>
</sec>
<ref-list>
<title>References</title>
<ref id="c1"><label>[1]</label><mixed-citation publication-type="journal"><string-name><given-names>G.</given-names> <surname>Vernikos</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Medini</surname></string-name>, <string-name><given-names>D. R.</given-names> <surname>Riley</surname></string-name>, and <string-name><given-names>H.</given-names> <surname>Tettelin</surname></string-name>. <article-title>Ten years of pan-genome analyses</article-title>. <source>Current Opinion Microbiology</source>, <volume>23</volume>:<fpage>148</fpage>&#x2013;<lpage>54</lpage>, <year>2015</year>.</mixed-citation></ref>
<ref id="c2"><label>[2]</label><mixed-citation publication-type="journal"><string-name><given-names>Richard A.</given-names> <surname>Gibbs</surname></string-name>, <string-name><given-names>John W.</given-names> <surname>Belmont</surname></string-name>, <string-name><given-names>Paul</given-names> <surname>Hardenbol</surname></string-name>, <string-name><given-names>Thomas D.</given-names> <surname>Willis</surname></string-name>, <string-name><given-names>Fuli</given-names> <surname>Yu</surname></string-name>, <string-name><given-names>Huanming</given-names> <surname>Yang</surname></string-name>, <string-name><given-names>Lan-Yang</given-names> <surname>Ch&#x2019;ang</surname></string-name>, <string-name><given-names>Wei</given-names> <surname>Huang</surname></string-name>, <string-name><given-names>Bin</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>Yan</given-names> <surname>Shen</surname></string-name>, <etal>et al.</etal> <article-title>The international HapMap project</article-title>. <source>Nature</source>, <volume>426</volume>(<issue>6968</issue>):<fpage>789</fpage>&#x2013;<lpage>796</lpage>, <year>2003</year>.</mixed-citation></ref>
<ref id="c3"><label>[3]</label><mixed-citation publication-type="journal"><string-name><given-names>R.</given-names> <surname>Andino</surname></string-name> and <string-name><given-names>E.</given-names> <surname>Domingo</surname></string-name>. <article-title>Viral quasispecies</article-title>. <source>Virology</source>, <volume>479&#x2013;480</volume>:<fpage>46</fpage>&#x2014;<lpage>51</lpage>, <year>2015</year>.</mixed-citation></ref>
<ref id="c4"><label>[4]</label><mixed-citation publication-type="journal"><string-name><given-names>Federico M</given-names> <surname>Lauro</surname></string-name>, <string-name><given-names>Diane</given-names> <surname>McDougald</surname></string-name>, <string-name><given-names>Torsten</given-names> <surname>Thomas</surname></string-name>, <string-name><given-names>Timothy J</given-names> <surname>Williams</surname></string-name>, <string-name><given-names>Suhelen</given-names> <surname>Egan</surname></string-name>, <string-name><given-names>Scott</given-names> <surname>Rice</surname></string-name>, <string-name><given-names>Matthew Z</given-names> <surname>DeMaere</surname></string-name>, <string-name><given-names>Lily</given-names> <surname>Ting</surname></string-name>, <string-name><given-names>Haluk</given-names> <surname>Ertan</surname></string-name>, <string-name><given-names>Justin</given-names> <surname>Johnson</surname></string-name>, <etal>et al.</etal> <article-title>The genomic basis of trophic strategy in marine bacteria</article-title>. <source>Proceedings of the National Academy of Sciences</source>, <volume>106</volume>(<issue>37</issue>):<fpage>15527</fpage>&#x2013;<lpage>15533</lpage>, <year>2009</year>.</mixed-citation></ref>
<ref id="c5"><label>[5]</label><mixed-citation publication-type="journal"><string-name><given-names>Sharon A</given-names> <surname>Huws</surname></string-name>, <string-name><given-names>Joan E</given-names> <surname>Edwards</surname></string-name>, <string-name><given-names>Christopher J</given-names> <surname>Creevey</surname></string-name>, <string-name><given-names>Pauline Rees</given-names> <surname>Stevens</surname></string-name>, <string-name><given-names>Wanchang</given-names> <surname>Lin</surname></string-name>, <string-name><given-names>Susan E</given-names> <surname>Girdwood</surname></string-name>, <string-name><given-names>Justin A</given-names> <surname>Pachebat</surname></string-name>, and <string-name><given-names>Alison H</given-names> <surname>Kingston-Smith</surname></string-name>. <article-title>Temporal dynamics of the metabolically active rumen bacteria colonizing fresh perennial ryegrass</article-title>. <source>FEMS Microbiology Ecology</source>, <volume>92</volume>(<issue>1</issue>):<fpage>fiv137</fpage>, <year>2016</year>.</mixed-citation></ref>
<ref id="c6"><label>[6]</label><mixed-citation publication-type="journal"><string-name><given-names>Francesco</given-names> <surname>Rubino</surname></string-name>, <string-name><given-names>Ciara</given-names> <surname>Carberry</surname></string-name>, <string-name><given-names>Sinead M</given-names> <surname>Waters</surname></string-name>, <string-name><given-names>David</given-names> <surname>Kenny</surname></string-name>, <string-name><given-names>Matthew S</given-names> <surname>McCabe</surname></string-name>, and <string-name><given-names>Christopher J</given-names> <surname>Creevey</surname></string-name>. <article-title>Divergent functional isoforms drive niche specialisation for nutrient acquisition and use in rumen microbiome</article-title>. <source>The ISME Journal</source>, <year>2017</year>.</mixed-citation></ref>
<ref id="c7"><label>[7]</label><mixed-citation publication-type="journal"><string-name><given-names>J.</given-names> <surname>Jung</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Philippot</surname></string-name>, and <string-name><given-names>W.</given-names> <surname>Park</surname></string-name>. <article-title>Metagenomic and functional analyses of the consequences of reduction of bacterial diversity on soil functions and bioremediation in diesel-contaminated microcosms</article-title>. <source>Nature Scientific Reports</source>, <volume>6</volume>:<fpage>23012</fpage>, <year>2016</year>.</mixed-citation></ref>
<ref id="c8"><label>[8]</label><mixed-citation publication-type="journal"><string-name><given-names>Chen</given-names> <surname>Zhang</surname></string-name> and <string-name><given-names>Se-Kwon</given-names> <surname>Kim</surname></string-name>. <article-title>Research and application of marine microbial enzymes: status and prospects</article-title>. <source>Marine Drugs</source>, <volume>8</volume>(<issue>6</issue>):<fpage>1920</fpage>&#x2013;<lpage>34</lpage>, <year>2010</year>.</mixed-citation></ref>
<ref id="c9"><label>[9]</label><mixed-citation publication-type="journal"><string-name><given-names>V.</given-names> <surname>Kuleshov</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Jiang</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Zhou</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Jahanbani</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Batzoglou</surname></string-name>, and <string-name><given-names>M.</given-names> <surname>Snyder</surname></string-name>. <article-title>Synthetic long-read sequencing reveals intraspecies diversity in the human microbiome</article-title>. <source>Nature Biotechnology</source>, <volume>34</volume>:<fpage>64</fpage> &#x2013; <lpage>69</lpage>, <year>2016</year>.</mixed-citation></ref>
<ref id="c10"><label>[10]</label><mixed-citation publication-type="book"><string-name><given-names>Giuseppe</given-names> <surname>Lancia</surname></string-name>, <string-name><given-names>Vineet</given-names> <surname>Bafna</surname></string-name>, <string-name><given-names>Sorin</given-names> <surname>Istrail</surname></string-name>, <string-name><given-names>Ross</given-names> <surname>Lippert</surname></string-name>, and <string-name><given-names>Russell</given-names> <surname>Schwartz</surname></string-name>. <chapter-title>SNPs problems, complexity, and algorithms</chapter-title>. In <source>Algorithms&#x2014;ESA 2001</source>, pages <fpage>182</fpage>&#x2013;<lpage>193</lpage>. <publisher-loc>Springer</publisher-loc>, <year>2001</year>.</mixed-citation></ref>
<ref id="c11"><label>[11]</label><mixed-citation publication-type="book"><string-name><given-names>Rudi</given-names> <surname>Cilibrasi</surname></string-name>, <string-name><given-names>Leo Van</given-names> <surname>Iersel</surname></string-name>, <string-name><given-names>Steven</given-names> <surname>Kelk</surname></string-name>, and <string-name><given-names>John</given-names> <surname>Tromp</surname></string-name>. <chapter-title>On the complexity of several haplotyping problems</chapter-title>. In <source>Algorithms in Bioinformatics</source>, pages <fpage>128</fpage>&#x2013;<lpage>139</lpage>. <publisher-loc>Springer</publisher-loc>, <year>2005</year>.</mixed-citation></ref>
<ref id="c12"><label>[12]</label><mixed-citation publication-type="journal"><string-name><given-names>Ross</given-names> <surname>Lippert</surname></string-name>, <string-name><given-names>Russell</given-names> <surname>Schwartz</surname></string-name>, <string-name><given-names>Giuseppe</given-names> <surname>Lancia</surname></string-name>, and <string-name><given-names>Sorin</given-names> <surname>Istrail</surname></string-name>. <article-title>Algorithmic strategies for the single nucleotide polymorphism haplotype assembly problem</article-title>. <source>Briefings in Bioinformatics</source>, <volume>3</volume>(<issue>1</issue>):<fpage>23</fpage>&#x2013;<lpage>31</lpage>, <year>2002</year>.</mixed-citation></ref>
<ref id="c13"><label>[13]</label><mixed-citation publication-type="journal"><string-name><given-names>Giuseppe</given-names> <surname>Lancia</surname></string-name>. <article-title>Algorithmic approaches for the single individual haplotyping problem</article-title>. <source>RAIRO-Operations Research</source>, <volume>50</volume>(<issue>2</issue>):<fpage>331</fpage>&#x2013;<lpage>340</lpage>, <year>2016</year>.</mixed-citation></ref>
<ref id="c14"><label>[14]</label><mixed-citation publication-type="journal"><string-name><given-names>Filippo</given-names> <surname>Geraci</surname></string-name>. <article-title>A comparison of several algorithms for the single individual SNP haplotyping reconstruction problem</article-title>. <source>Bioinformatics</source>, <volume>26</volume>(<issue>18</issue>):<fpage>2217</fpage>&#x2013;<lpage>2225</lpage>, <year>2010</year>.</mixed-citation></ref>
<ref id="c15"><label>[15]</label><mixed-citation publication-type="journal"><string-name><given-names>P.</given-names> <surname>Edge</surname></string-name>, <string-name><given-names>V.</given-names> <surname>Bafna</surname></string-name>, and <string-name><given-names>V.</given-names> <surname>Bansal</surname></string-name>. <article-title>HapCUT2: robust and accurate haplotype assembly for diverse sequencing technologies</article-title>. <source>Genome Research</source>, Advance access (10.1101/gr.213462.116), <year>2016</year>.</mixed-citation></ref>
<ref id="c16"><label>[16]</label><mixed-citation publication-type="journal"><string-name><given-names>D.</given-names> <surname>Aguiar</surname></string-name> and <string-name><given-names>S.</given-names> <surname>Istrail</surname></string-name>. <article-title>HapCompass: a fast cycle basis algorithm for accurate haplotype assembly of sequence data</article-title>. <source>Journal of Computational Biology</source>, <volume>19</volume>(<issue>6</issue>):<fpage>577</fpage>&#x2013;<lpage>590</lpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c17"><label>[17]</label><mixed-citation publication-type="journal"><string-name><given-names>Ehsan</given-names> <surname>Motazedi</surname></string-name>, <string-name><given-names>Richard</given-names> <surname>Finkers</surname></string-name>, <string-name><given-names>Chris</given-names> <surname>Maliepaard</surname></string-name>, and <string-name><given-names>Dick de</given-names> <surname>Ridder</surname></string-name>. <article-title>Exploiting next-generation sequencing to solve the haplotyping puzzle in polyploids: a simulation study</article-title>. <source>Briefings in Bioinformatics</source>, page <fpage>bbw126</fpage>, <year>2017</year>.</mixed-citation></ref>
<ref id="c18"><label>[18]</label><mixed-citation publication-type="journal"><string-name><given-names>Derek</given-names> <surname>Aguiar</surname></string-name> and <string-name><given-names>Sorin</given-names> <surname>Istrail</surname></string-name>. <article-title>Haplotype assembly in polyploid genomes and identical by descent shared tracts</article-title>. <source>Bioinformatics</source>, <volume>29</volume>(<issue>13</issue>):<fpage>i352&#x2013;i360</fpage>, <year>2013</year>.</mixed-citation></ref>
<ref id="c19"><label>[19]</label><mixed-citation publication-type="journal"><string-name><given-names>T.</given-names> <surname>Namiki</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Hachiya</surname></string-name>, <string-name><given-names>H.</given-names> <surname>Tanaka</surname></string-name>, and <string-name><given-names>Y. Sakakibara.</given-names> <surname>MetaVelvet</surname></string-name>: <article-title>An extension of Velvet assembler to de novo metagenome assembly from short sequence reads</article-title>. <source>Nucleic Acids Res</source>, <volume>40</volume>(<issue>20</issue>):<fpage>e155</fpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c20"><label>[20]</label><mixed-citation publication-type="journal"><string-name><given-names>S&#x00E9;bastien</given-names> <surname>Boisvert</surname></string-name>, <string-name><given-names>Fr&#x00E9;d&#x00E9;ric</given-names> <surname>Raymond</surname></string-name>, <string-name><given-names>&#x00C9;l&#x00E9;nie</given-names> <surname>Godzaridis</surname></string-name>, <string-name><given-names>Fran&#x00E7;ois</given-names> <surname>Laviolette</surname></string-name>, and <string-name><given-names>Jacques</given-names> <surname>Corbeil</surname></string-name>. <article-title>Ray Meta: scalable de novo metagenome assembly and profiling</article-title>. <source>Genome Biology</source>, <volume>13</volume>(<issue>12</issue>):<fpage>R122</fpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c21"><label>[21]</label><mixed-citation publication-type="journal"><string-name><given-names>John</given-names> <surname>Vollmers</surname></string-name>, <string-name><given-names>Sandra</given-names> <surname>Wiegand</surname></string-name>, and <string-name><given-names>Anne-Kristin</given-names> <surname>Kaster</surname></string-name>. <article-title>Comparing and evaluating metagenome assembly tools from a microbiologist&#x2019;s perspective-not only size matters&#x0021;</article-title> <source>PLoS One</source>, <volume>12</volume>(<issue>1</issue>):<fpage>e0169662</fpage>, <year>2017</year>.</mixed-citation></ref>
<ref id="c22"><label>[22]</label><mixed-citation publication-type="journal"><string-name><given-names>D. Y. C.</given-names> <surname>Brandt</surname></string-name>, <string-name><given-names>V. R. C.</given-names> <surname>Aguiar</surname></string-name>, <string-name><given-names>B. D.</given-names> <surname>Bitarello</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Nunes</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Goudet</surname></string-name>, and <string-name><given-names>D.</given-names> <surname>Meyer</surname></string-name>. <article-title>Mapping bias overestimates reference allele frequencies at the HLA genes in the 1000 Genomes Project Phase I Data</article-title>. <source>G3: Genes &#x2013; Genomes &#x2013; Genetics</source>, <volume>5</volume>(<issue>5</issue>):<fpage>931</fpage>&#x2013;<lpage>941</lpage>,<year>2015</year>.</mixed-citation></ref>
<ref id="c23"><label>[23]</label><mixed-citation publication-type="website"><string-name><given-names>Erik</given-names> <surname>Garrison</surname></string-name> <etal>et al.</etal> <article-title>vg: the variation graph toolkit</article-title>. <ext-link ext-link-type="uri" xlink:href="https://github.com/vgteam/vg">https://github.com/vgteam/vg</ext-link>, <year>2016</year>.</mixed-citation></ref>
<ref id="c24"><label>[24]</label><mixed-citation publication-type="journal"><string-name><given-names>Andrew</given-names> <surname>Rambaut</surname></string-name> and <string-name><given-names>Nicholas C.</given-names> <surname>Grass</surname></string-name>. <article-title>Seq-Gen: an application for the Monte Carlo simulation of DNA sequence evolution along phylogenetic trees</article-title>. <source>Computer applications in the biosciences: CABIOS</source>, <volume>13</volume>(<issue>3</issue>):<fpage>235</fpage>&#x2013;<lpage>238</lpage>, <year>1997</year>.</mixed-citation></ref>
<ref id="c25"><label>[25]</label><mixed-citation publication-type="journal"><string-name><given-names>Siegfried</given-names> <surname>Schloissnig</surname></string-name>, <string-name><given-names>Manimozhiyan</given-names> <surname>Arumugam</surname></string-name>, <string-name><given-names>Shinichi</given-names> <surname>Sunagawa</surname></string-name>, <string-name><given-names>Makedonka</given-names> <surname>Mitreva</surname></string-name>, <string-name><given-names>Julien</given-names> <surname>Tap</surname></string-name>, <string-name><given-names>Ana</given-names> <surname>Zhu</surname></string-name>, <string-name><given-names>Alison</given-names> <surname>Waller</surname></string-name>, <string-name><given-names>Daniel R</given-names> <surname>Mende</surname></string-name>, <string-name><given-names>Jens Roat</given-names> <surname>Kultima</surname></string-name>, <string-name><given-names>John</given-names> <surname>Martin</surname></string-name>, <etal>et al.</etal> <article-title>Genomic variation landscape of the human gut microbiome</article-title>. <source>Nature</source>, <volume>493</volume>(<issue>7430</issue>):<fpage>45</fpage>&#x2013;<lpage>50</lpage>, <year>2013</year>.</mixed-citation></ref>
<ref id="c26"><label>[26]</label><mixed-citation publication-type="journal"><string-name><given-names>Moni</given-names> <surname>Sharma</surname></string-name> and <string-name><given-names>Prem MS</given-names> <surname>Chauhan</surname></string-name>. <article-title>Dihydrofolate reductase as a therapeutic target for infectious diseases: opportunities and challenges</article-title>. <source>Future Medicinal Chemistry</source>, <volume>4</volume>(<issue>10</issue>):<fpage>1335</fpage>&#x2013;<lpage>1365</lpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c27"><label>[27]</label><mixed-citation publication-type="journal"><string-name><given-names>Francesca Di</given-names> <surname>Giallonardo</surname></string-name>, <string-name><given-names>Armin</given-names> <surname>T&#x00F6;pfer</surname></string-name>, <string-name><given-names>Melanie</given-names> <surname>Rey</surname></string-name>, <string-name><given-names>Sandhya</given-names> <surname>Prabhakaran</surname></string-name>, <string-name><given-names>Yannick</given-names> <surname>Duport</surname></string-name>, <string-name><given-names>Christine</given-names> <surname>Leemann</surname></string-name>, <string-name><given-names>Stefan</given-names> <surname>Schmutz</surname></string-name>, <string-name><given-names>Nottania K.</given-names> <surname>Campbell</surname></string-name>, <string-name><given-names>Beda</given-names> <surname>Joos</surname></string-name>, <string-name><given-names>Maria Rita</given-names> <surname>Lecca</surname></string-name>, <string-name><given-names>Andrea</given-names> <surname>Patrignani</surname></string-name>, <string-name><given-names>Martin</given-names> <surname>D&#x00E4;umer</surname></string-name>, <string-name><given-names>Christian</given-names> <surname>Beisel</surname></string-name>, <string-name><given-names>Peter</given-names> <surname>Rusert</surname></string-name>, <string-name><given-names>Alexandra</given-names> <surname>Trkola</surname></string-name>, <string-name><given-names>Huldrych F.</given-names> <surname>G&#x00Fc;nthard</surname></string-name>, <string-name><given-names>Volker</given-names> <surname>Roth</surname></string-name>, <string-name><given-names>Niko</given-names> <surname>Beerenwinkel</surname></string-name>, and <string-name><given-names>Karin J.</given-names> <surname>Metzner</surname></string-name>. <article-title>Full-length haplotype reconstruction to infer the structure of heterogeneous virus populations</article-title>. <source>Nucleic Acids Res</source>, <volume>42</volume>(<issue>14</issue>):<fpage>e115</fpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c28"><label>[28]</label><mixed-citation publication-type="journal"><string-name><given-names>J.M.</given-names> <surname>Cuevas</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Geller</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Garijo</surname></string-name>, <string-name><given-names>J.</given-names> <surname>L&#x00F3;pez-Aldeguer</surname></string-name>, and <string-name><given-names>R.</given-names> <surname>Sanju&#x00E1;n</surname></string-name>. <article-title>Extremely high mutation rate of HIV-1 in vivo</article-title>. <source>PLoS Biol</source>, <volume>13</volume>(<issue>9</issue>):<fpage>e1002251</fpage>, <year>2015</year>.</mixed-citation></ref>
<ref id="c29"><label>[29]</label><mixed-citation publication-type="journal"><string-name><given-names>NCBI</given-names> <surname>Resource Coordinators</surname></string-name>. <article-title>Database resources of the National Center for Biotechnology Information</article-title>. <source>Nucleic Acids Research</source>, <volume>44</volume>(<issue>Database issue</issue>):<fpage>D7</fpage>&#x2013;<lpage>D19</lpage>, <year>2016</year>.</mixed-citation></ref>
<ref id="c30"><label>[30]</label><mixed-citation publication-type="journal"><string-name><given-names>Liang</given-names> <surname>Shi</surname></string-name>, <string-name><given-names>Hailiang</given-names> <surname>Dong</surname></string-name>, <string-name><given-names>Gemma</given-names> <surname>Reguera</surname></string-name>, <string-name><given-names>Haluk</given-names> <surname>Beyenal</surname></string-name>, <string-name><given-names>Anhuai</given-names> <surname>Lu</surname></string-name>, <string-name><given-names>Juan</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>Han-Qing</given-names> <surname>Yu</surname></string-name>, and <string-name><given-names>James K</given-names> <surname>Fredrickson</surname></string-name>. <article-title>Extracellular electron transfer mechanisms between microorganisms and minerals</article-title>. <source>Nature Reviews Microbiology</source>, <volume>14</volume>(<issue>10</issue>):<fpage>651</fpage>&#x2013;<lpage>662</lpage>, <year>2016</year>.</mixed-citation></ref>
<ref id="c31"><label>[31]</label><mixed-citation publication-type="journal"><string-name><given-names>Priscilla EM</given-names> <surname>Purnick</surname></string-name> and <string-name><given-names>Ron</given-names> <surname>Weiss</surname></string-name>. <article-title>The second wave of synthetic biology: from modules to systems</article-title>. <source>Nature Reviews Molecular Cell Biology</source>, <volume>10</volume>(<issue>6</issue>):<fpage>410</fpage>&#x2013;<lpage>422</lpage>, <year>2009</year>.</mixed-citation></ref>
<ref id="c32"><label>[32]</label><mixed-citation publication-type="website"><string-name><given-names>Karel</given-names> <surname>B&#x159;inda</surname></string-name>, <string-name><given-names>Valentina</given-names> <surname>Boeva</surname></string-name>, and <string-name><given-names>Gregory</given-names> <surname>Kucherov</surname></string-name>. <article-title>OCOCO: the first online consensus caller</article-title>. <ext-link ext-link-type="uri" xlink:href="https://github.com/karel-brinda/ococo">https://github.com/karel-brinda/ococo</ext-link>, <year>2016</year>.</mixed-citation></ref>
<ref id="c33"><label>[33]</label><mixed-citation publication-type="journal"><string-name><given-names>Soyeon</given-names> <surname>Ahn</surname></string-name> and <string-name><given-names>Haris</given-names> <surname>Vikalo</surname></string-name>. <article-title>Joint haplotype assembly and genotype calling via sequential Monte Carlo algorithm</article-title>. <source>BMC Bioinformatics</source>, <volume>16</volume>(<issue>1</issue>):<fpage>223</fpage>, <year>2015</year>.</mixed-citation></ref>
<ref id="c34"><label>[34]</label><mixed-citation publication-type="book"><string-name><given-names>D.</given-names> <surname>Aguiar</surname></string-name>. <chapter-title>HapCompass manual</chapter-title>. <publisher-name>Technical report, Brown University</publisher-name>, <year>2014</year>.</mixed-citation></ref>
<ref id="c35"><label>[35]</label><mixed-citation publication-type="journal"><string-name><given-names>Rebecca</given-names> <surname>Rose</surname></string-name>, <string-name><given-names>Bede</given-names> <surname>Constantinides</surname></string-name>, <string-name><given-names>Avraam</given-names> <surname>Tapinos</surname></string-name>, <string-name><given-names>David L</given-names> <surname>Robertson</surname></string-name>, and <string-name><given-names>Mattia</given-names> <surname>Prosperi</surname></string-name>. <article-title>Challenges in the analysis of viral metagenomes</article-title>. <source>Virus Evolution</source>, <volume>2</volume>(<issue>2</issue>):<fpage>vew022</fpage>, <year>2016</year>.</mixed-citation></ref>
<ref id="c36"><label>[36]</label><mixed-citation publication-type="journal"><string-name><given-names>Niko</given-names> <surname>Beerenwinkel</surname></string-name>, <string-name><given-names>Huldrych F</given-names> <surname>G&#x00FC;nthard</surname></string-name>, <string-name><given-names>Volker</given-names> <surname>Roth</surname></string-name>, and <string-name><given-names>Karin J</given-names> <surname>Metzner</surname></string-name>. <article-title>Challenges and opportunities in estimating viral genetic diversity from next-generation sequencing data</article-title>. <source>Frontiers in Microbiology</source>, <volume>3</volume>:<fpage>329</fpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c37"><label>[37]</label><mixed-citation publication-type="journal"><string-name><given-names>Armin</given-names> <surname>T&#x00F6;pfer</surname></string-name>, <string-name><given-names>Osvaldo</given-names> <surname>Zagordi</surname></string-name>, <string-name><given-names>Sandhya</given-names> <surname>Prabhakaran</surname></string-name>, <string-name><given-names>Volker</given-names> <surname>Roth</surname></string-name>, <string-name><given-names>Eran</given-names> <surname>Halperin</surname></string-name>, and <string-name><given-names>Niko</given-names> <surname>Beerenwinkel</surname></string-name>. <article-title>Probabilistic inference of viral quasispecies subject to recombination</article-title>. <source>Journal of Computational Biology</source>, <volume>20</volume>(<issue>2</issue>):<fpage>113</fpage>&#x2013;<lpage>123</lpage>, <year>2013</year>.</mixed-citation></ref>
<ref id="c38"><label>[38]</label><mixed-citation publication-type="journal"><string-name><given-names>S.</given-names> <surname>Prabhakaran</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Rey</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Zagordi</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Beerenwinkel</surname></string-name>, and <string-name><given-names>V.</given-names> <surname>Roth</surname></string-name>. <article-title>HIV haplotype inference using a propagating dirichlet process mixture model</article-title>. <source>IEEE/ACM Trans. Comput. Biol. Bioinform.</source>, pages <fpage>182</fpage>&#x2013;<lpage>191</lpage>, <year>2013</year>.</mixed-citation></ref>
<ref id="c39"><label>[39]</label><mixed-citation publication-type="journal"><string-name><given-names>Aridaman</given-names> <surname>Pandit</surname></string-name> and <string-name><given-names>Rob J de</given-names> <surname>Boer</surname></string-name>. <article-title>Reliable reconstruction of HIV-1 whole genome haplotypes reveals clonal interference and genetic hitchhiking among immune escape variants</article-title>. <source>Retrovirology</source>, <volume>11</volume>(<issue>1</issue>):<fpage>56</fpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c40"><label>[40]</label><mixed-citation publication-type="journal"><string-name><given-names>Duleepa</given-names> <surname>Jayasundara</surname></string-name>, <string-name><given-names>Isaam</given-names> <surname>Saeed</surname></string-name>, <string-name><given-names>Suhinthan</given-names> <surname>Maheswararajah</surname></string-name>, <string-name><given-names>B. C.</given-names> <surname>Chang</surname></string-name>, <string-name><given-names>S.-L.</given-names> <surname>Tang</surname></string-name>, and <string-name><given-names>Saman K</given-names> <surname>Halgamuge</surname></string-name>. <article-title>ViQuaS: an improved reconstruction pipeline for viral quasispecies spectra generated by next-generation sequencing</article-title>. <source>Bioinformatics</source>, <volume>31</volume>(<issue>6</issue>):<fpage>886</fpage>&#x2013;<lpage>96</lpage>, <year>2015</year>.</mixed-citation></ref>
<ref id="c41"><label>[41]</label><mixed-citation publication-type="journal"><string-name><given-names>V.</given-names> <surname>Kuleshov</surname></string-name>. <article-title>Probabilistic single-individual haplotyping</article-title>. <source>Bioinformatics</source>, <volume>30</volume>(<issue>17</issue>):<fpage>i379&#x2013;85</fpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c42"><label>[42]</label><mixed-citation publication-type="book"><string-name><given-names>Alessandro</given-names> <surname>Panconesi</surname></string-name> and <string-name><given-names>Mauro</given-names> <surname>Sozio</surname></string-name>. <chapter-title>Fast hare: A fast heuristic for single individual SNP haplotype reconstruction</chapter-title>. In <source>International Workshop on Algorithms in Bioinformatics</source>, pages <fpage>266</fpage>&#x2013;<lpage>277</lpage>. <publisher-loc>Springer</publisher-loc>, <year>2004</year>.</mixed-citation></ref>
<ref id="c43"><label>[43]</label><mixed-citation publication-type="journal"><string-name><given-names>Hirotugu</given-names> <surname>Akaike</surname></string-name>. <article-title>Likelihood of a model and information criteria</article-title>. <source>Journal of Econometrics</source>, <volume>16</volume>(<issue>1</issue>):<fpage>3</fpage>&#x2013;<lpage>14</lpage>, <year>1981</year>.</mixed-citation></ref>
<ref id="c44"><label>[44]</label><mixed-citation publication-type="journal"><string-name><given-names>Matthew B.</given-names> <surname>Scholz</surname></string-name>, <string-name><given-names>Chien-Chi</given-names> <surname>Lo</surname></string-name>, and <string-name><given-names>Patrick S. G.</given-names> <surname>Chain</surname></string-name>. <article-title>Next generation sequencing and bioinformatic bottlenecks: the current state of metagenomic data analysis</article-title>. <source>Current Opinion in Biotechnology</source>, <volume>23</volume>(<issue>1</issue>):<fpage>9</fpage>&#x2013;<lpage>15</lpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c45"><label>[45]</label><mixed-citation publication-type="journal"><string-name><given-names>Zamin</given-names> <surname>Iqbal</surname></string-name>, <string-name><given-names>Mario</given-names> <surname>Caccamo</surname></string-name>, <string-name><given-names>Isaac</given-names> <surname>Turner</surname></string-name>, <string-name><given-names>Paul</given-names> <surname>Flicek</surname></string-name>, and <string-name><given-names>Gil</given-names> <surname>McVean</surname></string-name>. <article-title>De novo assembly and genotyping of variants using colored de Bruijn graphs</article-title>. <source>Nature Genetics</source>, <volume>44</volume>(<issue>2</issue>):<fpage>226</fpage>&#x2013;<lpage>232</lpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c46"><label>[46]</label><mixed-citation publication-type="journal"><string-name><given-names>D. R.</given-names> <surname>Zerbino</surname></string-name> and <string-name><given-names>E.</given-names> <surname>Birney</surname></string-name>. <article-title>Velvet: algorithms for de novo short read assembly using de Bruijn graphs</article-title>. <source>Genome Research</source>, <volume>18</volume>:<fpage>821</fpage>&#x2013;<lpage>829</lpage>, <year>2008</year>.</mixed-citation></ref>
<ref id="c47"><label>[47]</label><mixed-citation publication-type="journal"><string-name><given-names>B.</given-names> <surname>Langmead</surname></string-name> and <string-name><given-names>S.</given-names> <surname>Salzberg</surname></string-name>. <article-title>Fast gapped-read alignment with Bowtie 2</article-title>. <source>Nature Methods</source>, <volume>9</volume>:<fpage>357</fpage>&#x2013;<lpage>359</lpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c48"><label>[48]</label><mixed-citation publication-type="journal"><string-name><given-names>H.</given-names> <surname>Li</surname></string-name>, <string-name><given-names>B.</given-names> <surname>Handsaker</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Wysoker</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Fennell</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Ruan</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Homer</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Marth</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Abecasis</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Durbin</surname></string-name>, and <collab>1000 Genome Project Data Processing Subgroup</collab>. <article-title>The sequence alignment/map (SAM) format and SAMtools</article-title>. <source>Bioinformatics</source>, <volume>25</volume>:<fpage>2078</fpage>&#x2013;<lpage>9</lpage>, <year>2009</year>.</mixed-citation></ref>
<ref id="c49"><label>[49]</label><mixed-citation publication-type="journal"><string-name><given-names>M.</given-names> <surname>DePristo</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Banks</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Poplin</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Garimella</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Maguire</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Hartl</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Philippakis</surname></string-name>, <string-name><given-names>G.</given-names> <surname>del Angel</surname></string-name>, <string-name><given-names>M. A.</given-names> <surname>Rivas</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Hanna</surname></string-name>, <string-name><given-names>A.</given-names> <surname>McKenna</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Fennell</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Kernytsky</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Sivachenko</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Cibul-skis</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Gabriel</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Altshuler</surname></string-name>, and <string-name><given-names>M.</given-names> <surname>Daly</surname></string-name>. <article-title>A framework for variation discovery and genotyping using next-generation DNA sequencing data</article-title>. <source>Nature Genetics</source>, <volume>43</volume>:<fpage>491</fpage>&#x2013;<lpage>498</lpage>, <year>2011</year>.</mixed-citation></ref>
<ref id="c50"><label>[50]</label><mixed-citation publication-type="journal"><string-name><given-names>R. C.</given-names> <surname>Edgar</surname></string-name>. <article-title>MUSCLE: a multiple sequence alignment method with reduced time and space complexity</article-title>. <source>BMC Bioinformatics</source>, <volume>5</volume>(<issue>1</issue>):<fpage>113</fpage>, <year>2004</year>.</mixed-citation></ref>
<ref id="c51"><label>[51]</label><mixed-citation publication-type="journal"><string-name><given-names>Bette</given-names> <surname>Korber</surname></string-name>, <string-name><given-names>Brian T</given-names> <surname>Foley</surname></string-name>, <string-name><given-names>C</given-names> <surname>Kuiken</surname></string-name>, <string-name><given-names>Satish K</given-names> <surname>Pillai</surname></string-name>, <string-name><given-names>Joseph G</given-names> <surname>Sodroski</surname></string-name>, <etal>et al.</etal> <article-title>Numbering positions in HIV relative to HXB2CG</article-title>. <source>Human retroviruses and AIDS</source>, <volume>3</volume>:<fpage>102</fpage>&#x2013;<lpage>111</lpage>, <year>1998</year>.</mixed-citation></ref>
</ref-list>
<sec id="s5">
<title>Methods</title>
<sec id="s5a">
<title>The metahaplome</title>
<p>We have provided a detailed mathematical definition of the metahaplome in <xref ref-type="sec" rid="s6">Supplementary Section 1.</xref></p>
<p>To enable recovery of a metahaplome from a metagenome with <bold>Gretel</bold> we require:
<list list-type="bullet">
<list-item>
<p><italic>g</italic>, a known DNA region (for example a gene), to be identified by the user</p></list-item>
<list-item>
<p><italic>c</italic>[<italic>i</italic>: <italic>j</italic>], the region of contig <italic>c</italic> (from an assembly <italic>C</italic>) which has been identified as having similarity to <italic>g</italic></p></list-item>
<list-item>
<p><italic>A</italic><sub><italic>c</italic>[<italic>i</italic>:<italic>j</italic>]</sub>, the alignments of the set of reads <italic>R</italic> against the contig region <italic>c</italic>[<italic>i</italic>: <italic>j</italic>]</p></list-item>
<list-item>
<p><italic>S</italic><sub><italic>c</italic>[<italic>i</italic>:<italic>j</italic>]</sub>, the genomic positions determined to be SNPs over the region <italic>c</italic>[<italic>i</italic>: <italic>j</italic>]</p></list-item></list></p>
<p>A metagenomic assembly (which we refer to as a &#x2018;pseudo-reference&#x2019;, <italic>C</italic>) can be generated by assembling sequenced reads, with an assembler such as <bold>Velvet</bold> [<xref ref-type="bibr" rid="c46">46</xref>]. One may identify a gene of interest <italic>g</italic>, on a contig <italic>c</italic> by similarity search or gene prediction. We refer to gene <italic>g</italic> as the <italic>target.</italic> We want to recover the most likely haplotypes of <italic>g</italic> that exist in the metahaplome.</p>
<p>A subset of reads that align to the target region can be determined using a short read alignment tool such as <bold>bowtie2</bold> [<xref ref-type="bibr" rid="c47">47</xref>]. Reads that fall outside the target of interest (<italic>i.e</italic>. reads that do not cover any of the genomic positions covered by the target) can be safely discarded: they do not provide relevant evidence to SNPs that appear on the region of interest.</p>
<p>Variation at single nucleotide positions across reads along the target, can then be called with a SNP calling algorithm such as that provided by <bold>samtools</bold> [<xref ref-type="bibr" rid="c48">48</xref>] or <bold>GATK</bold> [<xref ref-type="bibr" rid="c49">49</xref>]. To avoid loss of information arising from the diploid bias of the majority of SNP callers [<xref ref-type="bibr" rid="c33">33</xref>], our methodology aggressively considers any heterogeneous site as a SNP.</p>
<p>The combination of aligned reads, and the locations of single nucleotide variation on those reads can be exploited by <bold>Hansel</bold> and <bold>Gretel</bold> to recover real haplotypes in the metagenome: the <bold>metahaplome</bold>.</p>
</sec>
<sec id="s5b">
<title>Hansel: A novel data structure</title>
<p>We present <bold>Hansel</bold>, a probabilistically-weighted, graph-inspired, novel data structure. <bold>Hansel</bold> is designed to store the number of observed occurrences of a symbol <italic>&#x03B1;</italic> appearing at some position in space or time <italic>i</italic>, co-occurring with another symbol <italic>&#x03B2;</italic> at another position in space or time <italic>j</italic>. For our approach, we use <bold>Hansel</bold> to store the number of times a SNP <italic>&#x03B1;</italic> at the <italic>i</italic>&#x2019;th variant some contig <italic>c</italic>, is observed to co-occur (appear on the same read) with a SNP <italic>&#x03B2;</italic> at the <italic>j</italic>&#x2019;th variant of the same contig. <bold>Hansel</bold> is a four dimensional matrix whose individual elements <italic>H</italic>[<italic>&#x03B1;</italic>, <italic>&#x03B2;</italic>, <italic>i</italic>, <italic>j</italic>] record the number of observations of a co-occurring pair of symbols (<italic>&#x03B1;<sub>i</sub></italic>, <italic>&#x03B2;<sub>j</sub></italic>).</p>
</sec>
<sec id="s5c">
<title>Different from the typical SNP matrix</title>
<p>Our representation differs from the typical SNP matrix model [<xref ref-type="bibr" rid="c10">10</xref>] that forms the basis of many of the surveyed approaches. Rather than a matrix of columns representing SNPs and rows representing reads, we discard the concept of a read entirely and aggregate the evidence seen across all reads by genomic position.</p>
<p>At first this structure may appear limited, but the data in <italic>H</italic> can easily be exploited to build other structures. Consider <italic>H</italic>[<italic>&#x03B1;</italic>, <italic>&#x03B2;</italic>,1, 2] for all symbol pairs (<italic>&#x03B1;</italic>, <italic>&#x03B2;</italic>). One may enumerate the available transitions from space or time point 1 to point 2. Extending this to consider <italic>H</italic>[<italic>&#x03B1;</italic>, <italic>&#x03B2;</italic>, <italic>i</italic>, <italic>i</italic> &#x002B; 1] for all (<italic>&#x03B1;</italic>, <italic>&#x03B2;</italic>) over <italic>i</italic>, one can construct a simple graph <italic>G</italic> of possible transitions between all symbols. In our setting, <italic>G</italic> could represent a graph of transitions observed between SNPs on a genomic sequence, across all reads <xref ref-type="fig" rid="fig5">Figure 5</xref> shows how the Hansel structure records information about SNP pairs, and shows a simple graph constructed from this information.</p>
<fig id="fig5" position="float" orientation="portrait" fig-type="figure">
<label>Figure 5:</label>
<caption>
<p>Three corresponding representations, (a) a set of aligned short read sequences, with called variants, (b) the actual <bold>Hansel</bold> structure where each possible pair of symbols (00, 01, 10, 11) has a matrix storing counts of occurrences of that ordered symbol pair between two genomic positions across all of the aligned reads, (c) a simple graph that can be constructed by considering the evidence provided by adjacent variants. Note this representation ignores evidence from non-adjacent pairs, which is overcome by the dynamic edge weighting of the <bold>Hansel</bold> data structure&#x2019;s interface.</p>
</caption>
<graphic xlink:href="117838_fig5.tif"/>
</fig>
<p>Intuitively, one may traverse a path through <italic>G</italic> by selecting edges with the highest weight in order to recover a series of symbols that represent an ordered sequence of SNPs that constitute a haplotype in the metahaplome. The weight of an edge between two nodes may be defined as the number of reads that provide direct evidence for that pair of SNP values occurring together.</p>
</sec>
<sec id="s5d">
<title>Different from a graph</title>
<p>Although the analogy to a graph helps us to consider paths through the structure, the available data cannot be fully represented with a graph such as that seen in <xref ref-type="fig" rid="fig5">Figure 5</xref> alone. A graph representation defines a constraint that only considers pairs of adjacent positions (<italic>i</italic>, <italic>i</italic> &#x002B; 1) over <italic>i</italic>. Edges can only be drawn between adjacent SNPs and their weightings cannot consider the evidence available in <italic>H</italic> between non-adjacent SNP symbols. Without considering information about non-adjacent SNPs, one can traverse <italic>G</italic> to create paths (sequences of SNPs) that do not exist in the observed data set, as shown in <xref ref-type="fig" rid="fig6">Figure 6</xref>. To prevent construction of such invalid paths and recover genuine paths more accurately, one should consider evidence observed between non-adjacent symbols when determining which edge to traverse next.</p>
<fig id="fig6" position="float" orientation="portrait" fig-type="figure">
<label>Figure 6:</label>
<caption><p>Considering only adjacent SNPs, one may create paths for which there was no actual observed evidence. Here, the reads &#x007B;0011, 0001, 0100&#x007D; do not support either of the results &#x007B;0000, 0101&#x007D;, but both are valid paths through a graph that permits edges between pairs of adjacent SNPs.</p>
</caption>
<graphic xlink:href="117838_fig6.tif"/>
</fig>
</sec>
<sec id="s5e">
<title>Using information from non-adjacent SNPs, and the path so far</title>
<p>The <bold>Hansel</bold> structure is designed to store pairwise co-occurrences of all SNPs (not just those that are adjacent), across all reads. We may take advantage of the additional information available in <italic>H</italic> and build upon the graph <italic>G</italic>. Incorporating evidence of non-adjacent SNPs in the formula for edge weights allows decisions during traversal to consider previously visited nodes, as well as merely the current node path, <italic>i</italic>.</p>
<p>That is, given a node <italic>i</italic>, the decision to move to a symbol at <italic>i</italic> &#x002B; 1 can be informed not only by observations in the reads covering positions (<italic>i</italic>, <italic>i</italic> &#x002B; 1), but also (<italic>i</italic> &#x2212; 1, <italic>i</italic> &#x002B; 1), (<italic>i</italic> &#x2212; 2, <italic>i</italic> &#x002B; 1), and so on. Such a scheme allows for the efficient storage of some of the most pertinent information from the reads, and allows edge weights to dynamically change in response to the path as it has been constructed thus far. Outward edges between (<italic>i</italic>, <italic>i</italic> &#x002B; 1) that would lead to the construction of a path that does not exist in the data can now be influenced by observations in the reads beyond that of the current node and the next. Our method mitigates the risk of constructing paths which do not truly exist.</p>
<p>The consideration and storage of pairwise SNPs fits well with the Naive Bayes model employed to simplify the potentially expensive calculation of conditional probabilities (<xref ref-type="sec" rid="s6d">Supplementary Section 4</xref>).</p>
<p>Although we describe <bold>Hansel</bold> as &#x201C;graph-inspired&#x201D;, allowing edge weights to depend on the current path through <italic>G</italic> itself leads to several differences between the <bold>Hansel</bold> structure and a weighted directed acyclic graph. Whilst these differences are not necessarily disadvantageous, they do change what we can infer about the structure.</p>
</sec>
<sec id="s5f">
<title>A dynamic structure</title>
<p>The structure of the graph is effectively unknown in advance. That is, not only are the weights of the edges not known ahead of traversal (as they depend on that traversal), but the entire layout of nodes and edges is also unknown until the graph is explored (although, arguably this would be true of very large simple graphs too). Indeed, this means it is also unknown whether or not the graph can even be successfully traversed.</p>
<p>Also of note is the fact that the graph is dynamically weighted. The current path represents a memory that affects the availability and weights of outgoing edges at each node. Edge weights are calculated probabilistically <italic>during</italic> traversal. They depend on the observation of SNP pairs between some number of the already selected nodes in the path, and any potential next node. <xref ref-type="sec" rid="s6c">Supplementary Section 3</xref> provides the equation and intuition for the probabilistic calculation of edge weights.</p>
<p>In exchange for these minor caveats, we have a data structure that permits graph-like traversal that is intrinsic to our problem definition, whilst utilising informative pairwise SNP information collected from observations on raw metagenomic reads. <bold>Hansel</bold> fuses the advantages of a graph&#x2019;s simple representation (and its inherent traversability) with the ability to efficiently store pertinent information by considering only pairs of SNPs across all reads.</p>
</sec>
<sec id="s5g">
<title>Gretel: An algorithm for recovering haplotypes from metagenomes</title>
<p>We introduce <bold>Gretel</bold>, an algorithm designed to interface with the <bold>Hansel</bold> data structure to recover the most likely haplotypes from a metahaplome. To obtain likely haplotypes, <bold>Gretel</bold> traverses the probabilistic graph structure provided by <bold>Hansel</bold>, selecting the most likely SNPs at each possible node (<italic>i.e</italic>. traversing edges with the greatest probability), given some subset of the most recently selected nodes in the path so far. At each node, an <italic>L</italic>&#x2019;th order Markov chain model is employed to predict which of the possible variants for the next SNP is most likely, given the last <italic>L</italic> variants in the current path.</p>
<p>Execution of <bold>Gretel</bold> can be broken into the following steps:
<list list-type="order">
<list-item>
<p>Parse the read alignments and retain only the bases that cover SNP sites, discarding any conserved base positions as they provide no haplotype information.</p></list-item>
<list-item>
<p>Populate the <bold>Hansel</bold> structure with all pairwise observations from each of the reads.</p></list-item>
<list-item>
<p>Exploit the <bold>Hansel</bold> graph API to incrementally recover a path until a variant has been selected at each SNP position:
<list list-type="bullet">
<list-item>
<p>Query for the available transitions from the current position in the graph to the next SNP</p></list-item>
<list-item>
<p>Calculate the probabilities of each of the potential next variants appearing in the path given the last L variants</p></list-item>
<list-item>
<p>Append the most likely variant to the path and traverse the edge</p></list-item></list></p></list-item>
<list-item>
<p>Report this path as a haplotype and then remove the information for this path from the data by reweighting observations that contributed to this path. This will allow for new paths to be retrieved next.</p></list-item>
<list-item>
<p>Repeat (3&#x2212;4) until the graph can no longer be traversed or an optional additional stopping criterion has been reached.</p></list-item></list></p>
</sec>
<sec id="s5h">
<title>Greedy path construction</title>
<p>Haplotypes are reconstructed as a path through the <bold>Hansel</bold> structure, one SNP at a time, linearly, from the beginning of the sequence. At each SNP position, the <bold>Hansel</bold> structure is queried for the variants that were observed on the raw reads at the next position. <bold>Hansel</bold> also calculates the conditional probabilities of each of those variants appearing as the next SNP in the sequence, using a Markov chain of order L that makes its predictions given the current state of the observations in the <bold>Hansel</bold> matrix and the last <italic>L</italic> selected SNPs. <bold>Gretel</bold>&#x2019;s approach is greedy: we only consider the probabilities of the next variant. Our razor is to assume that the best haplotypes are those that can be constructed by selecting the most likely edges at every opportunity.</p>
</sec>
<sec id="s5i">
<title>Reweighting to find multiple haplotypes</title>
<p>Whilst our framework is probabilistic, it is not stochastic. Given the same <bold>Hansel</bold> structure and operating parameters, <bold>Gretel</bold> will behave deterministically and return the same set of haplotypes every time. However, we are interested in recovering the metahaplome of multiple, real haplotypes from the set of reads, not just one haplotype. <bold>Hansel</bold> exposes a function in its interface for the reweighting of observations. Once a path through the graph is completed (a variant has been chosen for all SNP sites), the observations in the <bold>Hansel</bold> matrix are reweighted by <bold>Gretel</bold>.</p>
<p>Currently, <bold>Gretel</bold> reduces the weight of each pairwise observation that forms a component of a completed path - in an attempt to reduce evidence for that haplotype existing in the metahaplome at all, allowing evidence for other haplotypes to now direct the probabilistic search strategy.</p>
</sec>
<sec id="s5j">
<title>Gretel&#x0027;s outputs</title>
<p>Finally, <bold>Gretel</bold> outputs recovered sequences as FASTA, requiring no special parsing of results to be able to conduct further analyses. Of course, with knowledge of the input haplotypes that we expect to recover, we are able to quantify our approach. For real metahaplomes, we need a mechanism to differentiate false positives, or to rank our confidence in the returned haplotypes.</p>
<p>Future work will investigate this in more depth, but currently, in addition to the sequences themselves, <bold>Gretel</bold> outputs a &#x2018;crumbs&#x2019; file &#x2014; a whimsical name for a simple, tab delimited format &#x2014; that contains metadata for each of the recovered sequences: log probability of that sequence existing given the evidence seen overall, how much of the evidence in <bold>Hansel</bold> that particular sequence was supported by, and how much of that evidence was reweighted as a result of that path being chosen.</p>
<p>Currently, <bold>Gretel</bold> will continuously recover paths out of the remaining evidence until it encounters a node from which there is no evidence that can inform the next decision.</p>
</sec>
<sec id="s5k">
<title>Testing methodologies</title>
<p>In this section, we provide an overview of the methods to generate metahaplomes for both synthetic haplotypes, and haplotypes based on real genes. We describe our approach for evaluation of our work. Our test methodologies evaluate the performance of our framework against metahaplomes consisting of synthetic reads derived from both randomly generated haplotypes, and also haplotypes created from real gene sequences. <xref ref-type="table" rid="tbl3">Table 3</xref> summarises each of the evaluation data sets.</p>
<table-wrap id="tbl3" orientation="portrait" position="float">
<label>Table 3:</label>
<caption><p>Properties of the evaluation data sets. <sup>&#x2020;</sup>Per haplotype base variation rate estimated by dividing the ratio of SNPs over sequence length by the number of known haplotypes. <sup>&#x2021;</sup>Read size and depth for HIV-1 data sets were averaged over the region of the particular gene in the aligned BAM (<xref ref-type="table" rid="tbl5">Table 5</xref>).</p>
</caption>
<graphic xlink:href="117838_tbl3.tif"/>
</table-wrap>
</sec>
<sec id="s5l">
<title>Read generation and variant calling</title>
<p>With the exception of the HIV data set, our reads are generated <italic>in silico</italic> with our Python based tool (<bold>shredder</bold>) which can be found as part of our evaluation repository via: <ext-link ext-link-type="uri" xlink:href="https://github.com/SamStudio8/gretel-test">https://github.com/SamStudio8/gretel-test</ext-link>.</p>
<p>Our synthetic reads are designed to be simplistic; errorless and of uniform length and coverage. The synthetic read sets form a basis for testing the <bold>Hansel</bold> and <bold>Gretel</bold> packages during development, as well as providing a platform on which to investigate the influence that parameters such as read length, number of haplotypes, and mutation rate have on haplotype recovery.</p>
<p>For a given FASTA file, our tool generates reads of a uniform user-defined length and coverage, for each of the sequences in the file. The tool calculates the number of reads to generate to achieve the approximate coverage, given the length of the sequence, and the selected read length. A BED file can be used to mask particular areas of one or more of the input FASTA sequences.</p>
<p>Uniform coverage is approximated by randomly generating the start positions of all of the reads across the input sequence (and also allowing for up to half of a read to fall off either end of the sequence).</p>
<p>As our tool is aware of the start position of every read that it generates, it is possible to also produce an alignment of those reads in SAM format. This allows us to align reads without introducing biases and assumptions from external tools. Pileups of our generated reads typically feature many tri- or tetra-allelic sites (especially as mutation rate increases). Many variant calling approaches feature diploid biases and can disregard such sites as sequencing error, denying us the info rmation with which to recover correct haplotypes. Our approach is robust to noise arising from sequencing error (see the results for the HIV data, which consists of real reads from a mixed set of 5 HIV strains). It is also robust to misaligned reads (see results for the DHFR, Influenza and HIV data) and as such we can aggressively call variants by assuming any heterogeneous site is a SNP.</p>
<p>Our evaluation repository contains the simple <bold>snpper</bold> tool that generates a VCF for a given BAM. <bold>snpper</bold> outputs a VCF record for any heterogeneous site.</p>
<p>The code, documentation, and data for evaluation are open source and freely available via our data and testing repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/samstudio8/gretel-test">https://github.com/samstudio8/gretel-test</ext-link></p>
</sec>
<sec id="s5m">
<title>Evaluating recovery accuracy</title>
<p>To evaluate the accuracy of a run of <bold>Gretel</bold>, each known input haplotype is compared pairwise to each of the recovered output haplotypes. Each input haplotype is matched to a corresponding &#x201C;best&#x201D; recovered haplotype. Best is defined as the output haplotype that yields the smallest Hamming distance from a given input haplotype. For each synthetic metahaplome, we perform a multiple sequence alignment with <bold>MUSCLE</bold> [<xref ref-type="bibr" rid="c50">50</xref>] to determine the definitive SNP positions. When calculating Hamming distance, we consider only these corresponding positions. That is, we exclude the comparison of homogeneous sites from the evaluation metric, to ensure we only consider our accuracy on positions that require recovery. For our results we report the proportion of total SNPs that were correctly recovered by <bold>Gretel</bold>, expressed as a percentage.</p>
<p>Comparing sites enumerated by the multiple sequence alignment of the original haplotypes, as opposed to the VCF of each individual read set ensures <bold>Gretel</bold> is penalised when a SNP has not been called from the read set.</p>
<p>Note that regardless of quality, all input haplotypes are assigned a best output haplotype. An output haplotype may be the best haplotype for more than one input. If more than one output haplotype has the same Hamming distance, the first that was found is chosen. If <bold>Gretel</bold> could not complete at least one haplotype (<italic>i.e.</italic> a pair of adjacent SNP positions were not covered by at least one read), all input haplotypes are awarded a recovery of 0%.</p>
</sec>
<sec id="s5n">
<title>Synthetic (seq-gen) metahaplomes</title>
<p>With the desire to first test our approach on data sets with well-defined and controllable read properties, but still posing a recovery problem, <bold>seq-gen</bold> [<xref ref-type="bibr" rid="c24">24</xref>] was used to generate sets of DNA sequences that would serve as haplotypes of a synthetic metahaplome.</p>
<p><bold>seq-gen</bold> simulates the evolution of a nucleotide sequence along a given phylogeny. For testing <bold>Gretel</bold>, we provided a star shaped guide tree with uniform branch lengths, such that all haplotypes would be equally dissimilar to each other. These uniform branch lengths correspond to the rate of per haplotype base (hb) nucleotide heterogeneity. Thus, each taxa in the tree has a DNA sequence based upon the evolution of the given starting sequence, following simulated evolution at the given rate.</p>
<p>The same starting sequence was shared by all of our generated trees. We used a randomly generated sequence of 3000 nt with 50% GC content. We fixed the number of taxa in the trees at five, but varied the mutation rate across seven levels (<xref ref-type="table" rid="tbl4">Table 4</xref>. 35 trees were generated (7 mutation rates and 5 replicates), each containing five sequences mutated at the same rate, from the original 3000 nt sequence. Each of the resulting 35 sets of five mutated DNA sequences represent a metahaplome from which the five haplotypes must be recovered by <bold>Gretel</bold>.</p>
<table-wrap id="tbl4" orientation="portrait" position="float">
<label>Table 4:</label>
<caption><p>Mean number of variants called over the 900 generated synthetic read sets, for each per-haplotype base (hb) mutation rate. The generated sequences for each metahaplome were 3000 nt long.</p>
</caption>
<graphic xlink:href="117838_tbl4.tif"/>
</table-wrap>
<p>As per our described read generation and variant calling protocol, we generated synthetic reads from each of the five sequences in the metahaplome, varying both the read length and per-haplotype read depth <italic>(i.e.</italic> the average coverage of each haplotype). For each read length and depth parameter pair, ten read sets were generated, to amortise any effect on haplotype recovery introduced by the alignments of the reads themselves. We generated 6300 read sets (3 read sizes, 6 per-haplotype depth levels, 7 mutation rates, 10 read replicates, 5 tree replicates). <xref ref-type="table" rid="tbl3">Table 3</xref> summarises the data sets generated for evaluation.</p>
</sec>
<sec id="s5o">
<title>Metahaplomes from real genes</title>
<preformat preformat-type="dialog">
bowtie2 --local
-D 20 -R 3 -L 3 -N 1 -p 8
--gbar 1 --mp 3
-x master.bti -U reads.fq --un unaligned.fq --no-unal -S out.sam
</preformat>
<sec id="s5o1">
<label>Listing 1</label>
<title>Bowtie2 parameters used to align the read sets</title>
<p>We chose an arbitrary <italic>DHFR</italic> gene from GenBank (<italic>EU145592.1</italic>) to serve as the &#x2018;master&#x2019; (pseudo-reference) sequence against which to align reads to call variants of a synthetic <italic>DHFR</italic> metahaplome. To find sequences to use as haplotypes, a discontinuous <bold>megaBLAST</bold> was conducted against the master. A set of five related but arbitrary genes of decreasing sequence identity (&#x2248;99.8%, 97.3%, 90.1%, 83.5%, 78.7%) were selected (<xref ref-type="table" rid="tbl1">Table 1</xref>).</p>
<p>As per our previously described read generation method, we created read sets generated from the five input sequences, varying their length and depth. Our data set is outlined in <xref ref-type="table" rid="tbl3">Table 3</xref>, and consists of 1,200 sets of reads (2 read sizes, 6 per-haplotype coverage levels, 100 replicates).</p>
<p>Unlike the methodology for the <bold>seq-gen</bold> simulations, our <italic>DHFR</italic> reads were aligned back to the pseudo-reference with <bold>bowtie2</bold>, as the input sequences were not of the same length and could potentially contain insertions or deletions with respect to the chosen reference. Reads from the more dissimilar sequences were discarded by <bold>bowtie2</bold> (Supplementary Materials <xref ref-type="fig" rid="figS2">Fig. 2</xref>), which is a problem, because the variant information that they contain is then no longer available to add to <bold>Hansel</bold>. This was also true of other commonly used sequence aligners, including <bold>bwa</bold>. These tools are not designed for use-cases where one wishes to permit such diverse sequences to be co-aligned. Though, we were able to improve overall alignment scores for our <italic>DHFR</italic> and Flu-A7 data sets by significantly relaxing <bold>bowtie2</bold>&#x2019;s parameters (<xref ref-type="sec" rid="s5o1">Listing 1</xref>).</p>
<p>Variants were called on the alignment using our <bold>snpper</bold> tool (provided at <ext-link ext-link-type="uri" xlink:href="https://github.com/samstudio8/gretel-test">https://github.com/samstudio8/gretel-test</ext-link>) that determined all heterogeneous sites as variants. A multiple sequence alignment of the original five haplotypes showed the number of actual SNPs in the data set was 196. <xref ref-type="fig" rid="figS1">Supplementary Figure 1</xref> shows the proportion of SNPs that were correctly called from the read sets (before recovery). In this scenario, very short reads (50 bp) appear to offer insufficient evidence to call all the real variants. This can prevent full recovery of some of the haplotypes (whose variant sites were lost to synthetic read generation, or alignment).</p>
</sec>
</sec>
<sec id="s5p">
<title>Metahaplomes from real reads</title>
<p>For verification of our approach on real sequenced reads, we evaluated <bold>Gretel</bold> with a dataset designed specifically for the benchmarking of haplotype reconstruction methods [<xref ref-type="bibr" rid="c27">27</xref>]. Five well studied HIV-1 strains (<italic>89.6, HXB2, JRCSF, NL43,</italic> and <italic>YU2</italic>) were mixed and sequenced with an Illumina MiSeq.</p>
<p>The Illumina reads are available from ENA (<italic>SRR961514</italic>). As per our protocol, reads were aligned against a pseudo-reference. We selected one of the five strains to serve as this reference (<italic>89.6,</italic> and aligned all sequenced reads against it using <bold>bowtie2</bold>. The overall alignment rate was 96.87%, yielding an alignment of 1,385,162 sequences.</p>
<p>We determined that any heterozygous pileup site in the resulting alignment would be defined as a SNP, resulting in a VCF containing 9,570 called variants. The SNPs are so numerous that they occur at 98.98% of all sites.</p>
<p>We executed <bold>Gretel</bold> on five of the largest genes on the HIV-1 genome, using <italic>HXB2</italic> gene co-ordinates [<xref ref-type="bibr" rid="c51">51</xref>], each time providing the same alignment BAM and VCF to <bold>Gretel</bold>, but additionally using the <bold>start</bold> and <bold>end</bold> command line parameters to define the boundary of the particular region of interest. <xref ref-type="table" rid="tbl5">Table 5</xref> describes the five genes and their properties. <xref ref-type="table" rid="tbl6">Table 6</xref> shows the identity matrix for the five strains.</p>
<table-wrap id="tbl5" orientation="portrait" position="float">
<label>Table 5:</label>
<caption><p>The five HIV-1 genes, HXB2 co-ordinates [<xref ref-type="bibr" rid="c51">51</xref>] and associated properties of the aligned reads</p></caption>
<graphic xlink:href="117838_tbl5.tif"/>
</table-wrap>
<table-wrap id="tbl6" orientation="portrait" position="float">
<label>Table 6:</label>
<caption><p>Percentage identity matrix for the five HIV-1 strains as reported by <bold>MUSCLE</bold> [<xref ref-type="bibr" rid="c50">50</xref>]</p>
</caption>
<graphic xlink:href="117838_tbl6.tif"/>
</table-wrap>
<p>We evaluated our approach using the same framework as our synthetic metahaplomes. We report the proportion of variants correctly recovered by <bold>Gretel</bold> for each of the five known haplotypes, for each of the genes.</p>
</sec>
</sec>
<sec id="s6" sec-type="Supplementary-material">
<title>Supplementary Information</title>
<sec id="s6a">
<label>1</label>
<title>The metahaplome</title>
<p>Consider:
<list list-type="bullet">
<list-item>
<p>&#x03A9;</p>
<p>An environment of microbial organisms.</p></list-item>
<list-item>
<p><italic>O</italic></p>
<p>A bag containing each full genomic sequence, of each individual organism in environment &#x03A9;. <italic>O</italic> is the whole metagenome of &#x03A9;.</p></list-item>
<list-item>
<p><italic>o</italic>[<italic>i</italic>: <italic>j</italic>]</p>
<p>A sub-sequence <italic>i</italic>..<italic>j</italic> of some genome <italic>o</italic> &#x2208; <italic>O</italic></p></list-item>
<list-item>
<p>Gene <italic>g</italic>, Protein <italic>p</italic></p>
<p>A known DNA sequence <italic>g</italic>, responsible for the production of a protein <italic>p</italic>. <italic>p</italic> is a protein capable of performing a catalytic reaction of interest, such as the hydrolysis of cellulose</p></list-item>
<list-item>
<p>&#x0394;(<italic>s g</italic>)</p>
<p>Any function &#x0394; that can determine whether a DNA sequence <italic>s</italic> (such as a sub-sequence <italic>o<sub>n</sub></italic>[<italic>i</italic>: <italic>j</italic>]) has sufficient similarity to <italic>g</italic>. &#x0394; may return a boolean, or a real value with some user-selected threshold.</p></list-item>
<list-item>
<p>&#x0393;<italic>g</italic>&#x003D;<italic>se</italic>t(&#x23B1;<italic>o<sub>k</sub></italic>[<italic>i</italic>:<italic>j</italic>]&#x007C;&#x0394;(<italic>o<sub>k</sub></italic>[<italic>i</italic>,<italic>j</italic>],<italic>g</italic>),<italic>k</italic>&#x2208;1..&#x007C;<italic>O</italic>&#x007C;,<italic>i</italic>,<italic>j</italic>&#x2208;1..&#x007C;<italic>o<sub>k</sub></italic>&#x007C;&#x20B0;)</p></list-item>
<list-item>
<p>One may collect a bag of sub-sequences found to be a similar to <italic>g</italic> and thus responsible for the production of a protein product <italic>p</italic>. The set &#x0393;<italic><sub>g</sub></italic> of unique sequences contained in the bag enumerate the possible sub-sequences across all <italic>o</italic> &#x2208;<italic>O</italic> that are capable of producing a protein product <italic>p</italic>.</p></list-item></list></p>
<p>We define &#x0393;<sub><italic>g</italic></sub> as the <bold>metahaplome</bold> for the gene <italic>g</italic>, in the metagenome <italic>O</italic>. Each such member &#x03B3; &#x2208; &#x0393;<sub><italic>g</italic></sub> is a <italic>haplotype</italic> of <italic>g</italic>, capable of constructing a protein that performs a biological function of interest in the environment. We wish to recover the set &#x0393;<sub><italic>g</italic></sub>. Additionally, our methodology requires the following definitions:
<list list-type="bullet">
<list-item>
<p><italic>&#x03C3;</italic> &#x003D; Sample(&#x03A9;)</p>
<list list-type="bullet">
<list-item>
<p>A sample taken from microbial environment &#x03A9;.</p></list-item>
<list-item>
<p><italic>&#x03C3;</italic> &#x2282; &#x03A9;</p></list-item></list></list-item>
<list-item>
<p><italic>M</italic></p>
<list list-type="bullet">
<list-item>
<p>A bag containing each full genomic sequence <italic>m</italic>, of each individual organism captured in the subset &#x03C3;.</p></list-item>
<list-item>
<p><italic>M</italic> represents the metagenome that was captured in the sample <italic>&#x03C3;</italic>.</p></list-item>
<list-item>
<p><italic>M</italic> is not necessarily representative of the entire metagenome <italic>O</italic>.</p></list-item>
<list-item>
<p><italic>M</italic> &#x2282; <italic>O</italic></p></list-item></list></list-item>
<list-item>
<p><italic>R</italic> &#x003D; Seq(<italic>&#x03C3;</italic>)</p>
<list list-type="bullet">
<list-item>
<p>A set of sequenced <bold>reads</bold> <italic>r</italic> &#x2208; <italic>R</italic>, consisting of a series of residues (bases) <italic>r</italic>[<italic>i</italic>] &#x2208; &#x007B;<italic>A</italic>, <italic>C</italic>, <italic>G</italic>, <italic>T</italic>, <italic>N</italic>&#x007D;, <italic>i</italic> &#x2208; 1..&#x007C;<italic>r</italic>&#x007C;.</p></list-item>
<list-item>
<p><italic>R</italic> is the set of reads obtained from the sequencing of isolated DNA from sample <italic>&#x03C3;</italic>.</p></list-item>
<list-item>
<p><italic>R</italic> contains fragments of genomes <italic>m</italic> &#x2208; <italic>M</italic> (and error).</p></list-item>
<list-item>
<p>Due to sampling bias acquiring <italic>&#x03C3;</italic> from &#x03A9;, <italic>R</italic> is unlikely to be representative of the true genetic diversity available in <italic>O</italic>.</p></list-item>
<list-item>
<p>Additionally, due to sequencing and PCR biases and error, <italic>R</italic> is unlikely to provide uniform non-zero coverage of the residues across all <italic>m</italic> &#x2208; <italic>M</italic>.</p></list-item></list></list-item>
<list-item>
<p><italic>C</italic> &#x003D; Assembly(<italic>R</italic>)</p>
<list list-type="bullet">
<list-item>
<p>Contig set <italic>C</italic> (the &#x201C;<bold>Assembly</bold>&#x201D;) constructed from the reads <italic>R</italic> by some <bold>Assembly</bold> operation.</p></list-item>
<list-item>
<p><italic>C</italic> poses as a pseudo-reference for the sequenced metagenome.</p></list-item>
<list-item>
<p><italic>C</italic> attempts to estimate <italic>M</italic>, but typically fails to distinguish between similar sequences that belong on distinct <italic>c</italic>.</p></list-item>
<list-item>
<p><italic>c</italic>[<italic>j</italic>] &#x2208; &#x007B;<italic>A</italic>,<italic>C</italic>,<italic>G</italic>,<italic>T</italic>,<italic>N</italic>&#x007D; for <italic>j</italic> &#x2208; 1..&#x007C;<italic>c</italic>&#x007C;, for <italic>c</italic> &#x2208; <italic>C</italic>.</p></list-item></list></list-item>
<list-item>
<p><italic>A</italic> &#x003D; Align(<italic>R</italic>, <italic>C</italic>)</p>
<list list-type="bullet">
<list-item>
<p><bold>Alignment</bold> <italic>A</italic>, the set of alignments constructed via aligning read set <italic>R</italic> to contig set <italic>C</italic> with operation <bold>Align</bold>.</p></list-item>
<list-item>
<p><italic>A</italic><sub><italic>c</italic>[<italic>i</italic>:<italic>j</italic>]</sub>, the subset of A containing any alignment on contig <italic>c</italic> that spans any site between <italic>c</italic>[<italic>i</italic>..<italic>j</italic>]</p></list-item></list></list-item>
<list-item>
<p><italic>S</italic> &#x003D; Call(<italic>A<sub>c</sub></italic>)</p>
<list list-type="bullet">
<list-item>
<p>The set of genomic positions on a contig <italic>c</italic> &#x2208; <italic>C</italic> determined to be a SNP (single nucleotide polymorphism) by an operation <bold>Call</bold>, given the subset <italic>A<sub>c</sub></italic>: the alignments of <italic>R</italic> against <italic>c</italic>.</p></list-item></list></list-item></list></p>
<p>Our goal is to determine &#x0393;<sub><italic>g</italic></sub>, for some gene <italic>g</italic>. Although M will not be entirely representative of <italic>O</italic>, it is the only evidence of the sequence diversity available. Thus we adjust our goal to instead find the most likely elements of &#x0393;<sub><italic>g</italic></sub>, given the evidence that can be derived from <italic>M</italic>, via the alignments <italic>A</italic> and variant sites <italic>S</italic>.</p>
</sec>
<sec id="s6b">
<label>2</label>
<title>Hansel as a graph</title>
<p>Consider an alphabet of symbols, &#x03A3; (<italic>e.g</italic>. &#x007B;<italic>A,C,G,T, N,</italic> &#x2212;&#x007D;) and a list of n SNP positions 1..<italic>n</italic>. Symbols &#x2205;<sub><italic>S</italic></sub> and &#x2205;<sub><italic>E</italic></sub> represent special sentinal positions at the start and end of the SNP positions (0 and <italic>n</italic> &#x002B;1 respectively). As described in our article, the <bold>Hansel</bold> structure <italic>H</italic> can be considered as a graph <italic>G</italic> &#x003D; (<italic>V</italic>, <italic>E</italic>). Here, we define <italic>V</italic>, and <italic>E</italic>:
<disp-formula id="eqnS1"><alternatives><graphic xlink:href="117838_eqnS1.gif"/></alternatives></disp-formula>
<disp-formula id="eqnS2"><alternatives><graphic xlink:href="117838_eqnS2.gif"/></alternatives></disp-formula></p>
<p><italic>E</italic> represents the set of edges, where an edge (<italic>A</italic><sub>i</sub>, <italic>B<sub>i</sub></italic><sub>&#x002B;1</sub>) is determined to exist in <italic>E</italic> if there exists at least one read whereby symbol <italic>A</italic> was observed at position <italic>i</italic> to co-occur with symbol <italic>B</italic> at SNP position <italic>i</italic> &#x002B;1.</p>
<p>It should be noted, that although <italic>G</italic> can be constructed from <italic>H</italic> such that it is undirected and contains cycles, both properties lead to nonsensical haplotypes. Under such circumstances, <bold>Gretel</bold> could construct a path that visits multiple nodes that appear at the same <italic>i</italic>, or a trail that visits the same node multiple times. Such sequences would be meaningless in the context of haplotype construction, thus the interface to <bold>Hansel</bold> acts in such a way that <italic>G</italic> is a directed, acyclic graph.</p>
<p>We can define a haplotype as an alternating sequence of nodes (<italic>v</italic> &#x2208; <italic>V</italic>) and edges (<italic>e</italic> &#x2208; <italic>E</italic>). A path must always start and end at the special sentinel symbols &#x2205;<sub><italic>S</italic></sub> and &#x2205;<sub><italic>E</italic></sub>, respectively.
<disp-formula id="eqnS3"><alternatives><graphic xlink:href="117838_eqnS3.gif"/></alternatives></disp-formula></p>
<p>Although, as only one directed edge between some <italic>v<sub>i</sub></italic> and <italic>v<sub>i</sub></italic><sub>&#x002B;1</sub> may exist, we can define <italic>&#x0125;</italic> as a sequence of <italic>v</italic> &#x2208; <italic>V</italic>:
<disp-formula id="eqnS4"><alternatives><graphic xlink:href="117838_eqnS4.gif"/></alternatives></disp-formula></p>
</sec>
<sec id="s6c">
<label>3</label>
<title>Probabilistic edge weights</title>
<p>However, if the construction of <italic>G</italic> does not consider elements in <italic>H</italic>[<italic>A</italic>, <italic>B</italic>, <italic>i,j</italic>] where <italic>abs</italic>(<italic>i &#x2212; j</italic>) &#x003E; 1 (non-adjacent SNPs) it is likely one will recover haplotypes that do not actually exist.</p>
<p>Given the pairwise information available in <italic>H</italic>, for both adjacent, and non-adjacent SNPs, across all reads, edges in the graph <italic>G</italic> derived from <italic>H</italic> can be weighted probabilistically. We attempt to determine the next most likely symbol in a sequence, considering both the marginal distribution of symbols at the next position and the likelihood of those symbols appearing next, given an already observed partial sequence. That is, the next symbol <italic>v<sub>i</sub></italic><sub>&#x002B;1</sub> in a path depends not only on the current symbol (<italic>v<sub>i</sub></italic>) but some number of previous symbols (<italic>v<sub>i</sub></italic><sub>&#x2212;1</sub>, <italic>v<sub>i</sub></italic><sub>&#x2212;2</sub>&#x2026;<italic>v</italic><sub>0</sub>).</p>
<p>The outgoing edges from <italic>v<sub>i</sub></italic> are probabilistically weighted by exploiting the observations stored in the <bold>Hansel</bold> structure to create probabilities. These probabilities then determine the likelihood of moving from some <italic>vi</italic> to each of the possible <italic>v<sub>i</sub></italic><sub>&#x002B;1</sub>.</p>
<p>We take a Bayesian approach to the problem of probabilistically weighting edges in <bold>Hansel</bold>&#x2019;s graph representation. We define the probability of selecting <italic>v<sub>i</sub></italic><sub>&#x002B;1</sub>, conditioned on the path observed so far:
<disp-formula id="eqnS5"><alternatives><graphic xlink:href="117838_eqnS5.gif"/></alternatives></disp-formula></p>
</sec>
<sec id="s6d">
<label>4</label>
<title>Simplification of conditional edge weights</title>
<p>Clearly, the number of factors in <xref ref-type="disp-formula" rid="eqnS5">Equation S5</xref> increases with <italic>i</italic>. For longer paths (more single nucleotide polymorphisms detected along the target region of interest), evaluating the equation becomes more computationally expensive, and risks potentially compounding estimation errors.</p>
<p>To construct a whole path <italic>p</italic> from <italic>v</italic><sub>1</sub> &#x2026;<italic>v</italic><sub>n</sub>, the upper bound for the number of iterations will be &#x007C;&#x03A3;&#x007C; &#x00D7; <italic>n</italic> with calculations becoming increasingly complex as <italic>i</italic> increases.</p>
<p>To reduce complexity, we make an assumption of conditional independence between variants. Whilst this seems counter intuitive, the Naive Bayes model can deliver robust results despite its coarse assumption.</p>
<p>Thus we may simplify our previous equation and consider only the pairwise appearances of each <italic>v<sub>i</sub></italic> encountered thus far against <italic>v<sub>i</sub></italic><sub>&#x002B;1</sub>.
<disp-formula id="eqnS6"><alternatives><graphic xlink:href="117838_eqnS6.gif"/></alternatives></disp-formula></p>
<p>However as discussed in our article, individual reads will not cover all SNP positions 1..<italic>n</italic> (if they did, we would not have to define this problem). Thus, we need not consider all variants in the current path when evaluating edge weights. Instead, we could limit the number of variants to consider, from the current position in the path <italic>i</italic>, back some small and sensible number of steps <italic>L</italic>:
<disp-formula id="eqnS7"><alternatives><graphic xlink:href="117838_eqnS7.gif"/></alternatives></disp-formula></p>
<p>Additionally, to overcome inaccuracies encountered through floating point error when performing mathematical operations on very small decimals, <bold>Gretel</bold> uses log probabilities instead. Via the log identity <italic>log</italic>(<italic>ab<underline>)</underline></italic> &#x003D; <italic>log</italic>(<italic>a</italic>) &#x002B; <italic>log</italic>(<italic>b</italic>) the product of the conditional probabilities becomes a sum of the log conditional probabilities:
<disp-formula id="eqnS8"><alternatives><graphic xlink:href="117838_eqnS8.gif"/></alternatives></disp-formula></p>
<p>We define <italic>L</italic> as the the &#x2018;lookback&#x2019; size, the number of variants of the current path to consider when selecting <italic>v<sub>i</sub></italic><sub>&#x002B;1</sub>. Conveniently, there is a reasonable intuition available for selecting a value for <italic>L</italic>: the mean number of SNP sites covered by the observed reads. Thus we avoid the scenario of introducing an algorithmically influential but difficult to optimize parameter, such as <italic>k</italic>-mer size for metagenomic assembly.</p>
</sec>
<sec id="s6e">
<label>5</label>
<title>Estimation of probabilities</title>
<p><xref ref-type="disp-formula" rid="eqnS9">Equation S9</xref> provides an estimate for the marginal distribution of a symbol <italic>&#x03B2;</italic> appearing at position <italic>j.</italic>
<disp-formula id="eqnS9"><alternatives><graphic xlink:href="117838_eqnS9.gif"/></alternatives></disp-formula></p>
<p><xref ref-type="disp-formula" rid="eqnS8">Equation S8</xref> provides an estimate for the conditional distribution of symbol <italic>&#x03B1;</italic> appearing at position <italic>i</italic> given that <italic>&#x03B2;</italic> was observed at position <italic>j</italic>.
<disp-formula id="eqnS10"><alternatives><graphic xlink:href="117838_eqnS10.gif"/></alternatives></disp-formula></p>
</sec>
<sec id="s6f">
<label>6</label>
<title>Smoothing</title>
<p>To avoid the potential of dividing by 0 when using <xref ref-type="disp-formula" rid="eqnS10">Equation S10</xref> in cases where a suitable read spanning <italic>i</italic> and <italic>v</italic><sub>j</sub> &#x003D; <italic>&#x03B2;</italic> does not exist, we apply Laplace smoothing to effectively add a dummy support read. Future work will investigate alternative smoothing methodology.
<disp-formula id="eqnS11"><alternatives><graphic xlink:href="117838_eqnS11.gif"/></alternatives></disp-formula></p>
</sec>
<sec id="s6g">
<label>7</label>
<title>Reweighting</title>
<p>The paths generated by <bold>Gretel</bold> are probabilistic, but not stochastic. For a given <italic>H</italic>, <bold>Gretel</bold> will always return the same path. After a path has been constructed we can perform some transformation of <italic>H</italic> to prevent repetitive generation of the same path and return the next most likely path on the next iteration instead.</p>
<p>Given a path <italic>&#x0125;</italic>, we inspect the marginal distribution of each element of the path in order to find the smallest marginal. <bold>Gretel</bold> iterates over each element <italic>&#x0125;</italic>[<italic>i</italic>] in the path, and uses the <bold>Hansel</bold> interface to reweight the element <italic>H</italic>[<italic>&#x0125;</italic>[<italic>i</italic>],<italic>&#x0125;</italic>[<italic>i</italic> &#x002B; 1],<italic>i</italic>,<italic>i</italic> &#x002B; 1] by subtracting the result of multiplying the smallest marginal by the original value for that observation in <italic>H</italic>:</p>
<disp-formula id="eqnS12"><alternatives><graphic xlink:href="117838_eqnS12.gif"/></alternatives></disp-formula>
<disp-formula id="eqnS13"><alternatives><graphic xlink:href="117838_eqnS13.gif"/></alternatives></disp-formula>
<p>In practice <italic>&#x03BB;</italic> is capped by <bold>Gretel</bold> in an attempt to stop aggressive reweighting that might otherwise prevent the recovery of closely related haplotypes.</p>
</sec>
<sec id="s6h">
<label>8</label>
<title>Stopping criterion</title>
<p>After multiple iterations of path finding and subsequent reweighting, elements in <italic>H</italic> will begin to approach 0, causing edges in the graph to become unavailable for traversal. <bold>Gretel</bold> will immediately terminate upon encountering a node in the graph with no viable outgoing edges. That is, the selected symbol at the current i has no non-zero weighted edges to traverse between SNP positions (<italic>i</italic>, <italic>i</italic> &#x002B; 1) in the graph. Alternatively, if this criterion is not reached after 100 iterations (haplotypes), <bold>Gretel</bold> aborts.</p>
</sec>
<sec id="s6i">
<label>9</label>
<title>Haplotype scoring</title>
<p><bold>Gretel</bold> can score and rank the haplotypes it recovers. For a completed haplotype, <italic>&#x0125;</italic>, we compute its likelihood based upon the sum of the marginal log probabilities for each element of <italic>&#x0125;</italic> given the current state of <italic>H</italic>.</p>
<disp-formula id="eqnS16"><alternatives><graphic xlink:href="117838_eqnS14.gif"/></alternatives></disp-formula>
<p>To overcome the potential for floating point arithmetic error (<xref ref-type="disp-formula" rid="eqnS8">Equation S8</xref>), we calculate and report the log likelihood.</p>
<disp-formula id="eqnS15"><alternatives><graphic xlink:href="117838_eqnS15.gif"/></alternatives></disp-formula>
</sec>
<sec id="s6j">
<label>10</label>
<title>Metahaplomes from real genes (DHFR): Additional plots</title>
<fig id="figS1" position="float" orientation="portrait" fig-type="figure">
<label>Figure 1:</label>
<caption><p>Proportion of the 196 SNPs across the five <italic>DHFR</italic> haplotypes that were correctly discovered by our snpper tool (y-axes) during variant calling of each of the synthetic read sets. Read sets are split by per-haplotype read depth (x-axis) and read length (row facets), each box-with-whiskers summarises 100 read sets. Uncalled SNPs prevent full recovery of one or more of the input haplotypes.</p>
</caption>
<graphic xlink:href="117838_figS1.tif"/>
</fig>
<fig id="figS2" position="float" orientation="portrait" fig-type="figure">
<label>Figure 2:</label>
<caption><p>Proportion of synthetic reads from read sets dropped (y-axes) by the chosen aligner bowtie2 (see Listing 1 for parameters used), for each input <italic>DHFR</italic> gene (column facets). Read sets are split by per-haplotype read depth (x-axis) and read length (row facets), each box-with-whiskers summarises the proportion of a particular gene&#x2019;s synthetic reads dropped, across 100 read sets. Dropped reads can impact the calling of SNPs and reduces the available evidence for the recovery of those haplotypes.</p></caption>
<graphic xlink:href="117838_figS2.tif"/>
</fig>
</sec>
<sec id="s6k">
<label>11</label>
<title>Metahaplomes with many haplotypes: Influenza A Segment 7</title>
<p>In order to test our methods on a data set with many haplotypes and many variants we obtained 446 Influenza A Segment 7 sequences from GenBank, requesting any sequences deposited during December 2016. After removing duplicates, and sequences with 99.0% or greater identity to any other candidates, 60 remained.</p>
<p>These 60 remaining sequences had varying lengths. 25 of the 60 sequences were of one particular length: 982 bp. This provided a suitable selection criteria with which to construct our metahaplome (<xref ref-type="table" rid="tbl1">Table 1</xref>). From the 25, <italic>KP404423.1</italic> was selected at random to act as the pseudo-reference for alignment. The pool of 24 remaining sequences act as haplotypes from which we generated synthetic reads via the same method used for our simulations and DHFR metahaplomes. Variants were called in the same way as our previous experiments, determining any site without a unanimous consensus as a variant.</p>
<table-wrap id="tblS1" orientation="portrait" position="float">
<label>Table 1:</label>
<caption><p>Accession numbers for the 25 Influenza A Segment 7 sequences used in our analysis. The randomly selected pseudo-reference is marked with an asterisk.</p>
</caption>
<graphic xlink:href="117838_tblS1.tif"/>
</table-wrap>
<p>We followed the same experimental design as per the <italic>DHFR</italic> data sets, yielding 1,200 sets of reads (2 read sizes, 6 per-haplotype coverage levels, 100 replicates), each containing synthetic reads from the 24 haplotypes. A multiple sequence alignment of the 24 haplotypes determined the number of true SNPs to be 277. The mean number of called SNPs across all read sets was 276.02.</p>
<p><bold>Gretel</bold> was used on each read set, returning 1,200 sets of recovered haplotypes. Each set of output haplotypes is compared pairwise against the input 24 haplotypes, calculating the Hamming distance at sites determined to be heterogeneous via a multiple sequence alignment. We report the proportion of correctly recovered heterogeneous sites, as a percentage.</p>
<p>Figure 3 aggregates the proportions of SNPs that were correctly recovered by <bold>Gretel</bold> over the 24 haplotypes under varying conditions of read size and depth. At this level of variation we produce high accuracy recoveries with reads of 50 bp. Read sets with at least 7x per-haplotype depth and 150 bp length make recoveries across the 24 haplotypes with an average accuracy of 92%. Notably, increasing read length and coverage does little to improve recovery accuracy, even at 250 bp (not shown). There appears to be an upper-limit on <bold>Gretel</bold>&#x2019;s performance on this particular data set. As discussed in our <italic>DHFR</italic> Results, this could be due to dropped reads obscuring the existence of SNPs, and denying evidence of the variation that exists on that haplotype. Additionally, the shared variation in such a closely related set of sequences can cause paths in the true metahaplome to converge. Our data suggests that even in a metahaplome with 24 haplotypes, it is possible to make accurate recoveries (&#x003E;90%) with reads of 50 bp.</p>
<fig id="figS3" position="float" orientation="portrait" fig-type="figure">
<label>Figure 3:</label>
<caption>
<p>Boxplots aggregating the proportion of variants correctly recovered (y-axes) for the 24 input Influenza A Segment 7 sequences by <bold>Gretel</bold>. We generated reads from the <italic>Flu-A7</italic> metahaplome at 6 different per-haplotype read depths (x-axes) between 3 and 50x, 2 read lengths (50 bp and 150 bp row facets) with 100 replicates. Individual box-with-whiskers describe the recovery rates across the 24 haplotypes, from reads of a per-haplotype depth and size, over the 100 replicates. There appears to be an upper limit on the recoveries that are possible from this data set.</p>
</caption>
<graphic xlink:href="117838_figS3.tif"/>
</fig>
</sec>
</sec>
</back>
</article>