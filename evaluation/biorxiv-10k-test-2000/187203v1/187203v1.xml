<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">BIORXIV</journal-id>
<journal-title-group>
<journal-title>bioRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/187203</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="author-type">
<subject>Regular Article</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>New Results</subject>
</subj-group>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Bioinformatics</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>SHAMAN: bin-free randomization, normalization and screening of Hi-C matrices</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Mendelson Cohen</surname>
<given-names>Netta</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Olivares-Chauvet</surname>
<given-names>Pedro</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Lubling</surname>
<given-names>Yaniv</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Baran</surname>
<given-names>Yael</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Lifshitz</surname>
<given-names>Aviezer</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Hoichman</surname>
<given-names>Michael</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<name>
<surname>Tanay</surname>
<given-names>Amos</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="corresp" rid="cor1">&#x002A;</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Department of Computer Science and Applied Mathematics Weizmann Institute of Science</institution>, Rehovot 76100 <country>Israel</country></aff>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>&#x002A;</label>Correspondence: <email>amos.tanay@weizmann.ac.il</email></corresp>
</author-notes>
<pub-date pub-type="epub">
<year>2017</year>
</pub-date>
<elocation-id>187203</elocation-id>
<history>
<date date-type="received">
<day>12</day>
<month>9</month>
<year>2017</year>
</date>
<date date-type="rev-recd">
<day>12</day>
<month>9</month>
<year>2017</year>
</date>
<date date-type="accepted">
<day>12</day>
<month>9</month>
<year>2017</year>
</date>
</history>
<permissions>
<copyright-statement>&#x00A9; 2017, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2017</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="187203.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract>
<title>ABSTRACT</title>
<p>Genome wide chromosome conformation capture (Hi-C) is used to interrogate contact frequencies among genomic elements at multiple scales and intensities, ranging from high frequency interactions among proximal regulatory elements, through specific long-range loops between insulator binding sites and up to rare and transient cis&#x2010; and trans-chromosomal contacts. Visualization and statistical analysis of Hi-C data is made difficult by the extreme variation in the background frequencies of chromosomal contacts between elements at short and long genomic distances. Here we introduce SHAMAN for performing Hi-C analysis at dynamic scales, without predefined resolution, and while minimizing biases over very large datasets. Algorithmically, we devise a Markov Chain Monte Carlo-like procedure for randomizing contact matrices such that coverage and contact distance distributions are preserved. We combine this strategy with bin-free assessment of contact enrichment using a K-nearest neighbor approach. We show how to use the new method for visualizing contact hotspots and for quantifying differential contacts in matching Hi-C maps. We demonstrate how contact preferences among regulatory elements, including promoters, enhancers and insulators can be assessed with minimal bias by comparing pooled empirical and randomized matrices. Full support for our methods is available in a new software package that is freely available.</p>
</abstract>
<counts>
<page-count count="26"/>
</counts>
</article-meta>
</front>
<body>
<sec id="s1">
<title>INTRODUCTION</title>
<p>In order for chromosomal conformations to be robustly studied using the Hi-C<sup><xref rid="c1" ref-type="bibr">1</xref>,<xref rid="c2" ref-type="bibr">2</xref></sup> technology, a large pool of nuclei is fixed, digested and chromosomal proximity events are recovered through massive sequencing of ligated restriction fragment ends. The data is then summarized as a contact matrix, in which the number of recovered ligations between every pair of restriction fragments is recorded. Since the total number of potential restriction fragment pairs in the genome is very large (at the order of hundreds of trillions), and since most restriction fragments contact with extremely low frequencies, any Hi-C matrix, including those sequenced at the maximal depth reported so far (billions of reads)<sup><xref rid="c34" ref-type="bibr">34</xref>,<xref rid="c5" ref-type="bibr">5</xref></sup>, is very sparse. Subsequent Hi-C analysis is thereby statistical, pooling together contacts across ranges of restriction fragments, or <italic>bins</italic>, to ensure data is transformed into statistically robust features (e.g., contacts between bins). Following binning, additional statistical modeling is usually performed to distinguish specific contacts of pairs of loci or regions from the background distribution of contacts over chromosomes, or to support informative visualization of the data.</p>
<p>Modeling chromosomal contact background distribution<sup><xref rid="c6" ref-type="bibr">6</xref></sup> can be approached parametrically, by assigning bias-parameters to fragment-ends and modeling the contact probability given such parameters<sup><xref rid="c7" ref-type="bibr">7</xref>,<xref rid="c8" ref-type="bibr">8</xref>,<xref rid="c9" ref-type="bibr">9</xref>,<xref rid="c10" ref-type="bibr">10</xref></sup>. Alternatively, a non-parametric approach considering the marginal coverage for genomic bins can be applied to normalize systematic biases that are linked with one-dimensional sequence&#x2010; or epigenetic&#x2010; preferences<sup><xref rid="c11" ref-type="bibr">11</xref>,<xref rid="c12" ref-type="bibr">12</xref></sup>. Modeling chromosomal domain structure and identifying insulation hotspots can be approached based on such normalized binned matrices<sup><xref rid="c3" ref-type="bibr">3</xref>,<xref rid="c5" ref-type="bibr">5</xref></sup> or performed by comparison of empirical contact distributions to a parametric model<sup><xref rid="c4" ref-type="bibr">4</xref></sup>. Searching for contact hotspots can similarly be performed by comparing the expected number of contacts given a parametric model<sup><xref rid="c4" ref-type="bibr">4</xref>,<xref rid="c13" ref-type="bibr">13</xref>,<xref rid="c14" ref-type="bibr">14</xref></sup>, by adapting techniques for peak finding<sup><xref rid="c3" ref-type="bibr">3</xref>,<xref rid="c15" ref-type="bibr">15</xref>,<xref rid="c16" ref-type="bibr">16</xref></sup> on appropriately binned matrices, or by pooling contacts over specific pairs of epigenomic features<sup><xref rid="c17" ref-type="bibr">17</xref>,<xref rid="c13" ref-type="bibr">13</xref></sup>. Current methodologies for computational analysis of Hi-C matrices have allowed identification of key chromosomal features, including topological domains and CTCF/cohesin loops, and are becoming more sensitive as Hi-C matrices become richer in contacts, and there is a large number of software packages and algorithms<sup><xref rid="c18" ref-type="bibr">18</xref>,<xref rid="c19" ref-type="bibr">19</xref>,<xref rid="c20" ref-type="bibr">20</xref></sup>, most of which are not mentioned here for lack for space, suggesting different computational strategies for detecting these features in large matrices.</p>
<p>Despite much progress in the computational processing of Hi-C maps, their universal modeling remains challenging, in particular when searching for differential contacts between maps or when combining analysis of short range and long-range contacts. For example, the parametric models that were proposed require strong assumptions on the factors affecting contact distributions, and can be computationally demanding, while the a-parametric approaches that are based on binning, limit the resolution of the assay, and require careful additional normalization or stratification of chromosomal distance effects and other factors. In particular, a universal approach for comparing empirical features of Hi-C contact maps to those expected given simple assumptions is lacking.</p>
<p>In this paper we develop an approach for shuffling Hi-C contacts to generate randomized matrices that conserve the empirical number of contacts per restriction fragment and the empirical distribution of genomic distances over contacts. We then introduce techniques for analyzing Hi-C matrices by comparing observed and randomized data, based on an easy to use K-nearest neighbor approach for assessing differential contact densities. Our randomization algorithm and analysis suite is available through a new R package (called <italic>shaman</italic>), and we demonstrate its use by reanalyzing Hi-C data on mouse embryonic stem cells and human cancer cell lines, deriving high resolution models for contact insulation, loops, and longer range contacts.</p>
</sec>
<sec id="s2">
<title>Results</title>
<sec id="s2a">
<title>Shuffling Hi-C matrices while preserving contact marginal and distance distributions</title>
<p>The contact probability between pairs of restriction elements in Hi-C matrices is strongly correlated with the inverse genomic distance between them. When analyzing this trend globally (<bold><xref ref-type="fig" rid="fig1">Fig 1a</xref></bold>), ranges of genomic distances that grow exponentially (1-2kb, 2-4kb, 4-8kb,&#x2026;, 64-128MB, 128-256MB) are populated by a comparable number of Hi-C contacts on average despite varying in size by five orders of magnitude. More precisely, logarithmic distance bins show a fivefold relative enrichment over this trend for the distance range between 100kb and 1MB, an effect strongly coupled to the topological domain structure of chromosomes<sup><xref rid="c4" ref-type="bibr">4</xref>,<xref rid="c5" ref-type="bibr">5</xref>,<xref rid="c21" ref-type="bibr">21</xref>,<xref rid="c22" ref-type="bibr">22</xref></sup>. The genomic distance effect on Hi-C contact probability, and its variation in specific distance ranges, is likely to reflect the true physical dynamics of the chromosome fiber, but it poses a difficult analytic challenge since the contact frequencies represented within Hi-C matrices can vary over a factor of 10,000 and more. A second major factor affecting the distribution of contacts in a Hi-C matrix is the overall efficiency of the complete protocol (fixation, digestion, ligation, retrieval, sequencing and mapping) for each restriction fragment, which can be estimated by the total number of contacts per fragment, denoted here as the <italic>marginal coverage</italic> (<bold><xref ref-type="fig" rid="fig1">Fig 1b-c</xref></bold>). This compound effect can span a range of over 100 fold, which can be correlated with the fragment sequence composition, chromosomal accessibility, digestion efficiency, overall fragment length, and sequencing mapability<sup><xref rid="c7" ref-type="bibr">7</xref></sup>. Differences in marginal coverage can increase the number of contacts between favored fragments in a way that is indirectly correlated with various epigenetic factors, thus introducing complex technical biases in the data.</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1:</label>
<caption><title>Bin-free multiscale HiC D normalization.</title>
<p><bold>a) Decay curve</bold> &#x2010; probability of contact as a function of log linear genomic distance, shown for Rao et al human GM12878 and K562 and Olivares et al mouse ES Hi-C. <bold>b)</bold> Distribution of marginal coverage, number of contacts per fragment, for Rao et al K562 Hi-C. <bold>c)</bold> Similar to b, stratified by fragment length (left) and by fragment G/C content (right). <bold>d)</bold> MCMC-like randomization algorithm scheme. Refer to methods for detailed description. In short, a pair of near-by contacts are randomly proposed for coordinate interchanging based on the probabilities of the distances between the contact end points <bold>e)</bold> D score computation. For each observed contact, a score is computed by comparing the K-nearest neighbor distances in the observed and shuffled matrices using Kolmogorov Smirnov D statistic. Refer to methods for detailed description. <bold>f)</bold> D score significance. Kolmogorov Smirnov (KS) D statistic color coded by value for KS test with observed K=100 and shuffled K=200 values (top). FDR for positive scores (D&#x003E;0) (middle) and negative scores (D&#x003C;0) (bottom) as computed by fdr test (Methods). <bold>g)</bold> Distribution of log distance to 100<sup>th</sup> nearest neighbor stratified by log linear distance computed for K562 Hi-C data. <bold>h)</bold> Shown are observed (left), randomized (middle) and color coded D score normalized maps for the K562 HOXD region. <bold>i)</bold> Replicate sampling of contacts in the K562 HOXD locus, generating a randomized matrix and computing the D normalized score. <bold>j)</bold> Replicate randomization of contacts in the K562 HOXD locus, followed by D score computation.</p></caption>
<graphic xlink:href="187203_fig1.tif"/>
</fig>
<p>Randomizing a Hi-C matrix, so as to preserve both genomic distance and marginal contact distributions cannot be achieved by na&#x00EF;ve shuffling of contact pairs (which can preserve marginal contacts density but not the genomic distance distribution), or by sampling from a parametric model assuming the empirical contact distance distribution (which will not be consistent with the marginal coverage). We therefore developed a Markov Chain Monte Carlo (or Metropolis-Hastings-like) randomization algorithm, by repeatedly sampling pairs of contacts and shuffling them by swapping the fragment end points, with a ratio proportional to their contact distance probabilities, correcting for the asymmetric distribution of sampled and shuffled distances using an adaptive procedure (<bold><xref ref-type="fig" rid="fig1">Fig 1d</xref></bold>, Methods) (<bold><xref ref-type="fig" rid="figS1">Fig S1a</xref></bold>). The resulting shuffled matrix, after symmetrizing all contacts, maintains twice the precise marginal coverage for each restriction fragment, as well as nearly exactly the same distribution of contact distances observed in the empirical contact map (<bold><xref ref-type="fig" rid="figS1">Fig S1b</xref></bold>). We used sampling of pairs with restricted total genomic distance (methods) to improve overall sampler efficiency (<bold><xref ref-type="fig" rid="figS1">Fig S1c</xref></bold>). Parallelizing shuffling over chromosomes allows complete randomization of a Hi-C experiment with 1 billion reads within 7 hours on a standard machine with a core for each shuffled chromosome. Importantly, such randomization is performed once per dataset as an analysis pre-process following sequence mapping and contact calling. Applying our algorithm to dense Hi-C matrices generated for K562 and GM12787 human cancer cell lines<sup><xref rid="c3" ref-type="bibr">3</xref></sup>, and to a Hi-C matrix generated from mouse ES nuclei<sup><xref rid="c23" ref-type="bibr">23</xref></sup>, confirmed that randomized matrices closely follow the empirical contact distance distributions (<bold><xref ref-type="fig" rid="figS1">Fig S1b</xref></bold>)</p>
</sec>
<sec id="s2b">
<title>Using D score for bin-free comparison of observed and randomized contact densities</title>
<p>To assess relative enrichment of contacts around a point of interest in the Hi-C matrix, we define a Euclidean proximity metric between contacts (<bold><xref ref-type="fig" rid="fig1">Fig 1e</xref></bold>) and compute for each observed contact, the cumulative distributions of proximities over the K contact pairs closest to the point of interest in the empirical and randomized matrix. This can be performed efficiently even for very large matrices, using standard algorithms for identifying the K nearest neighbors in a metric space. We defined the <italic>D</italic> score of each observed contact in the HI-C matrix as the Kolmogorov-Smirnov (KS) D statistic obtained by comparing the empirical and randomized distributions of distances.</p>
<p>We note that the background distribution of the D scores depends on the selection of K, where larger K implies more statistical power but lower resolution. We determine statistical significance of D values using reshuffling and computing of False Discovery Rate (FDR) values (<bold><xref ref-type="fig" rid="fig1">Fig 1f</xref></bold>).</p>
<p>This algorithmic approach supports analysis at very high resolution for short-range contacts with high density where the K nearest neighbors are observed within a very short range of the contact of interest (<bold><xref ref-type="fig" rid="fig1">Fig 1g</xref></bold>, <bold>S1d</bold>). The same strategy uses much lower effective resolution for very long-range contacts with low density, and we are guaranteed natural scaling of the resolution as sequencing coverage increases. To visualize contact densities we simply color code points on the Hi-C matrix according to their D scores (<bold><xref ref-type="fig" rid="fig1">Fig 1h</xref></bold>), with a color scale that is selected according to FDR scores to ensure reproducibility and robustness (<bold><xref ref-type="fig" rid="fig1">Fig 1i-j</xref></bold>). In summary, the combination of matrix randomization and bin-free analysis of contact density allows flexible visualization and statistical analysis of complex Hi-C matrices, which naturally scales with the chromosomal distance of assayed contacts.</p>
</sec>
<sec id="s2c">
<title>Comparing Hi-C matrices</title>
<p>One of the main challenges of analyzing Hi-C data is comparing contact maps acquired in different conditions or from distinct cell types, and distinguishing between the technical differences affecting captured contacts distributions and true differential contact enrichment with possible regulatory impact. Using the randomization approach described above, we implemented two strategies for comparing contact matrices. First, we can use the D scoring scheme for comparison of two empirical matrices instead of relying on it for correcting one empirical matrix with a randomized one. When using this approach, difference in marginal coverage between the maps, or differences in the overall contact distance distribution will affect, and may even dominate the differential signal. Second, we can correct each dataset independently for effects associated with marginal coverage and contact distance distribution and compare the resulted D scores following normalization. This is exemplified by analysis of contact distributions around the beta globin locus in erythroid K562 cell line and lymphoblastic cell line GM12878. As expected, the active conformation of this site in K562 (<bold><xref ref-type="fig" rid="fig2">Fig 2a</xref></bold>) is markedly different from the repressed GM12878 conformation (<bold><xref ref-type="fig" rid="fig2">Fig 2b</xref></bold>), with marked increase in the contact intensity on several loops closing up the globin genes and the locus control region. The direct comparative analysis (<bold><xref ref-type="fig" rid="fig2">Fig 2c</xref></bold>) highlights the gain of globin-associated loops (H1-H3) and a specific loop closing up the downstream domain (H4). The normalized comparison <bold>(<xref ref-type="fig" rid="fig2">Fig 2d</xref>)</bold> suggests that increased looping intensity in H2-H3 is less specific, while H1 and H4 remains highly specific even after correcting each map separately to contact distance and marginal distribution.</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2:</label>
<caption><title>Comparing Hi-C matrices.</title>
<p><bold>a)</bold> Normalized D map of the K562 active beta-globin locus, annotated with genes, K562 H3K27ac and H3K4me1 profiles, as well as ES CTCF. <bold>b)</bold> Similar to a for GM12878. <bold>c)</bold> Similar to a, for D score map generate by comparing K562 observed Hi-C with GM12878 observed Hi-C. <bold>d)</bold> Similar to c, comparing K562 and GM12878 maps by subtracting normalized scores computed for each dataset separately (by comparing to its randomized matrix) at union of all points from both datasets.</p></caption>
<graphic xlink:href="187203_fig2.tif"/>
</fig>
<p>Additional differential looping below the H4 loop is observed in the normalized comparison, suggesting direct comparison may mask short-range differential contact due to global changes in contact distribution (See <bold><xref ref-type="fig" rid="figS2">Fig S2</xref></bold> for similar analysis erythroid/megakaryocytic and lymphoid regulated loci). In summary, comparison between Hi-C maps is simplified through the D scores, but its implementation and interpretation, with or without normalization of the compared matrices, should be adapted to the analytic question at hand.</p>
</sec>
<sec id="s2d">
<title>Analysis of contact distributions around epigenetic landmarks</title>
<p>Pooling together Hi-C sub-matrices around pairs of epigenetic hotspots was used before to characterize the potential for preferential long-range chromosomal interaction in specific contexts, such as CTCF/cohesion sites<sup><xref rid="c3" ref-type="bibr">3</xref>,<xref rid="c24" ref-type="bibr">24</xref></sup>, transcription factor binding sites<sup><xref rid="c17" ref-type="bibr">17</xref>,<xref rid="c25" ref-type="bibr">25</xref>,<xref rid="c26" ref-type="bibr">26</xref></sup> and polycomb repressive domains<sup><xref rid="c27" ref-type="bibr">27</xref>&#x2013;<xref rid="c29" ref-type="bibr">29</xref></sup>. A challenge in this approach is to ensure proper normalization, since systematic biases for variable marginal coverage on epigenetic hotspots, or overall differences in chromosomal distance distributions between classes of such hotspots, may skew the pooled matrices considerably. This for example, frequently results in the appearance of enriched horizontal and central bands (a cross-like pattern), which represent a combination of marginal coverage on the examined hotspots, rather than specific enrichment in the pairing probability. Using randomized Hi-C matrices as statistical background allows for straightforward control over marginal and genomic-distance effects (<bold><xref ref-type="fig" rid="fig3">Fig 3a</xref></bold>, Methods). Ratio of pooled observed and randomized contacts around potentially contacting CTCF binding sites confirm the previously reported enrichment of contacts around CTCF sites with converging motifs (<bold><xref ref-type="fig" rid="fig3">Fig 3b</xref></bold>). Importantly, CTCF sites contact enrichment is observed nearly symmetrically around the focal contact point (<bold><xref ref-type="fig" rid="fig3">Fig 3c</xref></bold>), with significant enrichment observed at least 5kb from the motifs on either side (see spatial pattern for pairs filtered on significant contact enrichment in <bold><xref ref-type="fig" rid="figS3">Fig S3a</xref></bold>). The intensity of CTCF contact enrichment strongly depends on the genomic distance (<bold><xref ref-type="fig" rid="fig3">Fig 3d</xref></bold>), where 2-fold enrichment over the background is observed on average for sites at 100kb distance, but no enrichment (or in fact, mild negative enrichment) is observed for sites within 1MB distance, possibly due to closer competing CTCF pairings. Analysis of divergent sites (reverse-to-forward) shows nonspecific enrichment of contacts in the lower-right quadrant (representing contacts of genomic elements between the two divergent sites) suggesting that the occurrence of forward-to-reverse pairs between these sites combine together to generate indirect and non-specific contact enrichment pattern (<bold><xref ref-type="fig" rid="figS3">Fig S3b</xref></bold>). Pairs of CTCF sites with matching orientation (forward-to-forward, reverse-to-reverse, <bold><xref ref-type="fig" rid="fig3">Fig 3e</xref></bold>) are associated with contact enrichment on a band, which is likely to represent pairing of a hidden site, reverse oriented for a forward pair (left), forward oriented for a reverse pair (right), which give rise to a non-specific enrichment downstream from the first forward site or upstream from the second reverse site (right) (<bold><xref ref-type="fig" rid="figS3">Fig S3b</xref></bold>). This analysis demonstrates how indirect effects (due to convergent CTCF sites or other factors located near the analyzed loci) can give rise to seemingly significant contact enrichment. The specificity of factor interaction must therefore be supported by a localized, centered enrichment in spatial analysis, as observed for convergent CTCF sites here.</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3:</label>
<caption><title>Contact distributions around epigenetic landmarks.</title>
<p><bold>a)</bold> Schematic overview for pooling of contacts around epigenetic hotspots and comparing observed to randomized distributions. <bold>b)</bold> Spatial enrichment &#x2010; shown are log2(obs/shuffled) number of contacts 25kb around CTCF convergent (top left), CTCF divergent (top right), CTCF forward/forward (bottom left) and CTCF reverse/reverse (bottom right) that are distanced between 200K and 2MB from each other and that contain a D score&#x003E;30 anywhere within the 50K window at 1kb resolution (Methods). <bold>c)</bold> CTCF convergent enrichment profile (log2(obs/shuffled)), by offset from hotspot. <bold>d)</bold> Contact enrichment at CTCF pooled pairs stratified by log linear distance. <bold>e)</bold> Similar to b for TSS. <bold>f)</bold> Similar to b for contact enrichment between active TSS<bold>. g)</bold> Similar to b for active TSS and H3K27ac (left), passive TSS and H3K27ac (middle), and H3K27ac and H3K27ac (right). <bold>h)</bold> Similar to b for active TSS and Gata1 (left) and Gata2 (right).</p></caption>
<graphic xlink:href="187203_fig3.tif"/>
</fig>
<p>In addition to CTCF sites, it has been proposed that the three-dimensional folding of chromosomes can bring distant regulatory elements such as promoters and enhancers into close spatial proximity. Applying the statistical method described above to contacts above 200kb and within less than 2Mb associating a TSS with another genomic element (excluding CTCF sites, Methods), we observe a modest (1.41 fold) but significant (chi-square, p&#x003C;&#x003C;0.001) localized enrichment in contacts between active pairs of TSS (<bold><xref ref-type="fig" rid="fig3">Fig 3f-g</xref></bold>), or between active TSSs and putative H3K27ac marked enhancers (<bold><xref ref-type="fig" rid="fig3">Fig 3h</xref></bold>) and Gata1,2 binding sites (<bold><xref ref-type="fig" rid="fig3">Fig 3i</xref></bold>). Non-specific enrichment downstream active TSSs (i.e. transcribed gene bodies) vs. passive TSSs may represent a general tendency of such region to contact at longer range (<bold><xref ref-type="fig" rid="fig3">Fig 3f</xref></bold>, middle panels). Pairing of H3K27me3 or H3K9me3 hotspots in K562 or GM12878 were not associated with significant local enrichment (<bold><xref ref-type="fig" rid="figS3">Fig S3c</xref></bold>). In conclusion, spatial analysis of pooled putative interaction is a powerful and sensitive tool for distinguishing truly synergistic and specific pairing from various background effects, and can be used to critically assess hypothesis on short&#x2010; and long-range regulatory contacts and hubs.</p>
</sec>
<sec id="s2e">
<title>Screening for long-range contacts using D scores</title>
<p>Using the D scoring scheme, it is possible to screen for contact enrichment hotspots throughout the entire Hi-C matrix without prior assumptions. We applied this approach to the high depth lymphoblasts and ertirhroid maps, deriving 462 and 1304 non-overlapping contact enrichment hotspots, respectively ranging in distance from 4Mb to 100Mb (Methods). We observe that many of the identified hotspots were characterized by a broad pattern of enrichment, associating together genomic elements at a much larger scale than observed above for CTCFs or TSSs. To quantify this observation, we extracted for each contact hotspot a 2D matrix reflecting the spatial contact enrichment pattern within a 0.5MB range at 50kb resolution. We then clustered these matrices and studied the average spatial pattern associated with each cluster (<bold><xref ref-type="fig" rid="figS4">Fig S4</xref></bold>). This confirmed the broad nature of nearly all long-range contact hotspots we identified, showing contact enrichment at distance range of 100kb around the center, and in many of the cases larger distances are observed. Highly localized contacts between elements genomically separated by more than 4MB are very rare, and are all linked with possible assembly or mapping limitations (<bold><xref ref-type="fig" rid="figS4">Fig S4c</xref></bold>). These results suggest that weak preferential association between TADs and compartments, time of replication effects, cell cycle phase effects or other global phenomenon, all of which are not corrected by our randomization, may underlie a significant fraction to the very long range contact enrichment we observed. Spatial analysis as performed above is essential in these cases, in order to ensure observed contact enrichment between certain local elements is not a mere consequence of their embedding into broadly enriched contacting domains.</p>
</sec>
</sec>
<sec id="s3">
<title>DISCUSSION</title>
<p>We introduce <italic>Shaman</italic> &#x2010; a new approach for analyzing Hi-C contact matrices based on a matrix randomization algorithm combined with a bin-free scheme for analysis of contact density enrichment. <italic>Shaman</italic> is using its randomization scheme for balancing the Hi-C challenging background contact probability distribution, providing effective multi-scale visualization of the data so as to capture CTCF-mediated looping, promoter-enhancer contacts, topological domain boundaries and long range, low-specificity contacts between entire topological domains, all within one scheme and without any parameter setting. Randomizing matrices that preserve simultaneously the empirical marginal and contact distance distribution is also facilitating statistical analysis at various regulatory contexts, as effects at any epigenomic context or any mixture of chromosomal proximities can be studied systematically by comparison of empirical and randomized contact densities.</p>
<p>The resolution of Hi-C screen depends on sequencing depth and the genomic distance spanned between elements whose interaction is being screened. As shown in <xref ref-type="fig" rid="fig1">Fig 1g</xref>, the typical range of the k-nearest contacts to a point of interest increases with distance and thus making detection of effects that are localized but enriched only mildly above the background level increasingly difficult or impossible. Targeted methods, such as 4C<sup><xref rid="c9" ref-type="bibr">9</xref>,<xref rid="c30" ref-type="bibr">30</xref>,<xref rid="c31" ref-type="bibr">31</xref><xref rid="c25" ref-type="bibr">25</xref></sup>, ChiA-PET (REFs) or Capture Hi-C<sup><xref rid="c32" ref-type="bibr">32</xref>&#x2013;<xref rid="c34" ref-type="bibr">34</xref></sup> can enrich for specific contacts and increase resolution in loci of interest. Nevertheless, detection of putative interaction based on targeted methods can be confounded when applied to long range loci, since enrichment of contacts between two loci can be a consequence of regional and non-specific effects. Multiple sources of indirect effects, including replication time and cell cycle biases, variable compartment and pseudo-compartment preferences<sup><xref rid="c22" ref-type="bibr">22</xref></sup> or changes in the overall intensity of enriched contacts between active loci may result in detection of statistically significant contacts that are nevertheless non-specific. We suggest that unbiased Hi-C analysis using the tools introduced here can provide a global map of such global effects, and highlight regions for potential follow up by targeted methods, which can then be interpreted not only locally, but given the broader context. Moreover, when assessing overall preferences of contacts among families of loci (e.g. transcription factor binding sites), it is essential to distinguish specific vs. non-specific contact enrichment by controlling foci of putative interaction with spatial analysis (as demonstrated in <xref ref-type="fig" rid="fig3">Figure 3</xref>, and while controlling for overall capture preferences of assayed elements). The data here suggest that Hi-C maps with reasonable sequencing burden should be generated routinely prior to application of targeted approaches, and that a combined non-specific and focused study design can achieve maximum impact and ensure the interpretability of the derived putative interactions.</p>
</sec>
</body>
<back>
<ack>
<title>ACKNOWLEDGMENTS</title>
<p>Research was supported by the European Research Council (EVOEPIC), and by the NIH 4DN program.</p>
</ack>
<sec sec-type="data_availability">
<title>Software availability</title>
<p>The SHAMAN package is available from <ext-link ext-link-type="uri" xlink:href="https://tanaylab.bitbucket.io/shaman">https://tanaylab.bitbucket.io/shaman</ext-link>.</p>
</sec>
<ref-list>
<title>LITERATURE</title>
<ref id="c1"><label>1.</label><mixed-citation publication-type="journal"><string-name><surname>Lieberman-Aiden</surname>, <given-names>E.</given-names></string-name> <etal>et al.</etal> <article-title>Comprehensive mapping of long-range interactions reveals folding principles of the human genome</article-title>. <source>Science</source> <volume>326</volume>, <fpage>289</fpage>&#x2013;<lpage>293</lpage> (<year>2009</year>).</mixed-citation></ref>
<ref id="c2"><label>2.</label><mixed-citation publication-type="journal"><string-name><surname>Denker</surname>, <given-names>A.</given-names></string-name> &#x0026; <string-name><surname>de Laat</surname>, <given-names>W.</given-names></string-name> <article-title>The second decade of 3C technologies: detailed insights into nuclear organization</article-title>. <source>Genes Dev.</source> <volume>30</volume>, <fpage>1357</fpage>&#x2013;<lpage>1382</lpage> (<year>2016</year>).</mixed-citation></ref>
<ref id="c3"><label>3.</label><mixed-citation publication-type="journal"><string-name><surname>Rao</surname>, <given-names>S. S. P.</given-names></string-name> <etal>et al.</etal> <article-title>A 3D Map of the Human Genome at Kilobase Resolution Reveals Principles of Chromatin Looping</article-title>. <source>Cell</source> <volume>159</volume>, <fpage>1665</fpage>&#x2013;<lpage>1680</lpage> (<year>2014</year>).</mixed-citation></ref>
<ref id="c4"><label>4.</label><mixed-citation publication-type="journal"><string-name><surname>Sexton</surname>, <given-names>T.</given-names></string-name> <etal>et al.</etal> <article-title>Three-dimensional folding and functional organization principles of the Drosophila genome</article-title>. <source>Cell</source> <volume>148</volume>, <fpage>458</fpage>&#x2013;<lpage>472</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="c5"><label>5.</label><mixed-citation publication-type="journal"><string-name><surname>Dixon</surname>, <given-names>J. R.</given-names></string-name> <etal>et al.</etal> <article-title>Topological domains in mammalian genomes identified by analysis of chromatin interactions</article-title>. <source>Nature</source> <volume>485</volume>, <fpage>376</fpage>&#x2013;<lpage>80</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="c6"><label>6.</label><mixed-citation publication-type="journal"><string-name><surname>Forcato</surname>, <given-names>M.</given-names></string-name> <etal>et al.</etal> <article-title>Comparison of computational methods for Hi-C data analysis</article-title>. <source>Nat. Methods</source> <volume>14</volume>, <fpage>679</fpage>&#x2013;<lpage>685</lpage> (<year>2017</year>).</mixed-citation></ref>
<ref id="c7"><label>7.</label><mixed-citation publication-type="journal"><string-name><surname>Yaffe</surname>, <given-names>E.</given-names></string-name> &#x0026; <string-name><surname>Tanay</surname>, <given-names>A.</given-names></string-name> <article-title>Probabilistic modeling of Hi-C contact maps eliminates systematic biases to characterize global chromosomal architecture</article-title>. <source>Nat. Genet.</source> <volume>43</volume>, <fpage>1059</fpage>&#x2013;<lpage>1065</lpage> (<year>2011</year>).</mixed-citation></ref>
<ref id="c8"><label>8.</label><mixed-citation publication-type="journal"><string-name><surname>Li</surname>, <given-names>W.</given-names></string-name>, <string-name><surname>Gong</surname>, <given-names>K.</given-names></string-name>, <string-name><surname>Li</surname>, <given-names>Q.</given-names></string-name>, <string-name><surname>Alber</surname>, <given-names>F.</given-names></string-name> &#x0026; <string-name><surname>Zhou</surname>, <given-names>X. J.</given-names></string-name> <article-title>Hi-Corrector: a fast, scalable and memory-efficient package for normalizing large-scale Hi-C data</article-title>. <source>Bioinforma. Oxf. Engl.</source> <volume>31</volume>, <fpage>960</fpage>&#x2013;<lpage>962</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c9"><label>9.</label><mixed-citation publication-type="journal"><string-name><surname>van de Werken</surname>, <given-names>H. J. G.</given-names></string-name> <etal>et al.</etal> <article-title>Robust 4C-seq data analysis to screen for regulatory DNA interactions</article-title>. <source>Nat. Methods</source> <volume>9</volume>, <fpage>969</fpage>&#x2013;<lpage>972</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="c10"><label>10.</label><mixed-citation publication-type="journal"><string-name><surname>Hu</surname>, <given-names>M.</given-names></string-name> <etal>et al.</etal> <article-title>HiCNorm: removing biases in Hi-C data via Poisson regression</article-title>. <source>Bioinforma. Oxf. Engl.</source> <volume>28</volume>, <fpage>3131</fpage>&#x2013;<lpage>3133</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="c11"><label>11.</label><mixed-citation publication-type="journal"><string-name><surname>Imakaev</surname>, <given-names>M.</given-names></string-name> <etal>et al.</etal> <article-title>Iterative correction of Hi-C data reveals hallmarks of chromosome organization</article-title>. <source>Nat. Methods</source> <volume>9</volume>, <fpage>999</fpage>&#x2013;<lpage>1003</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="c12"><label>12.</label><mixed-citation publication-type="journal"><string-name><surname>Yan</surname>, <given-names>K.-K.</given-names></string-name>, <string-name><surname>G&#x00FC;rkan Yardimci</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Yan</surname>, <given-names>C.</given-names></string-name>, <string-name><surname>Noble</surname>, <given-names>W. S.</given-names></string-name> &#x0026; <string-name><surname>Gerstein</surname>, <given-names>M.</given-names></string-name> <article-title>HiCSpector: A matrix library for spectral and reproducibility analysis of Hi-C contact maps</article-title>. <source>Bioinforma. Oxf. Engl.</source> (<year>2017</year>). doi:<pub-id pub-id-type="doi">10.1093/bioinformatics/btx152</pub-id></mixed-citation></ref>
<ref id="c13"><label>13.</label><mixed-citation publication-type="journal"><string-name><surname>Sofueva</surname>, <given-names>S.</given-names></string-name> <etal>et al.</etal> <article-title>Cohesin-mediated interactions organize chromosomal domain architecture</article-title>. <source>EMBO J.</source> <volume>32</volume>, <fpage>3119</fpage>&#x2013;<lpage>3129</lpage> (<year>2013</year>).</mixed-citation></ref>
<ref id="c14"><label>14.</label><mixed-citation publication-type="journal"><string-name><surname>Ay</surname>, <given-names>F.</given-names></string-name>, <string-name><surname>Bailey</surname>, <given-names>T. L.</given-names></string-name> &#x0026; <string-name><surname>Noble</surname>, <given-names>W. S.</given-names></string-name> <article-title>Statistical confidence estimation for Hi-C data reveals regulatory chromatin contacts</article-title>. <source>Genome Res.</source> <volume>24</volume>, <fpage>999</fpage>&#x2013;<lpage>1011</lpage> (<year>2014</year>).</mixed-citation></ref>
<ref id="c15"><label>15.</label><mixed-citation publication-type="journal"><string-name><surname>Xu</surname>, <given-names>Z.</given-names></string-name> <etal>et al.</etal> <article-title>A hidden Markov random field-based Bayesian method for the detection of long-range chromosomal interactions in Hi-C data</article-title>. <source>Bioinforma. Oxf. Engl.</source> <volume>32</volume>, <fpage>650</fpage>&#x2013;<lpage>656</lpage> (<year>2016</year>).</mixed-citation></ref>
<ref id="c16"><label>16.</label><mixed-citation publication-type="journal"><string-name><surname>Durand</surname>, <given-names>N. C.</given-names></string-name> <etal>et al.</etal> <article-title>Juicer Provides a One-Click System for Analyzing Loop-Resolution Hi-C Experiments</article-title>. <source>Cell Syst.</source> <volume>3</volume>, <fpage>95</fpage>&#x2013;<lpage>98</lpage> (<year>2016</year>).</mixed-citation></ref>
<ref id="c17"><label>17.</label><mixed-citation publication-type="journal"><string-name><surname>de Wit</surname>, <given-names>E.</given-names></string-name> <etal>et al.</etal> <article-title>The pluripotent genome in three dimensions is shaped around pluripotency factors</article-title>. <source>Nature</source> <volume>501</volume>, <fpage>227</fpage>&#x2013;<lpage>231</lpage> (<year>2013</year>).</mixed-citation></ref>
<ref id="c18"><label>18.</label><mixed-citation publication-type="journal"><string-name><surname>Sauria</surname>, <given-names>M. E.</given-names></string-name>, <string-name><surname>Phillips-Cremins</surname>, <given-names>J. E.</given-names></string-name>, <string-name><surname>Corces</surname>, <given-names>V. G.</given-names></string-name> &#x0026; <string-name><surname>Taylor</surname>, <given-names>J.</given-names></string-name> <article-title>HiFive: a tool suite for easy and efficient HiC and 5C data analysis</article-title>. <source>Genome Biol.</source> <volume>16</volume>, <fpage>237</fpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c19"><label>19.</label><mixed-citation publication-type="journal"><string-name><surname>Durand</surname>, <given-names>N. C.</given-names></string-name> <etal>et al.</etal> <article-title>Juicebox Provides a Visualization System for Hi-C Contact Maps with Unlimited Zoom</article-title>. <source>Cell Syst.</source> <volume>3</volume>, <fpage>99</fpage>&#x2013;<lpage>101</lpage> (<year>2016</year>).</mixed-citation></ref>
<ref id="c20"><label>20.</label><mixed-citation publication-type="journal"><string-name><surname>Wingett</surname>, <given-names>S.</given-names></string-name> <etal>et al.</etal> <article-title>HiCUP: pipeline for mapping and processing Hi-C data</article-title>. <source>F1000Research</source> <volume>4</volume>, <fpage>1310</fpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c21"><label>21.</label><mixed-citation publication-type="journal"><string-name><surname>Nora</surname>, <given-names>E. P.</given-names></string-name> <etal>et al.</etal> <article-title>Spatial partitioning of the regulatory landscape of the X-inactivation centre</article-title>. <source>Nature</source> <volume>485</volume>, <fpage>381</fpage>&#x2013;<lpage>5</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="c22"><label>22.</label><mixed-citation publication-type="journal"><string-name><surname>Nagano</surname>, <given-names>T.</given-names></string-name> <etal>et al.</etal> <article-title>Cell-cycle dynamics of chromosomal organization at single-cell resolution</article-title>. <source>Nature</source> <volume>547</volume>, <fpage>61</fpage>&#x2013;<lpage>67</lpage> (<year>2017</year>).</mixed-citation></ref>
<ref id="c23"><label>23.</label><mixed-citation publication-type="journal"><string-name><surname>Olivares-Chauvet</surname>, <given-names>P.</given-names></string-name> <etal>et al.</etal> <article-title>Capturing pairwise and multi-way chromosomal conformations using chromosomal walks</article-title>. <source>Nature</source> <volume>540</volume>, <fpage>296</fpage>&#x2013;<lpage>300</lpage> (<year>2016</year>).</mixed-citation></ref>
<ref id="c24"><label>24.</label><mixed-citation publication-type="journal"><string-name><surname>Vietri Rudan</surname>, <given-names>M.</given-names></string-name> <etal>et al.</etal> <article-title>Comparative Hi-C reveals that CTCF underlies evolution of chromosomal domain architecture</article-title>. <source>Cell Rep.</source> <volume>10</volume>, <fpage>1297</fpage>&#x2013;<lpage>1309</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c25"><label>25.</label><mixed-citation publication-type="journal"><string-name><surname>Li</surname>, <given-names>G.</given-names></string-name> <etal>et al.</etal> <article-title>Extensive Promoter-Centered Chromatin Interactions Provide a Topological Basis for Transcription Regulation</article-title>. <source>Cell</source> <volume>148</volume>, <fpage>84</fpage>&#x2013;<lpage>98</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="c26"><label>26.</label><mixed-citation publication-type="journal"><string-name><surname>Grubert</surname>, <given-names>F.</given-names></string-name> <etal>et al.</etal> <article-title>Genetic Control of Chromatin States in Humans Involves Local and Distal Chromosomal Interactions</article-title>. <source>Cell</source> <volume>162</volume>, <fpage>1051</fpage>&#x2013;<lpage>1065</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c27"><label>27.</label><mixed-citation publication-type="journal"><string-name><surname>Schoenfelder</surname>, <given-names>S.</given-names></string-name> <etal>et al.</etal> <article-title>Polycomb repressive complex PRC1 spatially constrains the mouse embryonic stem cell genome</article-title>. <source>Nat. Genet.</source> <volume>47</volume>, <fpage>1179</fpage>&#x2013;<lpage>1186</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c28"><label>28.</label><mixed-citation publication-type="journal"><string-name><surname>Schuettengruber</surname>, <given-names>B.</given-names></string-name> <etal>et al.</etal> <article-title>Cooperativity, specificity, and evolutionary stability of Polycomb targeting in Drosophila</article-title>. <source>Cell Rep.</source> <volume>9</volume>, <fpage>219</fpage>&#x2013;<lpage>233</lpage> (<year>2014</year>).</mixed-citation></ref>
<ref id="c29"><label>29.</label><mixed-citation publication-type="journal"><string-name><surname>Andrey</surname>, <given-names>G.</given-names></string-name> <etal>et al.</etal> <article-title>A switch between topological domains underlies HoxD genes collinearity in mouse limbs</article-title>. <source>Science</source> <volume>340</volume>, 1234167 (<year>2013</year>).</mixed-citation></ref>
<ref id="c30"><label>30.</label><mixed-citation publication-type="journal"><string-name><surname>Schwartzman</surname>, <given-names>O.</given-names></string-name> <etal>et al.</etal> <article-title>UMI-4C for quantitative and targeted chromosomal contact profiling</article-title>. <source>Nat. Methods</source> <volume>13</volume>, <fpage>685</fpage>&#x2013;<lpage>691</lpage> (<year>2016</year>).</mixed-citation></ref>
<ref id="c31"><label>31.</label><mixed-citation publication-type="journal"><string-name><surname>Simonis</surname>, <given-names>M.</given-names></string-name> <etal>et al.</etal> <article-title>Nuclear organization of active and inactive chromatin domains uncovered by chromosome conformation capture&#x2013;on-chip (4C)</article-title>. <source>Nat. Genet.</source> <volume>38</volume>, <fpage>1348</fpage>&#x2013;<lpage>1354</lpage> (<year>2006</year>).</mixed-citation></ref>
<ref id="c32"><label>32.</label><mixed-citation publication-type="journal"><string-name><surname>Kolovos</surname>, <given-names>P.</given-names></string-name> <etal>et al.</etal> <article-title>Targeted Chromatin Capture (T2C): a novel high resolution high throughput method to detect genomic interactions and regulatory elements</article-title>. <source>Epigenetics Chromatin</source> <volume>7</volume>, <fpage>10</fpage> (<year>2014</year>).</mixed-citation></ref>
<ref id="c33"><label>33.</label><mixed-citation publication-type="journal"><string-name><surname>Mifsud</surname>, <given-names>B.</given-names></string-name> <etal>et al.</etal> <article-title>Mapping long-range promoter contacts in human cells with high-resolution capture Hi-C</article-title>. <source>Nat. Genet.</source> <volume>47</volume>, <fpage>598</fpage>&#x2013;<lpage>606</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c34"><label>34.</label><mixed-citation publication-type="journal"><string-name><surname>Davies</surname>, <given-names>J. O. J.</given-names></string-name> <etal>et al.</etal> <article-title>Multiplexed analysis of chromosome conformation at vastly improved sensitivity</article-title>. <source>Nat. Methods</source> <volume>13</volume>, <fpage>74</fpage>&#x2013;<lpage>80</lpage> (<year>2016</year>).</mixed-citation></ref>
</ref-list>
<sec>
<title>METHODS</title>
<sec>
<title>Estimating the contact genomic distance probability distirubtion</title>
<p>Focusing on one chromosome at a time, and given a set of Hi-C intra-chromosomal contacts between coordinates (x<sub>i</sub>,y<sub>i</sub>) we estimate the contact distance decay curve D by binning contacts using floor(B&#x002A;log2(|x<sub>i</sub>-y<sub>i</sub>|), B is set by default to:
<disp-formula id="ueqn1"><alternatives><graphic xlink:href="187203_ueqn1.gif"/></alternatives></disp-formula></p>
<p>Where N<sub>obs</sub> is the total number of contacts and <italic>min_dist</italic>, <italic>max_dist</italic> define the range of genomic distances observed. For each bin, we count the number of observed contacts to generate the raw decay curve <italic>D<sub>i</sub></italic>. We smooth the decay curve by defining a smoothing window of size S bins in each direction, such that the smoothed value <italic>DSmooth</italic> for bin S &#x003C; I &#x003C; max_bin-S is defined:
<disp-formula id="ueqn2"><alternatives><graphic xlink:href="187203_ueqn2.gif"/></alternatives></disp-formula></p>
<p>Setting S&#x003D; min{20, (B/10)} provides good tradeoff between curve stability and its resolution. We apply linear regression to compute the smoothed S end bins on each side, taking into account 2&#x002A;S observed raw bins, and correcting for negative values by setting to 0.</p>
</sec>
<sec>
<title>Randomizing Hi-C matrices using a Metropolis-Hastings scheme</title>
<p>Given an observed Hi-C matrix for a given chromosome, we define a probability distribution over all symmetric matrices that preserve the observed total number of contacts per column/row by considering only the contact chromosomal distances:
<disp-formula id="ueqn3"><alternatives><graphic xlink:href="187203_ueqn3.gif"/></alternatives></disp-formula></p>
<p>We implement a Metropolis-Hastings (MH)-like algorithm to sample from this probability distribution. In general, the sampler selects (or &#x201C;proposes&#x201D;) contact pairs at random (e.g., (a,b), (c,d)) and tries to cross them (e.g., to (a,d),(c,b)) with probability that is proportional to their chromosomal distance probabilities. Sampling arbitrary contact pairs would typically generate low probability (high distance) crosses, so we implemented a more restricted pair sampling scheme, by selecting the first contact (a,b) uniformly from all current matrix contacts, and the paired contact uniformly among all pairs (c,d) such that |a-c|&#x003C;W and |b-d|)&#x003C;W. Here W is defined as the proposal distribution <italic>grid size</italic>. Such sampling was implemented efficiently by binning contacts into two dimensional bins of size W and repeatedly sampling a paired contact from bins overlapping or adjacent to (a,b)&#x2019;s bin until a contact within distance W was sampled.</p>
<p>In a simple Metropolis algorithm, the proposal function is symmetric, hence once we sample a proposed change to the matrix, accepting the change with probability min(1,&#x03C0;(M)/&#x03C0;(M&#x2019;)) guarantees convergence to the desired distribution. However when the proposal distribution Q(M&#x2192;M&#x2019;) is non symmetric, as in our case, one must correct for the asymmetry by multiplying the acceptance probability by the Hastings ratio h(M,M&#x2019;) &#x003D; Q(M&#x2019;&#x2192;M) / Q(M&#x2192;M). The non-symmetry in our proposal distribution stems from the sampling of contact pairs from a matrix that is highly imbalanced in its contact distance distribution, generating longer-distance crosses with higher probability. Computing the hastings ratio explicitly is possible, if we can count at each sample the ratio between total number of contacts around the original and proposed (crossed) contacts, but this may be computationally expensive. Given the definition of our probability distribution, we choose to approximate the Hastings factor <italic>h</italic> using only the two contacts (a,b),(c,d) selected for shuffling (rather than the entire matrix M), and to further parameterize our approximation, using the chromosomal distances involved d<sub>1</sub>=|a-b|, d<sub>2</sub>=|c-d|. d<sub>3</sub>=|a-d|, d<sub>4</sub>=|c-b|, setting h ((a,b),(c,d)) &#x003D; h<sub>d</sub>(d<sub>3</sub>)&#x002A;h<sub>d</sub>(d<sub>4</sub>)/h<sub>d</sub>(d<sub>1</sub>)&#x002A;h<sub>d</sub>(d<sub>2</sub>). Here h<sub>d</sub> is correcting the proposal distribution asymmetry by assuming it is defined completely by the sampled and shuffled contact distances. Importantly, the approximated Hastings effect as captured by h<sub>d</sub> is imperfect, and we must periodically update it to avoid continuous drift of the sampled matrices.</p>
<p>Our sampling algorithm therefore works as follows. We assume the original contact matrix M has N<sub>obs</sub> contacts following an estimated distance decay curve D:</p>
<list list-type="simple">
<list-item>
<label>1)</label><p>Initialize h<sub>d</sub>. We do this by sampling a large number (0.5N<sub>obs</sub>) of contact pairs M and measuring the distance of all putative crossed contacts M<sub>rand</sub>(x) (without performing any shuffle). h<sub>d</sub>(x) is defined as the ratio M<sub>rand</sub>(x)/M, where the actual value is derived for 200 logarithmic bins and smoothed, as performed generically for estimating D.</p></list-item>
<list-item>
<label>2)</label><p>Until we accept (0.0001 N<sub>obs</sub>) shuffles: sample contact pairs as described above and shuffle them with acceptance probability:
<disp-formula id="ueqn4"><alternatives><graphic xlink:href="187203_ueqn4.gif"/></alternatives></disp-formula></p></list-item>
<list-item>
<label>3)</label><p>Correct the hastings ratio according to the accumulated skew of the current sampled matrix M from the expected distance decay curve. This is done by correcting for the divergence of the current randomized matrix curve (Dobs) from the original expected one:
<disp-formula id="ueqn5"><alternatives><graphic xlink:href="187203_ueqn5.gif"/></alternatives></disp-formula></p>
<p>Where the default value for the correction factor CF&#x003D; 0.25.</p></list-item>
<list-item>
<label>4)</label><p>We go back to step 2 and repeat iteration until K<sub>burn</sub>&#x002A;N<sub>obs</sub> shuffles are accepted, where K<sub>burn</sub> is the burn-in parameter that we typically set to 40 for a proposal grid size of 500K followed by another 40 iterations for proposal grid size of 1Mb.</p></list-item>
<list-item>
<label>5)</label><p>After randomization is complete, we symmetrize the resulted Hi-C matrix, such that any contact (a,b) is duplicated to (b,a). The final matrix thereby contains 2N<sub>obs</sub> contacts.</p></list-item>
</list>
</sec>
<sec>
<title>Characterizing Hi-C contact density enrichment using the D score</title>
<p>We assess the density of a Hi-C matrix at a point (a,b) by characterizing the sequence of Euclidean distances from (a,b) to the K contacts most proximal to it. This can be computed efficiently using a K-nn data structure. The distance sequence, or the cumulative distribution defined by it can be easily compared between matrices using a Kolmogorov Smirnov (KS) D statistic, provided the K parameter is scaled according to the total number of contacts in the matrix, hence setting 2K neighbors for the randomized matrix. We define this D statistic, when comparing observed and randomized matrix, as the density enrichment score, where positive D values indicate contact enrichment over the expected background distribution and negative D values represent depletion. The parameter K can be tuned according to the overall coverage, where smaller K values can enhance resolution but may decrease statistical power.</p>
<p>To determine the background distribution of D values we randomized a matrix and compared its D score over all contacts against re-randomized matrices. This distribution was used as a background in order to assess FDR values (<xref ref-type="fig" rid="fig1">Fig 1f</xref>).</p>
</sec>
<sec>
<title>Epigenetics landmarks</title>
<p>We downloaded epigenetic data from ENCODE as described in <xref ref-type="table" rid="tblS1">Table S1</xref>. For each epigenetic landmark, we screened for genomic regions with strong ChIP-seq signal (peak percentile as listed in table S1).</p>
<list list-type="bullet">
<list-item>
<p>For CTCF, we annotated each peak according to the motif strength, requiring motif strength &#x003E; 99.988&#x0025; of the genome-wide distribution. Each 20bp window of the CTCF peaks was classified as C (only ChIP), F (ChIP &#x002B; forward motif), R (chip &#x002B; reverse motif) or B (ChIP &#x002B; forward and reverse motifs). Only F and B CTCF were considered for contact distributions analysis of CTCFs.</p></list-item>
<list-item><p>For TSS, H3K4me3 peaks that were within 5K of transcription start site and were at least 5k from CTCF chip peak were marked as active TSS. TSS that were not marked with H3K4me3 (distance to H3K4me3 peak &#x003E; 5k) or CTCF (distance to CTCF chip peak&#x003E;5k) were considered as passive TSS.</p></list-item>
<list-item><p>For all other epigenetic ChIP-seq, peaks were filtered for CTCF peaks (distance &#x003E; 5k).</p></list-item>
</list>
</sec>
<sec>
<title>Screening contact hotposts</title>
<p>For a given pair of epigenetic landmarks (e.g. CTCF_forward, CTCF_reverse), we define hotspot candidates as all possible pairs distanced 200Kb-2Mb from each other. Candidates were further filtered by contact enrichment in the normalized contact map, requiring a D score higher than 30 within a 50x50 Kb window centered on the hotspot. Spatial enrichment is computed by pooling all sub-matrices around candidates at 500 bp resolution in both observed and random data and computing the log ratio for each spatial bin at 1k resolution.</p>
</sec>
<sec>
<title>Clustering contacts hotspots spatial structures (<xref ref-type="fig" rid="figS4">fig S4</xref>)</title>
<p>We screened for all long-range contacts (distanced between 4-100M) with high score (&#x003E;80). High scoring contacts were merged if they shared a K-nearest-neighbor (K=100), defining hotspots, and the center of each hotspots was defined. For each hostspot, we defined a grid of 20x20 100kb bins around the center and extracted the maximum D score in each bin to create a vector of features characterizing the spatial structure around the hotspot. We then clustered hostpots using Kmeans, and visualized the derived patterns as shown in <xref ref-type="fig" rid="figS4">Fig S4</xref>.</p>
</sec>
</sec>
<sec>
<table-wrap id="tblS1" orientation="portrait" position="float">
<label>Table S1:</label>
<caption><title>Epigenetic landmarks from ENCODE</title></caption>
<graphic xlink:href="187203_tblS1.tif"/>
<graphic xlink:href="187203_tblS1a.tif"/>
</table-wrap>
<fig id="figS1" position="float" fig-type="figure">
<label>Supplementary Figure 1.</label>
<caption><p><bold>a)</bold> Hastings ratio per correction for several color coded log2 distance bins. <bold>b)</bold> Decay curve for observed (black) and randomized (red) datasets, K562 (left), GM12878 (center), mouse ES (right). <bold>c)</bold> Monte Carlo Markov Chain acceptance probability distribution as a function of the distance W between the proposed contact points (Methods). <bold>d)</bold> Distribution of log distance to 50<sup>th</sup> nearest neighbor stratified by log linear distance computed for K562 Hi-C data.</p></caption>
<graphic xlink:href="187203_figS1.tif"/>
</fig>
<fig id="figS2" position="float" fig-type="figure">
<label>Supplementary Figure 2.</label>
<caption><p><bold>a-c)</bold> Direct comparison of D scores maps is shown to the left, K562 data is top left, GM12878 is bottom-right. K27ac ChIP-seq data is shown for the two cell types on the diagonal. Visualizing the differential D score (as discussed in <xref ref-type="fig" rid="fig2">Figure 2</xref>) is shown on the right, (symmetric matrix is shown, where enrichment (ref-yellow) represent denser contacts in K562 and anti-enrichment (blue) represent denser contacts in GM12878.</p></caption>
<graphic xlink:href="187203_figS2.tif"/>
</fig>
<fig id="figS3" position="float" fig-type="figure">
<label>Supplementary Figure 3.</label>
<caption><p><bold>a)</bold> Shown are log2(obs/shuffled) number of contacts 25kb around any CTCF convergent sites (left) and CTCF convergent sites that contain D score&#x003E;60 anywhere within the 50K window that are distanced between 200K and 2MB from each other at 1kb resolution (Methods). <bold>b)</bold> Schematic visualization explaining the spatial contact enrichment patterns of non-convergent CTCF pairs, including forward-to-forward (left), reverse-to-reverse (center) and reverse-to-forward (right), all rely on convergent CTCFs to generate the observed spatial pattern. <bold>c)</bold> Similar to a for H3K9me3 sites (left) and H3K27me3 sites (center) and active-TSS and Runx1 (right) requiring D score &#x003E; 30 anywhere within the 50K window.</p></caption>
<graphic xlink:href="187203_figS3.tif"/>
</fig>
<fig id="figS4" position="float" fig-type="figure">
<label>Supplementary Figure 4.</label>
<caption><p><bold>a)</bold> Long range contact enrichment hotspots clusters average spatial profile in K562. <bold>b)</bold> similar to a for GM12878 dataset. <bold>c)</bold> Chromosomal ideogram depicting all genomic loci with D score &#x003E; 80.</p></caption>
<graphic xlink:href="187203_figS4.tif"/>
</fig>
</sec>
</back>
</article>