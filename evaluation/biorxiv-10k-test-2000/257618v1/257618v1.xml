<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">BIORXIV</journal-id>
<journal-title-group>
<journal-title>bioRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/257618</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="author-type">
<subject>Regular Article</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>New Results</subject>
</subj-group>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Biophysics</subject>
</subj-group>
</article-categories>
<title-group>
<article-title><italic>cis</italic>TEM: User-friendly software for single-particle image processing</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Grant</surname>
<given-names>Tim</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3343-9621</contrib-id>
<name>
<surname>Rohou</surname>
<given-names>Alexis</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1506-909X</contrib-id>
<name>
<surname>Grigorieff</surname>
<given-names>Nikolaus</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Janelia Research Campus, Howard Hughes Medical Institute</institution>, Ashburn, Virginia, <country>USA</country></aff>
<aff id="a2"><label>2</label><institution>Present address: Department of Structural Biology, Genentech</institution>, South San Francisco, California, <country>USA</country></aff>
</contrib-group>
<pub-date pub-type="epub">
<year>2018</year>
</pub-date>
<elocation-id>257618</elocation-id>
<history>
<date date-type="received">
<day>31</day>
<month>1</month>
<year>2018</year>
</date>
<date date-type="rev-recd">
<day>31</day>
<month>1</month>
<year>2018</year>
</date>
<date date-type="accepted">
<day>31</day>
<month>1</month>
<year>2018</year>
</date>
</history>
<permissions>
<copyright-statement>&#x00A9; 2018, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2018</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="257618.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract>
<title>Abstract</title>
<p>We have developed new open-source software called <italic>cis</italic>TEM (computational imaging system for transmission electron microscopy) for the processing of data for high-resolution electron cryo-microscopy and single-particle averaging. <italic>cis</italic>TEM features a graphical user interface that is used to submit jobs, monitor their progress, and display results. It implements a full processing pipeline including movie processing, image defocus determination, automatic particle picking, 2D classification, ab-initio 3D map generation from random parameters, 3D classification, and high-resolution refinement and reconstruction. Some of these steps implement newly-developed algorithms; others were adapted from previously published algorithms. The software is optimized to enable processing of typical datasets (2000 micrographs, 200k &#x2013; 300k particles) on a high-end, CPU-based workstation in half a day or less, comparable to GPU-accelerated processing. Jobs can also be scheduled on large computer clusters using flexible run profiles that can be adapted for most computing environments. <italic>cis</italic>TEM is available for download from <ext-link ext-link-type="uri" xlink:href="http://cistem.org">cistem.org</ext-link>.</p>
</abstract>
<counts>
<page-count count="48"/>
</counts>
</article-meta>
</front>
<body>
<sec id="s1">
<title>Introduction</title>
<p>The three-dimensional (3D) visualization of biological macromolecules and their assemblies by single-particle electron cryo-microscopy (cryo-EM) has become a prominent approach in the study of molecular mechanisms (<xref ref-type="bibr" rid="c5">Cheng et al., 2015</xref>; <xref ref-type="bibr" rid="c44">Subramaniam et al., 2016</xref>). Recent advances have been primarily due to the introduction of direct detectors (<xref ref-type="bibr" rid="c25">McMullan et al., 2016</xref>). With the improved data quality, there is increasing demand for advanced computational algorithms to extract signal from the noisy image data and reconstruct 3D density maps from them at the highest possible resolution. The promise of near-atomic resolution (3 &#x2013; 4 &#x00C5;), where densities can be interpreted reliably with atomic models, has been realized by many software tools and suites (<xref ref-type="bibr" rid="c9">Frank et al., 1996</xref>; <xref ref-type="bibr" rid="c17">Hohn et al., 2007</xref>; <xref ref-type="bibr" rid="c21">Lyumkis et al., 2013</xref>; <xref ref-type="bibr" rid="c36">Scheres, 2012</xref>; <xref ref-type="bibr" rid="c45">Tang et al., 2007</xref>; <xref ref-type="bibr" rid="c49">van Heel et al., 1996</xref>). Many of these software tools implement a standard set of image processing steps that are now routinely performed in a single particle project. These typically include movie frame alignment, contrast transfer function (CTF) determination, particle picking, two-dimensional (2D) classification, 3D reconstruction, refinement and classification, and sharpening of the final reconstructions.</p>
<p>We have written new software called <italic>cis</italic>TEM to implement a complete image processing pipeline for single-particle cryo-EM, including all these steps, accessible through an easy-to-use graphical user interface (GUI). Some of these steps implement newly-developed algorithms described below; others were adapted from previously published algorithms. <italic>cis</italic>TEM consists of a set of compiled programs and tools, as well as a wxWidgets-based GUI. The GUI launches programs and controls them by sending specific commands and receiving results via TCP/IP sockets. Each program can also be run manually, in which case it solicits user input on the command line. The design of <italic>cis</italic>TEM, therefore, allows users who would like to have more control over the different processing steps to design their own procedures outside the GUI. To adopt this new architecture, a number of previously existing Fortran-based programs were rewritten in C&#x002B;&#x002B;, including Unblur and Summovie (<xref ref-type="bibr" rid="c11">Grant and Grigorieff, 2015b</xref>), mag_distortion_estimate and mag_distortion_correct (<xref ref-type="bibr" rid="c10">Grant and Grigorieff, 2015a</xref>), CTFFIND4 (<xref ref-type="bibr" rid="c33">Rohou and Grigorieff, 2015</xref>), and Frealign (<xref ref-type="bibr" rid="c21">Lyumkis et al., 2013</xref>). Additionally, algorithms described previously were added for particle picking (<xref ref-type="bibr" rid="c40">Sigworth, 2004</xref>), 2D classification (<xref ref-type="bibr" rid="c38">Scheres et al., 2005</xref>) and ab-initio 3D reconstruction (<xref ref-type="bibr" rid="c14">Grigorieff, 2016</xref>), sometimes with modifications to optimize their performance.</p>
<p><italic>cis</italic>TEM currently does not support computation on graphical processing units (GPUs). Benchmarking of a hotspot identified in the global orientational search to determine particle alignment parameters showed that an NVIDIA K40 GPU performs approximately as well as 16 Xeon E5-2687W CPU cores after the code was carefully optimized for the respective hardware in both cases. Since CPU code is more easily maintained and more generally compatible with existing computer hardware, the potential benefit of GPU-adapted code is primarily the lower cost of a high-end GPU compared with a high-end CPU. We chose to focus on optimizing our code for CPU.</p>
</sec>
<sec id="s2">
<title>Results</title>
<sec id="s2a">
<title>Movie alignment and CTF determination</title>
<p>Movie alignment and CTF determination are based on published algorithms previously implemented in Unblur and Summovie (<xref ref-type="bibr" rid="c11">Grant and Grigorieff, 2015b</xref>), and CTFFIND4 (<xref ref-type="bibr" rid="c33">Rohou and Grigorieff, 2015</xref>), respectively, and these are therefore only briefly described here. Unblur determines the translations of individual movie frames necessary to bring features (particles) visible in the frames into register. Each frame is aligned against a sum of all other frames that is iteratively updated until there is no further change in the translations. The trajectories along the x- and y-axes are smoothed using a Savitzky-Golay filter to reduce the possibility of spurious translations. Summovie uses the translations to calculate a final frame average with optional exposure filtering to take into account radiation damage of protein and maximize its signal in the final average. <italic>cis</italic>TEM combines the functionality of Unblur and Summovie into a single panel and exposes all relevant parameters to the user (<xref ref-type="fig" rid="fig1">Figure 1</xref>). Both programs were originally written in Fortran and have been rewritten entirely in C&#x002B;&#x002B;.</p>
<fig id="fig1" position="float" orientation="portrait" fig-type="figure">
<label>Figure 1</label>
<caption><p>Movie alignment panel of the <italic>cis</italic>TEM GUI. All Action panels provide background information on the operation they control, as well as a section with detailed explanations of all user-accessible parameters. All Action panels also have an Expert Options section that exposes additional parameters.</p></caption>
<graphic xlink:href="257618_fig1.tif"/>
</fig>
<p>CTFFIND4 fits a calculated two-dimensional CTF to Thon rings (<xref ref-type="bibr" rid="c46">Thon, 1966</xref>) visible in the power spectrum calculated from either images or movies. The fitted parameters include astigmatism and, optionally, phase shifts generated by phase plates. When computed from movies, the Thon rings are often more clearly visible compared to Thon rings calculated from images (<xref ref-type="fig" rid="fig2">Figure 2</xref>; (<xref ref-type="bibr" rid="c2">Bartesaghi et al., 2014</xref>)). When selecting movies as inputs, the user can specify how many frames should be summed to calculate power spectra. An optimal value to amplify Thon rings would be to sum the number of frames that correspond to an exposure of about 4 electrons/ &#x00C5;<sup>2</sup> (<xref ref-type="bibr" rid="c26">McMullan et al., 2015</xref>).</p>
<fig id="fig2" position="float" orientation="portrait" fig-type="figure">
<label>Figure 2</label>
<caption><p>Thon ring pattern calculated for micrograph &#x201C;0000&#x201D; of the high-resolution dataset of &#x03B2;-galactosidase (<xref ref-type="bibr" rid="c3">Bartesaghi et al., 2015</xref>) used to benchmark <italic>cis</italic>TEM. The left pattern was calculated from the average of aligned frames while the right pattern was calculated using the original movie with 3-frame sub-averages. The pattern calculated using the movie shows significantly stronger rings compared to the other pattern.</p></caption>
<graphic xlink:href="257618_fig2.tif"/>
</fig>
<p>Since our original description of the CTFFFIND4 algorithm (<xref ref-type="bibr" rid="c33">Rohou and Grigorieff, 2015</xref>), several significant changes were introduced. (1) The initial exhaustive search over defocus values can now be performed using a one-dimensional version of the CTF (i.e. with only two parameters: defocus and phase shift) against a radial average of the amplitude spectrum. This search is much faster than the equivalent search over the 2D CTF parameters (i.e., four parameters: two for defocus, one for astigmatism angle and one for phase shift) and can be expected to perform well except in cases of very large astigmatism (<xref ref-type="bibr" rid="c50">Zhang, 2016</xref>). Once an initial estimate of the defocus parameter has been obtained, it is refined by a conjugate gradient minimizer against the 2D amplitude spectrum, as done previously. In <italic>cis</italic>TEM, the default behavior is to perform the initial search over the 1D amplitude spectrum, but the user can revert to previous behavior by setting a flag in the &#x201C;Expert Options&#x201D; of the &#x201C;Find CTF&#x201D; Action panel. (2) If the input micrograph&#x2019;s pixel size is smaller than 1.4 &#x00C5;, the resampling and clipping of its 2D amplitude spectrum will be adjusted so as to give a final spectrum for fitting with an edge corresponding to 1/2.8 &#x00C5;<sup>&#x2212;1</sup>, to avoid all of the Thon rings being located near the origin of the spectrum, where they can be very poorly sampled. (3) The computation of the quality of fit (<italic>CC</italic><sub><italic>fit</italic></sub> in (<xref ref-type="bibr" rid="c33">Rohou and Grigorieff, 2015</xref>)) is now computed over a moving window, similar to (<xref ref-type="bibr" rid="c39">Sheth et al., 2015</xref>), rather than at intervals delimited by nodes in the CTF. (4) Following background subtraction as described in (<xref ref-type="bibr" rid="c27">Mindell and Grigorieff, 2003</xref>), a radial, cosine-edged mask is applied to the spectrum, and this masked version is used during search and refinement of defocus, astigmatism and phase shift parameters. The cosine is 0.0 at the origin, and 1.0 at a radius corresponding to 1/4 &#x00C5;<sup>&#x2212;1</sup>, and serves to emphasize high-resolution Thon rings, which are less susceptible to artefacts caused by imperfect background subtraction. For all outputs from the program (diagnostic image of the amplitude spectrum, 1D plots, etc.), the background-subtracted, but non-masked, version of the amplitude spectrum is used. (5) Users receive a warning if the box size of the amplitude spectrum and the estimated defocus parameters suggest that significant CTF aliasing occurred (<xref ref-type="bibr" rid="c30">Penczek et al., 2014</xref>).</p>
</sec>
<sec id="s2b">
<title>Particle picking</title>
<p>Putative particles are found by matching to a soft-edged disk template. The use of a soft-edged disk template as opposed to structured templates has two main advantages. It greatly speeds up calculation, enabling picking in &#x2018;real time&#x2019;, and alleviates the problem of templates biasing the result of all subsequent processing towards those templates (<xref ref-type="bibr" rid="c16">Henderson, 2013</xref>; <xref ref-type="bibr" rid="c43">Subramaniam, 2013</xref>; van <xref ref-type="bibr" rid="c48">Heel, 2013</xref>). Any bias that is introduced will be towards a featureless &#x201C;blob&#x201D; and will likely be obvious if present.</p>
<p>The picking is performed using an algorithm adapted from (<xref ref-type="bibr" rid="c40">Sigworth, 2004</xref>). Rather than describing it fully, we will emphasize here where we deviated from this algorithm. The user must specify three parameters: the radius of the template disk, the maximum radius of the particle, which sets the minimum distance between picks, and the detection threshold value, given as a number of standard deviations of the (Gaussian) distribution of scores expected if no particles were present in the input micrograph. Values of 1.0 to 6.0 for this threshold generally give acceptable results. All other parameters mentioned below can usually remain set to their default values.</p>
<p>Prior to matched filtering, micrographs are resampled by Fourier cropping to a pixel size of 15 &#x00C5; (the user can override this by changing the &#x201C;Highest resolution used in picking&#x201D; value from its default 30 &#x00C5;), and then filtered with a high-pass cosine-edged aperture to remove very low-frequency density ramps caused by variations in ice thickness.</p>
<p>The background noise spectrum of the micrograph is estimated by computing the average rotational power spectrum of 50 areas devoid of particles, and is then used to &#x201C;whiten&#x201D; the background (shot &#x002B; solvent) noise of the micrograph. Normalization, including CTF effects, and matched filtering are then performed as described (<xref ref-type="bibr" rid="c40">Sigworth, 2004</xref>), except using a single reference image and no principal components&#x2019; decomposition.</p>
<p>One difficulty in estimating the background noise spectrum of the micrograph is to locate areas devoid of particles without a priori knowledge of their locations. Our algorithm first computes a map of the local variance and local mean in the micrograph (computed over the area defined by the maximum radius given by the user (<xref ref-type="bibr" rid="c34">Roseman, 2004</xref>; <xref ref-type="bibr" rid="c47">van Heel, 1982</xref>)) and the distribution of values of these mean and variance maps. The average radial power spectrum of the 50 areas of the micrograph with the lowest local variance is then used as an estimate of the background noise spectrum. Optionally, the user can set a different number of areas to be used for this estimate (for example if the density of particles is very high or very low) or use areas with local variances closest to the mode of the distribution of variances, which may also be expected to be devoid of particles.</p>
<p>Matched-filter methods are susceptible to picking high-contrast features such as contaminating ice crystals or carbon films. (<xref ref-type="bibr" rid="c40">Sigworth, 2004</xref>) suggests subtracting matched references from the extracted boxes and examining the remainder in order to discriminate between real particles and false positives. In the interest of performance, we decided instead to pick using a single artificial reference (disk) and to forgo such subtraction approaches. To avoid picking these kinds of artifacts, the user can choose to ignore areas with abnormal local variance or local mean. We find that ignoring high-variance areas often helps avoid edges of problematic objects, e.g. ice crystals or carbon foils, and that avoiding high- and low-mean areas helps avoid picking from areas within them, e.g. the carbon foil itself or within an ice crystal (<xref ref-type="fig" rid="fig3">Figure 3</xref>). The thresholds used are set to <italic>Mo &#x002B; 2 FWHM</italic> for the variance and &#x00B1; (<italic>Mo &#x002B; 2 FWHM</italic>) for the mean, where <italic>Mo</italic> is the mode and <italic>FWHM</italic> the full width at half-maximum of the distribution of the relevant statistic. For micrographs with additional phase plate phase shifts between 0.1 and 0.9 &#x03C0;, where much higher contrast is expected, the variance threshold is increased to <italic>Mo &#x002B;</italic> 8 <italic>FWHM.</italic> We have found that in favorable cases many erroneous picks can be avoided. Remaining false-positive picks are removed later during 2D classification.</p>
<fig id="fig3" position="float" orientation="portrait" fig-type="figure">
<label>Figure 3</label>
<caption><p>Particle picking panel of the <italic>cis</italic>TEM GUI. The panel shows the preview mode, which allows interactive tuning of the picking parameters for optimal picking. The red circles overlaying the image of the sample indicate candidate particles. The picking algorithm avoids areas of high variance, such as the ice contamination visible in the image.</p></caption>
<graphic xlink:href="257618_fig3.tif"/>
</fig>
<p>Because of our emphasis on performance, our algorithm can be run nearly instantaneously on a typical &#x007E;4K image, using a single processor. In the Action panel, the user is presented with an &#x201C;Auto preview&#x201D; mode to enable interactive adjustment of the picking parameters (<xref ref-type="fig" rid="fig3">Figure 3</xref>). In this mode, the micrograph is displayed with optional and adjustable low-pass and high-pass filters, and the results of picking using the currently selected parameters are overlaid on top. Changing one or more of the parameters leads to a fast re-picking of the displayed micrograph, so that the parameters can be optimized in real-time. Once the three main parameters have been adjusted appropriately, the full complement of input micrographs can be picked, usually in a few seconds or minutes.</p>
<p>A possible disadvantage of using a single disk template exists when the particles to be picked are non-uniform in size or shape (e.g. in the case of an elongated particle). In this case, it may be expected that a single template would have difficulty in picking all the different types and views of particles present, and that in this case using a number of different templates would lead to a more accurate picking. In practice, we found that with careful optimization of the parameters, elongated particles and particles with size variation (<xref ref-type="fig" rid="fig3">Figure 3</xref>) were picked adequately.</p>
<p>The underlying implementation of the algorithm supports multiple references as well as reference rotation. These features may be exposed to the graphical user interface in future versions, for example enabling the use of 2D class averages as picking templates, should the need arise.</p>
</sec>
<sec id="s2c">
<title>2D classification</title>
<p>2D classification is a relatively quick and robust way to assess the quality of a single-particle dataset. <italic>cis</italic>TEM implements a maximum likelihood algorithm (<xref ref-type="bibr" rid="c38">Scheres et al., 2005</xref>) and generates fully CTF-corrected class averages that typically display clear high-resolution detail, such as secondary structure. Integration of the likelihood function is done by evaluating the function at defined angular steps <italic>da</italic> that are calculated according to
<disp-formula id="eqn1"><alternatives><graphic xlink:href="257618_eqn1.gif"/></alternatives></disp-formula>
where <italic>R</italic> is the resolution limit of the data and <italic>D</italic> is the diameter of the particle (twice the mask radius that is applied to the iteratively-refined class averages). <italic>cis</italic>TEM runs a user-defined number of iterations <italic>n</italic> defaulting to 20. To speed up convergence, the resolution limit is adjusted as a function of iteration cycle <italic>l</italic> (0 <italic>&#x2264;l &#x003C;n</italic>):
<disp-formula id="eqn2"><alternatives><graphic xlink:href="257618_eqn2.gif"/></alternatives></disp-formula>
where <italic>R</italic><sub><italic>start</italic></sub> and <italic>R</italic><sub><italic>finiSh</italic></sub> are user-defined resolution limits at the first and last iteration, defaulting to 40 &#x00C5; and 8 &#x00C5;, respectively. The user also sets <italic>K</italic>, the number of classes to calculate. Depending on this number and the number of particles <italic>N</italic> in the dataset, only a percentage <italic>p</italic> of the particles are included in the calculation. These particles are randomly reselected for each iteration and <italic>p</italic> is typically small, for example 0.1, in the first 10 iterations (<italic>p</italic><sub>0-9</sub>), then increases to 0.3 for iteration 10 to 14 (<italic>p</italic><sub>10-14</sub>) and finishes with five iterations including all data (<italic>p</italic><sub>15-19</sub>):
<disp-formula id="eqn3"><alternatives><graphic xlink:href="257618_eqn3.gif"/></alternatives></disp-formula>
<disp-formula><alternatives><graphic xlink:href="257618_ueqn1.gif"/></alternatives></disp-formula></p>
<p>For example, for a dataset containing <italic>N</italic> = 100,000 particles, <italic>p</italic><sub>0-9</sub>= 0.15, i.e. 15&#x0025; of the data will be used to obtain <italic>K</italic> = 50 classes. Apart from speeding up the calculation, the stepwise increase of the resolution limit and the random selection of subsets of the data also reduce the chance of overfitting (see also the calculation of ab-initio 3D reconstructions and 3D refinement below) and, therefore, increase the convergence radius of the 2D classification algorithm.</p>
<p>For the calculation of the likelihood function, the particle images <bold><italic>X</italic></bold><sub><italic>i</italic></sub> are noise-whitened by dividing their Fourier transforms &#x1D4D5;{<bold><italic>X</italic></bold><sub><italic>i</italic></sub>}by the square root of the radially average noise power spectrum, <italic>NPS</italic>:
<disp-formula id="eqn4"><alternatives><graphic xlink:href="257618_eqn4.gif"/></alternatives></disp-formula>
where <bold>g</bold> is the 2D reciprocal space coordinate and <italic>g</italic> = |<bold>g</bold>| its magnitude. The noise power spectrum is calculated from the boxed particle images using the area outside the circular mask set by the user according to the expected particle size. To increase accuracy, it is further averaged across 2000 randomly selected particles. The background (density outside the mask) is further normalized by adding a constant to each particle that yields a background average of zero.</p>
<p>Finally, at the beginning of each iteration, noise features in the class averages <bold><italic>A</italic></bold><sub><italic>i</italic></sub> are suppressed by resetting negative values below a threshold <italic>t</italic><sub><italic>i</italic></sub> to the threshold:
<disp-formula id="eqn5"><alternatives><graphic xlink:href="257618_eqn5.gif"/></alternatives></disp-formula>
where <italic>j</italic> runs over all pixels in average <bold>A</bold><sub><italic>i</italic></sub>.</p>
</sec>
<sec id="s2d">
<title>3D refinement (FrealignX)</title>
<p>The refinement of 3D reconstructions in cisTEM uses a version of Frealign (<xref ref-type="bibr" rid="c21">Lyumkis et al., 2013</xref>) that was specifically designed to work with cisTEM. Most of Frealign&#x2019;s control parameters are exposed to the user in the &#x201C;Manual Refine&#x201D; Action panel (<xref ref-type="fig" rid="fig4">Figure 4</xref>). The &#x201C;Auto Refine&#x201D; and &#x201C;Ab-Initio&#x201D; panels also use Frealign but manage many of the parameters automatically (see below). Frealign&#x2019;s algorithm was described previously (<xref ref-type="bibr" rid="c13">Grigorieff, 2007</xref>; <xref ref-type="bibr" rid="c21">Lyumkis et al., 2013</xref>) and this section will mostly cover important differences, including a new objective function used in the refinement, different particle weighting used in reconstructions, optional likelihood-based blurring, as well as new masking options.</p>
<fig id="fig4" position="float" orientation="portrait" fig-type="figure">
<label>Figure 4</label>
<caption><p>Manual refinement panel with Expert Options exposed. Most of the parameters needed to run FrealignX can be accessed on this panel. The panel also allows application of a 3D mask, which can be imported as a Volume Asset.</p></caption>
<graphic xlink:href="257618_fig4.tif"/>
</fig>
<sec id="s2d1">
<title>Matched filter</title>
<p>To make Frealign compatible with <italic>cis</italic>TEM&#x2019;s GUI, the code was completely rewritten in C&#x002B;&#x002B;, and it will be referred to here as Frealign v10, or FrealignX. The new version makes use of a matched filter (<xref ref-type="bibr" rid="c24">McDonough and Whalen, 1995</xref>) to maximize the signal in cross correlation maps calculated between particle images and reference projections. This requires whitening of the noise present in the images and resolution-dependent scaling of the reference projections to match the signal in the noise-whitened images. Both can be achieved if the spectral signal-to-noise ratio (SSNR) of the data is known. As part of a 3D reconstruction, Frealign calculates the resolution-dependent <italic>PSSNR</italic>, the radially averaged SSNR present in the particle images before they are affected by the CTF (<xref ref-type="bibr" rid="c41">Sindelar and Grigorieff, 2012</xref>). Using <italic>PSSNR</italic> and the CTF determined for a particle, the SSNR in the particle image can be calculated as
<disp-formula id="eqn6"><alternatives><graphic xlink:href="257618_eqn6.gif"/></alternatives></disp-formula>
(as before, <bold>g</bold> is the 2D reciprocal space coordinate and <italic>g</italic> = |<bold>g</bold>|). Here, <italic>SNR</italic> is defined as the ratio of the variance of the signal and the noise. The Fourier transform <inline-formula><alternatives><inline-graphic xlink:href="257618_inline1.gif"/></alternatives></inline-formula> of the noise-whitened particle image <inline-formula><alternatives><inline-graphic xlink:href="257618_inline2.gif"/></alternatives></inline-formula> can then be calculated as
<disp-formula id="eqn7"><alternatives><graphic xlink:href="257618_eqn7.gif"/></alternatives></disp-formula>
where &#x1D4D5;{<bold><italic>X</italic></bold><sub><italic>i</italic></sub>} is the Fourier transform of the original image <bold><italic>X</italic></bold><sub><italic>i</italic></sub> | <bold><italic>&#x00B7;</italic></bold> | is the absolute value, and <inline-formula><alternatives><inline-graphic xlink:href="257618_inline3.gif"/></alternatives></inline-formula> is the radially averaged spectrum of the squared 2D Fourier transform amplitudes of image <bold><italic>X</italic></bold><sub><italic>i</italic></sub>. To implement <xref ref-type="disp-formula" rid="eqn7">Eq. (7</xref>), a particle image is first divided by its amplitude spectrum, which includes power from both signal and noise, and then multiplied by a term that amplifies the image amplitudes according to the signal strength in the image. The reference projection <bold>A</bold><sub><italic>i</italic></sub> can be matched by calculating
<disp-formula id="eqn8"><alternatives><graphic xlink:href="257618_eqn8.gif"/></alternatives></disp-formula></p>
<p><xref ref-type="disp-formula" rid="eqn8">Eq. (8</xref>) scales the variance of the signal in the reference to be proportional to the measured signal-to-noise ratio in the noise-whitened images. The main term in the objective function <italic>O</italic>(&#x03C6;) maximized in FrealignX is therefore given by the cross-correlation function
<disp-formula id="eqn9a"><alternatives><graphic xlink:href="257618_eqn9a.gif"/></alternatives></disp-formula>
where <italic>&#x03C6;</italic> is a set of parameters describing the particle view, x,y position, magnification and defocus, <italic>Re</italic>(&#x00B7;) is the real part of a complex number, || &#x00B7; || is the Euclidean norm, i.e. the square root of the sum of the squared pixel values, and &#x1D4D5;<sub><italic>R1,R3</italic></sub>{&#x00B7;}&#x002A; is the conjugate complex value of the Fourier transform &#x1D4D5;<sub><italic>R1,R3</italic></sub>{&#x00B7;}. The subscripts <italic>R1</italic> and <italic>R3</italic> specify the low- and high-resolution limits of the Fourier transforms included in the calculation of Eq. (9a), as specified by the user. To reduce noise overfitting, the user has the option to specify also a resolution range in which the absolute value of the cross terms in the numerator of Eq. (9a) are used (<xref ref-type="bibr" rid="c42">Stewart and Grigorieff, 2004</xref>), instead of the signed values (option &#x201C;Signed CC Resolution Limit&#x201D; under &#x201C;Expert Options&#x201D; in the &#x201C;Manual Refine&#x201D; Action panel). In this case
<disp-formula id="eqn9b"><alternatives><graphic xlink:href="257618_eqn9b.gif"/></alternatives></disp-formula>
where <italic>R2</italic> is specified by the &#x201C;Signed CC Resolution Limit.&#x201D; The objective function also includes a term <italic>R (&#x03C6;</italic> |&#x0398;) to restrain alignment parameters (<xref ref-type="bibr" rid="c4">Chen et al., 2009</xref>; <xref ref-type="bibr" rid="c21">Lyumkis et al., 2013</xref>; <xref ref-type="bibr" rid="c40">Sigworth, 2004</xref>), which currently only includes the x,y positions:
<disp-formula id="eqn10"><alternatives><graphic xlink:href="257618_eqn10.gif"/></alternatives></disp-formula>
where <italic>&#x03C3;</italic> is the standard deviation of the noise in the particle image and &#x0398; represents a set of model parameters including the average particle positions in a dataset <inline-formula><alternatives><inline-graphic xlink:href="257618_inline4.gif"/></alternatives></inline-formula> and <inline-formula><alternatives><inline-graphic xlink:href="257618_inline5.gif"/></alternatives></inline-formula>, and the standard deviations of the x,y positions from the average values, <italic>&#x03C3;</italic><sub><italic>&#x03C7;</italic></sub> and <italic>&#x03C3;</italic><sub><italic>y</italic></sub>, and <italic>M</italic> is the number of pixels in the mask applied to the particle before alignment. The complete objective function is therefore
<disp-formula id="eqn11"><alternatives><graphic xlink:href="257618_eqn11.gif"/></alternatives></disp-formula></p>
<p>The maximized values determined in a refinement are converted to particle scores by multiplication with 100.</p>
</sec>
<sec id="s2d2">
<title>CTF refinement</title>
<p>FrealignX can refine the defocus assigned to each particle. This may be useful when particles have a size of about 400 kDa or larger. Depending on the quality of the sample and images, these particles may generate sufficient signal to yield per-particle defocus values that are more accurate than the average defocus values determined for whole micrographs by CTFFIND4 (see above). Refinement is achieved by a simple one-dimensional grid search of a defocus offset applied to both defocus values determined in the 2D CTF fit obtained by CTFFIND4. FrealignX applies this offset to the starting values in a refinement, typically determined by CTFFIND4, and evaluates the objective function, <xref ref-type="disp-formula" rid="eqn11">Eq. (11</xref>), for each offset. The offset yielding the maximum is then used to assign refined defocus values. In a typical refinement, the defocus offset is searched in steps of 50 &#x00C5;, in a range of &#x00B1; 500 &#x00C5;. In the case of &#x03B2;-galactosidase (see below), a single round of defocus refinement changed the defocus on average by 60 &#x00C5;; the RMS change was 80 &#x00C5;. The refinement produced a marginal improvement of 0.05 &#x00C5; in the Fourier Shell Correlation (FSC) threshold of 0.143, suggesting that the defocus values determined by CTFFIND4 were already close to optimal. In a different dataset of rotavirus double layered particles, a single round of defocus refinement changed the defocus on average by 160 &#x00C5;; the RMS change was 220 &#x00C5;. In this case the refinement increased the resolution from &#x007E;3.0 &#x00C5; to &#x007E;2.8 &#x00C5;.</p>
</sec>
<sec id="s2d3">
<title>Masking</title>
<p>FrealignX has a 3D masking function to help in the refinement of structures that contain significant disordered regions, such as micelles in detergent-solubilized membrane proteins. To apply a 3D mask, the user supplies a 3D map that will be binarized by setting to zero all voxel values less than or equal to zero, and all others to 1 to indicate that they are inside the masked region. A soft cosine-shaped falloff of specified width (e.g. 10 &#x00C2;) is then applied to soften the edge of the masked region and avoid sharp edges when the mask is applied to a 3D reconstruction. Voxels of the masked reconstruction that fall outside the mask can be set to zero, or to a low-pass filtered version of the original density, optionally downweighted by multiplication by a scaling factor set by the user. At the edge of the mask, the low-pass filtered density is blended with the unfiltered density inside the mask to produce a smooth transition. <xref ref-type="fig" rid="fig5">Figure 5</xref> shows the result of masking the reconstruction of an ABC transporter associated with antigen processing (TAP, (<xref ref-type="bibr" rid="c29">Oldham et al., 2016</xref>)). The mask was designed to contain only density corresponding to protein and the outside density was low-pass filtered at 30 &#x00C5; resolution and kept with a weight of 100&#x0025; in the final masked reconstruction. The combination of masking and low-pass filtering in this case keeps a low-pass filtered version of the density outside the mask in the reconstruction, including the detergent micelle. Detergent micelles can be a source of noise in the particle images because the density represents disordered material. However, at low, 20 to 30 &#x00C5; resolution, micelles generate features in the images that can help in the alignment of the particles. In the case of TAP, this masking helped obtain a reconstruction at 4 &#x00C5; resolution (<xref ref-type="bibr" rid="c29">Oldham et al., 2016</xref>).</p>
<fig id="fig5" position="float" orientation="portrait" fig-type="figure">
<label>Figure 5</label>
<caption><p>3D masking with low-pass filtering outside the mask. A) Orthogonal sections through the 3D reconstruction of the transporter associated with antigen processing (TAP), an ABC transporter (<xref ref-type="bibr" rid="c29">Oldham et al., 2016</xref>). Density corresponding to the protein, as well as the detergent micelle (n-Dodecyl b-D-maltoside; highlighted with arrows), is visible. B) Orthogonal sections through a 3D mask corresponding to the sections shown in A). The sharp edges of this mask are smoothed before the mask is applied to the map. C) Orthogonal sections through the masked 3D reconstruction. The regions outside the mask are low-pass filtered at 30 &#x00C2; resolution to remove high-resolution noise from the disordered detergent micelle, but keeping its low-resolution signal to help particle alignment.</p></caption>
<graphic xlink:href="257618_fig5.tif"/>
</fig>
</sec>
<sec id="s2d4">
<title>3D reconstruction</title>
<p>In Frealign, a 3D reconstruction <bold><italic>V</italic></bold><sub><italic>k</italic></sub> of class average <italic>k</italic> and containing <italic>N</italic> images is calculated as (<xref ref-type="bibr" rid="c21">Lyumkis et al., 2013</xref>; <xref ref-type="bibr" rid="c41">Sindelar and Grigorieff, 2012</xref>)
<disp-formula id="eqn12"><alternatives><graphic xlink:href="257618_eqn12.gif"/></alternatives></disp-formula>
where <italic>q</italic><sub><italic>ik</italic></sub> is the probability of particle <italic>i</italic> belonging to class <italic>k, &#x03C3;</italic><sub><italic>i</italic></sub> is the standard deviation of the noise in particle image <italic>i, &#x03C6;</italic><sub><italic>i</italic></sub> are its alignment parameters, <italic>w</italic><sub><italic>ik</italic></sub> the score-based weights (<xref ref-type="disp-formula" rid="eqn14">Eq. (14</xref>), see below), CTF<sub><italic>i</italic></sub> the CTF of the particle image, &#x1D4E1;(<italic>&#x03C6;</italic><sub><italic>i</italic></sub>,&#x00B7;) the reconstruction operator merging data into a 3D volume according to alignment parameters <italic>&#x03C6;</italic><sub><italic>i</italic></sub>, <italic>PSSNR</italic> the radially averaged particle SSNR derived from the FSC between half-maps (<xref ref-type="bibr" rid="c41">Sindelar and Grigorieff, 2012</xref>), <inline-formula><alternatives><inline-graphic xlink:href="257618_inline6.gif"/></alternatives></inline-formula> noise-whitened image <italic>i</italic>, and &#x1D4D5;<sup>&#x2212;1</sup>{<italic>&#x00B7;</italic>} the inverse Fourier transform. For the calculation of the 3D reconstructions, as well as 3D classification (see below) the particle images are not whitened according to <xref ref-type="disp-formula" rid="eqn7">Eq. (7)</xref>. Instead, they are whitened using the radially- and particle-averaged power spectrum of the background around the particles:
<disp-formula id="eqn13"><alternatives><graphic xlink:href="257618_eqn13.gif"/></alternatives></disp-formula>
where <italic>B</italic>(<bold>X</bold><sub><italic>i</italic></sub>) is a masked version of image <bold>X</bold><sub><italic>i</italic></sub> with the area inside a circular mask centered on the particle replaced with the average values at the edge of the mask, and scaled variance to produce an average pixel variance of 1 in the whitened image <inline-formula><alternatives><inline-graphic xlink:href="257618_inline7.gif"/></alternatives></inline-formula>. Using the procedure in <xref ref-type="disp-formula" rid="eqn13">Eq. (13</xref>) has the advantage that whitening does not depend on the knowledge of the SSNR of the data, and reconstructions can therefore be calculated even when the SSNR is not known.</p>
</sec>
<sec id="s2d5">
<title>Score-based weighting</title>
<p>In previous versions of Frealign, resolution-dependent weighting was applied to the particle images during reconstruction (the Frealign parameter was called &#x201C;PBC&#x201D;, (<xref ref-type="bibr" rid="c13">Grigorieff, 2007</xref>)). The weighting function took the form of a B-factor dependent exponential that attenuates the image data at higher resolution. FrealignX still uses B-factor weighting but the weighting function is now derived from the particle scores (see above) as
<disp-formula id="eqn14"><alternatives><graphic xlink:href="257618_eqn14.gif"/></alternatives></disp-formula></p>
<p><italic>BSC</italic> converts the difference between a particle score and the average particle score, <inline-formula><alternatives><inline-graphic xlink:href="257618_inline8.gif"/></alternatives></inline-formula>, into a B-factor. Setting <italic>BSC</italic> to zero will turn off score-based particle weighting. Typical values for <italic>BSC</italic> that produce reasonable discrimination between high-scoring and low-scoring particles are between 2 and 10 &#x00C5;<sup>2</sup>.</p>
</sec>
<sec id="s2d6">
<title>3D Classification</title>
<p>FrealignX uses a maximum-likelihood approach for 3D classification (<xref ref-type="bibr" rid="c21">Lyumkis et al., 2013</xref>). Assuming that all images were noise-whitened according to <xref ref-type="disp-formula" rid="eqn13">Eq. (13</xref>), which scales the variance of each image such that the average standard deviation of the noise in a pixel is 1, the probability density function (PDF) of observing image <bold>X</bold><sub><italic>i</italic></sub>, given alignment parameters <italic>&#x03C6;</italic><sub><italic>i</italic></sub> and reconstruction <bold><italic>V</italic></bold><sub><italic>k</italic></sub>, is calculated as (<xref ref-type="bibr" rid="c21">Lyumkis et al., 2013</xref>)
<disp-formula id="eqn15"><alternatives><graphic xlink:href="257618_eqn15.gif"/></alternatives></disp-formula></p>
<p>As before, <italic>&#x03C6;</italic><sub><italic>ik</italic></sub> are the alignment parameters (usually just Euler angles and x,y shifts) determined for image <italic>i</italic> with respect to class average <italic>k,&#x2118;</italic> is the projection operator producing an aligned 2D projection of reconstruction <bold><italic>V</italic></bold><sub><italic>k</italic></sub> according to parameters <inline-formula><alternatives><inline-graphic xlink:href="257618_inline9.gif"/></alternatives></inline-formula> is the sum of the squared pixel value differences between whitened image <inline-formula><alternatives><inline-graphic xlink:href="257618_inline10.gif"/></alternatives></inline-formula> and the reference projection inside a circular mask defining the area of the particle with user-defined diameter, <inline-formula><alternatives><inline-graphic xlink:href="257618_inline11.gif"/></alternatives></inline-formula> is the number of pixels inside this mask, and <inline-formula><alternatives><inline-graphic xlink:href="257618_inline12.gif"/></alternatives></inline-formula> is a hierarchical prior describing the probability of observing alignment parameters <italic>&#x03C6;</italic><sub><italic>ik</italic></sub> given model parameters <italic>&#x0398;</italic><sub><italic>k</italic></sub> (see <xref ref-type="disp-formula" rid="eqn10">Eq. (10</xref>)). Given the joint probability, <xref ref-type="disp-formula" rid="eqn15">Eq. (15</xref>), determined in a refinement, the probability <italic>q</italic><sub><italic>ik</italic></sub> of particle <italic>i</italic> belonging to class <italic>k</italic> can be updated as (<xref ref-type="bibr" rid="c21">Lyumkis et al., 2013</xref>)
<disp-formula id="eqn16"><alternatives><graphic xlink:href="257618_eqn16.gif"/></alternatives></disp-formula>
where the summation in the denominator is taken over all classes and the average probabilities <italic>&#x03C0;</italic><sub><italic>k</italic></sub> for a particle to belong to class <italic>k</italic> are given by the average values of <italic>q</italic><sub><italic>ik</italic></sub> determined in a prior iteration, calculated for the entire dataset of <italic>N</italic> particles:
<disp-formula id="eqn17"><alternatives><graphic xlink:href="257618_eqn17.gif"/></alternatives></disp-formula></p>
<p>An example of 3D classification is shown in <xref ref-type="fig" rid="fig6">Figure 6</xref> for F1Fo-ATPase, revealing different conformational states of the &#x03B3; subunit (<xref ref-type="bibr" rid="c51">Zhou et al., 2015</xref>).</p>
<fig id="fig6" position="float" orientation="portrait" fig-type="figure">
<label>Figure 6</label>
<caption><p>3D classification of a dataset of F1Fo-ATPase, revealing different conformational states (<xref ref-type="bibr" rid="c51">Zhou et al., 2015</xref>). Sections through the F1 domain showing the &#x03B3; subunit (arrows) in three different states related by 120&#x00B0; rotations are shown on the left. A surface rendering of the map corresponding to State 1a is shown on the right. Scale bars, 25 &#x00C5;.</p></caption>
<graphic xlink:href="257618_fig6.tif"/>
</fig>
</sec>
<sec id="s2d7">
<title>Focused classification</title>
<p>3D classification can be improved by focusing on conformationally- or compositionally-variable regions of the map. To achieve this, a mask is applied to the particle images and reference projections, the area of which is defined as the projection of a sphere with user-specified center (within the 3D reconstruction) and radius. This 2D mask is therefore defined independently for each particle, as a function of its orientation. When using focused classification, <inline-formula><alternatives><inline-graphic xlink:href="257618_inline13.gif"/></alternatives></inline-formula> in <xref ref-type="disp-formula" rid="eqn15">Eq. (15</xref>) is adjusted to the number of pixels inside the projected mask and the sum of the squared pixel value differences in <xref ref-type="disp-formula" rid="eqn15">Eq. (15</xref>) is limited to the area of the 2D mask. By applying the same mask to image and reference, only variability inside the masked region is used for 3D classification. Other regions of the map are ignored, leading to a &#x201C;focusing&#x201D; on the region of interest. The focused mask also excludes noise contained in the particle images outside the mask and therefore improves classification results that often depend on detecting small differences between particles and references. A typical application of a focused mask is in the classification of ribosome complexes that may exhibit localized conformational and/or compositional variability, for example the variable conformations of an IRES (<xref ref-type="bibr" rid="c1">Abeyrathne et al., 2016</xref>) or different states of tRNA accommodation (<xref ref-type="bibr" rid="c20">Loveland et al., 2017</xref>).</p>
</sec>
<sec id="s2d8">
<title>Likelihood-based blurring</title>
<p>In some cases, the convergence radius of refinement can be improved by blurring the reconstruction according to a likelihood function. This procedure is similar to the maximization step in a maximum likelihood approach (<xref ref-type="bibr" rid="c36">Scheres, 2012</xref>). The likelihood-blurred reconstruction is given by
<disp-formula id="eqn18"><alternatives><graphic xlink:href="257618_eqn18.gif"/></alternatives></disp-formula>
where, in the case of FrealignX, <italic>&#x03C6;</italic><sub><italic>axy</italic></sub> only includes the x,y particle positions and in-plane rotation angle &#x03B1;, which are a subset of the alignment parameters <italic>&#x03C6;</italic><sub>i</sub>, and <inline-formula><alternatives><inline-graphic xlink:href="257618_inline14.gif"/></alternatives></inline-formula> is the reconstruction from an earlier refinement iteration. As before, <inline-formula><alternatives><inline-graphic xlink:href="257618_inline15.gif"/></alternatives></inline-formula> is the probability of observing image <italic>i</italic>, given alignment parameters <italic>&#x03C6;</italic><sub><italic>i</italic></sub> and reconstruction <inline-formula><alternatives><inline-graphic xlink:href="257618_inline16.gif"/></alternatives></inline-formula>. Integration over these three parameters can be efficiently implemented and, therefore, does not produce a significant additional computational burden.</p>
</sec>
<sec id="s2d9">
<title>Resolution assessment</title>
<p>The resolution of reconstructions generated by FrealignX is assessed using the FSC criterion (<xref ref-type="bibr" rid="c15">Harauz and van Heel, 1986</xref>). FSC curves in <italic>cis</italic>TEM are calculated using two reconstructions (&#x201C;half-maps&#x201D;) calculated either from the even-numbered and odd-numbered particles, or by dividing the dataset into 100 equal subsets and using the even- and odd-numbered subsets to calculate the two reconstructions (in the c/sTEM GUI, the latter is always used). The latter method has the advantage that accidental duplication of particles in a stack is less likely to affect the FSC calculation. All particles are refined against a single reference and, therefore, the calculated FSC values may be biased towards higher values (<xref ref-type="bibr" rid="c12">Grigorieff, 2000</xref>; <xref ref-type="bibr" rid="c42">Stewart and Grigorieff, 2004</xref>). This bias extends slightly beyond the resolution limit imposed during refinement, by approximately <italic>2/D</italic><sub><italic>mask</italic></sub>, where <italic>D</italic><sub><italic>mask</italic></sub> is the mask radius used to mask the reconstructions (see above). During auto-refinement (see below), the resolution limit imposed during refinement is carefully adjusted to stay well below the estimated resolution of the reconstruction and the resolution estimate is therefore unbiased (<xref ref-type="bibr" rid="c37">Scheres and Chen, 2012</xref>). However, users have full control over all parameters during manual refinement and will have to make sure that they do not bias the resolution estimate by choosing a resolution limit that is close to, or higher than, the estimated resolution of the final reconstruction. Calculated FSC curves are smoothed using a Savitzky-Golay cubic polynomial that reduces the noise often affecting FSC curves at the high-resolution end.</p>
<p>The FSC calculated between two density maps is dependent on the amount of solvent included inside the mask applied to the maps. A larger mask that includes more solvent background will yield lower FSC values than a tighter mask. To obtain an accurate resolution estimate in the region of the particle density, one possibility is to apply a tight mask that closely follows the boundary of the particle. This approach bears the risk of generating artifacts because the particle boundary is not always well defined, especially when the particle includes disordered domains that generate weak density in the reconstruction. The approach in Frealign avoids tight masking and instead calculates an FSC curve using generously masked density maps, corrected for the solvent content inside the mask (<xref ref-type="bibr" rid="c41">Sindelar and Grigorieff, 2012</xref>). The corrected FSC curve is referred to as <italic>Part_FSC</italic> and is calculated from the uncorrected <italic>FSC</italic><sub><italic>uncor</italic></sub> as (<xref ref-type="bibr" rid="c29">Oldham et al., 2016</xref>)
<disp-formula id="eqn19"><alternatives><graphic xlink:href="257618_eqn19.gif"/></alternatives></disp-formula>
where <italic>f</italic> is the ratio of mask volume to estimated particle volume. The particle volume can be estimated from its molecular mass <italic>M</italic><sub><italic>w</italic></sub> as <inline-formula><alternatives><inline-graphic xlink:href="257618_inline17.gif"/></alternatives></inline-formula> (<xref ref-type="bibr" rid="c23">Matthews, 1968</xref>). <xref ref-type="disp-formula" rid="eqn19">Eq. (19</xref>) assumes that both maps have similar SSNR values, as is normally the case for the two reconstructions calculated from two halves of the dataset, indicated by the subscript <italic>half &#x2014; maps.</italic> If one of the maps does not contain noise from solvent background, for example when calculating the FSC between a reconstruction and a map derived from an atomic model, the solvent-corrected FSC is given as
<disp-formula id="eqn20"><alternatives><graphic xlink:href="257618_eqn20.gif"/></alternatives></disp-formula></p>
</sec>
<sec id="s2d10">
<title>Speed optimization</title>
<p>FrealignX has been optimized for execution on multiple CPU cores. Apart from using optimized library functions for FFT calculation and vector multiplication (Intel Math Kernel Library), the processing speed is also increased by on-the-fly cropping in real and reciprocal space of particle images and 3D reference maps. Real-space cropping reduces the interpolation accuracy in reciprocal space and is therefore limited to global parameter searches that do not require the highest accuracy in the calculation of search projections. Reciprocal-space cropping is used whenever a resolution limit is specified by the user or in an automated refinement (ab-initio 3D reconstruction and auto-refinement). For the calculation of in-plane rotated references, reciprocal-space padding is used to increase the image size four-fold, allowing fast nearest-neighbor resampling in real space with sufficient accuracy to produce rotated images with high fidelity.</p>
</sec>
</sec>
<sec id="s2e">
<title>Ab-initio 3D reconstruction</title>
<p>Ab-initio reconstruction offers a convenient way to proceed from single particle images to a 3D structure when a suitable reference is not available to initialize 3D reconstruction and refinement. Different ab-initio methods have been described (<xref ref-type="bibr" rid="c17">Hohn et al., 2007</xref>; <xref ref-type="bibr" rid="c31">Punjani et al., 2017</xref>; <xref ref-type="bibr" rid="c32">Reboul et al., 2018</xref>) and <italic>cis</italic>TEM&#x2019;s implementation follows a strategy published originally by (<xref ref-type="bibr" rid="c14">Grigorieff, 2016</xref>). It is based on the premise that iterative refinement of a reconstruction initialized with random angular parameters is likely to converge on the correct structure if overfitting is avoided and the refinement proceeds in small steps to reduce the chance of premature convergence onto an incorrect structure. The procedure is implemented as part of <italic>cis</italic>TEM&#x2019;s GUI and uses FrealignX to perform the refinements and reconstructions.</p>
<p>After initialization with random angles, <italic>cis</italic>TEM performs a user-specified number of global alignment parameter searches, recalculating the reconstruction after each search and applying an automatic masking procedure to it before the next global search. Similar to 2D classification (see above), only a randomly selected subset of the data is used in each iteration and the resolution limit applied during the search is increased with every iteration. The number of iterations <italic>n</italic> defaults to 40, the starting and final resolution limits <italic>R</italic><sub><italic>start</italic></sub> and <italic>R</italic><sub><italic>finiSh</italic></sub> default to 20 &#x00C5; and 8 &#x00C5;, respectively, and the starting and final percentage of included particles in the reconstruction, <italic>P</italic><sub><italic>start</italic></sub> and <italic>P</italic><sub><italic>finiSh</italic></sub> default to <italic>2500K/N</italic> and <italic>10,000K/N</italic>, respectively (results larger than 1 are reset to 1), with <italic>K</italic> the number of 3D classes to be calculated as specified by the user, and <italic>N</italic> the number of particles in the dataset. If symmetry is being applied, <italic>N</italic> is replaced by <italic>NO</italic><sub><italic>sym</italic></sub> where <italic>O</italic><sub><italic>sym</italic></sub> is the number of asymmetric units present in one particle. The resolution limit is then updated in each iteration <italic>I</italic> as in <xref ref-type="disp-formula" rid="eqn2">Eq. (2</xref>), and the percentage is updated as
<disp-formula id="eqn21"><alternatives><graphic xlink:href="257618_eqn21.gif"/></alternatives></disp-formula>
again resetting results larger than 1 to 1. <italic>cis</italic>TEM actually performs a global search for a percentage <italic>3p</italic> of the particle stack, i.e. three times as many particles as are included in the reconstructions for each iteration. The particles included in the reconstructions are then chosen to be those with the highest scores as calculated by FrealignX.</p>
<p>The global alignment parameters are performed using the &#x201C;general&#x201D; FrealignX procedure with the following changes. Firstly, the <italic>PSSNR</italic> is not directly estimated from the FSC calculated at each round. Instead, for the first 3 iterations, a default <italic>PSSNR</italic> is calculated based on the molecular weight. From the 4<sup>th</sup> iteration onwards, the <italic>PSSNR</italic> is calculated from the FSC, however if the calculated <italic>PSSNR</italic> is higher than the default <italic>PSSNR</italic>, the default <italic>PSSNR</italic> is taken instead. This is done in order to avoid some of the overfitting that will occur during the refinements. Secondly, during a normal global search the top <italic>h</italic> (where <italic>h</italic> defaults to 20) results of the grid search are locally refined, and the best locally refined result is taken. In the ab-initio procedure, however, the result of the global search for a given particle image is taken randomly from all results that have a score which lies in the top 15&#x0025; of the difference between the worst score and the best score.</p>
<p>During the reconstruction steps, the calculated <italic>&#x03C3;</italic> for each particle is reset to 1 prior to 3D reconstruction and score weighting is disabled. This is done because the <italic>&#x03C3;</italic> and score values are not meaningful until an approximately correct solution is obtained.</p>
<p>The reconstructions are automatically masked before each new refinement iteration to suppress noise features that could otherwise be amplified in subsequent iterations. The same masking procedure is also applied during auto-refinement (see below). It starts by calculating the density average <inline-formula><alternatives><inline-graphic xlink:href="257618_inline18.gif"/></alternatives></inline-formula> of the reconstruction and resetting all voxel values below <inline-formula><alternatives><inline-graphic xlink:href="257618_inline19.gif"/></alternatives></inline-formula> to <inline-formula><alternatives><inline-graphic xlink:href="257618_inline20.gif"/></alternatives></inline-formula>. This thresholded reconstruction is then low-pass filtered at 50 &#x00C5; resolution and turned into a binary mask by setting densities equal or below a given threshold <italic>t</italic> to zero and all others to 1. The threshold is calculated as
<disp-formula id="eqn22"><alternatives><graphic xlink:href="257618_eqn22.gif"/></alternatives></disp-formula>
where <inline-formula><alternatives><inline-graphic xlink:href="257618_inline21.gif"/></alternatives></inline-formula> is the density average of the low-pass filtered map and <inline-formula><alternatives><inline-graphic xlink:href="257618_inline22.gif"/></alternatives></inline-formula> is the average of the 500 highest values in the filtered map. The largest contiguous volume in this binarized map is then identified and used as a mask for the original thresholded reconstruction, such that all voxels outside of this mask will be set to <inline-formula><alternatives><inline-graphic xlink:href="257618_inline23.gif"/></alternatives></inline-formula>. Finally, a spherical mask, centered in the reconstruction box, is applied by resetting all densities outside the mask to zero.</p>
<p>The user has the option to repeat the ab-initio procedure multiple times using the result from the previous run as the starting map in each new run, to increase the convergence radius if necessary. In the case of symmetric particles, the default behavior is to perform the first 2/3<sup>rds</sup> of the iterations without applying symmetry. The non-symmetrized map is then aligned to the expected symmetry axes and the final 1/3<sup>rd</sup> of the iterations are carried out with the symmetry applied. This default behavior can be changed by the user such that symmetry is always applied, or is never applied.</p>
<p>Alignment of the model to the symmetry axes is achieved using the following process. First, 3 direction are chosen. These directions are kept constant through the rest of the process. Next, a brute force grid search over rotations around the x, y and z axes is set up. At each position on the grid the 3D map is rotated using the current x, y and z parameters, and then its projection along the 1<sup>st</sup> direction is calculated. The symmetry-related projections for this direction are then calculated, and for each one a cross-correlation map is calculated using the original projection as a reference, and the peak within this map is found. This process is then repeated for the other 2 directions and the sum of all of the peak heights across all directions is calculated. The x,y,z rotations that result in the largest sum of all peaks is taken as the final rotation result. Shifts for this rotation are then calculated based on the found 2D x,y shifts between the initial and symmetry related projections, with the z shift being set to 0 for C symmetries. The symmetry alignment is also included as a command-line program, which can be used to align a volume to the symmetry axis when the ab-initio is carried out in C1 only, or when using a reference obtained by some other means.</p>
</sec>
<sec id="s2f">
<title>Automatic refinement</title>
<p>Like ab-initio 3D reconstruction, auto-refinement makes use of randomly selected subsets of the data and of increasing resolution limit as refinement proceeds. However, unlike the ab-initio procedure, the percentage of particles <italic>p</italic><sub><italic>l</italic></sub> and the resolution limit <italic>R</italic><sub><italic>l</italic></sub> used in iteration <italic>l</italic> depend on the resolution of the reconstructions estimated on iteration <italic>l &#x2014; 1.</italic> When the estimated resolution improved in the previous cycle,
<disp-formula id="eqn23"><alternatives><graphic xlink:href="257618_eqn23.gif"/></alternatives></disp-formula>
with
<disp-formula id="eqn24"><alternatives><graphic xlink:href="257618_eqn24.gif"/></alternatives></disp-formula>
where <italic>K</italic> is the number of 3D classes to be calculated and <italic>N</italic> the number of particles in the dataset. As before, if the particle has symmetry, <italic>N</italic> is replaced by <italic>NO</italic><sub><italic>sym</italic></sub> where <italic>O</italic><sub><italic>sym</italic></sub> is the number of asymmetric units present in one particle. If the calculated <italic>p</italic><sub><italic>l</italic></sub> exceeds 1, it is reset to 1. The resolution limit is estimated as
<disp-formula id="eqn25"><alternatives><graphic xlink:href="257618_eqn25.gif"/></alternatives></disp-formula>
where <italic>FSC</italic><sub>0.5</sub> is the point at which the FSC, unadjusted for the solvent within the mask (see above) crosses the 0.5 threshold and <italic>D</italic><sub><italic>mask</italic></sub> is the user-specified diameter of the spherical mask applied to the 3D reference at the beginning of each iteration, and to the half-maps used to calculate the FSC. The term <italic>2/D</italic><sub><italic>mask</italic></sub> accounts for correlations between the two half-maps due to the masking (see above). When the resolution did not improve in the previous iteration,
<disp-formula id="eqn26"><alternatives><graphic xlink:href="257618_eqn26.gif"/></alternatives></disp-formula>
(reset to 1 if resulting in a value larger than 1). At least five refinement iterations are run and refinement stops when <italic>p</italic><sub><italic>l</italic></sub> reaches 1 (all particles are included) and there was no improvement in the estimated resolution for the last three iterations.</p>
<p>If multiple classes are refined, the resolution limit in <xref ref-type="disp-formula" rid="eqn25">Eq. (25</xref>) is set independently for each class, however the highest resolution used for classification is fixed at 8 &#x00C5;. At least nine iterations are run and refinement stops when <italic>p</italic><sub><italic>l</italic></sub> reaches 1, the average change in the particle occupancy in the last cycle was 1&#x0025; or less, and there was no improvement in the estimated resolution for the last three iterations.</p>
<p>In a similar manner to the ab-initio procedure, <italic>&#x03C3;</italic> values for each particle are set to 1 and score weighting is turned off. This is done until the refinement resolution is better than 7 &#x00C5;, at which point it is assumed the model is of a reasonable quality.</p>
</sec>
<sec id="s2g">
<title>Map sharpening</title>
<p>Most single-particle reconstructions require some degree of sharpening that is usually achieved by applying a negative B-factor to the map. <italic>cis</italic>TEM includes a map sharpening tool that allows the application of an arbitrary B-factor. Additionally, maps can be sharpened by whitening the power spectrum of the reconstruction beyond a user-specified resolution (the default is 8 &#x00C5;). The whitening amplifies terms at higher resolution similar to a negative B-factor but avoids the overamplification at the high-resolution end of the spectrum that sometimes occurs with the B-factor method due to its exponential behavior. Whitening is applied after masking of the map, either with a hollow spherical mask of defined inner and outer radius, or with a user-defined mask supplied as a separate 3D volume. The masking removes background noise and makes the whitening of the particle density more accurate. Both methods can be combined in cisTEM, together with a resolution limit imposed on the final reconstruction. The whitened and B-factor-sharpened map can optionally be filtered with a figure-of-merit curve calculate using the FSC determined for the reconstruction (<xref ref-type="bibr" rid="c35">Rosenthal and Henderson, 2003</xref>; <xref ref-type="bibr" rid="c41">Sindelar and Grigorieff, 2012</xref>).</p>
</sec>
<sec id="s2h">
<title>GUI design and workflow</title>
<p><italic>cis</italic>TEM&#x2019;s GUI required extensive development because it is an integral part of the processing pipeline. GUIs have become more commonplace in cryo-EM software tools to make them more accessible to users (<xref ref-type="bibr" rid="c6">Conesa Mingo et al., 2018</xref>; <xref ref-type="bibr" rid="c8">Desfosses et al., 2014</xref>; <xref ref-type="bibr" rid="c31">Punjani et al., 2017</xref>; <xref ref-type="bibr" rid="c36">Scheres, 2012</xref>; <xref ref-type="bibr" rid="c45">Tang et al., 2007</xref>). Many of the interfaces are designed as so-called wrappers of command-line driven tools, i.e. they take user input and translate it into a command line that launches the tool. Feedback to the user takes place by checking output files, which are also the main repository of processing results, such as movie frame alignments, image defocus measurements and particle alignment parameters. As processing strategies become more complex and the number of users new to cryo-EM grows, the demands on the GUI increase in the quest for obtaining the best possible results. Useful GUI functions include guided user input (so-called wizards) that adjust to specific situations, graphical presentation of relevant results, user interaction with running processes to allow early intervention and make adjustments, tools to manipulate data (e.g. masking), implementation of higher-level procedures that combine more primitive processing steps to achieve specific goals, and a global searchable database that keeps track of all processing steps and result. While some of these functions can be or have been implemented in wrapper GUIs, the lack of control of these GUIs over the data and processes makes a reliable implementation more difficult. For example, keeping track of results from multiple processing steps, some of them perhaps repeated with different parameters or run many times during an iterative refinement, can become challenging if each step produces a separate results file. Communicating with running processes via files can be slow and is sometimes unreliable due to file system caching. Communication via files may complicate the implementation of higher-level procedures, which rely on the parsing of results from the more primitive processing steps.</p>
<p>The <italic>cis</italic>TEM GUI is more than a wrapper as it implements some of the new algorithms in the processing pipeline directly, adjusting the input of running jobs as the refinement proceeds. It enables more complex data processing strategies by tracking all results in a single searchable database. All processing steps are run and controlled by the GUI, which communicates with master and slave processes through TCP/IP. <italic>cis</italic>TEM uses a SQL database to store all results (except image files), offers input functions that guide the user or set appropriate defaults, and implements more complex procedures to automate processing where possible. cisTEM&#x2019;s design is flexible to allow execution in many different environments, including single workstations, multiple networked workstations and large computer clusters.</p>
<p>User input and the display of results is organized into different panels that make up cisTEM&#x2019;s GUI, each panel dedicated to specific processing steps (for examples, see <xref ref-type="fig" rid="fig1">Figure 1</xref>, 3, 4). This design guides users through a standard workflow that most single particle projects follow: movie alignment, CTF determination, particle picking, 2D classification, 3D reconstruction, refinement and classification, and sharpening of the final reconstructions. Three types of panels exist, dealing with Assets, Actions and Results. Assets are mostly data that can be used in processing steps called Actions. They include Movies, Images, Particle Positions and Volumes. One type of Asset, a Refinement Package, defines the data and parameters necessary to carry out refinement of a 3D structure (or a set of structures if 3D classification is done), it contains a particle stack, as well as information about the sample (e.g. particle size and molecular weight) along with parameters for each particle (e.g. orientations and defocus values). Actions comprise the above mentioned workflow steps, with additional options for ab-initio 3D reconstruction, as well as automatic and manual 3D refinement to enable users to obtain the best possible results from their data. The results of most of these Actions are stored in the database and can be viewed in the related Results panels, which display relevant data necessary to evaluate the success of each processing step. Movie alignment, 3D refinement and reconstruction also produce new Image and Volume Assets, respectively.</p>
<p>Importing or generating new Assets is accomplished by wizards that solicit the necessary user input and perform checks were possible to avoid nonsensical input. In the more complex case of creating a new Refinement Package Asset, the wizard allows the specification of input data, for example based on particle picking results or the selection of 2D and 3D classes. Once an Action has been launched, results are displayed as soon as they become available, together with an overall progress bar, giving users an estimate of how long a processing step will take and of whether the results are as expected. If desired, an Action can be aborted and restarted with a different set of parameters, or the Action can be run again after regular termination to test different parameters. In the latter case, all prior results remain accessible and users can specify those to be used for the next step in the workflow. This provides users with the flexibility to pick and choose the best results in cases where different parts of a dataset require different settings to yield optimal results.</p>
</sec>
<sec id="s2i">
<title>Parallelization</title>
<p><italic>cis</italic>TEM uses a home-grown scheme to accelerate processing in parallel environments. Image processing of single-particle data is an embarrassingly parallel problem, i.e. the parallelization of most tasks can be achieved simply by dividing the data to be processed into smaller chunks that are each processed by a separate program thread, without the need for inter-process communication. Only certain steps require merging of data, such as the calculation of a 3D reconstruction from the entire dataset. <italic>cis</italic>TEM parallelizes processing steps by running multiple instances of the same program, each dealing with a subset of the data, then directly communicating with the launched processes over TCP/IP sockets. This enables the <italic>cis</italic>TEM GUI to distribute jobs and receive results in real time. Communication is directed through a &#x201C;manager&#x201D; process, which enables jobs to be run on a cluster, while the GUI itself can run on a local workstation</p>
<p>Another advantage of using a home-grown scheme over existing schemes (e.g. MPI) occurs when jobs are run on a multi-node computing cluster. In this case, jobs will complete even if the full number of requested processors is not available. For example, if a user requests 300 CPUs for a processing step but only 100 are available, <italic>cis</italic>TEM launches 300 jobs of which 200 will remain in the job scheduler&#x2019;s queue. Data processing starts immediately with the 100 jobs that are allowed to run and will complete even if the remaining jobs never run. In such a scenario, an MPI-based job could only run when 300 CPUs become available, potentially delaying execution. In the few cases were a step requires merging of an entire dataset, for example in a 3D reconstruction, parallelization is achieved by calculating multiple intermediate 3D reconstructions for subsets of the data, dumping the intermediate reconstructions to disk and merging them after all reconstruction jobs have finished. It can therefore help to designate a fast disk as a scratch disk to allow rapid dumping and reading of the relatively large files (200 MB - 5 GB).</p>
</sec>
<sec id="s2j">
<title>Benchmarking with &#x03B2;-galactosidase</title>
<p>A high-resolution dataset of &#x03B2;-galactosidase (<xref ref-type="bibr" rid="c3">Bartesaghi et al., 2015</xref>) has been used to benchmark Relion 2 (<xref ref-type="bibr" rid="c19">Kimanius et al., 2016</xref>) and is also used here to illustrate the workflow of <italic>cis</italic>TEM and assess the time for the completion of different processing steps. The entire dataset was downloaded from the EMPIAR database (<xref ref-type="bibr" rid="c18">Iudin et al., 2016</xref>) and consists of 1539 movies containing 38 frames, recorded at super-resolution on a K2 Summit camera (Gatan, Inc., Pleasanton, CA) and stored locally as tif files using LZW compression (the conversion to tiff and compression was performed by mrc2tif (<xref ref-type="bibr" rid="c22">Mastronarde and Held, 2017</xref>)). The pixel size of the super-resolution frames was 0.3185 &#x00C5;, and images were binned to a pixel size of 0.75 &#x00C5; after movie processing. For 2D classification and ab-initio 3D reconstruction, particles were boxed using 384 &#x00D7; 384 pixel boxes. For auto- and manual refinement, the particles were re-boxed into 648 &#x00D7; 648 pixel boxes (boxing is part of the creation of Refinement Packages, see above). For all processing steps, a Dell Precision T7910 workstation containing two E5-2699 v4 Xeon processors with a total of 44 cores was used. Processing parameters were left on default settings except for the CTF determination, which was performed at 3.5 &#x00C5; resolution using the movie averages instead of the frames, and particle picking, which used optimized parameters based on previewing a few selected images (<xref ref-type="fig" rid="fig3">Figure 3</xref>). The data were stored on a local SSD Raid 0 disk for fast access. <xref ref-type="table" rid="tbl1">Table 1</xref> lists the timings of the different processing steps using all 44 CPU cores. Results obtained at different points in the workflow are shown in <xref ref-type="fig" rid="fig7">Figure 7</xref>.</p>
<fig id="fig7" position="float" orientation="portrait" fig-type="figure">
<label>Figure 7</label>
<caption><p>Processing results of the &#x03B2;-galactosidase dataset (<xref ref-type="bibr" rid="c3">Bartesaghi et al., 2015</xref>) used to benchmark <italic>cis</italic>TEM. A) Different stages of the ab-initio reconstruction procedure, starting from a reconstruction from randomly assigned Euler angles. The process takes less than an hour to complete on a high-end CPU-based workstation. B) High-resolution detail of the refined &#x03B2;-galactosidase reconstruction with an average resolution of 2.2 &#x00C5;, showing sidechain details for most amino acids. C) FSC plot for the refined &#x03B2;-galactosidase reconstruction, adjusted for the solvent background within the spherical mask applied to the half maps (<xref ref-type="disp-formula" rid="eqn19">Eq. (19</xref>)), and indicating the resolution limit that was not exceeded during refinement, as well as the FSC = 0.143 threshold.</p></caption>
<graphic xlink:href="257618_fig7.tif"/>
</fig>
<table-wrap id="tbl1" orientation="portrait" position="float">
<label>Table 1</label>
<caption><p>Benchmarking of <italic>cis</italic>TEM using a high-resolution dataset of &#x03B2;-galactosidase (<xref ref-type="bibr" rid="c3">Bartesaghi et al., 2015</xref>).</p></caption>
<graphic xlink:href="257618_tbl1.tif"/>
</table-wrap>
</sec>
</sec>
<sec id="s3">
<title>Discussion</title>
<p>The implementation of a complete image processing workflow in <italic>cis</italic>TEM offers users a uniform experience and guarantees smooth transitions between processing steps. It also helps developers maintain the software as all the tools and algorithms are developed in-house.</p>
<p>The main focus of <italic>cis</italic>TEM is on the processing of single-particle cryo-EM data and high-resolution 3D reconstruction. Future releases of <italic>cis</italic>TEM may include particle-based movie alignment, support for helical particles, improved 3D masking tools, more reliable resolution and quality indicators, as well as miscellaneous tools such as the determination of the detective quantum efficiency of electron detectors.</p>
<p>Since <italic>cis</italic>TEM does not rely on third-party libraries, such as Python, MPI or CUDA, that usually have to be installed and compiled separately on the target system, ready-to-run binaries can be made available for download that are optimized for different architectures. Using the wxWidgets library also means that <italic>cis</italic>TEM can be compiled for different operating systems, including Linux, Windows and OSX. Using a configure script, different options for the fast Fourier transforms (FFTs) can be specified, including the FFTW (<ext-link ext-link-type="uri" xlink:href="http://www.fftw.org">http://www.fftw.org</ext-link>) and Intel MKL (<ext-link ext-link-type="uri" xlink:href="http://software.intel.com/en-us/mkl">http://software.intel.com/en-us/mkl</ext-link>) libraries. The downloadable binaries are statically linked against the MKL library as this exhibits superior speeds compared to the FFTW library on Intel-based CPUs.</p>
<p>While the lack of support for GPUs simplifies the installation and execution of <italic>cis</italic>TEM, it can also be a limitation on workstations that are optimized for GPU-accelerated code. These workstations often do not have many CPU cores and, therefore, <italic>cis</italic>TEM will run significantly more slowly than code that can take advantage of the GPU hardware. Users who would like to run both CPU and GPU-optimized software may therefore have to invest in both types of hardware. One advantage of a CPU-optimized workstation, for example a 44-core Dell Precision workstation, is that it runs significantly more quietly under load than a GPU-optimized workstation, making it easy to locate it in regular office space.</p>
</sec>
</body>
<back>
<sec id="s4">
<title>Materials and Methods</title>
<sec id="s4a">
<title>Development of <italic>cis</italic>TEM</title>
<p>The entire <italic>cis</italic>TEM image processing package was written in C&#x002B;&#x002B; using the wxWidgets toolkit (<ext-link ext-link-type="uri" xlink:href="http://wxwidgets.org">http://wxwidgets.org</ext-link>) to implement the GUI, as well as the libtiff library (<ext-link ext-link-type="uri" xlink:href="http://www.libtiff.org">http://www.libtiff.org</ext-link>) to support the tiff image format, the SQLite library (<ext-link ext-link-type="uri" xlink:href="https://sqlite.org">https://sqlite.org</ext-link>) to implement the SQL database, and Intel&#x2019;s MKL library (<ext-link ext-link-type="uri" xlink:href="http://software.intel.com/en-us/mkl">http://software.intel.com/en-us/mkl</ext-link>) for the calculation of Fourier transforms and vector products. Optionally, <italic>cis</italic>TEM can also be linked against the FFTW library (<ext-link ext-link-type="uri" xlink:href="http://www.fftw.org">http://www.fftw.org</ext-link>) to replace the MKL library. The code was written and edited using Eclipse (<ext-link ext-link-type="uri" xlink:href="http://www.eclipse.org">http://www.eclipse.org</ext-link>) and GitHub (<ext-link ext-link-type="uri" xlink:href="http://github.com">http://github.com</ext-link>) was used for version control.</p>
</sec>
<sec id="s4b">
<title>Image and data formats</title>
<p><italic>cis</italic>TEM stores all image data using the MRC format (<xref ref-type="bibr" rid="c7">Crowther et al., 1996</xref>). Additionally, particle parameters can be imported from, and exported to Frealign (<xref ref-type="bibr" rid="c14">Grigorieff, 2016</xref>) and Relion (<xref ref-type="bibr" rid="c36">Scheres, 2012</xref>).</p>
</sec>
</sec>
<ack>
<title>Acknowledgements</title>
<p>The authors are grateful for feedback from early testers of c/sTEM, including Ruben Diaz-Avalos, Sarah Loerch, Priyanka Abeyrathne, Peter Rickgauer, Ben Himes, Andrei Korostelev, Anna Loveland, Gabriel Demo, Jue Chen, Dmitry Lyumkis, Hiro Furukawa, Wei Lu and Juan D</p>
</ack>
<sec id="s5" sec-type="COI-statement">
<title>Competing Interests</title>
<p><named-content content-type="COI-statement">The authors declare no competing interest.</named-content></p>
</sec>
<ref-list>
<title>References</title>
<ref id="c1"><mixed-citation publication-type="other"><string-name><surname>Abeyrathne</surname>, <given-names>P.D.</given-names></string-name>, <string-name><surname>Koh</surname>, <given-names>C.S.</given-names></string-name>, <string-name><surname>Grant</surname>, <given-names>T.</given-names></string-name>, <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name>, and <string-name><surname>Korostelev</surname>, <given-names>A.A.</given-names></string-name> (<year>2016</year>). <article-title>Ensemble cryo-EM uncovers inchworm-like translocation of a viral IRES through the ribosome</article-title>. <source>Elife</source> <fpage>5</fpage>.</mixed-citation></ref>
<ref id="c2"><mixed-citation publication-type="journal"><string-name><surname>Bartesaghi</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Matthies</surname>, <given-names>D.</given-names></string-name>, <string-name><surname>Banerjee</surname>, <given-names>S.</given-names></string-name>, <string-name><surname>Merk</surname>, <given-names>A.</given-names></string-name>, and <string-name><surname>Subramaniam</surname>, <given-names>S.</given-names></string-name> (<year>2014</year>). <article-title>Structure of beta-galactosidase at 3.2-A resolution obtained by cryo-electron microscopy</article-title>. <source>Proc Natl Acad Sci U S A</source> <volume>111</volume>, <fpage>11709</fpage>&#x2013;<lpage>11714</lpage>.</mixed-citation></ref>
<ref id="c3"><mixed-citation publication-type="journal"><string-name><surname>Bartesaghi</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Merk</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Banerjee</surname>, <given-names>S.</given-names></string-name>, <string-name><surname>Matthies</surname>, <given-names>D.</given-names></string-name>, <string-name><surname>Wu</surname>, <given-names>X.</given-names></string-name>, <string-name><surname>Milne</surname>, <given-names>J.L.</given-names></string-name>, and <string-name><surname>Subramaniam</surname>, <given-names>S.</given-names></string-name> (<year>2015</year>). <article-title>2.2 A resolution cryo-EM structure of beta-galactosidase in complex with a cell-permeant inhibitor</article-title>. <source>Science</source> <volume>348</volume>, <fpage>1147</fpage>&#x2013;<lpage>1151</lpage>.</mixed-citation></ref>
<ref id="c4"><mixed-citation publication-type="journal"><string-name><surname>Chen</surname>, <given-names>J.Z.</given-names></string-name>, <string-name><surname>Settembre</surname>, <given-names>E.C.</given-names></string-name>, <string-name><surname>Aoki</surname>, <given-names>S.T.</given-names></string-name>, <string-name><surname>Zhang</surname>, <given-names>X.</given-names></string-name>, <string-name><surname>Bellamy</surname>, <given-names>A.R.</given-names></string-name>, <string-name><surname>Dormitzer</surname>, <given-names>P.R.</given-names></string-name>, <string-name><surname>Harrison</surname>, <given-names>S.C.</given-names></string-name>, and <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2009</year>). <article-title>Molecular interactions in rotavirus assembly and uncoating seen by high-resolution cryo-EM</article-title>. <source>Proc Natl Acad Sci U S A</source> <volume>106</volume>, <fpage>10644</fpage>&#x2013;<lpage>10648</lpage>.</mixed-citation></ref>
<ref id="c5"><mixed-citation publication-type="journal"><string-name><surname>Cheng</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name>, <string-name><surname>Penczek</surname>, <given-names>P.A.</given-names></string-name>, and <string-name><surname>Walz</surname>, <given-names>T.</given-names></string-name> (<year>2015</year>). <article-title>A primer to single-particle cryo-electron microscopy</article-title>. <source>Cell</source> <volume>161</volume>, <fpage>438</fpage>&#x2013;<lpage>449</lpage>.</mixed-citation></ref>
<ref id="c6"><mixed-citation publication-type="journal"><string-name><surname>Conesa Mingo</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Gutierrez</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Quintana</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>de la Rosa Trevin</surname>, <given-names>J.M.</given-names></string-name>, <string-name><surname>Zaldivar-Peraza</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Cuenca Alba</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Kazemi</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Vargas</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Del Cano</surname>, <given-names>L.</given-names></string-name>, <string-name><surname>Segura</surname>, <given-names>J.</given-names></string-name>, <etal>et al.</etal> (<year>2018</year>). <article-title>Scipion web tools: Easy to use cryo-EM image processing over the web</article-title>. <source>Protein Sci</source> <volume>27</volume>, <fpage>269</fpage>&#x2013;<lpage>275</lpage>.</mixed-citation></ref>
<ref id="c7"><mixed-citation publication-type="journal"><string-name><surname>Crowther</surname>, <given-names>R.A.</given-names></string-name>, <string-name><surname>Henderson</surname>, <given-names>R.</given-names></string-name>, and <string-name><surname>Smith</surname>, <given-names>J.M.</given-names></string-name> (<year>1996</year>). <article-title>MRC image processing programs</article-title>. <source>J Struct Biol</source> <volume>116</volume>, <fpage>9</fpage>&#x2013;<lpage>16</lpage>.</mixed-citation></ref>
<ref id="c8"><mixed-citation publication-type="journal"><string-name><surname>Desfosses</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Ciuffa</surname>, <given-names>R.</given-names></string-name>, <string-name><surname>Gutsche</surname>, <given-names>I.</given-names></string-name>, and <string-name><surname>Sachse</surname>, <given-names>C.</given-names></string-name> (<year>2014</year>). <article-title>SPRING - an image processing package for single-particle based helical reconstruction from electron cryomicrographs</article-title>. <source>J Struct Biol</source> <volume>185</volume>, <fpage>15</fpage>&#x2013;<lpage>26</lpage>.</mixed-citation></ref>
<ref id="c9"><mixed-citation publication-type="journal"><string-name><surname>Frank</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Radermacher</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Penczek</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Zhu</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Li</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Ladjadj</surname>, <given-names>M.</given-names></string-name>, and <string-name><surname>Leith</surname>, <given-names>A.</given-names></string-name> (<year>1996</year>). <article-title>SPIDER and WEB: processing and visualization of images in 3D electron microscopy and related fields</article-title>. <source>J Struct Biol</source> <volume>116</volume>, <fpage>190</fpage>&#x2013;<lpage>199</lpage>.</mixed-citation></ref>
<ref id="c10"><mixed-citation publication-type="journal"><string-name><surname>Grant</surname>, <given-names>T.</given-names></string-name>, and <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2015a</year>). <article-title>Automatic estimation and correction of anisotropic magnification distortion in electron microscopes</article-title>. <source>J Struct Biol</source> <volume>192</volume>, <fpage>204</fpage>&#x2013;<lpage>208</lpage>.</mixed-citation></ref>
<ref id="c11"><mixed-citation publication-type="journal"><string-name><surname>Grant</surname>, <given-names>T.</given-names></string-name>, and <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2015b</year>). <article-title>Measuring the optimal exposure for single particle cryo-EM using a 2.6 A reconstruction of rotavirus VP6</article-title>. <source>Elife</source> <volume>4</volume>, <fpage>e06980</fpage>.</mixed-citation></ref>
<ref id="c12"><mixed-citation publication-type="journal"><string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2000</year>). <article-title>Resolution measurement in structures derived from single particles</article-title>. <source>Acta Crystallogr D Biol Crystallogr</source> <volume>56</volume>, <fpage>1270</fpage>&#x2013;<lpage>1277</lpage>.</mixed-citation></ref>
<ref id="c13"><mixed-citation publication-type="journal"><string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2007</year>). <article-title>FREALIGN: high-resolution refinement of single particle structures</article-title>. <source>J Struct Biol</source> <volume>157</volume>, <fpage>117</fpage>&#x2013;<lpage>125</lpage>.</mixed-citation></ref>
<ref id="c14"><mixed-citation publication-type="journal"><string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2016</year>). <article-title>Frealign: An Exploratory Tool for Single-Particle Cryo-EM</article-title>. <source>Methods Enzymol</source> <volume>579</volume>, <fpage>191</fpage>&#x2013;<lpage>226</lpage>.</mixed-citation></ref>
<ref id="c15"><mixed-citation publication-type="journal"><string-name><surname>Harauz</surname>, <given-names>G.</given-names></string-name>, and <string-name><surname>van Heel</surname>, <given-names>M.</given-names></string-name> (<year>1986</year>). <article-title>Exact Filters for General Geometry 3-Dimensional Reconstruction</article-title>. <source>Optik</source> <volume>73</volume>, <fpage>146</fpage>&#x2013;<lpage>156</lpage>.</mixed-citation></ref>
<ref id="c16"><mixed-citation publication-type="journal"><string-name><surname>Henderson</surname>, <given-names>R.</given-names></string-name> (<year>2013</year>). <article-title>Avoiding the pitfalls of single particle cryo-electron microscopy: Einstein from noise</article-title>. <source>Proc Natl Acad Sci U S A</source> <volume>110</volume>, <fpage>18037</fpage>&#x2013;<lpage>18041</lpage>.</mixed-citation></ref>
<ref id="c17"><mixed-citation publication-type="journal"><string-name><surname>Hohn</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Tang</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Goodyear</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Baldwin</surname>, <given-names>P.R.</given-names></string-name>, <string-name><surname>Huang</surname>, <given-names>Z.</given-names></string-name>, <string-name><surname>Penczek</surname>, <given-names>P.A.</given-names></string-name>, <string-name><surname>Yang</surname>, <given-names>C.</given-names></string-name>, <string-name><surname>Glaeser</surname>, <given-names>R.M.</given-names></string-name>, <string-name><surname>Adams</surname>, <given-names>P.D.</given-names></string-name>, and <string-name><surname>Ludtke</surname>, <given-names>S.J.</given-names></string-name> (<year>2007</year>). <article-title>SPARX, a new environment for Cryo-EM image processing</article-title>. <source>J Struct Biol</source> <volume>157</volume>, <fpage>47</fpage>&#x2013;<lpage>55</lpage>.</mixed-citation></ref>
<ref id="c18"><mixed-citation publication-type="journal"><string-name><surname>Iudin</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Korir</surname>, <given-names>P.K.</given-names></string-name>, <string-name><surname>Salavert-Torres</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Kleywegt</surname>, <given-names>G.J.</given-names></string-name>, and <string-name><surname>Patwardhan</surname>, <given-names>A.</given-names></string-name> (<year>2016</year>). <article-title>EMPIAR: a public archive for raw electron microscopy image data</article-title>. <source>Nat Methods</source> <volume>13</volume>, <fpage>387</fpage>&#x2013;<lpage>388</lpage>.</mixed-citation></ref>
<ref id="c19"><mixed-citation publication-type="other"><string-name><surname>Kimanius</surname>, <given-names>D.</given-names></string-name>, <string-name><surname>Forsberg</surname>, <given-names>B.O.</given-names></string-name>, <string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name>, and <string-name><surname>Lindahl</surname>, <given-names>E.</given-names></string-name> (<year>2016</year>). <article-title>Accelerated cryo-EM structure determination with parallelisation using GPUs in RELION-2</article-title>. <source>Elife</source> <fpage>5</fpage>.</mixed-citation></ref>
<ref id="c20"><mixed-citation publication-type="journal"><string-name><surname>Loveland</surname>, <given-names>A.B.</given-names></string-name>, <string-name><surname>Demo</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name>, and <string-name><surname>Korostelev</surname>, <given-names>A.A.</given-names></string-name> (<year>2017</year>). <article-title>Ensemble cryo-EM elucidates the mechanism of translation fidelity</article-title>. <source>Nature</source> <volume>546</volume>, <fpage>113</fpage>&#x2013;<lpage>117</lpage>.</mixed-citation></ref>
<ref id="c21"><mixed-citation publication-type="journal"><string-name><surname>Lyumkis</surname>, <given-names>D.</given-names></string-name>, <string-name><surname>Brilot</surname>, <given-names>A.F.</given-names></string-name>, <string-name><surname>Theobald</surname>, <given-names>D.L.</given-names></string-name>, and <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2013</year>). <article-title>Likelihood-based classification of cryo-EM images using FREALIGN</article-title>. <source>J Struct Biol</source> <volume>183</volume>, <fpage>377</fpage>&#x2013;<lpage>388</lpage>.</mixed-citation></ref>
<ref id="c22"><mixed-citation publication-type="journal"><string-name><surname>Mastronarde</surname>, <given-names>D.N.</given-names></string-name>, and <string-name><surname>Held</surname>, <given-names>S.R.</given-names></string-name> (<year>2017</year>). <article-title>Automated tilt series alignment and tomographic reconstruction in IMOD</article-title>. <source>J Struct Biol</source> <volume>197</volume>, <fpage>102</fpage>&#x2013;<lpage>113</lpage>.</mixed-citation></ref>
<ref id="c23"><mixed-citation publication-type="journal"><string-name><surname>Matthews</surname>, <given-names>B.W.</given-names></string-name> (<year>1968</year>). <article-title>Solvent content of protein crystals</article-title>. <source>J Mol Biol</source> <volume>33</volume>, <fpage>491</fpage>&#x2013;<lpage>497</lpage>.</mixed-citation></ref>
<ref id="c24"><mixed-citation publication-type="book"><string-name><surname>McDonough</surname>, <given-names>R.N.</given-names></string-name>, and <string-name><surname>Whalen</surname>, <given-names>A.D.</given-names></string-name> (<year>1995</year>). <source>Detection of Signals in Noise</source>, <edition>2nd edn</edition> (<publisher-loc>San Diego</publisher-loc>: <publisher-name>Academic Press</publisher-name>).</mixed-citation></ref>
<ref id="c25"><mixed-citation publication-type="journal"><string-name><surname>McMullan</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Faruqi</surname>, <given-names>A.R.</given-names></string-name>, and <string-name><surname>Henderson</surname>, <given-names>R.</given-names></string-name> (<year>2016</year>). <article-title>Direct Electron Detectors</article-title>. <source>Methods Enzymol</source> <volume>579</volume>, <fpage>1</fpage>&#x2013;<lpage>17</lpage>.</mixed-citation></ref>
<ref id="c26"><mixed-citation publication-type="journal"><string-name><surname>McMullan</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Vinothkumar</surname>, <given-names>K.R.</given-names></string-name>, and <string-name><surname>Henderson</surname>, <given-names>R.</given-names></string-name> (<year>2015</year>). <article-title>Thon rings from amorphous ice and implications of beam-induced Brownian motion in single particle electron cryo-microscopy</article-title>. <source>Ultramicroscopy</source> <volume>158</volume>, <fpage>26</fpage>&#x2013;<lpage>32</lpage>.</mixed-citation></ref>
<ref id="c27"><mixed-citation publication-type="journal"><string-name><surname>Mindell</surname>, <given-names>J.A.</given-names></string-name>, and <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2003</year>). <article-title>Accurate determination of local defocus and specimen tilt in electron microscopy</article-title>. <source>J Struct Biol</source> <volume>142</volume>, <fpage>334</fpage>&#x2013;<lpage>347</lpage>.</mixed-citation></ref>
<ref id="c28"><mixed-citation publication-type="other"><string-name><surname>Moriya</surname>, <given-names>T.</given-names></string-name>, <string-name><surname>Saur</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Stabrin</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Merino</surname>, <given-names>F.</given-names></string-name>, <string-name><surname>Voicu</surname>, <given-names>H.</given-names></string-name>, <string-name><surname>Huang</surname>, <given-names>Z.</given-names></string-name>, <string-name><surname>Penczek</surname>, <given-names>P.A.</given-names></string-name>, <string-name><surname>Raunser</surname>, <given-names>S.</given-names></string-name>, and <string-name><surname>Gatsogiannis</surname>, <given-names>C.</given-names></string-name> (<year>2017</year>). <article-title>High-resolution Single Particle Analysis from Electron Cryo-microscopy Images Using SPHIRE</article-title>. <source>J Vis Exp</source>.</mixed-citation></ref>
<ref id="c29"><mixed-citation publication-type="other"><string-name><surname>Oldham</surname>, <given-names>M.L.</given-names></string-name>, <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name>, and <string-name><surname>Chen</surname>, <given-names>J.</given-names></string-name> (<year>2016</year>). <article-title>Structure of the transporter associated with antigen processing trapped by herpes simplex virus</article-title>. <source>Elife</source> <fpage>5</fpage>.</mixed-citation></ref>
<ref id="c30"><mixed-citation publication-type="journal"><string-name><surname>Penczek</surname>, <given-names>P.A.</given-names></string-name>, <string-name><surname>Fang</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Li</surname>, <given-names>X.</given-names></string-name>, <string-name><surname>Cheng</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Loerke</surname>, <given-names>J.</given-names></string-name>, and <string-name><surname>Spahn</surname>, <given-names>C.M.</given-names></string-name> (<year>2014</year>). <article-title>CTER-rapid estimation of CTF parameters with error assessment</article-title>. <source>Ultramicroscopy</source> <volume>140</volume>, <fpage>9</fpage>&#x2013;<lpage>19</lpage>.</mixed-citation></ref>
<ref id="c31"><mixed-citation publication-type="journal"><string-name><surname>Punjani</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Rubinstein</surname>, <given-names>J.L.</given-names></string-name>, <string-name><surname>Fleet</surname>, <given-names>D.J.</given-names></string-name>, and <string-name><surname>Brubaker</surname>, <given-names>M.A.</given-names></string-name> (<year>2017</year>). <article-title>cryoSPARC: algorithms for rapid unsupervised cryo-EM structure determination</article-title>. <source>Nat Methods</source> <volume>14</volume>, <fpage>290</fpage>&#x2013;<lpage>296</lpage>.</mixed-citation></ref>
<ref id="c32"><mixed-citation publication-type="journal"><string-name><surname>Reboul</surname>, <given-names>C.F.</given-names></string-name>, <string-name><surname>Eager</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Elmlund</surname>, <given-names>D.</given-names></string-name>, and <string-name><surname>Elmlund</surname>, <given-names>H.</given-names></string-name> (<year>2018</year>). <article-title>Single-particle cryo-EM-Improved ab initio 3D reconstruction with SIMPLE/PRIME</article-title>. <source>Protein Sci</source> <volume>27</volume>, <fpage>51</fpage>&#x2013;<lpage>61</lpage>.</mixed-citation></ref>
<ref id="c33"><mixed-citation publication-type="journal"><string-name><surname>Rohou</surname>, <given-names>A.</given-names></string-name>, and <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2015</year>). <article-title>CTFFIND4: Fast and accurate defocus estimation from electron micrographs</article-title>. <source>J Struct Biol</source> <volume>192</volume>, <fpage>216</fpage>&#x2013;<lpage>221</lpage>.</mixed-citation></ref>
<ref id="c34"><mixed-citation publication-type="journal"><string-name><surname>Roseman</surname>, <given-names>A.M.</given-names></string-name> (<year>2004</year>). <article-title>FindEM&#x2014;a fast, efficient program for automatic selection of particles from electron micrographs</article-title>. <source>J Struct Biol</source> <volume>145</volume>, <fpage>91</fpage>&#x2013;<lpage>99</lpage>.</mixed-citation></ref>
<ref id="c35"><mixed-citation publication-type="journal"><string-name><surname>Rosenthal</surname>, <given-names>P.B.</given-names></string-name>, and <string-name><surname>Henderson</surname>, <given-names>R.</given-names></string-name> (<year>2003</year>). <article-title>Optimal determination of particle orientation, absolute hand, and contrast loss in single-particle electron cryomicroscopy</article-title>. <source>J Mol Biol</source> <volume>333</volume>, <fpage>721</fpage>&#x2013;<lpage>745</lpage>.</mixed-citation></ref>
<ref id="c36"><mixed-citation publication-type="journal"><string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name> (<year>2012</year>). <article-title>RELION: implementation of a Bayesian approach to cryo-EM structure determination</article-title>. <source>J Struct Biol</source> <volume>180</volume>, <fpage>519</fpage>&#x2013;<lpage>530</lpage>.</mixed-citation></ref>
<ref id="c37"><mixed-citation publication-type="journal"><string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name>, and <string-name><surname>Chen</surname>, <given-names>S.</given-names></string-name> (<year>2012</year>). <article-title>Prevention of overfitting in cryo-EM structure determination</article-title>. <source>Nat Methods</source> <volume>9</volume>, <fpage>853</fpage>&#x2013;<lpage>854</lpage>.</mixed-citation></ref>
<ref id="c38"><mixed-citation publication-type="journal"><string-name><surname>Scheres</surname>, <given-names>S.H.</given-names></string-name>, <string-name><surname>Valle</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Nunez</surname>, <given-names>R.</given-names></string-name>, <string-name><surname>Sorzano</surname>, <given-names>C.O.</given-names></string-name>, <string-name><surname>Marabini</surname>, <given-names>R.</given-names></string-name>, <string-name><surname>Herman</surname>, <given-names>G.T.</given-names></string-name>, and <string-name><surname>Carazo</surname>, <given-names>J.M.</given-names></string-name> (<year>2005</year>). <article-title>Maximum-likelihood multi-reference refinement for electron microscopy images</article-title>. <source>J Mol Biol</source> <volume>348</volume>, <fpage>139</fpage>&#x2013;<lpage>149</lpage>.</mixed-citation></ref>
<ref id="c39"><mixed-citation publication-type="journal"><string-name><surname>Sheth</surname>, <given-names>L.K.</given-names></string-name>, <string-name><surname>Piotrowski</surname>, <given-names>A.L.</given-names></string-name>, and <string-name><surname>Voss</surname>, <given-names>N.R.</given-names></string-name> (<year>2015</year>). <article-title>Visualization and quality assessment of the contrast transfer function estimation</article-title>. <source>J Struct Biol</source> <volume>192</volume>, <fpage>222</fpage>&#x2013;<lpage>234</lpage>.</mixed-citation></ref>
<ref id="c40"><mixed-citation publication-type="journal"><string-name><surname>Sigworth</surname>, <given-names>F.J.</given-names></string-name> (<year>2004</year>). <article-title>Classical detection theory and the cryo-EM particle selection problem</article-title>. <source>J Struct Biol</source> <volume>145</volume>, <fpage>111</fpage>&#x2013;<lpage>122</lpage>.</mixed-citation></ref>
<ref id="c41"><mixed-citation publication-type="journal"><string-name><surname>Sindelar</surname>, <given-names>C.V.</given-names></string-name>, and <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2012</year>). <article-title>Optimal noise reduction in 3D reconstructions of single particles using a volume-normalized filter</article-title>. <source>J Struct Biol</source> <volume>180</volume>, <fpage>26</fpage>&#x2013;<lpage>38</lpage>.</mixed-citation></ref>
<ref id="c42"><mixed-citation publication-type="journal"><string-name><surname>Stewart</surname>, <given-names>A.</given-names></string-name>, and <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name> (<year>2004</year>). <article-title>Noise bias in the refinement of structures derived from single particles</article-title>. <source>Ultramicroscopy</source> <volume>102</volume>, <fpage>67</fpage>&#x2013;<lpage>84</lpage>.</mixed-citation></ref>
<ref id="c43"><mixed-citation publication-type="journal"><string-name><surname>Subramaniam</surname>, <given-names>S.</given-names></string-name> (<year>2013</year>). <article-title>Structure of trimeric HIV-1 envelope glycoproteins</article-title>. <source>Proc Natl Acad Sci U S A</source> <volume>110</volume>, <fpage>E4172</fpage>&#x2013;<lpage>4174</lpage>.</mixed-citation></ref>
<ref id="c44"><mixed-citation publication-type="journal"><string-name><surname>Subramaniam</surname>, <given-names>S.</given-names></string-name>, <string-name><surname>Earl</surname>, <given-names>L.A.</given-names></string-name>, <string-name><surname>Falconieri</surname>, <given-names>V.</given-names></string-name>, <string-name><surname>Milne</surname>, <given-names>J.L.</given-names></string-name>, and <string-name><surname>Egelman</surname>, <given-names>E.H.</given-names></string-name> (<year>2016</year>). <article-title>Resolution advances in cryo-EM enable application to drug discovery</article-title>. <source>Curr Opin Struct Biol</source> <volume>41</volume>, <fpage>194</fpage>&#x2013;<lpage>202</lpage>.</mixed-citation></ref>
<ref id="c45"><mixed-citation publication-type="journal"><string-name><surname>Tang</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Peng</surname>, <given-names>L.</given-names></string-name>, <string-name><surname>Baldwin</surname>, <given-names>P.R.</given-names></string-name>, <string-name><surname>Mann</surname>, <given-names>D.S.</given-names></string-name>, <string-name><surname>Jiang</surname>, <given-names>W.</given-names></string-name>, <string-name><surname>Rees</surname>, <given-names>I.</given-names></string-name>, and <string-name><surname>Ludtke</surname>, <given-names>S.J.</given-names></string-name> (<year>2007</year>). <article-title>EMAN2: an extensible image processing suite for electron microscopy</article-title>. <source>J Struct Biol</source> <volume>157</volume>, <fpage>38</fpage>&#x2013;<lpage>46</lpage>.</mixed-citation></ref>
<ref id="c46"><mixed-citation publication-type="journal"><string-name><surname>Thon</surname>, <given-names>F.</given-names></string-name> (<year>1966</year>). <article-title>Zur Defokussierungsabhangigkeit des Phasenkontrastes bei der elektronenmikroskopischen Abbildung</article-title>. <source>Z Naturforschung</source> <volume>21a</volume>, <fpage>476</fpage>&#x2013;<lpage>478</lpage>.</mixed-citation></ref>
<ref id="c47"><mixed-citation publication-type="journal"><string-name><surname>van Heel</surname>, <given-names>M.</given-names></string-name> (<year>1982</year>). <article-title>Detection of Objects in Quantum-Noise-Limited Images</article-title>. <source>Ultramicroscopy</source> <volume>7</volume>, <fpage>331</fpage>&#x2013;<lpage>341</lpage>.</mixed-citation></ref>
<ref id="c48"><mixed-citation publication-type="journal">van <string-name><surname>Heel</surname>, <given-names>M.</given-names></string-name> (<year>2013</year>). <article-title>Finding trimeric HIV-1 envelope glycoproteins in random noise</article-title>. <source>Proc Natl Acad Sci U S A</source> <volume>110</volume>, <fpage>E4175</fpage>&#x2013;<lpage>4177</lpage>.</mixed-citation></ref>
<ref id="c49"><mixed-citation publication-type="journal"><string-name><surname>van Heel</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Harauz</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Orlova</surname>, <given-names>E.V.</given-names></string-name>, <string-name><surname>Schmidt</surname>, <given-names>R.</given-names></string-name>, and <string-name><surname>Schatz</surname>, <given-names>M.</given-names></string-name> (<year>1996</year>). <article-title>A new generation of the IMAGIC image processing system</article-title>. <source>J Struct Biol</source> <volume>116</volume>, <fpage>17</fpage>&#x2013;<lpage>24</lpage>.</mixed-citation></ref>
<ref id="c50"><mixed-citation publication-type="journal"><string-name><surname>Zhang</surname>, <given-names>K.</given-names></string-name> (<year>2016</year>). <article-title>Gctf: Real-time CTF determination and correction</article-title>. <source>J Struct Biol</source> <volume>193</volume>, <fpage>1</fpage>&#x2013;<lpage>12</lpage>.</mixed-citation></ref>
<ref id="c51"><mixed-citation publication-type="journal"><string-name><surname>Zhou</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Rohou</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Schep</surname>, <given-names>D.G.</given-names></string-name>, <string-name><surname>Bason</surname>, <given-names>J.V.</given-names></string-name>, <string-name><surname>Montgomery</surname>, <given-names>M.G.</given-names></string-name>, <string-name><surname>Walker</surname>, <given-names>J.E.</given-names></string-name>, <string-name><surname>Grigorieff</surname>, <given-names>N.</given-names></string-name>, and <string-name><surname>Rubinstein</surname>, <given-names>J.L.</given-names></string-name> (<year>2015</year>). <article-title>Structure and conformational states of the bovine mitochondrial ATP synthase by cryo-EM</article-title>. <source>Elife</source> <volume>4</volume>, <fpage>e10180</fpage>.</mixed-citation></ref>
</ref-list>
</back>
</article>