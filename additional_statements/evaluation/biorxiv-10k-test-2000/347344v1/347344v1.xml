<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">BIORXIV</journal-id>
<journal-title-group>
<journal-title>bioRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/347344</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="author-type">
<subject>Regular Article</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>New Results</subject>
</subj-group>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Evolutionary Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>The evolution and maintenance of extraordinary allelic diversity</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3720-4926</contrib-id>
<name>
<surname>Siljestam</surname>
<given-names>Mattias</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="corresp" rid="cor1">&#x002A;</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9836-2752</contrib-id>
<name>
<surname>Rueffler</surname>
<given-names>Claus</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Department of Ecology and Genetics, Animal Ecology, Uppsala University</institution>, Norbyv&#x00E4;gen 18D, 752 36 Uppsala, <country>Sweden</country></aff>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>&#x002A;</label>Corresponding author: <email>mattias.siljestam@ebc.uu.se</email></corresp>
</author-notes>
<pub-date pub-type="epub"><year>2018</year></pub-date>
<elocation-id>347344</elocation-id>
<history>
<date date-type="received">
<day>14</day>
<month>6</month>
<year>2018</year>
</date>
<date date-type="rev-recd">
<day>14</day>
<month>6</month>
<year>2018</year>
</date>
<date date-type="accepted">
<day>14</day>
<month>6</month>
<year>2018</year>
</date>
</history>
<permissions>
<copyright-statement>&#x00A9; 2018, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2018</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="347344.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract>
<p>Many loci harbour allelic polymorphism, but the majority of highly polymorphic genes are related to the immune function.<sup><xref ref-type="bibr" rid="c1">1</xref></sup> Genes of the major histocompatibility complex (MHC) are the most polymorphic loci in vertebrates<sup><xref ref-type="bibr" rid="c2">2</xref>,<xref ref-type="bibr" rid="c3">3</xref></sup> with over 100 alleles reported within a population.<sup><xref ref-type="bibr" rid="c4">4</xref></sup> How such extraordinary polymorphism arose and is maintained is controversial but balancing selection rather than purely neutral processes seems responsible.<sup><xref ref-type="bibr" rid="c2">2</xref>,<xref ref-type="bibr" rid="c5">5</xref></sup> Heterozygote advantage can in principle maintain an arbitrary number of alleles at a single locus<sup><xref ref-type="bibr" rid="c6">6</xref>&#x2013;<xref ref-type="bibr" rid="c8">8</xref></sup> but biologically explicit models have failed to reliably predict the coexistence of significantly more than ten alleles.<sup><xref ref-type="bibr" rid="c9">9</xref>&#x2013;<xref ref-type="bibr" rid="c18">18</xref></sup>Consequently, current explanations of polymorphism at MHC loci ascribe only a minor role to heterozygote advantage<sup><xref ref-type="bibr" rid="c19">19</xref>&#x2013;<xref ref-type="bibr" rid="c25">25</xref></sup> despite the fact that this mechanism has been documented in many empirical studies.<sup><xref ref-type="bibr" rid="c22">22</xref>,<xref ref-type="bibr" rid="c24">24</xref>,<xref ref-type="bibr" rid="c26">26</xref>&#x2013;<xref ref-type="bibr" rid="c31">31</xref></sup> Here, we present an eco-evolutionary model showing that evolution can through a self-organising process give rise to the emergence of more than 100 alleles at a single locus that are maintained by heterozygote advantage. In our model, MHC molecules trigger immune responses that are traded off: no single MHC molecule can efficiently induce a response against all pathogens simultaneously. The emerging heterozygote advantage allows for the build-up of up to 20 coexisting alleles in the case of two pathogens while with eight pathogens this number can reach 200. We conclude that evolution driven by heterozygote advantage alone has the potential to explain the high degree of polymorphism found at MHC loci. Our model does not only explain diversity at MHC loci but applies more generally whenever gene products are involved in multiple functions important for survival and can therefore also explain the evolution of polymorphism at other genes.</p>
</abstract>
<counts>
<page-count count="20"/>
</counts>
</article-meta>
</front>
<body>
<sec id="s1">
<p>Heterozygote advantage is a well established explanation for single locus polymorphism with the sickle cell locus as a classical text book example.<sup><xref ref-type="bibr" rid="c32">32</xref></sup> However, whether heterozygote advantage is generally important for the maintenance of genetic polymorphism is questioned.<sup><xref ref-type="bibr" rid="c33">33</xref>,<xref ref-type="bibr" rid="c34">34</xref></sup> Genes of the major histocompatibility complex (MHC), which are responsible for inducing immune defence by recognising pathogenic antigens, are the most polymorphic loci among vertebrates.<sup><xref ref-type="bibr" rid="c2">2</xref>,<xref ref-type="bibr" rid="c23">23</xref>,<xref ref-type="bibr" rid="c35">35</xref></sup> Heterozygote advantage as an explanation for this high level of polymorphism was introduced more than 40 years ago by Doherty and Zinkernagel with the idea that having MHC molecules of two different alleles allows for the recognition of a broader spectrum of pathogens resulting in higher fitness.<sup><xref ref-type="bibr" rid="c26">26</xref></sup> While early theoretical work suggested that heterozygote advantage can maintain the high number of alleles found at MHC loci<sup><xref ref-type="bibr" rid="c6">6</xref>&#x2013;<xref ref-type="bibr" rid="c8">8</xref></sup> later work discredited this idea<sup><xref ref-type="bibr" rid="c9">9</xref>&#x2013;<xref ref-type="bibr" rid="c18">18</xref></sup> and other mechanisms were suggested to be important.<sup><xref ref-type="bibr" rid="c2">2</xref>,<xref ref-type="bibr" rid="c5">5</xref>,<xref ref-type="bibr" rid="c13">13</xref>,<xref ref-type="bibr" rid="c17">17</xref>,<xref ref-type="bibr" rid="c19">19</xref>,<xref ref-type="bibr" rid="c21">21</xref>,<xref ref-type="bibr" rid="c25">25</xref>,<xref ref-type="bibr" rid="c35">35</xref></sup></p>
<p>In our model MHC molecules produced by the two alleles at a focal locus govern the performance of the immune response against <italic>m</italic> pathogens. This immune performance determines the condition <italic>c</italic> of an individual, for instance body weight,<sup><xref ref-type="bibr" rid="c36">36</xref></sup> which, in turn, determines survival <italic>s</italic>. A crucial assumption is the existence of a trade-off in the efficiencies of MHC molecules to induce a defence against different pathogens. Thus, no MHC molecule can perform optimally with respect to all pathogens and an improved efficiency against one set of pathogens can only be achieved at the expense of a decreased efficiency against another set of pathogens. Hence, generalist MHC molecules can detect many pathogens with low efficiency and specialist MHC molecules can detect few pathogens but with high efficiency. Two lines of empirical evidence support such trade-offs. First, many MHC molecules can detect only a certain set of antigens<sup><xref ref-type="bibr" rid="c36">36</xref>&#x2013;<xref ref-type="bibr" rid="c39">39</xref></sup> and therefore provide different degrees of protection against different pathogens.<sup><xref ref-type="bibr" rid="c2">2</xref>, <xref ref-type="bibr" rid="c23">23</xref>, <xref ref-type="bibr" rid="c36">36</xref>&#x2013;<xref ref-type="bibr" rid="c38">38</xref></sup> Second, it has been found that specialist MHC molecules are expressed at higher levels at the cell surface while generalist MHC molecules that bind less selectively are expressed at lower levels, potentially to reduce the harm of binding self-peptides.<sup><xref ref-type="bibr" rid="c39">39</xref></sup> This could explain the lower efficiency among generalist MHC molecules.</p>
<p>We model the trade-off using Gaussian functions <italic>e</italic><sub><italic>k</italic></sub> (<bold><italic>x</italic></bold><sub><italic>i</italic></sub>) as shown in <xref ref-type="fig" rid="fig1">Fig. 1</xref>. Here, each allele is characterised by an allelic value <bold><italic>x</italic></bold><sub><italic>i</italic></sub> determining its MHC molecule&#x2019;s efficiency <italic>e</italic><sub><italic>k</italic></sub> (<bold><italic>x</italic></bold><sub><italic>i</italic></sub>) against pathogen <italic>k</italic>. Since MHC alleles are codominantly expressed<sup><xref ref-type="bibr" rid="c23">23</xref>,<xref ref-type="bibr" rid="c40">40</xref></sup> the protection for an individual from both alleles against a pathogens <italic>k</italic> is modelled as the arithmetic mean (<italic>e</italic><sub><italic>k</italic></sub>(<bold><italic>x</italic></bold><sub><italic>i</italic></sub>) &#x002B; <italic>e</italic><sub><italic>k</italic></sub>(<bold><italic>x</italic></bold><sub><italic>j</italic></sub>))/2. The phenotypic condition <italic>c</italic> is given by the product of an individual&#x2019;s defences against all <italic>m</italic> pathogens,
<disp-formula id="eqn1"><alternatives><graphic xlink:href="347344_eqn1.gif"/></alternatives></disp-formula>
Here, <italic>c</italic><sub>max</sub> is the condition of a hypothetical individual with perfect defence against all pathogens.</p>
<p>Finally, survival <italic>s</italic> is an increasing but saturating function of an individual&#x2019;s condition <italic>c</italic>, namely
<disp-formula id="eqn2"><alternatives><graphic xlink:href="347344_eqn2.gif"/></alternatives></disp-formula>
where <italic>K</italic> is the survival half-saturation constant. This survival function increases approximately linearly for <italic>c</italic> smaller than <italic>K</italic> and saturates for large <italic>c</italic> where <italic>s</italic> &#x2248; 1 (orange lines in bottom panel of <xref ref-type="fig" rid="fig2">Fig. 2</xref>).</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1:</label>
<caption><p>Gaussian trade-offs between an MHC molecule&#x2019;s efficiencies <italic>e</italic><sub><italic>k</italic></sub> for two (<bold>a-b</bold>) and three (<bold>c-d</bold>) pathogens. (<bold>a-b</bold>) The blue and green lines give the efficiencies <italic>e</italic><sub>1</sub> and <italic>e</italic><sub>2</sub> for pathogen 1 and 2, respectively, as a function of the allelic value <italic>x</italic>. These efficiency functions have maxima at <italic>p</italic><sub>1</sub> and <italic>p</italic><sub>2</sub> separated by distance <italic>d</italic>. (<bold>c-d</bold>) Coloured cones give the trade-off between three pathogens, which is modeled with two-dimensional Gaussian functions. Thus, allelic values <bold><italic>x</italic></bold> &#x003D; (<italic>x</italic><sub>1</sub>, <italic>x</italic><sub>2</sub>) and pathogen optima <italic>p</italic><sub><italic>k</italic></sub> become two-dimensional vectors, i.e., points on the plane. We refer to the allele located in the centre with equal distance to the pathogen optima as the generalist allele <bold><italic>x</italic></bold>&#x002A;. The efficiency of this generalist allele for the different pathogens is determined by the distance <italic>d</italic> between the pathogen optima. If pathogens are similar (<bold>a,c</bold>) the generalist has a high efficiency against both pathogens while for more dissimilar pathogens (<bold>b,d</bold>) the generalist has a low efficiency. The grey lines (<bold>a-b</bold>) and grey cones (<bold>c-d</bold>) give the condition <italic>c</italic> of a homozygote genotype with the corresponding allelic trait values. The generalist allele (indicated by <italic>x</italic>&#x002A; in <bold>a,b</bold>) gives the maximal homozygote condition <italic>c</italic>&#x002A; (without loss of generality <italic>c</italic>&#x002A; is standardised to 1 by choosing <italic>c</italic><sub>max</sub> in <xref ref-type="disp-formula" rid="eqn1">Eq. 1</xref> appropriately). It is straightforward to extend this model to <italic>m</italic> pathogens and (<italic>m</italic>-1)-dimensional trait vectors (Supplementary Information 6.5). Here, we focus on the symmetric case with equally spaced pathogen optima and all covariance matrices of the Gaussians equalling the identity matrix. The general case with non-equally spaced pathogen optima and arbitrary covariance matrices is described in the Supplementary Information 4.</p></caption>
<graphic xlink:href="347344_fig1.tif"/>
</fig>
<p>We study the evolutionary dynamics of allelic values <bold><italic>x</italic></bold><sub><italic>i</italic></sub> in a diploid Wright-Fisher model with selection<sup><xref ref-type="bibr" rid="c41">41</xref>,<xref ref-type="bibr" rid="c42">42</xref></sup> by following the fate of recurrent mutations of small effect.<sup><xref ref-type="bibr" rid="c43">43</xref>,<xref ref-type="bibr" rid="c44">44</xref></sup> The assumption of small mutational effects is made to allow for analytical derivations but simulations show that none of our results critically depend on it (<xref ref-type="fig" rid="figS2">Fig. S2</xref>). Thus, we consider a diploid population of fixed size <italic>N</italic> with non-overlapping generations, random mating resulting in Hardy-Weinberg proportions before viability selection. Initially the population is fixed for a single allele. We then ask whether a mutant allele can invade and if so, if it replaces its ancestor or coexists with it. The long-term evolutionary dynamics is obtained by iterating this procedure (<xref ref-type="fig" rid="fig2">Fig. 2</xref> top panel). The evolution of the emerging allelic lineages in this model is driven by increasing the allele&#x2019;s expected survival (or marginal fitness). This follows from standard population genetics theory. Detailed derivations of all results are in Supplementary Information 5 &#x0026; 6.</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2:</label>
<caption><p>Evolution of allelic values in the presence of three pathogens (arranged as in <xref ref-type="fig" rid="fig1">Fig. 1d</xref>) for three different values of the survival half-saturation constant <italic>K</italic> (<bold>a</bold>: <italic>K</italic> &#x003D; 10, <bold>b</bold>: <italic>K</italic> &#x003D;1, <bold>c</bold>: <italic>K</italic> &#x003D; 0.1; dashed line in lower panel). The top panel shows the result of individual-based simulations where the two horizontal axes give the two values <bold><italic>x</italic></bold> &#x003D; (<italic>x</italic><sub>1</sub>, <italic>x</italic><sub>2</sub>) that characterise an allele while the vertical axes shows evolutionary time. The thickness of the blue tubes is proportional to allele frequencies. Allelic values at the last generation are projected as red dots on the top as well as on the bottom plane. The coloured circles represent the contour lines of the Gaussian efficiency functions shown in <xref ref-type="fig" rid="fig1">Fig. 1d</xref>. The bottom panel gives survival <italic>s</italic> as a function of condition <italic>c</italic> as defined by <xref ref-type="disp-formula" rid="eqn2">Eq. 2</xref> on a log-log scale (orange line, left vertical axis) and the frequencies of individual condition at the final generation (blue bars, right vertical axis, conditions from 0 to 10<sup>&#x2212;4</sup> are incorporated into the first bar). In all simulations gradual evolution leads toward the generalist allele <bold><italic>x</italic></bold>&#x002A; &#x003D; (0, 0) and branching occurs in its neighbourhood, as predicted by our analytical derivations (Supplementary Information 6). In (<bold>a</bold>) there are three consecutive branching events (the second branching event is marked out by the grey plane). This leads to the evolution of three specialist alleles and the generalist allele. Random mating results in ten genotypes (four homozygotes and six heterozygotes). The homozygote specialists have a condition and thereby a survival close to zero (two left bars in bottom panel <bold>a</bold>), the homozygote for the generalist allele <italic>x</italic>&#x002A; has a condition <italic>c</italic>&#x002A; &#x003D; 1 (middle bar) and thereby a survival equalling 1/(<italic>K</italic> &#x002B;1) &#x2248; 0.091 (<xref ref-type="disp-formula" rid="eqn2">Eq. 2</xref>), and the heterozygote genotypes have a survival close to 1 (right bar). (<bold>b</bold>) and (<bold>c</bold>) show an increasing number of branching events resulting in increasing numbers of coexisting alleles. The lower panel shows that the increasing number of alleles results in a lower proportion of homozygotes with low survival (left most bars in lower panels). Mutations are drawn from a rotational symmetric normal distribution with expected step size <italic>&#x03B4;</italic> &#x003D; 0.14. Other parameter values: <italic>d</italic> &#x003D;7, per-capita mutation probability <italic>&#x03BC;</italic> &#x003D; 5 &#x00D7; 10<sup>&#x2212;7</sup>, population size <italic>N</italic> &#x003D; 2 &#x00D7; 10<sup>5</sup>.</p></caption>
<graphic xlink:href="347344_fig2.tif"/>
</fig>
<p>Initially, allelic values evolve towards an allele <bold><italic>x</italic></bold>&#x002A; given by the arithmetic mean of the optimal allelic values <italic>P</italic><sub>1</sub>,&#x2026;,<italic>P</italic><sub><italic>m</italic></sub> against the <italic>m</italic> pathogens (<xref ref-type="fig" rid="fig1">Fig. 1</xref>). We refer to <bold><italic>x</italic></bold>&#x002A; as the generalist allele. From here on we present our results in two steps. First we explain how an allelic dimorphism can emerge after <bold><italic>x</italic></bold>&#x002A; has been reached. We then proceed by describing how after this initial diversification allelic diversity can increase further and reach extraordinarily high levels.</p>
<p>Our analytical derivations (Supplementary Information 6.5) for <italic>m</italic> pathogens with dissimilarity <italic>d</italic> (see <xref ref-type="fig" rid="fig1">Fig. 1</xref>) show that for similar pathogens such that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline1.gif"/></alternatives></inline-formula> (<xref ref-type="fig" rid="fig1">Fig. 1a,c</xref>) the generalist allele <bold><italic>x</italic></bold>&#x002A; is an evolutionary stable strategy (ESS), i.e., it cannot be invaded by nearby mutants and therefore is the endpoint of evolution (<xref ref-type="fig" rid="figS1">Fig. S1</xref>), as it has a relatively high efficiency for all pathogens. If, however, the pathogens are more different such that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline2.gif"/></alternatives></inline-formula> and the generalist&#x2019;s efficiency low (<xref ref-type="fig" rid="fig1">Fig. 1b,d</xref>), then any nearby mutant allele can invade and coexist with the generalist allele <bold><italic>x</italic></bold>&#x002A;. Under this condition a heterozygote genotype carrying the generalist and a mutant allele has higher survival <italic>s</italic> than either homozygote and the allelic dimorphism is maintained by heterozygote advantage. A new mutant allele can invade if its more specialised than the allele from which it originated. If successful such a mutant also replaces its parent allele. In summary, two allelic lineages can emerge from the generalist allelic value <bold><italic>x</italic></bold>&#x002A; and subsequently diverge (<xref ref-type="fig" rid="fig2">Fig. 2</xref>). Thus, <bold><italic>x</italic></bold>&#x002A; is an evolutionary branching point in the sense of adaptive dynamics theory.<sup><xref ref-type="bibr" rid="c43">43</xref>,<xref ref-type="bibr" rid="c44">44</xref></sup></p>
<p>Increasing the difference between the two alleles has two opposing effects. The condition and thereby the survival of the heterozygote genotype increases because the two alleles present in the dimorphism provide increasingly better protection against complementary sets of pathogens (divergent allele advantage in sense of Wakeland <italic>et al</italic>.<sup><xref ref-type="bibr" rid="c37">37</xref></sup>). On the other hand, survival of the two homozygote genotypes decreases because they become increasingly vulnerable for the set of pathogens for which their alleles do not offer protection. Allelic divergence proceeds as long as the increase in heterozygote survival outweighs the decreases in homozygote survival. Since the increase in survival of heterozygotes slows down (plateau of the orange curves in <xref ref-type="fig" rid="fig2">Fig. 2</xref>) the two opposing forces eventually balance each other and divergence comes halts. Due to random mating half of the population are high survival heterozygotes and the remaining half are homozygotes with low survival. At this point, one of the lineages branches again and thereby decreases the proportion of low-survival homozygotes. The three alleles coexisting in this trimorphism diverge from each other as the increase in heterozygote survival outweighs the decreased survival in the (now also less frequent) homozygotes once again (see <xref ref-type="fig" rid="fig2">Fig. 2a</xref> at time <italic>t</italic> &#x003D; 3 &#x00D7; 10<sup>4</sup>, grey plane).</p>
<p>This process of evolutionary branching and allelic divergence repeats itself and the allelic diversity continues to increase (<xref ref-type="fig" rid="fig2">Fig. 2</xref>). The number of consecutive branching events increases with the number of pathogens <italic>m</italic> and their dissimilarity <italic>d</italic>, but also depends on <italic>K</italic>, determining how quickly the survival function saturates. <xref ref-type="fig" rid="fig3">Fig. 3</xref> presents the final number of coexisting alleles for different model parameters derived from individual-based simulations. It shows that for a large part of this parameter space more than 100 (solid contour lines in <xref ref-type="fig" rid="fig3">Fig. 3</xref>) and up to 200 alleles can emerge and coexist. In <xref ref-type="fig" rid="figS3">Fig. S3</xref> we show that qualitatively this prediction is robust against violations of the symmetry assumptions made in <xref ref-type="fig" rid="fig1">Fig. 1</xref>.</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3:</label>
<caption><p>Number of coexisting alleles for <italic>m</italic> pathogens as a function of pathogen dissimilarity <italic>d</italic> and the survival halfsaturation constant <italic>K</italic>. Results are based on a single individual-based simulation per pixel run for 10<sup>6</sup> generations. This assures that the equilibrium distribution of alleles is reached. The clear pattern in the figures indicates a high degree of determinism in the simulations. Results are reported in terms of the effective number of alleles <italic>n</italic><sub><italic>e</italic></sub>, which discounts for alleles arising from mutation-drift balance. It is defined as the inverse of homozygosity and is lower or equal to the absolute number of allele. Note that for our demographic parameters the expected <italic>n</italic><sub><italic>e</italic></sub> under mutation-drift balance alone equals 1.2 (Supplementary Information 3). Dashed and solid lines give the contours for <italic>n</italic><sub><italic>e</italic></sub> &#x003D; 50 and <italic>n</italic><sub><italic>e</italic></sub> &#x003D; 100, respectively. Red arrows indicate <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline3.gif"/></alternatives></inline-formula> the threshold for polymorphism to emerge from branching. Accordingly, simulations in the dark blue area result in a single abundant allele with <italic>n</italic><sub><italic>e</italic></sub> close to one. Other parameters: population size <italic>N</italic> &#x003D; 2 &#x00D7; 10<sup>5</sup>, per-capita mutation probability <italic>&#x03BC;</italic> &#x003D; 5 &#x00D7; 10<sup>&#x2212;7</sup>, expected mutational step size <italic>&#x03B4;</italic> &#x003D; 0.03<italic>d</italic>.</p></caption>
<graphic xlink:href="347344_fig3.tif"/>
</fig>
<p>Kimura and Crow<sup><xref ref-type="bibr" rid="c6">6</xref></sup> and subsequently Wright<sup><xref ref-type="bibr" rid="c7">7</xref></sup> showed that it is in principle possible that heterozygote advantage can result in the coexistence of an arbitrary number of alleles at a single locus if (<xref ref-type="disp-formula" rid="eqn1">1</xref>) all heterozygotes have a similarly high fitness and (<xref ref-type="disp-formula" rid="eqn2">2</xref>) all homozygotes a similarly low fitness. These conditions were deemed unrealistic by the authors themselves, an assessment confirmed in later studies<sup><xref ref-type="bibr" rid="c9">9</xref>&#x2013;<xref ref-type="bibr" rid="c18">18</xref></sup> In contrast, our study shows that heterozygote advantage alone can explain the high number of coexisting alleles found at MHC loci without making specific assumptions about homozygote and heterozygote fitnesses. Instead, alleles that are able to coexist emerge through evolutionary branching and self-organise through adaptive evolution such that at all times during this gradual buildup of diversity the two conditions are fulfilled. Specifically, as long as <italic>K</italic> is not too large the survival of heterozygotes quickly saturates with increasing condition (orange line in <xref ref-type="fig" rid="fig2">Fig. 2</xref> for <italic>c</italic> &#x003E; <italic>K</italic>). As a result, all heterozygote genotypes consisting of alleles that are not very similar to each other have survival close to 1. Thus, alleles evolve to fulfil condition (<xref ref-type="disp-formula" rid="eqn1">1</xref>) formulated by Kimura and Crow. If, additionally, pathogens are sufficiently different (<italic>d</italic> large), then survival of homozygote individuals that do not carry the generalist allele <italic>x</italic>&#x002A;, or alleles very similar to <italic>x</italic>&#x002A;, approaches zero (grey line and cone in <xref ref-type="fig" rid="fig1">Fig. 1b,d</xref>). Thus, evolution of allelic values also results in condition (<xref ref-type="disp-formula" rid="eqn2">2</xref>) of Crow and Kimura being fulfilled by the majority of homozygotes. However, for <italic>K</italic> very small the number of coexisting alleles decreases again (left side in the panels in <xref ref-type="fig" rid="fig3">Fig. 3</xref>). This is because then survival decreases only marginally with decreasing condition and even individuals homozygote for alleles that are different form the generalist allele <italic>x</italic>&#x002A; can have high survival, violating condition (<xref ref-type="disp-formula" rid="eqn2">2</xref>) above.</p>
<p>The gradual build-up of diversity occurs most readily when the mutational step size is neither very small, since then the evolutionary dynamics becomes exceedingly slow, nor very large, since then the self-organised assembly of alleles becomes dominated by a stochastic assembly that is less efficient in finding the set of alleles able to coexist (<xref ref-type="fig" rid="figS2">Fig. S2</xref>).</p>
<p>Many vertebrates have several MHC loci with similar functions.<sup><xref ref-type="bibr" rid="c5">5</xref>,<xref ref-type="bibr" rid="c21">21</xref>,<xref ref-type="bibr" rid="c23">23</xref></sup> The diversity generating mechanism described here still applies if the different loci are responsible for largely non-overlapping sets of pathogens.</p>
<p>Our model does not only apply to MHC genes but to any gene that fulfils the assumptions that it affects several functions important for survival. Examples are genes that are expressed in different ontogenetic stages or different tissues with competing demands on the optimal gene product. In principle, gene duplication will reduce the potential number of coexisting alleles per locus and eventually lead to a situation where the number of duplicates equals the number of functions.<sup><xref ref-type="bibr" rid="c45">45</xref></sup> Under this scenario, the high degree of polymorphism reported here would be transient. However, for MHC genes evidence exist that other forces limit the number of MHC loci<sup><xref ref-type="bibr" rid="c5">5</xref>,<xref ref-type="bibr" rid="c21">21</xref>,<xref ref-type="bibr" rid="c23">23</xref>,<xref ref-type="bibr" rid="c35">35</xref></sup> indicating that the mechanism presented here can in principle explain the high number of coexisting MHC alleles.</p>
</sec>
</body>
<back>
<ref-list>
<title>References</title>
<ref id="c1"><label>[1]</label><mixed-citation publication-type="journal"><string-name><surname>Jin</surname>, <given-names>P.</given-names></string-name> &#x0026; <string-name><surname>Wang</surname>, <given-names>E.</given-names></string-name> <article-title>Polymorphism in clinical immunology-from hla typing to immunogenetic profiling</article-title>. <source>Journal of Translational Medicine</source> <volume>1</volume>, <fpage>8</fpage> (<year>2003</year>).</mixed-citation></ref>
<ref id="c2"><label>[2]</label><mixed-citation publication-type="journal"><string-name><surname>Apanius</surname>, <given-names>V.</given-names></string-name>, <string-name><surname>Penn</surname>, <given-names>D.</given-names></string-name>, <string-name><surname>Slev</surname>, <given-names>P. R.</given-names></string-name>, <string-name><surname>Ruff</surname>, <given-names>L. R.</given-names></string-name> &#x0026; <string-name><surname>Potts</surname>, <given-names>W. K.</given-names></string-name> <article-title>The nature of selection on the major histocompatibility complex</article-title>. <source>Critical Reviews in Immunology</source> <volume>17</volume> (<year>1997</year>).</mixed-citation></ref>
<ref id="c3"><label>[3]</label><mixed-citation publication-type="journal"><string-name><surname>Sommer</surname>, <given-names>S.</given-names></string-name> <article-title>The importance of immune gene variability (MHC) in evolutionary ecology and conservation</article-title>. <source>Froniers in Zoology</source> <volume>2</volume>, <fpage>16</fpage> (<year>2005</year>).</mixed-citation></ref>
<ref id="c4"><label>[4]</label><mixed-citation publication-type="journal"><string-name><surname>Duncan</surname>, <given-names>W.</given-names></string-name>, <string-name><surname>Wakeland</surname>, <given-names>E.</given-names></string-name> &#x0026; <string-name><surname>Klein</surname>, <given-names>J.</given-names></string-name> <article-title>Histocompatibility-2 system in wild mice</article-title>. <source>Immunogenetics</source> <volume>9</volume>, <fpage>261</fpage>&#x2013;<lpage>272</lpage> (<year>1979</year>).</mixed-citation></ref>
<ref id="c5"><label>[5]</label><mixed-citation publication-type="confproc"><string-name><surname>Spurgin</surname>, <given-names>L. G.</given-names></string-name> &#x0026; <string-name><surname>Richardson</surname>, <given-names>D. S.</given-names></string-name> <article-title>How pathogens drive genetic diversity: MHC, mechanisms and misunderstandings</article-title>. <conf-name>Proceedings of the Royal Society of London B: Biological Sciences</conf-name> <volume>277</volume>,<fpage>979</fpage>&#x2013;<lpage>988</lpage> (<year>2010</year>).</mixed-citation></ref>
<ref id="c6"><label>[6]</label><mixed-citation publication-type="journal"><string-name><surname>Kimura</surname>, <given-names>M.</given-names></string-name> &#x0026; <string-name><surname>Crow</surname>, <given-names>J. F.</given-names></string-name> <article-title>The number of alleles that can be maintained in a finite population</article-title>. <source>Genetics</source> <volume>49</volume>, <fpage>725</fpage>&#x2013;<lpage>738</lpage> (<year>1964</year>).</mixed-citation></ref>
<ref id="c7"><label>[7]</label><mixed-citation publication-type="confproc"><string-name><surname>Wright</surname>, <given-names>S.</given-names></string-name> <article-title>Polyallelic random drift in relation to evolution</article-title>. <conf-name>Proceedings of the National Academy of Sciences</conf-name> <volume>55</volume>, <fpage>1074</fpage>&#x2013;<lpage>1081</lpage> (<year>1966</year>).</mixed-citation></ref>
<ref id="c8"><label>[8]</label><mixed-citation publication-type="journal"><string-name><surname>Maruyama</surname>, <given-names>T.</given-names></string-name> &#x0026; <string-name><surname>Nei</surname>, <given-names>M.</given-names></string-name> <article-title>Genetic variability maintained by mutation and overdominant selection in finite populations</article-title>. <source>Genetics</source> <volume>98</volume>, <fpage>441</fpage>&#x2013;<lpage>459</lpage> (<year>1981</year>).</mixed-citation></ref>
<ref id="c9"><label>[9]</label><mixed-citation publication-type="journal"><string-name><surname>Lewontin</surname>, <given-names>R.</given-names></string-name>, <string-name><surname>Ginzburg</surname>, <given-names>L.</given-names></string-name> &#x0026; <string-name><surname>Tuljapurkar</surname>, <given-names>S.</given-names></string-name> <article-title>Heterosis as an explanation for large amounts of genic polymorphism</article-title>. <source>Genetics</source> <volume>88</volume>, <fpage>149</fpage>&#x2013;<lpage>169</lpage> (<year>1978</year>).</mixed-citation></ref>
<ref id="c10"><label>[10]</label><mixed-citation publication-type="journal"><string-name><surname>Spencer</surname>, <given-names>H. G.</given-names></string-name> &#x0026; <string-name><surname>Marks</surname>, <given-names>R. W.</given-names></string-name> <article-title>The maintenance of singlelocus polymorphism. I. Numerical studies of a viability selection model</article-title>. <source>Genetics</source> <volume>120</volume>, <fpage>605</fpage>&#x2013;<lpage>613</lpage> (<year>1988</year>).</mixed-citation></ref>
<ref id="c11"><label>[11]</label><mixed-citation publication-type="journal"><string-name><surname>Hedrick</surname>, <given-names>P. W.</given-names></string-name> <article-title>Pathogen resistance and genetic variation at MHC loci</article-title>. <source>Evolution</source> <volume>56</volume>, <fpage>1902</fpage>&#x2013;<lpage>1908</lpage> (<year>2002</year>).</mixed-citation></ref>
<ref id="c12"><label>[12]</label><mixed-citation publication-type="journal"><string-name><surname>de Boer</surname>, <given-names>R. J.</given-names></string-name>, <string-name><surname>Borghans</surname>, <given-names>J. A.</given-names></string-name>, <string-name><surname>Van Boven</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Ke&#x015F;mir</surname>, <given-names>C.</given-names></string-name> &#x0026; <string-name><surname>Weissing</surname>, <given-names>F. J.</given-names></string-name> <article-title>Heterozygote advantage fails to explain the high degree of polymorphism of the MHC</article-title>. <source>Immunogenetics</source> <volume>55</volume>, <fpage>725</fpage>&#x2013;<lpage>731</lpage> (<year>2004</year>).</mixed-citation></ref>
<ref id="c13"><label>[13]</label><mixed-citation publication-type="journal"><string-name><surname>Borghans</surname>, <given-names>J. A.</given-names></string-name>, <string-name><surname>Beltman</surname>, <given-names>J. B.</given-names></string-name> &#x0026; <string-name><surname>De Boer</surname>, <given-names>R. J.</given-names></string-name> <article-title>MHC polymorphism under host-pathogen coevolution</article-title>. <source>Immunogenetics</source> <volume>55</volume>, <fpage>732</fpage>&#x2013;<lpage>739</lpage> (<year>2004</year>).</mixed-citation></ref>
<ref id="c14"><label>[14]</label><mixed-citation publication-type="journal"><string-name><surname>Stoffels</surname>, <given-names>R. J.</given-names></string-name> &#x0026; <string-name><surname>Spencer</surname>, <given-names>H. G.</given-names></string-name> <article-title>An asymmetric model of heterozygote advantage at major histocompatibility complex genes: degenerate pathogen recognition and intersection advantage</article-title>. <source>Genetics</source> <volume>178</volume>, <fpage>1473</fpage>&#x2013;<lpage>1489</lpage> (<year>2008</year>).</mixed-citation></ref>
<ref id="c15"><label>[15]</label><mixed-citation publication-type="journal"><string-name><surname>Trotter</surname>, <given-names>M. V.</given-names></string-name> &#x0026; <string-name><surname>Spencer</surname>, <given-names>H. G.</given-names></string-name> <article-title>The generation and maintenance of genetic variation by frequency-dependent selection: constructing polymorphisms under the pairwise interaction model</article-title>. <source>Genetics</source> <volume>180</volume>, <fpage>1547</fpage>&#x2013;<lpage>1557</lpage> (<year>2008</year>).</mixed-citation></ref>
<ref id="c16"><label>[16]</label><mixed-citation publication-type="journal"><string-name><surname>Trotter</surname>, <given-names>M. V.</given-names></string-name> &#x0026; <string-name><surname>Spencer</surname>, <given-names>H. G.</given-names></string-name> <article-title>Models of frequency-dependent selection with mutation from parental alleles</article-title>. <source>Genetics</source> <volume>195</volume>, <fpage>231</fpage>&#x2013;<lpage>242</lpage> (<year>2013</year>).</mixed-citation></ref>
<ref id="c17"><label>[17]</label><mixed-citation publication-type="journal"><string-name><surname>Ejsmond</surname>, <given-names>M. J.</given-names></string-name> &#x0026; <string-name><surname>Radwan</surname>, <given-names>J.</given-names></string-name> <article-title>Red queen processes drive positive selection on major histocompatibility complex (MHC) genes</article-title>. <source>PLoS Comput Biol</source> <volume>11</volume> (<year>2015</year>).</mixed-citation></ref>
<ref id="c18"><label>[18]</label><mixed-citation publication-type="journal"><string-name><surname>Lau</surname>, <given-names>Q.</given-names></string-name>, <string-name><surname>Yasukochi</surname>, <given-names>Y.</given-names></string-name> &#x0026; <string-name><surname>Satta</surname>, <given-names>Y. A</given-names></string-name> <article-title>limit to the divergent allele advantage model supported by variable pathogen recognition across hla-drb1 allele lineages</article-title>. <source>Tissue Antigens</source> <volume>86</volume>, <fpage>343</fpage>&#x2013;<lpage>352</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c19"><label>[19]</label><mixed-citation publication-type="journal"><string-name><surname>Hedrick</surname>, <given-names>P. W.</given-names></string-name> <article-title>Balancing selection and MHC</article-title>. <source>Genetica</source> <volume>104</volume>, <fpage>207</fpage>&#x2013;<lpage>214</lpage> (<year>1999</year>).</mixed-citation></ref>
<ref id="c20"><label>[20]</label><mixed-citation publication-type="journal"><string-name><surname>Gould</surname>, <given-names>S. J.</given-names></string-name>, <string-name><surname>Hildreth</surname>, <given-names>J. E.</given-names></string-name> &#x0026; <string-name><surname>Booth</surname>, <given-names>A. M.</given-names></string-name> <article-title>The evolution of alloimmunity and the genesis of adaptive immunity</article-title>. <source>The Quarterly review of biology</source> <volume>79</volume>, <fpage>359</fpage>&#x2013;<lpage>382</lpage> (<year>2004</year>).</mixed-citation></ref>
<ref id="c21"><label>[21]</label><mixed-citation publication-type="journal"><string-name><surname>Wegner</surname>, <given-names>K.</given-names></string-name> <article-title>Historical and contemporary selection of teleost MHC genes: did we leave the past behind?</article-title> <source>Journal of Fish Biology</source> <volume>73</volume>, <fpage>2110</fpage>&#x2013;<lpage>2132</lpage> (<year>2008</year>).</mixed-citation></ref>
<ref id="c22"><label>[22]</label><mixed-citation publication-type="confproc"><string-name><surname>Kek&#x00E4;l&#x00E4;inen</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Vallunen</surname>, <given-names>J. A.</given-names></string-name>, <string-name><surname>Primmer</surname>, <given-names>C. R.</given-names></string-name>, <string-name><surname>R&#x00E4;tty&#x00E4;</surname>, <given-names>J.</given-names></string-name> &#x0026; <string-name><surname>Taskinen</surname>, <given-names>J.</given-names></string-name> <article-title>Signals of major histocompatibility complex overdominance in a wild salmonid population</article-title>. <conf-name>Proceedings of the Royal Society of London B: Biological Sciences</conf-name> (<year>2009</year>).</mixed-citation></ref>
<ref id="c23"><label>[23]</label><mixed-citation publication-type="journal"><string-name><surname>Eizaguirre</surname>, <given-names>C.</given-names></string-name> &#x0026; <string-name><surname>Lenz</surname>, <given-names>T.</given-names></string-name> <article-title>Major histocompatibility complex polymorphism: dynamics and consequences of parasite-mediated local adaptation in fishes</article-title>. <source>Journal of Fish Biology</source> <volume>77</volume>, <fpage>2023</fpage>&#x2013;<lpage>2047</lpage> (<year>2010</year>).</mixed-citation></ref>
<ref id="c24"><label>[24]</label><mixed-citation publication-type="journal"><string-name><surname>Lenz</surname>, <given-names>T. L.</given-names></string-name> <article-title>Computational prediction of MHC Il-antigen binding supports divergent allele advantage and explains transspecies polymorphism</article-title>. <source>Evolution</source> <volume>65</volume>, <fpage>2380</fpage>&#x2013;<lpage>2390</lpage> (<year>2011</year>).</mixed-citation></ref>
<ref id="c25"><label>[25]</label><mixed-citation publication-type="confproc"><string-name><surname>Loiseau</surname>, <given-names>C.</given-names></string-name> <etal>et al.</etal> <article-title>Plasmodium relictum infection and MHC diversity in the house sparrow (Passer domesticus)</article-title>. <conf-name>Proceedings of the Royal Society of London B: Biological Sciences</conf-name> <volume>278</volume>, <fpage>1264</fpage>&#x2013;<lpage>1272</lpage> (<year>2011</year>).</mixed-citation></ref>
<ref id="c26"><label>[26]</label><mixed-citation publication-type="journal"><string-name><surname>Doherty</surname>, <given-names>P. C.</given-names></string-name> &#x0026; <string-name><surname>Zinkernagel</surname>, <given-names>R. M.</given-names></string-name> <article-title>Enhanced immunological surveillance in mice heterozygous at the h-2 gene complex</article-title>. <source>Nature</source> <volume>256</volume>, <fpage>50</fpage>&#x2013;<lpage>52</lpage> (<year>1975</year>).</mixed-citation></ref>
<ref id="c27"><label>[27]</label><mixed-citation publication-type="confproc"><string-name><surname>Hughes</surname>, <given-names>A. L.</given-names></string-name> &#x0026; <string-name><surname>Nei</surname>, <given-names>M.</given-names></string-name> <article-title>Nucleotide substitution at major histocompatibility complex class II loci: evidence for overdominant selection</article-title>. <conf-name>Proceedings of the National Academy of Sciences</conf-name> <volume>86</volume>, <fpage>958</fpage>&#x2013;<lpage>962</lpage> (<year>1989</year>).</mixed-citation></ref>
<ref id="c28"><label>[28]</label><mixed-citation publication-type="journal"><string-name><surname>Jeffery</surname>, <given-names>K. J.</given-names></string-name> &#x0026; <string-name><surname>Bangham</surname>, <given-names>C. R.</given-names></string-name> <article-title>Do infectious diseases drive MHC diversity?</article-title> <source>Microbes and Infection</source> <volume>2</volume>, <fpage>1335</fpage>&#x2013;<lpage>1341</lpage> (<year>2000</year>).</mixed-citation></ref>
<ref id="c29"><label>[29]</label><mixed-citation publication-type="journal"><string-name><surname>McClelland</surname>, <given-names>E. E.</given-names></string-name>, <string-name><surname>Penn</surname>, <given-names>D. J.</given-names></string-name> &#x0026; <string-name><surname>Potts</surname>, <given-names>W. K.</given-names></string-name> <article-title>Major histocompatibility complex heterozygote superiority during coinfection</article-title>. <source>Infection and immunity</source> <volume>71</volume>, <fpage>2079</fpage>&#x2013;<lpage>2086</lpage> (<year>2003</year>).</mixed-citation></ref>
<ref id="c30"><label>[30]</label><mixed-citation publication-type="journal"><string-name><surname>Froeschke</surname>, <given-names>G.</given-names></string-name> &#x0026; <string-name><surname>Sommer</surname>, <given-names>S.</given-names></string-name> <article-title>MHC class II DRB variability and parasite load in the striped mouse (Rhabdomys pumilio) in the southern Kalahari</article-title>. <source>Molecular biology and evolution</source> <volume>22</volume>, <fpage>1254</fpage>&#x2013;<lpage>1259</lpage> (<year>2005</year>).</mixed-citation></ref>
<ref id="c31"><label>[31]</label><mixed-citation publication-type="confproc"><string-name><surname>Oliver</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Telfer</surname>, <given-names>S.</given-names></string-name> &#x0026; <string-name><surname>Piertney</surname>, <given-names>S.</given-names></string-name> <article-title>Major histocompatibility complex (MHC) heterozygote superiority to natural multiparasite infections in the water vole (arvicola terrestris)</article-title>. <conf-name>Proceedings of the Royal Society of London B: Biological Sciences</conf-name> <volume>276</volume>, <fpage>1119</fpage>&#x2013;<lpage>1128</lpage> (<year>2009</year>).</mixed-citation></ref>
<ref id="c32"><label>[32]</label><mixed-citation publication-type="journal"><string-name><surname>Allison</surname>, <given-names>A. C.</given-names></string-name> <article-title>Protection afforded by sickle-cell trait against subtertian malarial infection</article-title>. <source>British medical journal</source> <volume>1</volume>, <fpage>290</fpage> (<year>1954</year>).</mixed-citation></ref>
<ref id="c33"><label>[33]</label><mixed-citation publication-type="journal"><string-name><surname>Hedrick</surname>, <given-names>P. W.</given-names></string-name> <article-title>What is the evidence for heterozygote advantage selection?</article-title> <source>Trends in ecology &#x0026; evolution</source> <volume>27</volume>, <fpage>698</fpage>&#x2013;<lpage>704</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="c34"><label>[34]</label><mixed-citation publication-type="journal"><string-name><surname>Sellis</surname>, <given-names>D.</given-names></string-name>, <string-name><surname>Kvitek</surname>, <given-names>D. J.</given-names></string-name>, <string-name><surname>Dunn</surname>, <given-names>B.</given-names></string-name>, <string-name><surname>Sherlock</surname>, <given-names>G.</given-names></string-name> &#x0026; <string-name><surname>Petrov</surname> <given-names>D. A.</given-names></string-name> <article-title>Heterozygote advantage is a common outcome of adaptation in saccharomyces cerevisiae</article-title>. <source>Genetics</source> <volume>203</volume>, <fpage>1401</fpage>&#x2013;<lpage>1413</lpage> (<year>2016</year>).</mixed-citation></ref>
<ref id="c35"><label>[35]</label><mixed-citation publication-type="journal"><string-name><surname>Penn</surname>, <given-names>D. J.</given-names></string-name> <article-title>The scent of genetic compatibility: sexual selection and the major histocompatibility complex</article-title>. <source>Ethology</source> <volume>108</volume>, <fpage>1</fpage>&#x2013;<lpage>21</lpage> (<year>2002</year>).</mixed-citation></ref>
<ref id="c36"><label>[36]</label><mixed-citation publication-type="journal"><string-name><surname>Eizaguirre</surname>, <given-names>C.</given-names></string-name>, <string-name><surname>Lenz</surname>, <given-names>T. L.</given-names></string-name>, <string-name><surname>Kalbe</surname>, <given-names>M.</given-names></string-name> &#x0026; <string-name><surname>Milinski</surname>, <given-names>M.</given-names></string-name> <article-title>Divergent selection on locally adapted major histocompatibility complex immune genes experimentally proven in the field</article-title>. <source>Ecology letters</source> <volume>15</volume>, <fpage>723</fpage>&#x2013;<lpage>731</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="c37"><label>[37]</label><mixed-citation publication-type="journal"><string-name><surname>Wakeland</surname>, <given-names>E. K.</given-names></string-name> <etal>et al.</etal> <article-title>Ancestral polymorphisms of MHC class II genes: divergent allele advantage</article-title>. <source>Immunologic Research</source> <volume>9</volume>, <fpage>115</fpage>&#x2013;<lpage>122</lpage> (<year>1990</year>).</mixed-citation></ref>
<ref id="c38"><label>[38]</label><mixed-citation publication-type="journal"><string-name><surname>Froeschke</surname>, <given-names>G.</given-names></string-name> &#x0026; <string-name><surname>Sommer</surname>, <given-names>S.</given-names></string-name> <article-title>Insights into the complex associations between MHC class II DRB polymorphism and multiple gastrointestinal parasite infestations in the striped mouse</article-title>. <source>PLoS One</source> <volume>7</volume> (<year>2012</year>).</mixed-citation></ref>
<ref id="c39"><label>[39]</label><mixed-citation publication-type="journal"><string-name><surname>Chappell</surname>, <given-names>P. E.</given-names></string-name> <etal>et al.</etal> <article-title>Expression levels of MHC class I molecules are inversely correlated with promiscuity of peptide binding</article-title>. <source>Elife</source> <fpage>4</fpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c40"><label>[40]</label><mixed-citation publication-type="journal"><string-name><surname>Abbas</surname>, <given-names>A. K.</given-names></string-name>, <string-name><surname>Lichtman</surname>, <given-names>A. H.</given-names></string-name> &#x0026; <string-name><surname>Pillai</surname>, <given-names>S.</given-names></string-name> <source>Basic immunology: functions and disorders of the immune system (Elsevier Health Sciences</source>, <year>2014</year>).</mixed-citation></ref>
<ref id="c41"><label>[41]</label><mixed-citation publication-type="book"><string-name><surname>Fisher</surname>, <given-names>R. A.</given-names></string-name> <source>The genetical theory of natural selection</source> (<publisher-name>Oxford University Press</publisher-name>, <year>1930</year>).</mixed-citation></ref>
<ref id="c42"><label>[42]</label><mixed-citation publication-type="journal"><string-name><surname>Wright</surname>, <given-names>S.</given-names></string-name> <article-title>Evolution in mendelian populations</article-title>. <source>Genetics</source> <volume>16</volume>, <fpage>97</fpage>&#x2013;<lpage>159</lpage> (<year>1931</year>).</mixed-citation></ref>
<ref id="c43"><label>[43]</label><mixed-citation publication-type="journal"><string-name><surname>Metz</surname>, <given-names>J. A. J.</given-names></string-name>, <string-name><surname>Nisbet</surname>, <given-names>R. M.</given-names></string-name> &#x0026; <string-name><surname>Geritz</surname>, <given-names>S. A. H.</given-names></string-name> <article-title>How should we define fitness for general ecological scenarios&#x003F;</article-title> <source>Trends in Ecology &#x0026; Evolution</source> <volume>7</volume>, <fpage>198</fpage>&#x2013;<lpage>202</lpage> (<year>1992</year>).</mixed-citation></ref>
<ref id="c44"><label>[44]</label><mixed-citation publication-type="journal"><string-name><surname>Geritz</surname>, <given-names>S. A. H.</given-names></string-name>, <string-name><surname>Kisdi</surname>, <given-names>E.</given-names></string-name>, <string-name><surname>Mesz&#x00E9;na</surname>, <given-names>G.</given-names></string-name> &#x0026; <string-name><surname>Metz</surname>, <given-names>J. A. J.</given-names></string-name> <article-title>Evolutionarily singular strategies and the adaptive growth and branching of the evolutionary tree</article-title>. <source>Evolutionary Ecology</source> <volume>12</volume>, <fpage>35</fpage>&#x2013;<lpage>57</lpage> (<year>1998</year>).</mixed-citation></ref>
<ref id="c45"><label>[45]</label><mixed-citation publication-type="journal"><string-name><surname>Proulx</surname>, <given-names>S. R.</given-names></string-name> &#x0026; <string-name><surname>Phillips</surname>, <given-names>P. C.</given-names></string-name> <article-title>Allelic divergence precedes and promotes gene duplication</article-title>. <source>Evolution</source> <volume>60</volume>, <fpage>881</fpage>&#x2013;<lpage>892</lpage> (<year>2006</year>).</mixed-citation></ref>
</ref-list>
<ack>
<title>Acknowledgements</title>
<p>We thank Yvonne Meyer-Lucht and Tobias Lenz for helpful discussions and G&#x00F6;aran Arnqvist, Helena Westerdahl, Joachim Hermisson and Sophie Karrenberg for comments on an earlier version of the manuscript.</p>
</ack>
<sec id="s2" sec-type="supplementary-material">
<label>1</label>
<title>Supplementary figure S1: Evolutionary dynamics without branching</title>
<fig id="figS1" position="float" fig-type="figure">
<label>Figure S1:</label>
<caption><p>Evolution of allelic values in the presence of three pathogens. This figure is analogous to <xref ref-type="fig" rid="fig2">Fig. 2</xref> but the distance between pathogen optima equals <italic>d</italic> &#x003D; 2.5 (as in <xref ref-type="fig" rid="fig1">Fig. 1c</xref>) while in <xref ref-type="fig" rid="fig2">Fig. 2</xref> this distance was much larger (<italic>d</italic> &#x003D; 7, as in <xref ref-type="fig" rid="fig1">Fig. 1d</xref>). As a consequence, the condition for evolutionary branching (<inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline4.gif"/></alternatives></inline-formula>) is not fulfilled and the evolutionary dynamics result in a monomorphic population consisting essentially of only the generalist allele <bold><italic>x</italic></bold>&#x002A; &#x003D; (0, 0). This result is independent of the half-saturation constant <italic>K</italic>, here chosen to be <italic>K</italic> &#x003D; 10. The lower panel shows that the generalist allele <bold><italic>x</italic></bold>&#x002A;, which is the final outcome of the evolutionary dynamics, has condition <italic>c</italic>&#x002A; &#x2248; 1 (blue bar) and thereby survival <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline5.gif"/></alternatives></inline-formula> (<xref ref-type="disp-formula" rid="eqn9">Eq. 9</xref>). Note that while in <xref ref-type="fig" rid="fig2">Fig. 2a</xref> the configuration <italic>c</italic>&#x002A; &#x003C; <italic>K</italic> resulted in three branching events leading to four alleles this does not occur here since the condition for the first branching is not fulfilled. Mutations are drawn from a rotational symmetric normal distribution with expected step size <italic>&#x03B4;</italic> &#x003D; 0.14. Other parameter values: per-capita mutation probability <italic>&#x03BC;</italic> &#x003D; 5 &#x00D7; 10<sup>&#x2212;7</sup>, population size <italic>N</italic> &#x003D; 2 &#x00D7; 10<sup>5</sup>.</p></caption>
<graphic xlink:href="347344_figS1.tif"/>
</fig>
</sec>
<sec id="s3" sec-type="supplementary-material">
<label>2</label>
<title>Supplementary figure S2: Varying the mutational step size</title>
<fig id="figS2" position="float" fig-type="figure">
<label>Figure S2:</label>
<caption><p>Number of coexisting alleles as they emerge in individual-based simulations for different expected mutational step sizes <italic>&#x03B4;</italic> and eight pathogens (<italic>m</italic> &#x003D; 8). Parameters are chosen such that up to 200 alleles can evolve (<italic>K</italic> &#x003D; 0.5, <italic>d</italic> &#x003D; 20; see bottom right panel in <xref ref-type="fig" rid="fig3">Fig. 3</xref> in the main text). Orange solid lines and blue dotted lines give the effective number <italic>n</italic><sub><italic>e</italic></sub> and the absolute number <italic>n</italic> of alleles, respectively. The number of alleles increases fastest and saturates earliest for an intermediate mutational step size of <italic>&#x03B4;</italic> &#x003D; 0.6 (<bold>d</bold>; pathogen optima are <italic>d</italic>/<italic>&#x03B4;</italic> &#x003D; 20/0.6 &#x003D; 33.3 average mutational steps apart) as used in <xref ref-type="fig" rid="fig3">Fig. 3</xref>. Decreasing the average mutational step size slows down the build-up of allelic diversity (<bold>e-g</bold>). In the extreme case shown in <bold>g</bold> (pathogen optima are 20/0.02 &#x003D; 1000 average mutational steps apart) the evolutionary dynamics is strongly limited by the rate of phenotypic change due to the small step size and the number of alleles after 10<sup>7</sup> time steps has reached only 10&#x0025; the number reached in <bold>d</bold>. Increasing the average mutational step size also slows down the build-up of allelic diversity (<bold>a-c</bold>). In the extreme case shown in a (pathogen optima are one average mutational steps apart) the evolutionary dynamics are strongly limited by the very large proportion of maladapted mutants and the number of alleles after 10<sup>7</sup> time steps has reached only 5&#x0025; the number reached in <bold>d</bold>. Other parameters as in <xref ref-type="fig" rid="fig3">Fig. 3</xref>: population size <italic>N</italic> &#x003D; 2 &#x00D7; 10<sup>5</sup>, per-capita mutation probability <italic>&#x03BC;</italic> &#x003D; 5 &#x00D7; 10<sup>&#x2212;7</sup>.</p></caption>
<graphic xlink:href="347344_figS2.tif"/>
</fig>
</sec>
<sec id="s4">
<label>3</label>
<title>Table of mathematical notation</title>
<p>Bold font indicates vector (e.g. <bold><italic>x</italic></bold>), otherwise scalar (e.g. <italic>x</italic>). Capital letter in sans serif font indicate matrices (e.g. <bold>X</bold>). Below is a list of all mathematical notations used in this supplementary material.</p>
<table-wrap id="utbl1" orientation="portrait" position="float">
<graphic xlink:href="347344_utbl1.tif"/>
</table-wrap>
</sec>
<sec id="s5">
<label>4</label>
<title>Effective number of alleles due to demographic processes</title>
<p>The expected homozygosity G under mutation-drift balance in a population of size <italic>N</italic> and per-capita mutation probability <italic>&#x03BC;</italic> at equilibrium is given by
<disp-formula id="eqn3"><alternatives><graphic xlink:href="347344_eqn3.gif"/></alternatives></disp-formula>
(see e.g. <xref ref-type="bibr" rid="c56">Gillespie 2004</xref>). The effective number of alleles <italic>n</italic><sub><italic>e</italic></sub> under mutation drift balance is defined as <italic>n</italic><sub><italic>e</italic></sub> &#x003D; 1/G &#x003D; 1 &#x002B; 4<italic>N&#x03BC;</italic>. With a population size of <italic>N</italic> &#x003D; 10<sup>5</sup> and per capita per generation mutation probability <italic>&#x03BC;</italic> &#x003D; 5 &#x00D7; 10<sup>&#x2212;7</sup> as used in all our simulations <italic>n</italic><sub><italic>e</italic></sub> &#x2248; 1.2. Hence, values of <italic>n</italic><sub><italic>e</italic></sub> significant higher than 1.2 indicate the presence of alleles maintained by balancing selection.</p>
</sec>
<sec id="s6">
<label>5</label>
<title>Robustness of the model: Deviations from symmetry</title>
<p><xref ref-type="fig" rid="fig3">Fig. 3</xref> in the main text shows the final number of coexisting alleles for different parameter combinations. This result is based on two symmetry assumptions, First, the <italic>m</italic> pathogen optima are placed fully symmetric, i.e., equidistantly resulting in a regular (<italic>m</italic> &#x2013; 1)-simplex. Second, the multivariate Gaussian functions describing the MHC-molecule&#x2019;s efficiencies <italic>e</italic><sub><italic>k</italic></sub> against pathogen <italic>k</italic> are assumed to be rotational symmetric as shown in <xref ref-type="fig" rid="fig1">Fig. 1</xref>. Thus, the variance-covariance matrix &#x2211;<sub><italic>k</italic></sub> in <xref ref-type="disp-formula" rid="eqn11">Eq. 11</xref> is equal to the identity matrix I. Here, we test the robustness of the outcome shown <xref ref-type="fig" rid="fig3">Fig. 3</xref> with respect to violations of these symmetry assumptions. We focus on the case with eight pathogens. The results are summarised in <xref ref-type="fig" rid="figS3">Fig. S3</xref>. Panel (a) is identical to the bottom right panel in <xref ref-type="fig" rid="fig3">Fig. 3</xref> and shown here for comparison. Panels (b-d) show the final number of coexisting alleles for increasing deviations from symmetry as explained in the following. Note that each pixel is derived from a single simulation with a unique random perturbation from symmetry.</p>
<p>In panel (b) the assumption of symmetrically placed pathogen optima is perturbed while the Gaussian functions <italic>e</italic><sub><italic>k</italic></sub> are still rotational symmetric. <xref ref-type="sec" rid="s6a">Section 5.1</xref> describes the procedure how the positions of the pathogen optima are randomised while controlling for their variance. The similarity between panel (a) and (b) indicates that deviations from a symmetric placement of pathogen optima have a minor effect on the number of coexisting alleles. The slightly decreased smoothness of the contours corresponding to 50 and 100 coexisting alleles stems from the fact that each pixel is derived from a unique perturbation. Note that polymorphism can emerge for <italic>d</italic>-values such that the branching condition <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline6.gif"/></alternatives></inline-formula> derived for the symmetric case is not fulfilled (below the red arrow). This can be understood based on the expression for the Hessian matrix given in <xref ref-type="disp-formula" rid="eqn32">Eq. 32</xref>. This Hessian is more likely to be non-negative definite for asymmetrically placed pathogen optima.</p>
<p>In <xref ref-type="fig" rid="figS3">Fig. S3(c,d)</xref> we, additionally to the non-symmetric placement of pathogen optima, allow for non-rotational symmetric Gaussian functions <italic>e</italic><sub><italic>k</italic></sub>. Thus, &#x2211;<sub><italic>k</italic></sub> can be different for each pathogen and neither needs to be a diagonal matrix nor a matrix with 1&#x2019;s on the diagonal. The variances of the perturbed variance-covariance matrices are constrained to the interval (1 &#x2212; <italic>&#x025B;</italic>, 1 &#x002B; <italic>&#x025B;</italic>) such that the average variance is kept equal to 1. <xref ref-type="sec" rid="s6b">Section 5.2</xref> describes the procedure in detail. Panel (c) shows the result for modest (<italic>&#x025B;</italic> &#x003D; 0.2) and panel (d) for strong (<italic>&#x025B;</italic> &#x003D; 0.5) deviations from rotational symmetry. Comparing panel (b) and (c) indicates that modest deviations from rotational symmetry still have a relatively minor effect on the final number of alleles. In panel <italic>d</italic> configurations exist where significantly fewer alleles are able to coexist. Interestingly, configurations resulting in a high number of alleles are more likely to occur in combination with high <italic>K</italic>-values. The highly irregular pattern results from each pixel corresponding to single simulation with a unique random perturbation from symmetry. Furthermore, the threshold for polymorphism decreases even more because the Hessian matrix given in <xref ref-type="disp-formula" rid="eqn6">Eq. 6</xref> is even more likely to be non-negative definite with perturbations in &#x2211;<sub><italic>k</italic></sub>.</p>
<sec id="s6a">
<label>5.1</label>
<title>Random placement of pathogen optima</title>
<p>The distribution of eight pathogen optima can be described by their seven dimensional variance-covariance matrix V calculated from the coordinates <italic>p</italic><sub>1</sub>,&#x2026;,<italic>p</italic><sub>8</sub>. Since each diagonal element of V describes the variance of the pathogen optima along a different dimension of the trait space the average variance equals tr(V)/7, where tr(V) denotes the trace. This measure is unaffected by rotation of the points <italic>p</italic><sub>1</sub>,&#x2026;,<italic>p</italic><sub>8</sub>. For symmetrically placed pathogen optima V<sub>sym</sub> &#x003D; <italic>d</italic><sup>2</sup>/(2<italic>m</italic>) I, were I denotes the identity matrix, and therefore tr(V<sub>sym</sub>) &#x003D; <italic>d</italic><sup>2</sup>(<italic>m</italic> &#x2212; 1)/(2<italic>m</italic>). In panel (b-d) We obtain randomly placed pathogen optima with tr(V<sub>per</sub>) &#x003D; <italic>d</italic><sup>2</sup>(<italic>m</italic> &#x2212; 1)/2<italic>m</italic> &#x003D; tr(V<sub>sym</sub>) in the following manner. First, eight preliminary points <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline7.gif"/></alternatives></inline-formula> are placed randomly within a unit 7-sphere. These points are subsequently multiplied with a scalar <italic>&#x03B1;</italic> given by
<disp-formula id="ueqn1"><alternatives><graphic xlink:href="347344_ueqn1.gif"/></alternatives></disp-formula>
to obtain the final set of pathogen optima <italic>p</italic><sub>1</sub>,&#x2026;,<italic>p</italic><sub>8</sub>. Here, <italic>m</italic> &#x003D; 8 and <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline8.gif"/></alternatives></inline-formula> is the variance-covariance matrix calculated based on the preliminary points <italic>p</italic><sub>1</sub>,&#x2026;<italic>p</italic><sub>8</sub>.</p>
</sec>
<sec id="s6b">
<label>5.2</label>
<title>Random covariance matrices for the pathogen efficiencies</title>
<p>In <xref ref-type="fig" rid="fig1">Fig. 1</xref>-<xref ref-type="fig" rid="fig3">3</xref> the variance-covariance matrices &#x2211;<sub><italic>k</italic></sub> determining the shape of the efficiency functions <italic>e</italic><sub><italic>k</italic></sub> are equal to the identity matrix I. In <xref ref-type="fig" rid="figS3">Fig. S3(c,d)</xref> we allow for arbitrary variance-covariance matrices. In order to keep the results between the symmetric and asymmetric case comparable we fix the mean variance over all &#x2211;<sub><italic>k</italic></sub> equal to 1. We obtain the eight random variance-covariance matrices &#x2211;<sub>1</sub>,&#x2026;,&#x2211;<sub>8</sub> in the following manner. First, eight random diagonal matrices D<sub>1</sub>,&#x2026;,D<sub>8</sub> are determined (one per pathogen optima) with entries drawn from a uniform distribution <italic>U</italic>(1 &#x2212; <italic>&#x025B;</italic>, 1 &#x002B; <italic>&#x025B;</italic>). These matrices are then multiplied with a scalar <italic>&#x03B2;</italic> given by
<disp-formula id="ueqn2"><alternatives><graphic xlink:href="347344_ueqn2.gif"/></alternatives></disp-formula>
with <italic>m</italic> &#x003D; 8, to obtain the set of matrices M<sub>1</sub>,&#x2026;,M<sub>8</sub> obeying <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline9.gif"/></alternatives></inline-formula>. In a final step we draw eight random rotation matrices R<sub>1</sub>,&#x2026;,R<sub>8</sub> and calculate our final variance-covariance matrices P<sub>1</sub>,&#x2026;,P<sub>8</sub> as <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline10.gif"/></alternatives></inline-formula>.</p>
<fig id="figS3" position="float" fig-type="figure">
<label>Figure S3:</label>
<caption><p>Number of coexisting alleles for eight pathogens as a function of pathogen dissimilarity <italic>d</italic> and the halfsaturation constant <italic>K</italic> for symmetric (<bold>a</bold>) and non-symmetric pathogen optima (<bold>b-d</bold>). Results are based on a single individual-based simulation per pixel. Panel (<bold>a</bold>) shows results for equally spaced pathogen optima and rotational symmetric functions <italic>e</italic><sub><italic>k</italic></sub> (<xref ref-type="disp-formula" rid="eqn11">Eq. 11</xref>). It is identical to the bottom right panel in <xref ref-type="fig" rid="fig3">Fig. 3</xref> and shown for comparison. Panel (<bold>b-d</bold>) show the result for increasing perturbations from symmetry. In panel (<bold>b</bold>) pathogen optima are placed randomly (see text for details) while the functions <italic>e</italic><sub><italic>k</italic></sub> are kept rotationally symmetric. In panel (<bold>c</bold>) and (<bold>d</bold>), additionally to the non-symmetric placement of pathogen optima, the functions <italic>e</italic><sub><italic>k</italic></sub> are independently perturbed from rotational symmetry (see text for details). In panel (<bold>c</bold>) the deviations from rotational symmetry are moderate while in panel (<bold>d</bold>) they are strong. Note that in panel (<bold>b-d</bold>) pathogen optima are no longer at a constant distance <italic>d</italic>. In these panels, the y-axis shows the value <italic>d</italic> that corresponds to symmetrically placed pathogen optima with a variance equal to the mean variance of the randomly placed pathogen optima. Simulations were run for 10<sup>6</sup> generations to assure that the equilibrium distribution of alleles is reached. Results are reported in terms of the effective number of alleles <italic>n</italic><sub><italic>e</italic></sub> (see <xref ref-type="fig" rid="fig3">Fig. 3</xref>). Dashed and solid lines are contours corresponding to <italic>n</italic><sub><italic>e</italic></sub> equalling 50 and 100, respectively. Red arrows indicate <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline11.gif"/></alternatives></inline-formula>, the minimal value for polymorphism to emerge from branching under full symmetry. Accordingly, simulations in the dark blue area result in a single abundant allele with <italic>n</italic><sub><italic>e</italic></sub> close to one. Other parameters: population size <italic>N</italic> &#x003D; 2 &#x00D7; 10<sup>5</sup>, per-capita mutation probability <italic>&#x03BC;</italic> &#x003D; 5 &#x00D7; 10<sup>&#x2212;7</sup>, expected mutational step size <italic>&#x03B4;</italic> &#x003D; 0.03<italic>d</italic>.</p></caption>
<graphic xlink:href="347344_figS3.tif"/>
</fig>
</sec>
</sec>
<sec id="s7">
<label>6</label>
<title>Preliminaries</title>
<sec id="s7a">
<label>6.1</label>
<title>Adaptive dynamics and invasion fitness</title>
<p>We analyse the model with an evolutionary invasion analysis using the adaptive dynamics formalism (<xref ref-type="bibr" rid="c63">Metz et al. 1992</xref>; <xref ref-type="bibr" rid="c50">Dieckmann and Law 1996</xref>; <xref rid="c54" ref-type="bibr">Geritz et al. 1998</xref>). The main tool to predict the evolutionary dynamics is invasion fitness <italic>w</italic>(<bold><italic>y</italic></bold>, <bold><italic>X</italic></bold>), which is the expected long-term exponential growth rate of an infinitesimally rare mutant allele with allelic value <bold><italic>y</italic></bold> in a resident population at equilibrium consisting of the alleles <bold><italic>X</italic></bold> &#x003D; (<bold><italic>x</italic></bold><sub>1</sub>,&#x2026;,<bold><italic>x</italic></bold><sub><italic>n</italic></sub>) (<xref rid="c63" ref-type="bibr">Metz et al. 1992</xref>; <xref ref-type="bibr" rid="c61">Metz 2008</xref>).</p>
<p>Here, we consider a large population consisting of <italic>N</italic> individuals containing <italic>n</italic> alleles <bold><italic>X</italic></bold> &#x003D; (<bold><italic>x</italic></bold><sub>1</sub>,&#x2026;,<bold><italic>x</italic></bold><sub><italic>n</italic></sub>) under Wright-Fisher population dynamics (<xref rid="c53" ref-type="bibr">Fisher 1930</xref>; <xref rid="c65" ref-type="bibr">Wright 1931</xref>). The recurrence equation for allele <bold><italic>x</italic></bold><sub><italic>a</italic></sub> equals
<disp-formula id="eqn4"><alternatives><graphic xlink:href="347344_eqn4.gif"/></alternatives></disp-formula>
where <italic>f</italic><sub><italic>a,t</italic></sub> is the frequency of allele <bold><italic>x</italic></bold><sub><italic>a</italic></sub> at time <italic>t</italic>, <italic>s</italic>(<bold><italic>x</italic></bold><sub><italic>a</italic></sub>, <bold><italic>x</italic></bold><sub><italic>b</italic></sub>) is the survival of an individual carrying the alleles <bold><italic>x</italic></bold><sub><italic>a</italic></sub> and <bold><italic>x</italic></bold><sub><italic>b</italic></sub> and
<disp-formula id="ueqn3"><alternatives><graphic xlink:href="347344_ueqn3.gif"/></alternatives></disp-formula>
is the population mean survival at time <italic>t</italic>. The sum on the right hand side of <xref ref-type="disp-formula" rid="eqn2">Eq. 2</xref> describes the marginal fitness of allele <bold><italic>x</italic></bold><sub><italic>a</italic></sub>.</p>
<p>Consider a rare mutant allele <bold><italic>y</italic></bold> &#x003D; <bold><italic>x</italic></bold><sub><italic>a</italic></sub> &#x002B; <bold><italic>&#x03F5;</italic></bold> for some <bold><italic>x</italic></bold><sub><italic>a</italic></sub> &#x2208; <bold><italic>X</italic></bold> introduced into a resident population of <italic>n</italic> coexisting alleles <bold><italic>X</italic></bold> at equilibrium. As long as the mutant allele has a negligible frequency its marginal fitness simplifies to
<disp-formula id="eqn5"><alternatives><graphic xlink:href="347344_eqn5.gif"/></alternatives></disp-formula>
which is its invasion fitness. Note that because of the equilibrium assumption the time-subscript could be dropped. Allele <bold><italic>y</italic></bold> is able to invade and increase in frequency if <italic>w</italic>(<bold><italic>y</italic>, <italic>X</italic></bold>) &#x003E; 1 and disappears otherwise.</p>
<p>The gradient &#x25BD;<italic>w</italic>(<bold><italic>x</italic></bold><sub><italic>a</italic></sub>, <bold><italic>X</italic></bold>) of invasion fitness with entries
<disp-formula id="eqn6"><alternatives><graphic xlink:href="347344_eqn6.gif"/></alternatives></disp-formula>
gives the direction in the <italic>h</italic>-dimensional allelic trait space in which invasion fitness of mutants of allele <bold><italic>x</italic></bold><sub><italic>a</italic></sub> increases fastest. If mutations occur rarely a mutant allele <italic>y</italic> will either go extinct or reach an equilibrium frequency before a new mutant appears. If, additionally, &#x25BD;<italic>w</italic>(<bold><italic>x</italic></bold><sub><italic>a</italic></sub>, <bold><italic>X</italic></bold>) &#x2260; 0 and mutational affects are sufficiently small such that <bold><italic>y</italic></bold> &#x003D; <bold><italic>x</italic></bold><sub><italic>a</italic></sub> &#x002B; <bold><italic>&#x03F5;</italic></bold> for <bold><italic>x</italic></bold><sub><italic>a</italic></sub> &#x2208; <bold><italic>X</italic></bold> and <bold><italic>&#x03F5;</italic></bold> small, then invasion of <bold><italic>y</italic></bold> implies extinction of <bold><italic>x</italic></bold><sub><italic>a</italic></sub> (<xref ref-type="bibr" rid="c49">Dercole and Rinaldi 2008</xref>, Appendix B) resulting in a trait substitution sequence. In the limit of small mutational steps the evolutionary dynamics of an allelic lineage becomes gradual and is given by
<disp-formula id="eqn7"><alternatives><graphic xlink:href="347344_eqn7.gif"/></alternatives></disp-formula>
(<xref ref-type="bibr" rid="c50">Dieckmann and Law 1996</xref>; <xref ref-type="bibr" rid="c47">Champagnat et al. 2006</xref>; <xref ref-type="bibr" rid="c52">Durinx et al. 2008</xref>; <xref ref-type="bibr" rid="c62">Metz and de Kovel 2013</xref>). Here, <italic>&#x03BC;</italic> is the per-capita mutation probability and C the mutational variance-covariance matrix. We note that <xref ref-type="disp-formula" rid="eqn5">Eq. 5</xref> is structurally similar to the gradient equation of quantitative genetics, which is based on the assumption of weak selection or, equivalently, small genetic variances (<xref ref-type="bibr" rid="c59">Lande 1979</xref>; <xref ref-type="bibr" rid="c58">Iwasa et al. 1991</xref>; <xref ref-type="bibr" rid="c46">Abrams et al. 1993</xref>; <xref ref-type="bibr" rid="c48">D&#x00E9;barre et al. 2014</xref>). In this case, <bold><italic>x</italic></bold><sub><italic>a</italic></sub> characterises the mean of the phenotype distribution, the variance-covariance matrix describes the distribution of the standing genetic variation, and the factor <italic>&#x03BC;N</italic> is a constant.</p>
<p>Combinations of alleles <bold><italic>X</italic></bold> such that 0 &#x003D; &#x25BD;<italic>w</italic>(<bold><italic>x</italic></bold><sub><italic>a</italic></sub>, <bold><italic>X</italic></bold>)<sub><italic>i</italic></sub> for all alleles are of special interest. In the case of a single resident allele <bold><italic>X</italic></bold> &#x003D; <bold><italic>x</italic></bold>, this trait value of <italic>x</italic> is then said to be an evolutionarily singular strategy. If <italic>n</italic> coexisting alleles all fulfil 0 &#x003D; &#x25BD;<italic>w</italic>(<bold><italic>x</italic></bold><sub><italic>a</italic></sub>, <bold><italic>X</italic></bold>)<sub><italic>i</italic></sub>, then these form an evolutionarily singular coalition. Evolutionarily singular coalitions can be either attractors or repellors of the evolutionary dynamics described by <xref ref-type="disp-formula" rid="eqn5">Eq. 5</xref>. Furthermore, an evolutionarily singular coalition of alleles can be either invadable or uninvadable by nearby mutants. For a single resident allele with a one-dimensional trait <bold><italic>x</italic></bold> &#x003D; <italic>x</italic> a classification of singular strategies is straight forward (<xref ref-type="bibr" rid="c54">Geritz et al. 1998</xref>). Evolutionarily singular points that are not approached, irrespective of whether they are invadable or uninvadable, act as repellors and we do not expect to ever find alleles with such values. Evolutionarily singular strategies that are attractors and uninvadable are endpoints of the evolutionary dynamics. Finally, evolutionarily singular points that are attractors and invadable are know as evolutionary branching points. In this case, any nearby mutant can invade the singular strategy and coexist with it in a protected dimorphism. Further evolution leads to divergence of the alleles present in the dimorphism. Thus, evolutionary branching points are points in trait space at which diversity emerges (<xref ref-type="bibr" rid="c64">Rueffler et al. 2006</xref>).</p>
<p>The classification of singular points becomes more complicated in multivariate trait spaces or when several strategies coexist in an evolutionarily singular coalition (<xref ref-type="bibr" rid="c60">Leimar 2009</xref>; <xref ref-type="bibr" rid="c51">Doebeli 2011</xref>; <xref ref-type="bibr" rid="c55">Geritz et al. 2016</xref>). First, in multivariate trait spaces or polymorphic populations, whether or not a singular coalition is an attractor does not only depend on the direction of the fitness gradient in the vicinity of the singular coalition but also on the mutational input (<xref ref-type="bibr" rid="c60">Leimar 2009</xref>). Second, in multivariate trait spaces or polymorphic populations attractivity of a singular coalition and invadability are necessary but generally not sufficient conditions for evolutionary branching (<xref ref-type="bibr" rid="c55">Geritz et al. 2016</xref>).</p>
<p>In <xref ref-type="sec" rid="s8a">Section 7.1</xref>, we show that for our model, as long as the resident population consists of a single allele <bold><italic>X</italic></bold> &#x003D; <bold><italic>x</italic></bold>, a unique singular point <bold><italic>x</italic></bold>&#x002A; exists. This allele is uninvadable if it is a minimum of <italic>w</italic>(<bold><italic>y</italic>, <italic>x</italic></bold>&#x002A;) as a function of <bold><italic>y</italic></bold>. This is the case if the <italic>h</italic>-dimensional Hessian matrix H with entries
<disp-formula id="eqn8"><alternatives><graphic xlink:href="347344_eqn8.gif"/></alternatives></disp-formula>
is negative definite (<xref ref-type="bibr" rid="c60">Leimar 2009</xref>; <xref ref-type="bibr" rid="c51">Doebeli 2011</xref>). In <xref ref-type="sec" rid="s8b">Section 7.2</xref> we derive an explicit expression for H for the fully general case of our model that allows to determine invadability of x&#x002A; as a function of the positions of the pathogen optima, the half-saturation constant <italic>K</italic>, and the variance-covariance matrices &#x2211;<sub><italic>k</italic></sub> that determine the shape of the efficiency functions <italic>e</italic><sub><italic>k</italic></sub>.</p>
<p>Whether or not the singular point <bold><italic>x</italic></bold>&#x002A; is an attractor of the evolutionary dynamics can be evaluated based on the Jacobian matrix J of the fitness gradient &#x25BD;<italic>w</italic>(<bold><italic>x</italic></bold>&#x002A;, <bold><italic>x</italic></bold>&#x002A;) (<xref ref-type="bibr" rid="c60">Leimar 2009</xref>), which is given by
<disp-formula id="eqn9"><alternatives><graphic xlink:href="347344_eqn9.gif"/></alternatives></disp-formula>
and where Q is the <italic>h</italic>-dimensional matrix of mixed derivatives with entries
<disp-formula id="eqn10"><alternatives><graphic xlink:href="347344_eqn10.gif"/></alternatives></disp-formula>
<xref ref-type="bibr" rid="c60">Leimar (2009)</xref> showed that if the symmetric part of J, i.e., (J &#x002B; J<sup>T</sup>)/2, is negative definite, then the singular point is an attractor of the evolutionary dynamics described by <xref ref-type="disp-formula" rid="eqn5">Eq. 5</xref>. Leimar refers to this case as strong convergence stability. In <xref ref-type="sec" rid="s8c">Section 7.3</xref> we show that for our model the Jacobian matrix is in fact a negative definite symmetric matrix. For this case, Leimar proved a stronger result to which he refers to as absolute convergence stability and where all conceivable gradualistic, adaptive paths starting near the point <bold><italic>x</italic></bold>&#x002A; converge to it.</p>
<p>To summarise, for the presented model we prove that a unique singular strategy <bold><italic>x</italic></bold>&#x002A; exists, to which we refer as the generalist allele, that is an attractor of any adaptive gradualistic trait substitution sequence. Furthermore, we compute an explicit expression for the Hessian matrix at this point. This expression allows to numerically calculate whether the singular point is invadable or not. We note that the definiteness of the Hessian matrix is independent of the half-saturation constant <italic>K</italic>. We also make some heuristic arguments about which factors make invadability more likely. For the case of two-dimensional trait spaces results in <xref ref-type="bibr" rid="c55">Geritz et al. (2016)</xref> allow us to conclude that if <bold><italic>x</italic></bold>&#x002A; is invadable, then it is indeed an evolutionary branching point. For trait spaces of dimension three or higher, whether strong convergence and invadability imply evolutionary branching is an open problem (<xref ref-type="bibr" rid="c55">Geritz et al. 2016</xref>). Individual-based simulations indicate, however, that for our model this indeed the case.</p>
</sec>
<sec id="s7b">
<label>6.2</label>
<title>Model description</title>
<p>In this section, we describe the model ingredients. Survival <italic>s</italic>(<bold><italic>x</italic></bold><sub><italic>a</italic></sub>, <bold><italic>x</italic></bold><sub><italic>b</italic></sub>) of a genotype carrying alleles <bold><italic>x</italic></bold><sub><italic>a</italic></sub> and <bold><italic>x</italic></bold><sub><italic>b</italic></sub> is a saturating function of condition <italic>c</italic> and described by the well known Michaelis-Menten equation
<disp-formula id="eqn11"><alternatives><graphic xlink:href="347344_eqn11.gif"/></alternatives></disp-formula>
Here, the half saturation constant <italic>K</italic> gives the condition <italic>c</italic> at which half of the maximum survival is reached and <italic>s</italic><sub>max</sub> is the maximum survival probability that is approached when <italic>c</italic> is large.</p>
<p>The condition of a genotype is given by
<disp-formula id="eqn12"><alternatives><graphic xlink:href="347344_eqn12.gif"/></alternatives></disp-formula>
where <italic>e</italic><sub><italic>k</italic></sub>(<bold><italic>x</italic></bold>) is the efficiency of an allele&#x2019;s MHC molecule against pathogen <italic>k</italic> in an environment with <italic>m</italic> pathogens. We assume that these efficiencies are traded off and we model this trade-off with Gaussian functions
<disp-formula id="eqn13"><alternatives><graphic xlink:href="347344_eqn13.gif"/></alternatives></disp-formula>
(see <xref ref-type="fig" rid="fig1">Fig. 1</xref>). Each of these multivariate Gaussian functions describes how the efficiency of an allele characterised by the <italic>h</italic>-dimensional vector <bold><italic>x</italic></bold> decreases with increasing distance from the pathogen optimum <italic>p</italic><sub><italic>k</italic></sub>. Hence, pathogen optimum <italic>p</italic><sub><italic>k</italic></sub> and allelic trait values <bold><italic>x</italic></bold> can be interpreted as points in a <italic>h</italic>-dimensional space. The closer an allelic trait is to a pathogen optimum the higher is the efficiency of the MHC molecule against that pathogen. The magnitude of the decrease in efficiency with increasing distance is determined by the shape of the Gaussian function given by the <italic>h</italic>-dimensional variance-covariance matrix &#x2211;<sub><italic>k</italic></sub>.</p>
</sec>
</sec>
<sec id="s8">
<label>7</label>
<title>Mathematical derivations</title>
<sec id="s8a">
<label>7.1</label>
<title>The evolutionarily singular point</title>
<p>In this section, we analyse the evolutionary dynamics of a monomorphic resident population (<bold><italic>X</italic></bold> &#x003D; <bold><italic>x</italic></bold>) in full generality. Panel (c&#x0026;d) in <xref ref-type="fig" rid="figS3">Fig. S3</xref> are based on this general case. By applying several symmetry assumptions we then derive the analytical results presented in the main text (see <xref ref-type="sec" rid="s8d">Section 7.4</xref> and 7.5). The invasion fitness of a rare mutant allele <italic>y</italic> is given by its marginal fitness and for a monomorphic population <xref ref-type="disp-formula" rid="eqn3">Eq. 3</xref> simplifies to
<disp-formula id="eqn14"><alternatives><graphic xlink:href="347344_eqn14.gif"/></alternatives></disp-formula>
Note that <italic>s</italic><sub>max</sub> cancels out. Since this is also true for the polymorphic case it is omitted from all further calculations. The direction of the evolutionary dynamics is governed by the selection gradient. Its <italic>i</italic>th entry calculates to
<disp-formula id="eqn15"><alternatives><graphic xlink:href="347344_eqn15.gif"/></alternatives></disp-formula>
Using the definitions for <italic>s</italic> (<xref ref-type="disp-formula" rid="eqn9">Eq. 9</xref>) and <italic>c</italic> (<xref ref-type="disp-formula" rid="eqn10">Eq. 10</xref>) and their derivatives
<disp-formula id="eqn16"><alternatives><graphic xlink:href="347344_eqn16.gif"/></alternatives></disp-formula>
and
<disp-formula id="eqn17"><alternatives><graphic xlink:href="347344_eqn17.gif"/></alternatives></disp-formula>
where <xref ref-type="disp-formula" rid="eqn15">Eq. 15</xref> is obtained by applying the generalised product <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline12.gif"/></alternatives></inline-formula>
we obtain
<disp-formula id="eqn18"><alternatives><graphic xlink:href="347344_eqn18.gif"/></alternatives></disp-formula>
In the next step we calculate the derivative of the function <italic>e</italic><sub><italic>k</italic></sub>(<bold><italic>y</italic></bold>) (<xref ref-type="disp-formula" rid="eqn11">Eq. 11</xref>). Applying the chain rule and simplifying results in
<disp-formula id="ueqn4"><alternatives><graphic xlink:href="347344_ueqn4.gif"/></alternatives></disp-formula>
where the entries of the matrix <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline13.gif"/></alternatives></inline-formula> are denoted by <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline14.gif"/></alternatives></inline-formula>. Using that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline15.gif"/></alternatives></inline-formula> for <italic>i</italic> &#x2260; <italic>j</italic> and <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline16.gif"/></alternatives></inline-formula> for <italic>i</italic> &#x003D; <italic>j</italic> this further simplifies to
<disp-formula id="eqn19"><alternatives><graphic xlink:href="347344_eqn19.gif"/></alternatives></disp-formula>
Substituting <xref ref-type="disp-formula" rid="eqn17">Eq. 17</xref> into <xref ref-type="disp-formula" rid="eqn16">Eq. 16</xref> finally results in
<disp-formula id="ueqn5"><alternatives><graphic xlink:href="347344_ueqn5.gif"/></alternatives></disp-formula>
and
<disp-formula id="eqn20"><alternatives><graphic xlink:href="347344_eqn20.gif"/></alternatives></disp-formula>
As mentioned in 6.1 singular points <bold><italic>x</italic></bold>&#x002A; are allelic trait vectors for which <xref ref-type="disp-formula" rid="eqn18">Eq. 18</xref> equals zero. From <xref ref-type="disp-formula" rid="eqn18">Eq. 18</xref> follows that in our model singular points have to fulfil
<disp-formula id="ueqn6"><alternatives><graphic xlink:href="347344_ueqn6.gif"/></alternatives></disp-formula>
Solving for <bold><italic>x</italic></bold>&#x002A; yeilds
<disp-formula id="eqn21"><alternatives><graphic xlink:href="347344_eqn21.gif"/></alternatives></disp-formula>
Thus, the unique singular point <bold><italic>x</italic></bold>&#x002A; equals the arithmetic mean of the pathogen optima <italic>p</italic><sub>1</sub>,&#x2026; <italic>p</italic><sub><italic>m</italic></sub>, each weighted by the inverse of their Gaussian covariance matrices &#x2211;<sub>1</sub>,&#x2026;,&#x2211;<sub>m</sub>. For a one dimensional trait space (<italic>h</italic> &#x003D; 1) this simplifies to
<disp-formula id="eqn22"><alternatives><graphic xlink:href="347344_eqn22.gif"/></alternatives></disp-formula>
which is the well-known weighted average for scalars. If &#x2211;<sub>1</sub> &#x003D;&#x2026; &#x003D; &#x2211;<sub><italic>m</italic></sub>, then <xref ref-type="disp-formula" rid="eqn19">Eq. 19</xref> simplifies to the arithmetic mean pathogen optimum
<disp-formula id="eqn23"><alternatives><graphic xlink:href="347344_eqn23.gif"/></alternatives></disp-formula>
as stated in the main text.</p>
</sec>
<sec id="s8b">
<label>7.2</label>
<title>Derivation of the Hessian matrix</title>
<p>As stated in <xref ref-type="disp-formula" rid="eqn6">Eq. 6</xref>, the entries of the Hessian matrix are given by
<disp-formula id="eqn24"><alternatives><graphic xlink:href="347344_eqn24.gif"/></alternatives></disp-formula>
The second derivative of the function <italic>s</italic> is obtained by differentiating <xref ref-type="disp-formula" rid="eqn14">Eq. 14</xref> with respect to <italic>y</italic><sub><italic>j</italic></sub> resulting in
<disp-formula id="eqn25"><alternatives><graphic xlink:href="347344_eqn25.gif"/></alternatives></disp-formula>
where in the final simplification step we use the conclusion drawn from <xref ref-type="disp-formula" rid="eqn16">Eq. 16</xref> that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline17.gif"/></alternatives></inline-formula> and therefore the term after the minus sign disappears.</p>
<p>The second derivative for the function c is obtained by differentiating <xref ref-type="disp-formula" rid="eqn15">Eq. 15</xref> with respect to <italic>y</italic><sub><italic>j</italic></sub> resulting in
<disp-formula id="eqn26"><alternatives><graphic xlink:href="347344_eqn26.gif"/></alternatives></disp-formula>
Here, the one but last simplification step again follows from the fact that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline18.gif"/></alternatives></inline-formula>.</p>
<p>The second derivative for the function <italic>e</italic><sub><italic>k</italic></sub> is obtained by differentiating <xref ref-type="disp-formula" rid="eqn17">Eq. 17</xref> with respect to <italic>y</italic><sub><italic>j</italic></sub> resulting in
<disp-formula id="eqn27"><alternatives><graphic xlink:href="347344_eqn27.gif"/></alternatives></disp-formula>
where the last simplification uses that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline19.gif"/></alternatives></inline-formula> for <italic>i</italic> &#x2260; <italic>j</italic> and <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline20.gif"/></alternatives></inline-formula> for <italic>i</italic> &#x003D; <italic>j</italic>.</p>
<p>By recursively substituting <xref ref-type="disp-formula" rid="eqn23">Eqs. 23</xref>-<xref ref-type="disp-formula" rid="eqn25">25</xref> into <xref ref-type="disp-formula" rid="eqn6">Eq. 6</xref> we obtain
<disp-formula id="ueqn7"><alternatives><graphic xlink:href="347344_ueqn7.gif"/></alternatives></disp-formula>
where in the last step we substituted <xref ref-type="disp-formula" rid="eqn17">Eq. 17</xref>. This result can be rewritten as a matrix
<disp-formula id="ueqn8"><alternatives><graphic xlink:href="347344_ueqn8.gif"/></alternatives></disp-formula>
Finally, substituting <bold><italic>x</italic></bold>&#x002A; with <xref ref-type="disp-formula" rid="eqn19">Eq. 19</xref> we obtain
<disp-formula id="eqn28"><alternatives><graphic xlink:href="347344_eqn28.gif"/></alternatives></disp-formula>
</p>
</sec>
<sec id="s8c">
<label>7.3</label>
<title>Derivation of the Jacobian matrix</title>
<p>From <xref ref-type="disp-formula" rid="eqn6">Eqs. 6</xref> and <xref ref-type="disp-formula" rid="eqn7">7</xref> we can conclude that the entries of the Jacobian matrix J are given by
<disp-formula id="ueqn9"><alternatives><graphic xlink:href="347344_ueqn9.gif"/></alternatives></disp-formula>
For <italic>q</italic><sub><italic>ij</italic></sub> we obtain
<disp-formula id="eqn29"><alternatives><graphic xlink:href="347344_eqn29.gif"/></alternatives></disp-formula>
where in the final simplification step we use the conclusion drawn from <xref ref-type="disp-formula" rid="eqn13">Eq. 13</xref> that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline21.gif"/></alternatives></inline-formula> and therefore the term after the minus sign disappears.</p>
<p>The mixed derivative of the function <italic>s</italic> is obtained by differentiating <xref ref-type="disp-formula" rid="eqn14">Eq. 14</xref> with respect to <italic>x</italic><sub><italic>j</italic></sub> resulting in
<disp-formula id="eqn30"><alternatives><graphic xlink:href="347344_eqn30.gif"/></alternatives></disp-formula>
where the final simplification follows from the fact that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline22.gif"/></alternatives></inline-formula>.</p>
<p>The mixed derivative for the function <italic>c</italic> is obtained by differentiating <xref ref-type="disp-formula" rid="eqn15">Eq. 15</xref> with respect to <italic>x</italic><sub><italic>j</italic></sub> resulting in
<disp-formula id="eqn31"><alternatives><graphic xlink:href="347344_eqn31.gif"/></alternatives></disp-formula>
Here, the one but last simplification step again follows from the fact that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline23.gif"/></alternatives></inline-formula>.</p>
<p>By recursively substituting <xref ref-type="disp-formula" rid="eqn28">Eqs. 28</xref> and <xref ref-type="disp-formula" rid="eqn29">29</xref> into <xref ref-type="disp-formula" rid="eqn27">Eq. 27</xref> we obtain
<disp-formula id="ueqn10"><alternatives><graphic xlink:href="347344_ueqn10.gif"/></alternatives></disp-formula>
where in the last step we substituted <xref ref-type="disp-formula" rid="eqn17">Eq. 17</xref>. This result can be rewritten in matrix form as
<disp-formula id="ueqn11"><alternatives><graphic xlink:href="347344_ueqn11.gif"/></alternatives></disp-formula>
Finally, substituting <bold><italic>x</italic></bold>&#x002A; with <xref ref-type="disp-formula" rid="eqn19">Eq. 19</xref> we obtain
<disp-formula id="eqn32"><alternatives><graphic xlink:href="347344_eqn32.gif"/></alternatives></disp-formula>
Combining <xref ref-type="disp-formula" rid="eqn26">Eqs. 26</xref> and <xref ref-type="disp-formula" rid="eqn30">30</xref>) and simplifying results in the Jacobian matrix we obtain
<disp-formula id="eqn33"><alternatives><graphic xlink:href="347344_eqn33.gif"/></alternatives></disp-formula>
Note that all matrices &#x2211;<sub><italic>k</italic></sub> are symmetric and therefore J is symmetric. Furthermore, J is the product of a negative scalar and sum of <italic>m</italic> positive-definite matrices. Taken together, we can conclude that J is negative definite and the singular point <bold><italic>x</italic></bold>&#x002A; is absolutely convergence stable in the sense of <xref ref-type="bibr" rid="c60">Leimar (2009)</xref>.</p>
</sec>
<sec id="s8d">
<label>7.4</label>
<title>Special case: Identically shaped pathogen optima</title>
<p>For the special case that the covariance matrices &#x2211;<sub><italic>i</italic></sub> are equal (&#x2211;<sub>1</sub> &#x003D; &#x2211;<sub>2</sub> &#x003D;&#x2026; &#x003D; &#x2211;<sub><italic>m</italic></sub> &#x003D; &#x2211;) the Hessian matrix simplifies to
<disp-formula id="eqn34"><alternatives><graphic xlink:href="347344_eqn34.gif"/></alternatives></disp-formula>
where we used that <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline24.gif"/></alternatives></inline-formula> is the variance-covariance matrix V of the positions <italic>p</italic><sub><italic>k</italic></sub> of the task optima. Since the ratio in <xref ref-type="disp-formula" rid="eqn32">Eq. 32</xref> is positive and &#x2211;<sup>&#x2212;1</sup> is positive definite it follows that the definiteness of H is given by the definiteness of the matrix V &#x2013; 2&#x2211;. Hence, the singular point <bold><italic>x</italic></bold>&#x002A; is uninvadable whenever V &#x2013; 2&#x2211; is negative definite. Panel (b) in <xref ref-type="fig" rid="figS3">Fig. S3</xref> is based on this case.</p>
<p>How do the entries of V and &#x2211; affect the definiteness of H&#x003F; Generally, increasing a diagonal element of a symmetric matrix either increases all its eigenvalues or increases some eigenvalues while leaving the remaining ones constant (e.g. Horn and Johnson <xref ref-type="bibr" rid="c57">2013</xref>, corollary 4.3.12). Thus, increasing diagonal elements of V or decreasing diagonal elements of &#x2211; can increase the eigenvalues of V &#x2013; 2&#x2211; and never decreases them. Thus, increasing the variance in the pathogen optima and decreasing the variance in the efficiency functions <italic>e</italic><sub><italic>i</italic></sub> makes evolutionary branching more likely. No simple statement is possible with respect to the off-diagonal elements.</p>
</sec>
<sec id="s8e">
<label>7.5</label>
<title>Special case: Maximal symmetry</title>
<p>For the even more special case that &#x2211; &#x003D; &#x03C3;<sup>2</sup>I and that the pathogen optima are arranged in a symmetric manner resulting in V &#x003D; &#x03C5;<sup>2</sup>I we obtain
<disp-formula id="eqn35"><alternatives><graphic xlink:href="347344_eqn35.gif"/></alternatives></disp-formula>
In this case, the singular point <bold><italic>x</italic></bold>&#x002A; is a branching point whenever &#x03C5;<sup>2</sup> &#x003E; 2&#x03C3;<sup>2</sup>. Assuming that all <italic>m</italic> pathogen optima have an equal distance <italic>d</italic> to each other implies that they are arranged in a m &#x2013; 1-dimensional regular simplex (see <xref ref-type="fig" rid="fig1">Fig. 1</xref>). For this case &#x03C5;<sup>2</sup> &#x003D; <italic>d</italic><sup>2</sup>/(2<italic>m</italic>) and we obtain the branching condition <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="347344_inline25.gif"/></alternatives></inline-formula>. Panel (a) and the results in the main text are based on this case.</p>
<p>Efficient binding of an MHC molecule to a pathogenic antigen is a high dimensional optimisation problem with many degrees of freedom. Here, we assume that in the presence of two pathogens, this problem reduces to an optimisation problem along a linear manifold that connects the two optima corresponding to the two pathogens. Similarly, in the presence of three pathogens the optimisation problem reduces to a twodimensional manifold, and, more generally, in the presence of m pathogens to a (<italic>m</italic>-1)-dimensional manifold. This assumption seems reasonable as long as the number of pathogens does not exceed the number of dimensions that is needed to describe match between a MHC molecule and a pathogenic antigen. The only consequence of restricting the analysis in this manner is that directions in which mutations are deleterious, because they cause maladaptations for all pathogens, are omitted from the analysis. This effects the speed of the evolutionary dynamics but not the final number of coexisting alleles. The assumption that <italic>m</italic> pathogens are arranged in a (<italic>m</italic>-1)-dimensional regular simplex where any two pathogen optima are separated by the same distance <italic>d</italic> imposes maximal symmetry and facilitates analytical calculations.</p>
</sec>
</sec>
<ref-list>
<title>References</title>
<ref id="c46"><mixed-citation publication-type="journal"><string-name><surname>Abrams</surname>, <given-names>P. A.</given-names></string-name>, <string-name><given-names>H.</given-names> <surname>Matsuda</surname></string-name>, and <string-name><given-names>Y.</given-names> <surname>Harada</surname></string-name>. <year>1993</year>. <article-title>Evolutionarily unstable fitness maxima and stable fitness minima of continuous traits</article-title>. <source>Evolutionary Ecology</source> <volume>7</volume>:<fpage>465</fpage>&#x2013;<lpage>487</lpage>.</mixed-citation></ref>
<ref id="c47"><mixed-citation publication-type="journal"><string-name><surname>Champagnat</surname>, <given-names>N.</given-names></string-name>, <string-name><given-names>R.</given-names> <surname>Ferri&#x00E8;re</surname></string-name>, and <string-name><given-names>S.</given-names> <surname>M&#x00E9;l&#x00E9;ard</surname></string-name>. <year>2006</year>. <article-title>Unifying evolutionary dynamics: from individual stochastic processes to macroscopic models</article-title>. <source>Theoretical Population Biology</source> <volume>69</volume>:<fpage>297</fpage>&#x2013;<lpage>321</lpage>.</mixed-citation></ref>
<ref id="c48"><mixed-citation publication-type="journal"><string-name><surname>D&#x00E9;barre</surname>, <given-names>F.</given-names></string-name>, <string-name><given-names>S. L.</given-names> <surname>Nuismer</surname></string-name>, and <string-name><given-names>M.</given-names> <surname>Doebeli</surname></string-name>. <year>2014</year>. <article-title>Multidimensional (co) evolutionary stability</article-title>. <source>The American Naturalist</source> <volume>184</volume>:<fpage>158</fpage>&#x2013;<lpage>171</lpage>.</mixed-citation></ref>
<ref id="c49"><mixed-citation publication-type="book"><string-name><surname>Dercole</surname>, <given-names>F.</given-names></string-name>, and <string-name><given-names>S.</given-names> <surname>Rinaldi</surname></string-name>. <year>2008</year>. <chapter-title>Analysis of evolutionary processes: the adaptive dynamics approach and its applications: the adaptive dynamics approach and its applications</chapter-title>. <publisher-name>Princeton University Press</publisher-name>.</mixed-citation></ref>
<ref id="c50"><mixed-citation publication-type="journal"><string-name><surname>Dieckmann</surname>, <given-names>U.</given-names></string-name>, and <string-name><given-names>R.</given-names> <surname>Law</surname></string-name>. <year>1996</year>. <article-title>The dynamical theory of coevolution: a derivation from stochastic ecological processes</article-title>. <source>Journal of Mathematical Biology</source> <volume>34</volume>:<fpage>579</fpage>&#x2013;<lpage>612</lpage>.</mixed-citation></ref>
<ref id="c51"><mixed-citation publication-type="book"><string-name><surname>Doebeli</surname>, <given-names>M.</given-names></string-name> <year>2011</year>. <source>Adaptive Diversification (MPB-48)</source>. <publisher-name>Princeton University Press</publisher-name>.</mixed-citation></ref>
<ref id="c52"><mixed-citation publication-type="journal"><string-name><surname>Durinx</surname>, <given-names>M.</given-names></string-name>, <string-name><given-names>J. A. J. H.</given-names> <surname>Metz</surname></string-name>, and <string-name><given-names>G.</given-names> <surname>Mesz&#x00e9;na</surname></string-name>. <year>2008</year>. <article-title>Adaptive dynamics for physiologically structured population models</article-title>. <source>Journal of Mathematical Biology</source> <volume>56</volume>:<fpage>673</fpage>&#x2013;<lpage>742</lpage>.</mixed-citation></ref>
<ref id="c53"><mixed-citation publication-type="book"><string-name><surname>Fisher</surname>, <given-names>R. A.</given-names></string-name> <year>1930</year>. <chapter-title>The genetical theory of natural selection</chapter-title>. <publisher-name>Oxford University Press</publisher-name>.</mixed-citation></ref>
<ref id="c54"><mixed-citation publication-type="journal"><string-name><surname>Geritz</surname>, <given-names>S. A. H.</given-names></string-name>, <string-name><given-names>E.</given-names> <surname>Kisdi</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Mesz&#x00E9;na</surname></string-name>, and <string-name><given-names>J. A. J.</given-names> <surname>Metz</surname></string-name>. <year>1998</year>. <article-title>Evolutionarily singular strategies and the adaptive growth and branching of the evolutionary tree</article-title>. <source>Evolutionary Ecology</source> <volume>12</volume>:<fpage>35</fpage>&#x2013;<lpage>57</lpage>.</mixed-citation></ref>
<ref id="c55"><mixed-citation publication-type="journal"><string-name><surname>Geritz</surname>, <given-names>S. A. H.</given-names></string-name>, <string-name><given-names>J. A. J.</given-names> <surname>Metz</surname></string-name>, and <string-name><given-names>C.</given-names> <surname>Rueffler</surname></string-name>. <year>2016</year>. <article-title>Mutual invadability near evolutionarily singular strategies for multivariate traits, with special reference to the strongly convergence stable case</article-title>. <source>Journal of Mathematical Biology</source> <volume>72</volume>:<fpage>1081</fpage>&#x2013;<lpage>1099</lpage>.</mixed-citation></ref>
<ref id="c56"><mixed-citation publication-type="book"><string-name><surname>Gillespie</surname>, <given-names>J. H.</given-names></string-name> <year>2004</year>. <source>Population Genetics: A Concise Guide</source>. <publisher-name>The Johns Hopkins University Press</publisher-name>.</mixed-citation></ref>
<ref id="c57"><mixed-citation publication-type="book"><string-name><surname>Horn</surname>, <given-names>R. A.</given-names></string-name>, and <string-name><given-names>C. R.</given-names> <surname>Johnson</surname></string-name>. <year>2013</year>. <source>Matrix analysis</source>, <edition>2nd</edition>. <publisher-loc>New York</publisher-loc>: <publisher-name>Cambridge University Press</publisher-name>.</mixed-citation></ref>
<ref id="c58"><mixed-citation publication-type="journal"><string-name><surname>Iwasa</surname>, <given-names>Y.</given-names></string-name>, <string-name><given-names>A.</given-names> <surname>Pomiankowski</surname></string-name>, and <string-name><given-names>S.</given-names> <surname>Nee</surname></string-name>. <year>1991</year>. <article-title>The evolution of costly mate preferences ii. the handicap principle</article-title>. <source>Evolution</source> <volume>45</volume>:<fpage>1431</fpage>&#x2013;<lpage>1442</lpage>.</mixed-citation></ref>
<ref id="c59"><mixed-citation publication-type="journal"><string-name><surname>Lande</surname>, <given-names>R.</given-names></string-name> <year>1979</year>. <article-title>Quantitative genetic analysis of multivariate evolution, applied to brain: body size allometry</article-title>. <source>Evolution</source> <volume>33</volume>:<fpage>402</fpage>&#x2013;<lpage>416</lpage>.</mixed-citation></ref>
<ref id="c60"><mixed-citation publication-type="journal"><string-name><surname>Leimar</surname>, <given-names>O.</given-names></string-name> <year>2009</year>. <article-title>Multidimensional convergence stability</article-title>. <source>Evolutionary Ecology Research</source> <volume>11</volume>:<fpage>191</fpage>&#x2013;<lpage>208</lpage>.</mixed-citation></ref>
<ref id="c61"><mixed-citation publication-type="book"><string-name><surname>Metz</surname>, <given-names>J. A. J.</given-names></string-name> <year>2008</year>. <chapter-title>Fitness</chapter-title>. Pages <fpage>1599</fpage>&#x2013;<lpage>1612</lpage> in <person-group person-group-type="editor"><string-name><given-names>S. E.</given-names> <surname>Jorgensen</surname></string-name> and <string-name><given-names>B.</given-names> <surname>Fath</surname></string-name></person-group>, eds. <source>Encyclopedia of ecology</source>. <publisher-loc>Oxford</publisher-loc>: <publisher-name>Elsevier</publisher-name>, available online as IIASA Interim Report IR06061.</mixed-citation></ref>
<ref id="c62"><mixed-citation publication-type="journal"><string-name><surname>Metz</surname>, <given-names>J. A. J.</given-names></string-name>, and <string-name><given-names>C. G. F.</given-names> <surname>de Kovel</surname></string-name>. <year>2013</year>. <article-title>The canonical equation of adaptive dynamics for Mendelian diploids and haplo-diploids</article-title>. <source>Interface Focus</source> <volume>3</volume>.</mixed-citation></ref>
<ref id="c63"><mixed-citation publication-type="journal"><string-name><surname>Metz</surname>, <given-names>J. A. J.</given-names></string-name>, <string-name><given-names>R. M.</given-names> <surname>Nisbet</surname></string-name>, and <string-name><given-names>S. A. H.</given-names> <surname>Geritz</surname></string-name>. <year>1992</year>. <article-title>How should we define fitness for general ecological scenarios&#x003F;</article-title> <source>Trends in Ecology &#x0026; Evolution</source> <volume>7</volume>:<fpage>198</fpage>&#x2013;<lpage>202</lpage>.</mixed-citation></ref>
<ref id="c64"><mixed-citation publication-type="journal"><string-name><surname>Rueffler</surname>, <given-names>C.</given-names></string-name>, <string-name><given-names>T. J. M.</given-names> <surname>Van Dooren</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Leimar</surname></string-name>, and <string-name><given-names>P. A.</given-names> <surname>Abrams</surname></string-name>. <year>2006</year>. <article-title>Disruptive selection and then what&#x003F;</article-title> <source>Trends in Ecology&#x0026;Evolution</source> <volume>21</volume>:<fpage>238</fpage>&#x2013;<lpage>245</lpage>.</mixed-citation></ref>
<ref id="c65"><mixed-citation publication-type="journal"><string-name><surname>Wright</surname>, <given-names>S.</given-names></string-name> <year>1931</year>. <article-title>Evolution in Mendelian populations</article-title>. <source>Genetics</source> <volume>16</volume>:<fpage>97</fpage>&#x2013;<lpage>159</lpage>.</mixed-citation></ref>
</ref-list>
</back>
</article>