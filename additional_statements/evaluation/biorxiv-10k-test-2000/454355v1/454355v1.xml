<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">BIORXIV</journal-id>
<journal-title-group>
<journal-title>bioRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/454355</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="author-type">
<subject>Regular Article</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>New Results</subject>
</subj-group>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Genomics</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Fast Hierarchical Bayesian Analysis of Population Structure</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4397-2224</contrib-id>
<name>
<surname>Tonkin-Hill</surname>
<given-names>Gerry</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5360-1254</contrib-id>
<name>
<surname>Lees</surname>
<given-names>John A.</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Bentley</surname>
<given-names>Stephen D.</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Frost</surname>
<given-names>Simon D.W.</given-names>
</name>
<xref ref-type="aff" rid="a3">3</xref>
<xref ref-type="aff" rid="a4">4</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7752-1942</contrib-id>
<name>
<surname>Corander</surname>
<given-names>Jukka</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a5">5</xref>
<xref ref-type="aff" rid="a6">6</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Parasites and Microbes, Wellcome Sanger Institute</institution>, Cambridge, <country>United Kingdom</country></aff>
<aff id="a2"><label>2</label><institution>Department of Microbiology, New York University School of Medicine</institution>, 10016, <country>USA</country></aff>
<aff id="a3"><label>3</label><institution>Department of Veterinary Medicine, University of Cambridge</institution>, Cambridge, <country>United Kingdom</country></aff>
<aff id="a4"><label>4</label><institution>The Alan Turing Institute</institution>, London, <country>United Kingdom</country></aff>
<aff id="a5"><label>5</label><institution>Department of Biostatistics, University of Oslo</institution>, Blindern, 0317, <country>Norway</country></aff>
<aff id="a6"><label>6</label><institution>Helsinki Institute for Information Technology HIIT, Department of Mathematics and Statistics, University of Helsinki</institution>, 00014 <country>Finland</country></aff>
</contrib-group>
<author-notes>
<corresp>Correspondence: <email>gt4@sanger.ac.uk</email></corresp>
</author-notes>
<pub-date pub-type="epub">
<year>2018</year>
</pub-date>
<elocation-id>454355</elocation-id>
<history>
<date date-type="received">
<day>26</day>
<month>10</month>
<year>2018</year>
</date>
<date date-type="rev-recd">
<day>26</day>
<month>10</month>
<year>2018</year>
</date>
<date date-type="accepted">
<day>26</day>
<month>10</month>
<year>2018</year>
</date>
</history>
<permissions><copyright-statement>&#x00A9; 2018, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2018</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="454355.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract>
<p>We present fastbaps, a fast solution to the genetic clustering problem. Fastbaps rapidly identifies an approximate fit to a Dirichlet Process Mixture model (DPM) for clustering multilocus genotype data. Our efficient model-based clustering approach is able to cluster datasets 10-100 times larger than the existing model-based methods, which we demonstrate by analysing an alignment of over 110,000 sequences of HIV-1 pol genes. We also provide a method for rapidly partitioning an existing hierarchy in order to maximise the DPM model marginal likelihood, allowing us to split phylogenetic trees into clades and subclades using a population genomic model. Extensive tests on simulated data as well as a diverse set of real bacterial and viral datasets show that fastbaps provides comparable or improved solutions to previous model-based methods, while generally being significantly faster. The method is made freely available under an open source MIT licence as an easy to use R package at <ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps">https://github.com/gtonkinhill/fastbaps</ext-link>.</p>
</abstract>
<counts>
<page-count count="16"/>
</counts>
</article-meta>
</front>
<body>
<sec id="s1">
<title>Introduction</title>
<p>Identifying clusters of genetically similar individuals within a larger population is a common problem in genetics and ecology. Population structure is helpful in understanding past historical population events, conservation genetics, the analysis of invasive species and disease outbreaks. Confounding population structure must also be considered in tests for natural selection as well as genetic association studies (<xref ref-type="bibr" rid="c1">1</xref>&#x2013;<xref ref-type="bibr" rid="c3">3</xref>).</p>
<p>Methods for clustering genotype data can generally be separated into those based on a statistical model of population structure, where observations from each underlying cluster are assumed to be drawn from a parametric model, and distance-based methods that rely on more general clustering techniques such as k-means (<xref ref-type="bibr" rid="c4">4</xref>). Whilst distance-based approaches are generally faster, they are not as readily inter-pretable and come with no statistical guarantees regarding large-sample behavior. Model-based methods typically indicate the probability that an individual belongs to a certain cluster, allow for different models to be compared and can provide estimates of uncertainty for the inferred parameters. Generally, either Bayesian or maximum-likelihood based approaches are widely used for inference in population structure models.</p>
<p>A commonly considered model of population structure assumes that there is a fixed number of uncorrelated underlying populations, <italic>K</italic>. An individual is then assumed to originate either from a single population, the no-admixture model, or to carry alleles from multiple populations, which corresponds to the admixture model (<xref ref-type="bibr" rid="c5">5</xref>). Solutions to this problem include STRUCTURE (<xref ref-type="bibr" rid="c5">5</xref>, <xref ref-type="bibr" rid="c6">6</xref>), BAPS (<xref ref-type="bibr" rid="c7">7</xref>&#x2013;<xref ref-type="bibr" rid="c9">9</xref>), Admixture (<xref ref-type="bibr" rid="c10">10</xref>), fastStructure (<xref ref-type="bibr" rid="c11">11</xref>) and the method of Anderson and Thompson (<xref ref-type="bibr" rid="c12">12</xref>). More recently, methods that combine model-based techniques with an initial faster distance-based clustering have been proposed including snapclust (<xref ref-type="bibr" rid="c13">13</xref>) and hierBAPS (<xref ref-type="bibr" rid="c14">14</xref>).</p>
<p>A common theme of most model-based methods is that they require the underlying number of clusters, <italic>K</italic>, to be provided. In practice, the methods are usually run over a range of <italic>K</italic> and the &#x2018;best fitting&#x2019; model is selected (<xref ref-type="bibr" rid="c15">15</xref>, <xref ref-type="bibr" rid="c16">16</xref>). An alternative Bayesian solution is to put a prior on the number of clusters, usually using a Dirichlet process mixture model (DPM) in an attempt to infer <italic>K</italic> as part of the model (<xref ref-type="bibr" rid="c17">17</xref>, <xref ref-type="bibr" rid="c18">18</xref>). Whilst this provides a natural method for inferring an appropriate <italic>K</italic>, the approach is very computationally expensive and does not scale to large numbers of loci and individuals. The greedy stochastic optimisation approach in hierBAPS (<xref ref-type="bibr" rid="c14">14</xref>) places a discrete uniform prior on <italic>K</italic> up to a supplied maximum value and is able to scale to larger datasets. However, as datasets become very large, inferring <italic>K</italic> using model-based clustering approaches has so far been infeasible. An example of a dataset that is too large for current model-based methods is the set of HIV-1 pol genes, which are routinely generated in clinical settings for the purposes of identifying resistance to antivirals. Despite the relatively short length of this region (typically 1200-1500 base pairs long), the very large number of sequences - in excess of 100,000 in public databases alone-makes choosing an appropriate value for <italic>K</italic> very challenging.</p>
<p>The Bayesian hierarchical clustering (BHC) algorithm (<xref ref-type="bibr" rid="c19">19</xref>) presents an alternative approach that approximates a Dirichlet Process Mixture model whilst guaranteeing a solution in polynomial time. The method performs a version of agglomerative bottom up clustering using a Dirichlet process to account for uncertainty in the data and Bayesian model selection to decide which clusters should be merged at each step. Whilst the approach has been shown to succeed in clustering text documents, microarray data and even electrical demand profiles (<xref ref-type="bibr" rid="c19">19</xref>&#x2013;<xref ref-type="bibr" rid="c21">21</xref>), it has yet to be successfully applied to the problem of identifying population structure. A reason for this is that the hyperparameters (<italic>&#x03B2;</italic>) of the model defining each component of the mixture are set to be proportional to the counts of each allele at each loci in the complete dataset. In practice setting the hyperparameters to be proportional to the entire dataset leads to an overpartitioning of population genetic data whereby the algorithm identifies a very high number of clusters (see Results). A common alternative prior in population structure studies is to use a symmetric Dirichlet prior (<xref ref-type="bibr" rid="c5">5</xref>). However, at the lowest levels of the hierarchy a symmetric prior will lead to different clustering combinations having the same posterior likelihood. This greatly reduces the ability of the algorithm to accurately cluster sequences at the lower levels. In contrast, the hierBAPS algorithm relies on a fast initial clustering using complete-linkage agglomerative clustering to provide an initial partition of the dataset. hier-BAPS then performs a greedy stochastic optimisation procedure to identify the local maximum a posteriori (MAP). By taking advantage of a fast initial clustering approach similar to that used in hierBAPS we are able to place a symmetric or BAPS prior on the mixture components, enabling the BHC algorithm to distinguish between different combinations of clusters.</p>
<p>Though methods such as hierBAPS and snapclust have allowed for analyses to scale to much larger datasets than previous approaches, they remain in practice inapplicable to the currently emerging datasets comprising tens of thousands or even hundreds of thousands of sequences, where very large numbers of underlying clusters may be present. Here, through incorporating ideas from both BHC and hier-BAPS, we produce an efficient inference solution to the no-admixture model for very large datasets when the underlying number of clusters may be in the tens or hundreds.</p>
</sec>
<sec id="s2">
<title>Methods</title>
<sec id="s2a">
<title>Initial clustering</title>
<p>Similar to hierBAPS, but unlike the original BHC algorithm, fastbaps begins by generating a fast initial clustering of the data using a value for <italic>K</italic> much larger than expected (<italic>K</italic><sub>init</sub>). This has the advantage of both reducing the complexity of the Bayesian agglomerative stage whilst allowing for symmetric priors to be used. Starting with a multiple sequence alignment in FASTA format, we first generate a pairwise single nucleotide polymorphism (SNP) distance matrix before clustering using Ward&#x2019;s agglomerative clustering (<xref ref-type="bibr" rid="c22">22</xref>). This hierarchy is cut to generate <italic>K</italic><sub>init</sub> clusters. The hierarchy is also used to estimate the hyper-parameters <italic>&#x03B2;</italic> of the individual mixture component priors. Very large datasets make the calculation of the initial pairwise distance matrix prohibitive. To counter this limitation, for datasets with more than 10,000 individuals we produce the initial clustering by first performing a Principal Component Analysis before clustering the first 50 principal components using a fast hierarchical algorithm such as genie or the memory efficient Ward algorithm in the fastcluster package (<xref ref-type="bibr" rid="c23">23</xref>, <xref ref-type="bibr" rid="c24">24</xref>). This removes the need to calculate the complete distance matrix.</p>
</sec>
<sec id="s2b">
<title>Bayesian hierarchical clustering</title>
<p>Given a collection of small clusters and their respective hierarchies, the BHC algorithm of Heller and Ghahramani (<xref ref-type="bibr" rid="c19">19</xref>) proceeds in a similar fashion to traditional agglomerative clustering. In the place of a distance metric, Bayesian hypothesis testing is conducted at each level to decide which clusters to merge. Let <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline1.gif"/>
</alternatives>
</inline-formula> describe the entire dataset of <italic>n</italic> samples and <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline2.gif"/>
</alternatives>
</inline-formula> the set of points at the leaves of the subtree <italic>T<sub>i</sub></italic>. We initialise the algorithm with the small subtrees obtained using the fast clustering step as shown in <xref ref-type="fig" rid="fig1">Figure 1</xref>. At each subsequent stage we then consider merging all pairs of existing trees. If trees <italic>T<sub>i</sub></italic> and <italic>T<sub>j</sub></italic> are merged into a combined tree <italic>T<sub>k</sub></italic> then the set of points corresponding to the new tree is <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline3.gif"/>
</alternatives>
</inline-formula>. At each merge we compare two hypotheses. The merged hypothesis, which we denote <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline4.gif"/>
</alternatives>
</inline-formula>, is that all data in <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline5.gif"/>
</alternatives>
</inline-formula> were generated identically and independently from the same probabilistic model <italic>p</italic>(<bold><italic>x</italic></bold>&#x007C;<italic>&#x03B8;</italic>) with unknown parameters <italic>&#x03B8;</italic>. In our case this model is a multinomial, with parameters <italic>&#x03B8;</italic> &#x003D; (<italic>n, p</italic>). We also specify a Dirichlet prior over the parameters <italic>p</italic> with hyperparameters <italic>&#x03B2;</italic>. Thus, we can write the probability of the data <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline6.gif"/>
</alternatives>
</inline-formula> under <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline7.gif"/>
</alternatives>
</inline-formula> as
<disp-formula id="ueqn1">
<alternatives>
<graphic xlink:href="454355_ueqn1.gif"/>
</alternatives>
</disp-formula></p>
<fig id="fig1" position="float">
<label>Fig. 1.</label>
<caption><p>A diagram outlining the fastbaps algorithm. An initial clustering is performed by default using agglomerative clustering with the Ward linkage method. Subsequently the merge with the highest posterior probability is chosen. The final clustering is then determined by only accepting merges with a posterior probability &#x003E; 0.5</p></caption>
<graphic xlink:href="454355_fig1.tif"/>
</fig>
<p>Assuming a multinomial-Dirichlet distribution, this integral is tractable and we can rewrite the above equation as
<disp-formula id="ueqn2">
<alternatives>
<graphic xlink:href="454355_ueqn2.gif"/>
</alternatives>
</disp-formula>
Where <italic>N<sub>L</sub></italic> is the number of loci, <italic>N<sub>A<sub>(<italic>j</italic>)</sub></sub></italic> is the number of possible alleles at loci <italic>j</italic> and <italic>n<sub>jl</sub></italic> is the number of copies of allele <italic>l</italic> at locus <italic>j</italic>. <italic>&#x03B2;<sub>j</sub></italic> is the corresponding Dirichlet prior hyperparameter.</p>
<p>The alternative hypothesis to merging two clusters <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline8.gif"/>
</alternatives>
</inline-formula> is that the data <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline9.gif"/>
</alternatives>
</inline-formula> have two or more clusters. Summing over all the possible partitions of <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline10.gif"/>
</alternatives>
</inline-formula> into two or more groups is in practice intractable. However, by only considering partitions that are consistent with the subtrees <italic>T<sub>i</sub></italic> and <italic>T<sub>j</sub></italic>, we can use recursion to quickly compute this sum. Under the restriction of remaining consistent with the subtrees, the probability of the data under the alternative hypothesis <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline11.gif"/>
</alternatives>
</inline-formula>, is just the product over the subtrees <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline12.gif"/>
</alternatives>
</inline-formula> (see <xref ref-type="fig" rid="fig1">Figure 1</xref>) where the probability of the data given the tree is given by
<disp-formula id="ueqn3">
<alternatives>
<graphic xlink:href="454355_ueqn3.gif"/>
</alternatives>
</disp-formula>
</p>
<p>The prior for the merged hypothesis <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline13.gif"/>
</alternatives>
</inline-formula>, can be computed bottom-up as described in Heller and Ghahramani, (<xref ref-type="bibr" rid="c19">19</xref>) and is a deterministic function of the concentration parameter of the DPM. In practice, for the size of datasets we are considering, the actual value of <italic>&#x03B1;</italic> makes very little difference as the prior <italic>&#x03C0;<sub>k</sub></italic> is dominated by the factorial on the number of points within a cluster. Similar to Savage et al., (<xref ref-type="bibr" rid="c21">21</xref>), we fix t he v alue o f <italic>&#x03B1;</italic>, the concentration parameter of the DPM, rather than keeping it as a user-tunable hyperparameter in the resulting clustering algorithm.</p>
<p>Finally, given the probabilities of each hypothesis described above we can calculate the posterior probability of the merged hypothesis <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline14.gif"/>
</alternatives>
</inline-formula> using Bayes&#x2019; rule
<disp-formula id="ueqn4">
<alternatives>
<graphic xlink:href="454355_ueqn4.gif"/>
</alternatives>
</disp-formula>
</p>
<p>We use this quantity to greedily decide which two subtrees to merge. After generating a final hierarchy we then use the same quantity to identify which merges were justified and cut the tree when <italic>r<sub>k</sub></italic> &#x003C; 0.5.</p>
</sec>
<sec id="s2c">
<title>Hyperparameter selection</title>
<p>As described in Heller and Ghahramani (<xref ref-type="bibr" rid="c19">19</xref>), for any given set of hyperparameters, the root node of the hierarchy approximates the probability of the data given that setting of the hyperparameters. By leveraging this, we use the marginal likelihood of the root node <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline15.gif"/>
</alternatives>
</inline-formula> to perform model comparisons for different settings of the hyperparameters. We found that different settings of the hyperparameter <italic>&#x03B1;</italic> had a negligible impact on the final clustering due to the dominance of the factorial component of <italic>&#x03C0;<sub>k</sub></italic>, which provided a strong motivation to fix the hyperparameter at the value <italic>&#x03B1;</italic> &#x003D; 1. Similar to Heller and Ghahramani (<xref ref-type="bibr" rid="c19">19</xref>) and Savage et al., (<xref ref-type="bibr" rid="c21">21</xref>), we use golden section search as provided in R&#x2019;s &#x2018;optimise&#x2019; function to select the <italic>&#x03B2;</italic> parameters and thus the variance of the Dirichlet prior. Unlike previous approaches, we did not set the <italic>&#x03B2;</italic> parameters to be proportional to the discrete total counts for the entire dataset. Instead we used either a symmetric prior, similar to Pritchard et al.,(<xref ref-type="bibr" rid="c5">5</xref>) or the non-informative prior <inline-formula>
<alternatives>
<inline-graphic xlink:href="454355_inline16.gif"/>
</alternatives>
</inline-formula> as used in hierBAPS and suggested in Anderson and Thompson (<xref ref-type="bibr" rid="c12">12</xref>). These priors are referred to as optimised symmetric, and optimised BAPS priors hereafter. These priors were found to generally outperform the prior used in the original BHC algorithm. To increase the efficiency in optimising the variance of the Dirichlet prior, we relied on an initial hierarchy produced using Ward&#x2019;s agglomerative clustering. The marginal likelihood of the root node was then used to select an appropriate scaling for the <italic>&#x03B2;</italic> hyperparameters. We subsequently refer to the combination of fast cluster initialization, Bayesian hierarchical clustering and prior hyperparameter optimisation using a symmetric or BAPS based prior as &#x2018;fastbaps&#x2019;.</p>
</sec>
<sec id="s2d">
<title>Conditioning on a pre-computed hierarchy</title>
<p>Given a precomputed hierarchy or phylogeny, we can use the recursion method described previously to decide when merging subclades of the tree is justified according to the DPM model. This allows us to identify a partition of the tree into clades that maximises the marginal likelihood of a DPM model given this hierarchy. As the hierarchy is pre-calculated, this approach is highly efficient and has a linear computational complexity in the number of nodes in the hierarchy. By leveraging the sparse matrix data structures in fastbaps and coupling them with the efficient implementation of Ward&#x2019;s hierarchical clustering in the fastcluster package (<xref ref-type="bibr" rid="c24">24</xref>), we are able to generate clusterings of comparable quality to the full fastbaps algorithm very quickly (see <xref ref-type="fig" rid="fig4">Figure 4</xref>).</p>
</sec>
<sec id="s2e">
<title>Cluster stability using the Bootstrap</title>
<p>In order to determine the sensitivity of the resulting clusters to the alignment, we implemented a simple bootstrap procedure. For each bootstrap replicate, the loci are sampled with replacement and the fastbaps clustering algorithm is run. A binary similarity matrix is then produced as described in Strehl and Ghosh (<xref ref-type="bibr" rid="c25">25</xref>) where for each pair of sequences (i,j), the (i,j)th entry in the matrix is 1 if the ith and jth sequences are clustered together and 0 otherwise. As this matrix is invariant to label switching (<xref ref-type="bibr" rid="c26">26</xref>) and its dimension is invariant to the underlying number of clusters, the sum of the resulting matrices can be used to provide an indication of the stability of a given clustering of two isolates. This can be plotted in a heatmap alongside the dendrogram produced using the full algorithm to illustrate the robustness of the final clustering.</p>
</sec>
<sec id="s2f">
<title>Implementation</title>
<p>The fastbaps method is implemented using R and C&#x002B;&#x002B; and is available as an R package under the MIT open source licence at <ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps">https://github.com/gtonkinhill/fastbaps</ext-link>. It can be run on Unix, Mac, or Windows operating systems and takes a multiple sequence alignment as input. The results can easily be parsed in R allowing for the generation of informative plots and further processing. The sparse matrix data structure generated by the package can also be used in other analysis types such as Principal Component Analysis (PCA) or k-means. All code to reproduce the simulations and results in this paper is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps_manuscript">https://github.com/gtonkinhill/fastbaps_manuscript</ext-link>.</p>
</sec>
<sec id="s2g">
<title>Simulation and evaluation</title>
<p>To compare the results of different algorithms, population structure was simulated using scrm as part of the Coala R package (<xref ref-type="bibr" rid="c27">27</xref>, <xref ref-type="bibr" rid="c28">28</xref>). The number of underlying populations, recombination rate and migration rate were varied as described in <xref ref-type="table" rid="tblS1">Supplementary Table 1</xref>. Each parameter combination was run for 3 replicates providing 90 test datasets for analysis. A more detailed description of how the simulations were run can be found in the supplementary R notebook. Three clustering algorithms were considered in addition to the fastbaps approach. Snapclust and hierBAPS are available as R packages and were compared with fastbaps along with the fully Bayesian Structure algorithm (<xref ref-type="bibr" rid="c5">5</xref>, <xref ref-type="bibr" rid="c13">13</xref>, <xref ref-type="bibr" rid="c14">14</xref>, <xref ref-type="bibr" rid="c29">29</xref>). Snapclust was run in parallel with the number of underlying clusters, <italic>K</italic>, varied between 2 and 30. The best fitting model was then chosen using either the Bayesian Information Criterion (BIC) or the Akaike Information Criterion (AIC). HierBAPS was run with 50 initial clusters. Finally, Structure was run with the no admixture model with 100,000 burn in iterations and 500,000 sampled iterations with 3 separate starting conditions. The run with highest likelihood was kept. The underlying number of clusters was fixed to the simulated <italic>K</italic> when running Structure to obtain a result in a reasonable amount of time, which nevertheless gives the method an unrealistic advantage against the alternatives which are fast enough to identify <italic>K</italic>.</p>
<p>To compare the simulated populations with those inferred by the different clustering algorithms, we used the Fowlkes-Mallows index (<xref ref-type="bibr" rid="c30">30</xref>). This accounts for both false positives and false negatives in determining the similarity between two clusterings and is defined as
<disp-formula id="ueqn5">
<alternatives>
<graphic xlink:href="454355_ueqn5.gif"/>
</alternatives>
</disp-formula>
</p>
<p>Here <italic>T P</italic> is the number of pairs of individuals that appear together in both clusterings, <italic>F P</italic> is the number that appear together in the inferred clusters but not the simulated and <italic>F N</italic> are those pairs that originated from the same population in the simulated data but are separated in the inferred clusters. Thus a clustering that perfectly matches the simulation with receive a Fowlkes-Mallows index of 1.</p>
<p>To compare with real data, six bacterial and two viral datasets were considered. The sets were chosen to cover a diverse range of pathogen species. The bacterial sets included the enteric bacteria <italic>Escherichia coli</italic>, the gram negative respiratory pathogen <italic>Haemophilus influenzae</italic>, as well as the firmicutes <italic>Streptococcus pneumoniae</italic>, <italic>Listeria monocytogenes</italic> and <italic>Staphylococcus aureus</italic> (<xref ref-type="bibr" rid="c31">31</xref>&#x2013;<xref ref-type="bibr" rid="c35">35</xref>). The two viral datasets comprised a subset of sequences from the recent Ebola out-break as well as a global dataset of over 110,000 HIV partial pol genes (positions 1-1497) obtained from the Los Alamos HIV Database (<xref ref-type="bibr" rid="c36">36</xref>, <xref ref-type="bibr" rid="c37">37</xref>), with associated metadata on subtype and country of sampling. A summary of the size of each dataset is given in <xref ref-type="table" rid="tblS2">Supplementary Table 2</xref>. As there is no gold standard truth set for the real datasets we instead chose to compare the inferred clusters with a phylogeny built using Fasttree v2.1.10 (<xref ref-type="bibr" rid="c38">38</xref>). Here, we counted the number of pairs of isolates within each cluster that were inconsistent with the phylogeny in that there was an isolate belonging to another cluster within the clade representing their most recent common ancestor. These were considered &#x2018;false positives&#x2019;. This count was then divided by the total number of possible pairs within each cluster to give an indication of the error rate of the clustering (assuming the phylogeny to be correct). As the number of possible pairs increases with cluster size, this approach appropriately penalises clustering solutions with too many clusters.</p>
</sec>
</sec>
<sec id="s3">
<title>Results</title>
<sec id="s3a">
<title>Fastbaps accurately clusters previously intractable viral and bacterial datasets containing thousands of samples</title>
<p>To investigate the performance of fastbaps on very large datasets, we analysed a dataset of over 110,000 HIV partial pol genes downloaded from the Los Alamos National Laboratories HIV Sequence Database (<ext-link ext-link-type="uri" xlink:href="http://www.hiv.lanl.gov">http://www.hiv.lanl.gov</ext-link>). The large number of sequences in this set presents a significant challenge to most model-based techniques as determining even the range of values of <italic>K</italic> is not straightforward. Additionally, we investigated the success of the algorithm on over 3, 100 pneumococcal genomes from the Maela refugee camp in Thailand (<xref ref-type="bibr" rid="c31">31</xref>). Whilst this dataset has fewer genomes, the large number of variable sites (284,194) makes this dataset very challenging for all current methods.</p>
<p><xref ref-type="fig" rid="fig2">Figure 2</xref> illustrates the resulting clusters inferred by fastbaps using the optimised BAPS prior on both the pneumococcal and HIV datasets. We made use of the UMAP dimensionality reduction method to project the isolates onto a 2D plane as this has been found to perform well in population genetics studies with very high numbers of individuals (<xref ref-type="bibr" rid="c39">39</xref>, <xref ref-type="bibr" rid="c40">40</xref>). As the other model based-methods considered here were unable to produce results on either of these datasets in under a week, we compared the resulting clusters to those inferred using k-means. We used both the <italic>K</italic> identified by fastbaps as well as the <italic>K</italic> found using the &#x2018;elbow method&#x2019; (<xref ref-type="bibr" rid="c41">41</xref>) when running the k-means algorithm. <xref ref-type="fig" rid="fig2">Figure 2a</xref> indicates that fastbaps mostly corresponds with the groupings formed in the UMAP projection. The visualization also demonstrates the utility of investigating the variability of the level of clonality across the clusters, as the layout of some clusters is more scattered spatially, reflecting the varying influence of recombination on the relatedness of pneumococcal strains. Whilst the k-means algorithm using the fastbaps inferred <italic>K</italic> (<italic>K</italic> &#x003D; 79), provides a similar result, the <italic>K</italic> inferred using the elbow method leads to many inferred clusters being separated across the projection (<xref ref-type="fig" rid="figS1">Supplementary Figures 1</xref> &#x0026; <xref ref-type="fig" rid="figS2">2</xref>). This highlights the advantages of using model-based techniques when investigating genetic datasets.</p>
<fig id="fig2" position="float">
<label>Fig. 2.</label>
<caption><p><bold>a</bold> A UMAP projection of over 3,100 pneumococcal genomes from Maela Thailand. The points are labeled and coloured by the cluster inferred using fastbaps with the optimised BAPS prior. In general the labeling appears to agree with the grouping observed in the UMAP projection. <bold>b</bold> Over 110,000 HIV-1 pol gene sequences from the Los Alamos public database. Sequences are coloured by their fastbaps inferred cluster. The large red cluster in the center contrasts with the noisy clustering observed using k-means (<xref ref-type="fig" rid="figS3">Supplementary Figure 3</xref>). The same plot with points numbered with their corresponding cluster is shown in <xref ref-type="fig" rid="figS4">Supplementary Figure 4</xref>. <bold>c</bold> Violin plots indicating the proportion of each inferred cluster that make up its most dominant subtype. Cluster size is represented by the size of a point and the width of the violin plot is proportional to the total number of clusters inferred. The fastbaps algorithm with the optimised BAPS prior provides a clustering that is most consistent with the underlying HIV subtypes whilst not overly segmenting the dataset. <bold>d</bold> Violin plots indicating the proportion of each inferred cluster that make up its most dominant country. Interestingly, the fastbaps approach is able to provide clusters that are more consistent with the underlying geography than alternative approaches such as k-means.</p></caption>
<graphic xlink:href="454355_fig2.tif"/>
</fig>
<p>The fastbaps algorithm provides a cleaner clustering of the HIV dataset as seen in <xref ref-type="fig" rid="fig2">Figure 2b</xref>. Here, the UMAP dimensionality reduction technique as implemented in the umaplearn python package was used to project the isolates onto two dimensions (<xref ref-type="bibr" rid="c39">39</xref>). The large group of isolates in the centre of the UMAP projection has been assigned to one cluster. Conversely, k-means is unable to distinguish this group, and instead partitions it into many smaller overlapping clusters (<xref ref-type="fig" rid="figS3">Supplementary Figure 3</xref> &#x0026; <xref ref-type="fig" rid="figS4">4</xref>). Similar to the pneumococcal dataset, when the lower value of <italic>K</italic> identified using the elbow method is used (<italic>K</italic> &#x003D; 21), the resulting clusters are separated out over the UMAP projection (<xref ref-type="fig" rid="figS5">Supplementary Figure 5</xref>).</p>
<p>As HIV is highly recombinant, comparing the clustering of such a large global dataset to a phylogeny is unlikely to be informative. Instead, to further investigate the quality of the fastbaps clustering we examined the HIV subtype composition (inferred using a variety of methods, and including circulating recombinant forms as well as non-recombinant subtypes) as well as the distribution of the countries of origin of the isolates found in each cluster. <xref ref-type="fig" rid="fig2">Figure 2</xref> indicates the proportion of each cluster that was dominated by a single subtype or any of its recombinant forms. Thus a cluster that is composed entirely of one subtype will have a proportion of 1. The figure indicates that despite having the same number of clusters as k-means, the fastbaps algorithm with both the optimised BAPS and optimised symmetric prior identifies larger clusters of purely one subtype.</p>
<p>This suggests the algorithm is identifying legitimate clusters within the dataset without over-partitioning the data. A similar comparison was made to investigate the proportion of each cluster that was dominated by a single country. <xref ref-type="fig" rid="fig2">Figure 2d</xref> indicates that fastbaps provides clusters that are more consistent with the underlying geography where as the k-means is dominated by many clusters that comprise isolates from many countries. Fastbaps was also used to partition a phylogeny. The resulting clustering produced a larger number of clusters due to the restriction of the phylogeny but the resulting clusters were more consistent by subtype and geography than those inferred using k-means.</p>
</sec>
<sec id="s3b">
<title>Simulations show that fastbaps cluster accuracy is the same as previous methods</title>
<p>In order to compare with different methods we made use of simulations where the true clustering solution was known. The Structure, hierBAPS, snapclust and fastbaps algorithms all achieved similar levels of accuracy on the simulated datasets (<xref ref-type="fig" rid="fig3">Figure 3</xref>). As expected, an increase in the migration rate between the simulated demes led to a subsequent decrease in the abilityof the methods to accurately identify the underlying population structure. Additionally, a lower recombination rate led to poorer results, which is probably due to the algorithms correctly identifying additional phylogenetic structure within each cluster. Snapclust using AIC to select <italic>K</italic> as well as the fastbaps algorithm with the optimised BAPS prior achieved the best results over the simulated datasets. hier-BAPS achieved a similar level of accuracy to the fastbaps algorithms using both the original (unscaled) BAPS prior as well as the optimised symmetric prior. Structure and Snap-clust with BIC performed worst over the simulations. This was despite the MCMC chains of each Structure run showing good convergence characteristics (<xref ref-type="fig" rid="figS6">Supplementary Figure 6</xref>). A closer investigation of the Structure results indicated that it tended to allocate empty clusters despite being given the correct <italic>K</italic>. This suggests that both Snapclust with BIC and Structure tend to be overly conservative in estimating the number of underlying clusters <italic>K</italic>.</p>
<fig id="fig3" position="float">
<label>Fig. 3.</label>
<caption><p>Violin plot indicating the Fowlkes-Mallows distance between the simulated clusters and those inferred by the different algorithms. Results for two distinct recombination rates are shown (10 and 100) as well as four different migration rates. The underlying number of clusters varied between 5-25. The plot indicates that as the migration rate increases the accuracy of the algorithm falls. Additionally, a lower recombination rate leads to lower accuracy, which is likely due to the algorithms identifying additional population structure within each simulated deme.</p></caption>
<graphic xlink:href="454355_fig3.tif"/>
</fig>
</sec>
<sec id="s3c">
<title>Fastbaps is efficient and accurate on a diverse range of viral and bacterial datasets</title>
<p>To investigate the ability of each algorithm to detect population structure in real datasets, we made use of six additional bacterial and viral datasets of varying sizes and complexity (<xref ref-type="table" rid="tbl2">Table 2</xref>). <xref ref-type="fig" rid="fig4">Figure 4</xref> indicates the resulting clusters inferred by the most promising algorithms from the simulation analysis on both a <italic>Neisseria meningitidis</italic> and <italic>Haemophilus influenzae</italic> data set. Here, we also provide comparisons with the prior from the original BHC algorithm and a partition of a Fasttree phylogeny using fastbaps. On the <italic>H. influenzae</italic> dataset, fastbaps using the optimised BAPS prior provided a clustering that was the most consistent with the phylogeny. Both the hierBAPS and snapclust solutions included polyphyletic clusters whilst the Bayesian Hierarchical Clustering (BHC) population mean based prior gave a similar result to the optimised BAPS solution. It should be noted that the initial fast clustering step was the same for both the BHC and optimised BAPS clusterings. The BHC prior failed to perform adequately on the large <italic>N. meningitidis</italic> dataset. Here, the BHC prior led to a highly partitioned solution with over 80 very small clusters. Conversely, the optimised BAPS prior led to a solution of similar quality to both hierBAPS and snapclust. Uncertainty in the Fasttree phylogenies was considered by comparing them with a bootstrapped phylogeny built using IQTREE v1.6.5 with the results found to be very similar. In both of these datasets the partition of the phylogeny using fastbaps provided a solution similar to that found using the optimised BAPS prior indicating it is an appropriate choice if a user&#x2019;s goal is to simply partition a pre-calculated phylogeny.</p>
<fig id="fig4" position="float">
<label>Fig. 4.</label>
<caption><p><bold>a,b</bold>. The resulting clustering inferred by hierBAPS, snapclust and fastbaps with both the original BHC prior and the optimised BAPS prior on both Staphylococcus aureus (<bold>a</bold>) and Neisseria meningitidis (<bold>b</bold>). The clusters are shown in comparison to a phylogeny generated using Fasttree. The final clustering indicates a partition of the Fasttree phylogeny using the fastbaps algorithm and thus is constrained to be consistent with the phylogeny. <bold>c.</bold> The proportion of isolate pairs that appear in the same inferred cluster but have isolates from a separate cluster in the clade represented by their most recent common ancestor in the Fasttree phylogeny. This provides a indication of the error of each algorithm assuming the phylogeny generated by Fasttree is correct. The fastbaps algorithm using either the optimised BAPS or symmetric prior outperforms the other methods on 5 out of 6 datasets.</p></caption>
<graphic xlink:href="454355_fig4.tif"/>
</fig>
<p><xref ref-type="fig" rid="fig4">Figure 4c</xref>, summarises the results of running the algorithms on all these data sets except the large HIV and pneumococcal collections. The figure indicates the number of pairs of isolates that are clustered together using the population structure algorithms but that are inconsistent with the phylogeny. Assuming the Fasttree phylogeny is accurate, this provides a measurement of error for each of the runs. The fastbaps algorithm with either the optimised symmetric or optimised BAPS priors archives a superior clustering on five out of six of the datasets. On the <italic>N. meningitidis</italic> dataset the snapclust algorithm using the BIC model selection criteria outperforms the other methods. The BIC model selection technique more heavily penalises solutions with a larger number of clusters and was in the simulations shown to frequently result in too few clusters. It is unlikely that the other methods are over-partitioning these data relative to snapclust with BIC. Hence, the outlying result for <italic>N. meningitidis</italic> could rather be due to inaccuracies in the Fasttree phylogeny, since <italic>N. meningitidis</italic> has a high recombination rate.</p>
<p>The computational run times and maximum memory requirements of each of the algorithms are shown in <xref ref-type="table" rid="tbl1">Tables 1</xref> &#x0026; <xref ref-type="table" rid="tbl2">2</xref> respectively. The tables indicate that fastbaps often performs more than an order of magnitude faster than snapclust and hi-erBAPS which themselves significantly outperform Structure in computational efficiency (<xref ref-type="bibr" rid="c13">13</xref>, <xref ref-type="bibr" rid="c42">42</xref>). Part of this speed is due to the use of highly optimised sparse matrix libraries in fastbaps. As snapclust must be run for all values of <italic>K</italic> that are to be considered, its computational performance is directly tied to the maximum <italic>K</italic> chosen. Here, snapclust was run for a maximum <italic>K</italic> &#x003D; 50 as this corresponded to a sensible upper bound for the <italic>E. coli</italic> dataset. Reducing the maximum <italic>K</italic> to use would improve the timing of the snapclust algorithm at the expense of failing to explore higher dimension solutions. However, <xref ref-type="table" rid="tbl1">Table 1</xref> indicates that the fastbaps algorithm achieves a superior runtime compared with snapclust even for a single value of <italic>K</italic>, whilst automatically determining an appropriate number of clusters. Depending on the dataset, the prior optimisation step in fastbaps can take longer than running the complete algorithm. Thus if a short run-time is a necessity, running the method with a fixed prior is available as an option. Finally, if a hierarchy is already available, either through the use of a traditional phylogeny reconstruction algorithm such as Fasttree or via agglomerative clustering a partition using the fastbaps algorithm can be achieved with a complexity linear in the number of sequences. Fastbaps was able to partition a phylogeny of the full HIV dataset built using Fasttree (<xref ref-type="bibr" rid="c38">38</xref>) in 5.5 minutes.</p>
<table-wrap id="tbl1" position="float">
<label>Table 1.</label>
<caption><title>Total CPU time (seconds) of the different algorithms. Only fastbaps was able to run in under a week for the Pneumococcal and HIV datasets.</title></caption>
<graphic xlink:href="454355_tbl1.tif"/>
</table-wrap>
<table-wrap id="tbl2" position="float">
<label>Table 2.</label>
<caption><title>Maximum memory usage of the different algorithms (Mb)</title></caption>
<graphic xlink:href="454355_tbl2.tif"/>
</table-wrap>
</sec>
</sec>
<sec id="s4">
<title>Discussion</title>
<p>Finding clusters of related sequences present in a genetic alignment is a critical first step for many genetic and ecological analyses, allowing targeted sub-analysis and determination of the structure of the population when external classifications are not present. Model-based clustering methods are attractive due to their ability to hierarchically find highly specific clusters, estimate meaningful clustering parameters incorporating uncertainties, compare different model fits and produce probabilities of cluster assignment. Typical cohort sizes now range between thousands and tens of thousands of samples, growing even larger if combined with previous cohorts. However, the ability of methods to fit a clustering model to these alignments has not increased in step with these increases in alignment size (<xref ref-type="bibr" rid="c13">13</xref>, <xref ref-type="bibr" rid="c29">29</xref>), with even modestly sized datasets requiring gene-by-gene or distance based approaches to determine clusters (<xref ref-type="bibr" rid="c4">4</xref>, <xref ref-type="bibr" rid="c43">43</xref>, <xref ref-type="bibr" rid="c44">44</xref>). Model-based approaches have also proved impractical in surveillance settings, where the continuous addition of small numbers of new sequences would require refitting the entire model.</p>
<p>By leveraging ideas from both the Bayesian Hierarchical Clustering (<xref ref-type="bibr" rid="c19">19</xref>) and the hierBAPS (<xref ref-type="bibr" rid="c14">14</xref>) algorithms, along with a fast sparse matrix based implementation, fastbaps enables efficient model-based clustering of large alignments that were previously infeasible to analyse using existing methods. Our approach enjoys all of the advantages inherent in modelbased approaches and can produce comparable or higher quality clusters than previous methods. Additionally, our algorithm is able to rapidly partition pre-computed phylogenies. This provides an attractive alternative approach for clustering genetic data when a phylogeny is available. The significant acceleration of inference provided by fastbaps enables the use of bootstrap replicates, allowing for the sensitivity of the resulting clusters to the alignment to be investigated in manner that has traditionally not been possible for model-based clustering methods on large alignments.</p>
<p>We verified our new approach by comparing its performance with other algorithms on both simulated data and eight real datasets. We show that as well as a considerable increase in the speed of the algorithm, we are able to achieve comparable accuracy, often outperforming previous model-based approaches. The speed of our new approach allowed us to cluster a large HIV sequence dataset containing over 100,000 sequences. The resulting clusters have higher concordance with HIV subtypes and geography than an alternative approach using k-means, whilst providing a principled method for selecting the underlying number of clusters; a major limitation of k-means.</p>
<p>Whilst our method enables the clustering of very large alignments, its complexity is still tied to the initial hierarchy generation and thus is <italic>O</italic>(<italic>n</italic><sup>2</sup>) or possibly <italic>O</italic>(<italic>nlog</italic>(<italic>n</italic>)) if single linkage hierarchical clustering is used. After the initial hierarchy is generated, the remaining Bayesian hierarchical clustering is of the order <italic>O</italic>(<italic>lm</italic><sup>2</sup>) where <italic>m</italic> is the number of clusters generated in the first stage and is the number of variable sites. Thus, in the future, as alignments begin to comprise tens of millions of sequences, additional improvements will need to be explored. Possible options include exploring the randomised extension to the BHC algorithm (<xref ref-type="bibr" rid="c45">45</xref>) or other machine learning based approaches such as those based on matrix decomposition (<xref ref-type="bibr" rid="c46">46</xref>).</p>
<p>Fastbaps therefore offers two new ways to rapidly find highquality clusters from a genetic alignment or phylogeny. The significant speed increase our software provides over previous approaches enables fitting a clustering model to previously intractable large alignments, and has the potential to allow continuous model refitting in surveillance settings. Fastbaps is provided as an open source package with a clearly documented interface.</p>
</sec>
<sec id="s5" sec-type="availability">
<title>SOFTWARE AVAILABILITY</title>
<p>Source code available from: <ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps">https://github.com/gtonkinhill/fastbaps</ext-link> Code for reproducing figures from:</p>
<p><ext-link ext-link-type="uri" xlink:href="https://github.com/gtonkinhill/fastbaps_manuscript">https://github.com/gtonkinhill/fastbaps_manuscript</ext-link> Archived source code at time of publication to bioRxiv: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.1472299">https://doi.org/10.5281/zenodo.1472299</ext-link></p>
<p>Archived code for figures at time of publication to bioRxiv: <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/badge/latestdoi/142294532">https://zenodo.org/badge/latestdoi/142294532</ext-link></p>
</sec>
</body>
<back>
<ack>
<title>ACKNOWLEDGEMENTS</title>
<p>This work was supported by the Wellcome Trust [206194] and [204016; to GTH; a Wellcome Trust PhD scholarship grant]; JC was supported by the ERC [742158]; and SDWF is supported in part by The Alan Turing Institute via an Engineering and Physical Sciences Research Council grant [EP/510129/1] and by the U.S. National Institutes of Health [R01AI135970].</p>
</ack>
<ref-list>
<title>Bibliography</title>
<ref id="c1"><label>1</label><mixed-citation publication-type="journal"><string-name><given-names>Sergei L</given-names> <surname>Kosakovsky Pond</surname></string-name> and <string-name><given-names>Simon D W</given-names> <surname>Frost</surname></string-name>. <article-title>Not so different after all: a comparison of methods for detecting amino acid sites under selection</article-title>. <source>Mol. Biol. Evol.</source>, <volume>22</volume>(<issue>5</issue>):<fpage>1208</fpage>&#x2013;<lpage>1222</lpage>, <collab>May</collab> <year>2005</year>.</mixed-citation></ref>
<ref id="c2"><label>2</label><mixed-citation publication-type="journal"><string-name><given-names>John A</given-names> <surname>Lees</surname></string-name>, <string-name><given-names>Minna</given-names> <surname>Vehkala</surname></string-name>, <string-name><given-names>Niko</given-names> <surname>V&#x00E4;lim&#x00E4;ki</surname></string-name>, <string-name><given-names>Simon R</given-names> <surname>Harris</surname></string-name>, <string-name><given-names>Claire</given-names> <surname>Chewapreecha</surname></string-name>, <string-name><given-names>Nicholas J</given-names> <surname>Croucher</surname></string-name>, <string-name><given-names>Pekka</given-names> <surname>Marttinen</surname></string-name>, <string-name><given-names>Mark R</given-names> <surname>Davies</surname></string-name>, <string-name><given-names>Andrew C</given-names> <surname>Steer</surname></string-name>, <string-name><given-names>Steven Y C</given-names> <surname>Tong</surname></string-name>, <string-name><given-names>Antti</given-names> <surname>Honkela</surname></string-name>, <string-name><given-names>Julian</given-names> <surname>Parkhill</surname></string-name>, <string-name><given-names>Stephen D</given-names> <surname>Bentley</surname></string-name>, and <string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name>. <article-title>Sequence element enrichment analysis to determine the genetic basis of bacterial phenotypes</article-title>. <source>Nat. Commun.</source>, <volume>7</volume>:<fpage>12797</fpage>, <collab>September</collab> <year>2016</year>.</mixed-citation></ref>
<ref id="c3"><label>3</label><mixed-citation publication-type="journal"><string-name><given-names>Sarah G</given-names> <surname>Earle</surname></string-name>, <string-name><given-names>Chieh-Hsi</given-names> <surname>Wu</surname></string-name>, <string-name><given-names>Jane</given-names> <surname>Charlesworth</surname></string-name>, <string-name><given-names>Nicole</given-names> <surname>Stoesser</surname></string-name>, <string-name><given-names>N</given-names> <surname>Claire Gordon</surname></string-name>, <string-name><given-names>Timothy M</given-names> <surname>Walker</surname></string-name>, <string-name><given-names>Chris C A</given-names> <surname>Spencer</surname></string-name>, <string-name><given-names>Zamin</given-names> <surname>Iqbal</surname></string-name>, <string-name><given-names>David A</given-names> <surname>Clifton</surname></string-name>, <string-name><given-names>Katie L</given-names> <surname>Hopkins</surname></string-name>, <string-name><given-names>Neil</given-names> <surname>Woodford</surname></string-name>, <string-name><given-names>E</given-names> <surname>Grace Smith</surname></string-name>, <string-name><given-names>Nazir</given-names> <surname>Ismail</surname></string-name>, <string-name><given-names>Martin J</given-names> <surname>Llewelyn</surname></string-name>, <string-name><given-names>Tim E</given-names> <surname>Peto</surname></string-name>, <string-name><given-names>Derrick W</given-names> <surname>Crook</surname></string-name>, <string-name><given-names>Gil</given-names> <surname>McVean</surname></string-name>, <string-name><given-names>A</given-names> <surname>Sarah Walker</surname></string-name>, and <string-name><given-names>Daniel J</given-names> <surname>Wilson</surname></string-name>. <article-title>Identifying lineage effects when controlling for population structure improves power in bacterial association studies</article-title>. <source>Nature Microbiology</source>, (April):<fpage>16041</fpage>, April <year>2016</year>.</mixed-citation></ref>
<ref id="c4"><label>4</label><mixed-citation publication-type="journal"><string-name><given-names>Thibaut</given-names> <surname>Jombart</surname></string-name>, <string-name><given-names>S&#x00E9;bastien</given-names> <surname>Devillard</surname></string-name>, and <string-name><given-names>Fran&#x00E7;ois</given-names> <surname>Balloux</surname></string-name>. <article-title>Discriminant analysis of principal components: a new method for the analysis of genetically structured populations</article-title>. <source>BMC Genet.</source>, <volume>11</volume>:<fpage>94</fpage>, <collab>October</collab> <year>2010</year>.</mixed-citation></ref>
<ref id="c5"><label>5</label><mixed-citation publication-type="journal"><string-name><given-names>J K</given-names> <surname>Pritchard</surname></string-name>, <string-name><given-names>M</given-names> <surname>Stephens</surname></string-name>, and <string-name><given-names>P</given-names> <surname>Donnelly</surname></string-name>. <article-title>Inference of population structure using multilocus genotype data</article-title>. <source>Genetics</source>, <volume>155</volume>(<issue>2</issue>):<fpage>945</fpage>&#x2013;<lpage>959</lpage>, <collab>June</collab> <year>2000</year>.</mixed-citation></ref>
<ref id="c6"><label>6</label><mixed-citation publication-type="journal"><string-name><given-names>Daniel</given-names> <surname>Falush</surname></string-name>, <string-name><given-names>Matthew</given-names> <surname>Stephens</surname></string-name>, and <string-name><given-names>Jonathan K</given-names> <surname>Pritchard</surname></string-name>. <article-title>Inference of population structure using multilocus genotype data: linked loci and correlated allele frequencies</article-title>. <source>Genetics</source>, <volume>164</volume>(<issue>4</issue>):<fpage>1567</fpage>&#x2013;<lpage>1587</lpage>, <collab>August</collab> <year>2003</year>.</mixed-citation></ref>
<ref id="c7"><label>7</label><mixed-citation publication-type="journal"><string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name> and <string-name><given-names>Pekka</given-names> <surname>Marttinen</surname></string-name>. <article-title>Bayesian identification of admixture events using multilocus molecular markers</article-title>. <source>Mol. Ecol.</source>, <volume>15</volume>(<issue>10</issue>):<fpage>2833</fpage>&#x2013;<lpage>2843</lpage>, <collab>September</collab> <year>2006</year>.</mixed-citation></ref>
<ref id="c8"><label>8</label><mixed-citation publication-type="journal"><string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name>, <string-name><given-names>Pekka</given-names> <surname>Marttinen</surname></string-name>, <string-name><given-names>Jukka</given-names> <surname>Sir&#x00E9;n</surname></string-name>, and <string-name><given-names>Jing</given-names> <surname>Tang</surname></string-name>. <article-title>Enhanced bayesian modelling in BAPS software for learning genetic structures of populations</article-title>. <source>BMC Bioinformatics</source>, <volume>9</volume>:<fpage>539</fpage>, <collab>December</collab> <year>2008</year>.</mixed-citation></ref>
<ref id="c9"><label>9</label><mixed-citation publication-type="journal"><string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name>, <string-name><given-names>Patrik</given-names> <surname>Waldmann</surname></string-name>, and <string-name><given-names>Mikko J</given-names> <surname>Sillanp&#x00E4;&#x00E4;</surname></string-name>. <article-title>Bayesian analysis of genetic differentiation between populations</article-title>. <source>Genetics</source>, <volume>163</volume>(<issue>1</issue>):<fpage>367</fpage>&#x2013;<lpage>374</lpage>, <collab>January</collab> <year>2003</year>.</mixed-citation></ref>
<ref id="c10"><label>10</label><mixed-citation publication-type="journal"><string-name><given-names>David H</given-names> <surname>Alexander</surname></string-name>, <string-name><given-names>John</given-names> <surname>Novembre</surname></string-name>, and <string-name><given-names>Kenneth</given-names> <surname>Lange</surname></string-name>. <article-title>Fast model-based estimation of ancestry in unrelated individuals</article-title>. <source>Genome Res.</source>, <volume>19</volume>(<issue>9</issue>):<fpage>1655</fpage>&#x2013;<lpage>1664</lpage>, <collab>September</collab> <year>2009</year>.</mixed-citation></ref>
<ref id="c11"><label>11</label><mixed-citation publication-type="journal"><string-name><given-names>Anil</given-names> <surname>Raj</surname></string-name>, <string-name><given-names>Matthew</given-names> <surname>Stephens</surname></string-name>, and <string-name><given-names>Jonathan K</given-names> <surname>Pritchard</surname></string-name>. <article-title>fastSTRUCTURE: variational inference of population structure in large SNP data sets</article-title>. <source>Genetics</source>, <volume>197</volume>(<issue>2</issue>):<fpage>573</fpage>&#x2013;<lpage>589</lpage>, <collab>June</collab> <year>2014</year>.</mixed-citation></ref>
<ref id="c12"><label>12</label><mixed-citation publication-type="journal"><string-name><given-names>E C</given-names> <surname>Anderson</surname></string-name> and <string-name><given-names>E A</given-names> <surname>Thompson</surname></string-name>. <article-title>A model-based method for identifying species hybrids using multilocus genetic data</article-title>. <source>Genetics</source>, <volume>160</volume>(<issue>3</issue>):<fpage>1217</fpage>&#x2013;<lpage>1229</lpage>, <collab>March</collab> <year>2002</year>.</mixed-citation></ref>
<ref id="c13"><label>13</label><mixed-citation publication-type="journal"><string-name><given-names>Marie-Pauline</given-names> <surname>Beugin</surname></string-name>, <string-name><given-names>Thibault</given-names> <surname>Gayet</surname></string-name>, <string-name><given-names>Dominique</given-names> <surname>Pontier</surname></string-name>, <string-name><given-names>S&#x00E9;bastien</given-names> <surname>Devillard</surname></string-name>, and <string-name><given-names>Thibaut</given-names> <surname>Jombart</surname></string-name>. <article-title>A fast likelihood solution to the genetic clustering problem</article-title>. <source>Methods Ecol. Evol.</source>, <volume>9</volume> (<issue>4</issue>):<fpage>1006</fpage>&#x2013;<lpage>1016</lpage>, <collab>April</collab> <year>2018</year>.</mixed-citation></ref>
<ref id="c14"><label>14</label><mixed-citation publication-type="journal"><string-name><given-names>Lu</given-names> <surname>Cheng</surname></string-name>, <string-name><given-names>Thomas R</given-names> <surname>Connor</surname></string-name>, <string-name><given-names>Jukka</given-names> <surname>Sir&#x00E9;n</surname></string-name>, <string-name><given-names>David M</given-names> <surname>Aanensen</surname></string-name>, and <string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name>. <article-title>Hierarchical and spatially explicit clustering of DNA sequences with BAPS software</article-title>. <source>Mol. Biol. Evol.</source>, <volume>30</volume>(<issue>5</issue>):<fpage>1224</fpage>&#x2013;<lpage>1228</lpage>, <collab>May</collab> <year>2013</year>.</mixed-citation></ref>
<ref id="c15"><label>15</label><mixed-citation publication-type="journal"><string-name><given-names>G</given-names> <surname>Evanno</surname></string-name>, <string-name><given-names>S</given-names> <surname>Regnaut</surname></string-name>, and <string-name><given-names>J</given-names> <surname>Goudet</surname></string-name>. <article-title>Detecting the number of clusters of individuals using the software STRUCTURE: a simulation study</article-title>. <source>Mol. Ecol.</source>, <volume>14</volume>(<issue>8</issue>):<fpage>2611</fpage>&#x2013;<lpage>2620</lpage>, <collab>July</collab> <year>2005</year>.</mixed-citation></ref>
<ref id="c16"><label>16</label><mixed-citation publication-type="journal"><string-name><given-names>H</given-names> <surname>Akaike</surname></string-name>. <article-title>A new look at the statistical model identification</article-title>. <source>IEEE Trans. Automat. Contr.</source>, <volume>19</volume> (<issue>6</issue>):<fpage>716</fpage>&#x2013;<lpage>723</lpage>, <collab>December</collab> <year>1974</year>.</mixed-citation></ref>
<ref id="c17"><label>17</label><mixed-citation publication-type="journal"><string-name><given-names>Jerome</given-names> <surname>Pella</surname></string-name> and <string-name><given-names>Michele</given-names> <surname>Masuda</surname></string-name>. <article-title>The gibbs and split-merge sampler for population mixture analysis from genetic data with incomplete baselines</article-title>. <source>Can. J. Fish. Aquat. Sci.</source>, <volume>63</volume>(<issue>3</issue>): <fpage>576</fpage>&#x2013;<lpage>596</lpage>, <collab>April</collab> <year>2011</year>.</mixed-citation></ref>
<ref id="c18"><label>18</label><mixed-citation publication-type="journal"><string-name><given-names>John P</given-names> <surname>Huelsenbeck</surname></string-name>, <string-name><given-names>Peter</given-names> <surname>Andolfatto</surname></string-name>, and <string-name><given-names>Edna T</given-names> <surname>Huelsenbeck</surname></string-name>. <article-title>Structurama: bayesian inference of population structure</article-title>. <source>Evol. Bioinform. Online</source>, <volume>7</volume>:<fpage>55</fpage>&#x2013;<lpage>59</lpage>, <collab>June</collab> <year>2011</year>.</mixed-citation></ref>
<ref id="c19"><label>19</label><mixed-citation publication-type="book"><string-name><given-names>Katherine A</given-names> <surname>Heller</surname></string-name> and <string-name><given-names>Zoubin</given-names> <surname>Ghahramani</surname></string-name>. <chapter-title>Bayesian hierarchical clustering</chapter-title>. In <source>Proceedings of the 22Nd International Conference on Machine Learning, ICML &#x2018;05</source>, pages <fpage>297</fpage>&#x2013;<lpage>304</lpage>, <publisher-name>New York</publisher-name>, <publisher-loc>NY, USA</publisher-loc>, <year>2005</year>. ACM.</mixed-citation></ref>
<ref id="c20"><label>20</label><mixed-citation publication-type="journal"><string-name><given-names>Anthony R</given-names> <surname>Florita</surname></string-name>, <string-name><given-names>Larry J</given-names> <surname>Brackney</surname></string-name>, <string-name><given-names>Todd P</given-names> <surname>Otanicar</surname></string-name>, and <string-name><given-names>Jeffrey</given-names> <surname>Robertson</surname></string-name>. <article-title>Classification of commercial building electrical demand profiles for energy storage applications</article-title>. <source>J. Sol. Energy Eng.</source>, <volume>135</volume>(<issue>3</issue>):<fpage>031020</fpage>, <collab>August</collab> <year>2013</year>.</mixed-citation></ref>
<ref id="c21"><label>21</label><mixed-citation publication-type="journal"><string-name><given-names>Richard S</given-names> <surname>Savage</surname></string-name>, <string-name><given-names>Katherine</given-names> <surname>Heller</surname></string-name>, <string-name><given-names>Yang</given-names> <surname>Xu</surname></string-name>, <string-name><given-names>Zoubin</given-names> <surname>Ghahramani</surname></string-name>, <string-name><given-names>William M</given-names> <surname>Truman</surname></string-name>, <string-name><given-names>Murray</given-names> <surname>Grant</surname></string-name>, <string-name><given-names>Katherine J</given-names> <surname>Denby</surname></string-name>, and <string-name><given-names>David L</given-names> <surname>Wild</surname></string-name>. <article-title>R/BHC: fast bayesian hierarchical clustering for microarray data</article-title>. <source>BMC Bioinformatics</source>, <volume>10</volume>:<fpage>242</fpage>, <collab>August</collab> <year>2009</year>.</mixed-citation></ref>
<ref id="c22"><label>22</label><mixed-citation publication-type="journal"><string-name><given-names>Fionn</given-names> <surname>Murtagh</surname></string-name> and <string-name><given-names>Pierre</given-names> <surname>Legendre</surname></string-name>. <article-title>Ward&#x2019;s hierarchical agglomerative clustering method: Which algorithms implement ward&#x2019;s criterion?</article-title> <source>J. Classification</source>, <volume>31</volume>(<issue>3</issue>):<fpage>274</fpage>&#x2013;<lpage>295</lpage>, <collab>October</collab> <year>2014</year>.</mixed-citation></ref>
<ref id="c23"><label>23</label><mixed-citation publication-type="journal"><string-name><given-names>Marek</given-names> <surname>Gagolewski</surname></string-name>, <string-name><given-names>Maciej</given-names> <surname>Bartoszuk</surname></string-name>, and <string-name><given-names>Anna</given-names> <surname>Cena</surname></string-name>. <article-title>Genie: A new, fast, and outlierresistant hierarchical clustering algorithm</article-title>. <source>Inf. Sci.</source>, <volume>363</volume>:<fpage>8</fpage>&#x2013;<lpage>23</lpage>, <collab>October</collab> <year>2016</year>.</mixed-citation></ref>
<ref id="c24"><label>24</label><mixed-citation publication-type="journal"><string-name><given-names>Daniel</given-names> <surname>M&#x00FC;llner</surname></string-name> and <collab>Others</collab>. <article-title>fastcluster: Fast hierarchical, agglomerative clustering routines for R and python</article-title>. <source>J. Stat. Softw.</source>, <volume>53</volume>(<issue>9</issue>):<fpage>1</fpage>&#x2013;<lpage>18</lpage>, <year>2013</year>.</mixed-citation></ref>
<ref id="c25"><label>25</label><mixed-citation publication-type="journal"><string-name><given-names>Alexander</given-names> <surname>Strehl</surname></string-name> and <string-name><given-names>Joydeep</given-names> <surname>Ghosh</surname></string-name>. <article-title>Cluster ensembles &#x2014; a knowledge reuse framework for combining multiple partitions</article-title>. <source>J. Mach. Learn. Res.</source>, <volume>3</volume>(<issue>Dec</issue>):<fpage>583</fpage>&#x2013;<lpage>617</lpage>, <year>2002</year>.</mixed-citation></ref>
<ref id="c26"><label>26</label><mixed-citation publication-type="journal"><string-name><given-names>Sylvia</given-names> <surname>Richardson</surname></string-name> and <string-name><given-names>Peter J</given-names> <surname>Green</surname></string-name>. <article-title>On bayesian analysis of mixtures with an unknown number of components (with discussion)</article-title>. <source>Journal of the Royal Statistical Society: series B (statistical methodology)</source>, <volume>59</volume>(<issue>4</issue>):<fpage>731</fpage>&#x2013;<lpage>792</lpage>, <year>1997</year>.</mixed-citation></ref>
<ref id="c27"><label>27</label><mixed-citation publication-type="journal"><string-name><given-names>Paul R</given-names> <surname>Staab</surname></string-name>, <string-name><given-names>Sha</given-names> <surname>Zhu</surname></string-name>, <string-name><given-names>Dirk</given-names> <surname>Metzler</surname></string-name>, and <string-name><given-names>Gerton</given-names> <surname>Lunter</surname></string-name>. <article-title>scrm: efficiently simulating long sequences using the approximated coalescent with recombination</article-title>. <source>Bioinformatics</source>, <volume>31</volume>(<issue>10</issue>): <fpage>1680</fpage>&#x2013;<lpage>1682</lpage>, <collab>May</collab> <year>2015</year>.</mixed-citation></ref>
<ref id="c28"><label>28</label><mixed-citation publication-type="journal"><string-name><given-names>Paul R</given-names> <surname>Staab</surname></string-name> and <string-name><given-names>Dirk</given-names> <surname>Metzler</surname></string-name>. <article-title>Coala: an R framework for coalescent simulation</article-title>. <source>Bioinformatics</source>, <volume>32</volume>(<issue>12</issue>):<fpage>1903</fpage>&#x2013;<lpage>1904</lpage>, <collab>June</collab> <year>2016</year>.</mixed-citation></ref>
<ref id="c29"><label>29</label><mixed-citation publication-type="journal"><string-name><given-names>Gerry</given-names> <surname>Tonkin-Hill</surname></string-name>, <string-name><given-names>John A</given-names> <surname>Lees</surname></string-name>, <string-name><given-names>Stephen D</given-names> <surname>Bentley</surname></string-name>, <string-name><given-names>Simon D W</given-names> <surname>Frost</surname></string-name>, and <string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name>. <article-title>RhierBAPS: An R implementation of the population clustering algorithm hierBAPS</article-title>. <source>Wellcome Open Res</source>, <volume>3</volume>:<fpage>93</fpage>, <collab>July</collab> <year>2018</year>.</mixed-citation></ref>
<ref id="c30"><label>30</label><mixed-citation publication-type="journal"><string-name><given-names>E B</given-names> <surname>Fowlkes</surname></string-name> and <string-name><given-names>C L</given-names> <surname>Mallows</surname></string-name>. <article-title>A method for comparing two hierarchical clusterings</article-title>. <source>J. Am. Stat. Assoc.</source>, <volume>78</volume>(<issue>383</issue>):<fpage>553</fpage>&#x2013;<lpage>569</lpage>, <collab>September</collab> <year>1983</year>.</mixed-citation></ref>
<ref id="c31"><label>31</label><mixed-citation publication-type="journal"><string-name><given-names>Claire</given-names> <surname>Chewapreecha</surname></string-name>, <string-name><given-names>Simon R</given-names> <surname>Harris</surname></string-name>, <string-name><given-names>Nicholas J</given-names> <surname>Croucher</surname></string-name>, <string-name><given-names>Claudia</given-names> <surname>Turner</surname></string-name>, <string-name><given-names>Pekka</given-names> <surname>Marttinen</surname></string-name>, <string-name><given-names>Lu</given-names> <surname>Cheng</surname></string-name>, <string-name><given-names>Alberto</given-names> <surname>Pessia</surname></string-name>, <string-name><given-names>David M</given-names> <surname>Aanensen</surname></string-name>, <string-name><given-names>Alison E</given-names> <surname>Mather</surname></string-name>, <string-name><given-names>Andrew J</given-names> <surname>Page</surname></string-name>, <string-name><given-names>Susannah J</given-names> <surname>Salter</surname></string-name>, <string-name><given-names>David</given-names> <surname>Harris</surname></string-name>, <string-name><given-names>Francois</given-names> <surname>Nosten</surname></string-name>, <string-name><given-names>David</given-names> <surname>Goldblatt</surname></string-name>, <string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name>, <string-name><given-names>Julian</given-names> <surname>Parkhill</surname></string-name>, <string-name><given-names>Paul</given-names> <surname>Turner</surname></string-name>, and <string-name><given-names>Stephen D</given-names> <surname>Bentley</surname></string-name>. <article-title>Dense genomic sampling identifies highways of pneumococcal recombination</article-title>. <source>Nat. Genet.</source>, <volume>46</volume>(<issue>3</issue>):<fpage>305</fpage>&#x2013;<lpage>309</lpage>, <collab>March</collab> <year>2014</year>.</mixed-citation></ref>
<ref id="c32"><label>32</label><mixed-citation publication-type="journal"><string-name><given-names>David M</given-names> <surname>Aanensen</surname></string-name>, <string-name><given-names>Edward J</given-names> <surname>Feil</surname></string-name>, <string-name><given-names>Matthew T G</given-names> <surname>Holden</surname></string-name>, <string-name><given-names>Janina</given-names> <surname>Dordel</surname></string-name>, <string-name><given-names>Corin A</given-names> <surname>Yeats</surname></string-name>, <string-name><given-names>Artemij</given-names> <surname>Fedosejev</surname></string-name>, <string-name><given-names>Richard</given-names> <surname>Goater</surname></string-name>, <string-name><given-names>Santiago</given-names> <surname>Castillo-Ram&#x00ED;rez</surname></string-name>, <string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name>, <string-name><given-names>Caroline</given-names> <surname>Colijn</surname></string-name>, <string-name><given-names>Monika A</given-names> <surname>Chlebowicz</surname></string-name>, <string-name><given-names>Leo</given-names> <surname>Schouls</surname></string-name>, <string-name><given-names>Max</given-names> <surname>Heck</surname></string-name>, <string-name><given-names>Gerlinde</given-names> <surname>Pluister</surname></string-name>, <string-name><given-names>Raymond</given-names> <surname>Ruimy</surname></string-name>, <string-name><given-names>Gunnar</given-names> <surname>Kahlmeter</surname></string-name>, <string-name><given-names>Jenny</given-names> <surname>&#x00C5;hman</surname></string-name>, <string-name><given-names>Erika</given-names> <surname>Matuschek</surname></string-name>, <string-name><given-names>Alexander W</given-names> <surname>Friedrich</surname></string-name>, <string-name><given-names>Julian</given-names> <surname>Parkhill</surname></string-name>, <string-name><given-names>Stephen D</given-names> <surname>Bentley</surname></string-name>, <string-name><given-names>Brian G</given-names> <surname>Spratt</surname></string-name>, <string-name><given-names>Hajo</given-names> <surname>Grundmann</surname></string-name>, and <collab>European SRL Working Group</collab>. <article-title>Whole-Genome sequencing for routine pathogen surveillance in public health: a population snapshot of invasive staphylococcus aureus in europe</article-title>. <source>MBio</source>, <volume>7</volume>(<issue>3</issue>), May <year>2016</year>.</mixed-citation></ref>
<ref id="c33"><label>33</label><mixed-citation publication-type="journal"><string-name><given-names>John A</given-names> <surname>Lees</surname></string-name>, <string-name><given-names>Philip H C</given-names> <surname>Kremer</surname></string-name>, <string-name><given-names>Ana S</given-names> <surname>Manso</surname></string-name>, <string-name><given-names>Nicholas J</given-names> <surname>Croucher</surname></string-name>, <string-name><given-names>Bart</given-names> <surname>Ferwerda</surname></string-name>, <string-name><given-names>Mercedes</given-names> <surname>Valls Ser&#x00F3;n</surname></string-name>, <string-name><given-names>Marco R</given-names> <surname>Oggioni</surname></string-name>, <string-name><given-names>Julian</given-names> <surname>Parkhill</surname></string-name>, <string-name><given-names>Matthijs C</given-names> <surname>Brouwer</surname></string-name>, <string-name><given-names>Arie</given-names> <surname>van der Ende</surname></string-name>, <string-name><given-names>Diederik</given-names> <surname>van de Beek</surname></string-name>, and <string-name><given-names>Stephen D</given-names> <surname>Bentley</surname></string-name>. <article-title>Large scale genomic analysis shows no evidence for pathogen adaptation between the blood and cerebrospinal fluid niches during bacterial meningitis</article-title>. <source>Microb Genom</source>, <volume>3</volume>(<issue>1</issue>):<fpage>e000103</fpage>, <collab>January</collab> <year>2017</year>.</mixed-citation></ref>
<ref id="c34"><label>34</label><mixed-citation publication-type="journal"><string-name><given-names>P H C</given-names> <surname>Kremer</surname></string-name>, <string-name><given-names>J A</given-names> <surname>Lees</surname></string-name>, <string-name><given-names>M M</given-names> <surname>Koopmans</surname></string-name>, <string-name><given-names>B</given-names> <surname>Ferwerda</surname></string-name>, <string-name><given-names>A W M</given-names> <surname>Arends</surname></string-name>, <string-name><given-names>M M</given-names> <surname>Feller</surname></string-name>, <string-name><given-names>K</given-names> <surname>Schipper</surname></string-name>, <string-name><given-names>M</given-names> <surname>Valls Seron</surname></string-name>, <string-name><given-names>A</given-names> <surname>van der Ende</surname></string-name>, <string-name><given-names>M C</given-names> <surname>Brouwer</surname></string-name>, <string-name><given-names>D</given-names> <surname>van de Beek</surname></string-name>, and <string-name><given-names>S D</given-names> <surname>Bentley</surname></string-name>. <article-title>Benzalkonium tolerance genes and outcome in listeria monocytogenes meningitis</article-title>. <source>Clin. Microbiol. Infect.</source>, <volume>23</volume>(<issue>4</issue>):<fpage>265.e1</fpage>&#x2013;<lpage>265.e7</lpage>, <collab>April</collab> <year>2017</year>.</mixed-citation></ref>
<ref id="c35"><label>35</label><mixed-citation publication-type="journal"><string-name><given-names>D</given-names> <surname>Koelman</surname></string-name>, <string-name><given-names>P</given-names> <surname>Kremer</surname></string-name>, <string-name><given-names>J</given-names> <surname>Lees</surname></string-name>, <string-name><given-names>M</given-names> <surname>Brouwer</surname></string-name>, <string-name><given-names>S</given-names> <surname>Bentley</surname></string-name>, and <string-name><given-names>D</given-names> <surname>van de Beek</surname></string-name>. <article-title>Bacterial hypervirulence in haemophilus influenzae meningitis identified by whole genome sequencing</article-title>. <source>J. Neurol. Sci.</source>, <volume>381</volume>:<fpage>181</fpage>&#x2013;<lpage>182</lpage>, <collab>October</collab> <year>2017</year>.</mixed-citation></ref>
<ref id="c36"><label>36</label><mixed-citation publication-type="website"><collab>Los Alamos National Laboratory</collab>. <source>HIV databases</source>. <ext-link ext-link-type="uri" xlink:href="https://www.hiv.lanl.gov/content/index">https://www.hiv.lanl.gov/content/index</ext-link>. Accessed: <date-in-citation content-type="access-date">2018-10-25</date-in-citation>.</mixed-citation></ref>
<ref id="c37"><label>37</label><mixed-citation publication-type="journal"><string-name><given-names>Gytis</given-names> <surname>Dudas</surname></string-name>, <string-name><given-names>Luiz</given-names> <surname>Max Carvalho</surname></string-name>, <string-name><given-names>Trevor</given-names> <surname>Bedford</surname></string-name>, <string-name><given-names>Andrew J</given-names> <surname>Tatem</surname></string-name>, <string-name><given-names>Guy</given-names> <surname>Baele</surname></string-name>, <string-name><given-names>Nuno R</given-names> <surname>Faria</surname></string-name>, <string-name><given-names>Daniel J</given-names> <surname>Park</surname></string-name>, <string-name><given-names>Jason T</given-names> <surname>Ladner</surname></string-name>, <string-name><given-names>Armando</given-names> <surname>Arias</surname></string-name>, <string-name><given-names>Danny</given-names> <surname>Asogun</surname></string-name>, <string-name><given-names>Filip</given-names> <surname>Bielejec</surname></string-name>, <string-name><given-names>Sarah L</given-names> <surname>Caddy</surname></string-name>, <string-name><given-names>Matthew</given-names> <surname>Cotten</surname></string-name>, <string-name><given-names>Jonathan</given-names> <surname>D&#x2019;Ambrozio</surname></string-name>, <string-name><given-names>Simon</given-names> <surname>Dellicour</surname></string-name>, <string-name><given-names>Antonino</given-names> <surname>Di Caro</surname></string-name>, <string-name><given-names>Joseph W</given-names> <surname>Diclaro</surname></string-name>, <string-name><given-names>Sophie</given-names> <surname>Duraffour</surname></string-name>, <string-name><given-names>Michael J</given-names> <surname>Elmore</surname></string-name>, <string-name><given-names>Lawrence S</given-names> <surname>Fakoli</surname></string-name>, <string-name><given-names>Ousmane</given-names> <surname>Faye</surname></string-name>, <string-name><given-names>Merle L</given-names> <surname>Gilbert</surname></string-name>, <string-name><given-names>Sahr M</given-names> <surname>Gevao</surname></string-name>, <string-name><given-names>Stephen</given-names> <surname>Gire</surname></string-name>, <string-name><given-names>Adrianne</given-names> <surname>Gladden-Young</surname></string-name>, <string-name><given-names>Andreas</given-names> <surname>Gnirke</surname></string-name>, <string-name><given-names>Augustine</given-names> <surname>Goba</surname></string-name>, <string-name><given-names>Donald S</given-names> <surname>Grant</surname></string-name>, <string-name><given-names>Bart L</given-names> <surname>Haagmans</surname></string-name>, <string-name><given-names>Julian A</given-names> <surname>Hiscox</surname></string-name>, <string-name><given-names>Umaru</given-names> <surname>Jah</surname></string-name>, <string-name><given-names>Jeffrey R</given-names> <surname>Kugelman</surname></string-name>, <string-name><given-names>Di</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>Jia</given-names> <surname>Lu</surname></string-name>, <string-name><given-names>Christine M</given-names> <surname>Malboeuf</surname></string-name>, <string-name><given-names>Suzanne</given-names> <surname>Mate</surname></string-name>, <string-name><given-names>David A</given-names> <surname>Matthews</surname></string-name>, <string-name><given-names>Christian B</given-names> <surname>Matranga</surname></string-name>, <string-name><given-names>Luke W</given-names> <surname>Meredith</surname></string-name>, <string-name><given-names>James</given-names> <surname>Qu</surname></string-name>, <string-name><given-names>Joshua</given-names> <surname>Quick</surname></string-name>, <string-name><given-names>Suzan D</given-names> <surname>Pas</surname></string-name>, <string-name><given-names>My V T</given-names> <surname>Phan</surname></string-name>, <string-name><given-names>Georgios</given-names> <surname>Pollakis</surname></string-name>, <string-name><given-names>Chantal B</given-names> <surname>Reusken</surname></string-name>, <string-name><given-names>Mariano</given-names> <surname>Sanchez-Lockhart</surname></string-name>, <string-name><given-names>Stephen F</given-names> <surname>Schaffner</surname></string-name>, <string-name><given-names>John S</given-names> <surname>Schieffelin</surname></string-name>, <string-name><given-names>Rachel S</given-names> <surname>Sealfon</surname></string-name>, <string-name><given-names>Etienne</given-names> <surname>Simon-Loriere</surname></string-name>, <string-name><given-names>Saskia L</given-names> <surname>Smits</surname></string-name>, <string-name><given-names>Kilian</given-names> <surname>Stoecker</surname></string-name>, <string-name><given-names>Lucy</given-names> <surname>Thorne</surname></string-name>, <string-name><given-names>Ekaete</given-names> <surname>Alice Tobin</surname></string-name>, <string-name><given-names>Mohamed A</given-names> <surname>Vandi</surname></string-name>, <string-name><given-names>Simon J</given-names> <surname>Watson</surname></string-name>, <string-name><given-names>Kendra</given-names> <surname>West</surname></string-name>, <string-name><given-names>Shannon</given-names> <surname>Whitmer</surname></string-name>, <string-name><given-names>Michael R</given-names> <surname>Wiley</surname></string-name>, <string-name><given-names>Sarah M</given-names> <surname>Winnicki</surname></string-name>, <string-name><given-names>Shirlee</given-names> <surname>Wohl</surname></string-name>, <string-name><given-names>Roman</given-names> <surname>W&#x00F6;lfel</surname></string-name>, <string-name><given-names>Nathan L</given-names> <surname>Yozwiak</surname></string-name>, <string-name><given-names>Kristian G</given-names> <surname>Andersen</surname></string-name>, <string-name><given-names>Sylvia O</given-names> <surname>Blyden</surname></string-name>, <string-name><given-names>Fatorma</given-names> <surname>Bolay</surname></string-name>, <string-name><given-names>Miles W</given-names> <surname>Carroll</surname></string-name>, <string-name><given-names>Bernice</given-names> <surname>Dahn</surname></string-name>, <string-name><given-names>Boubacar</given-names> <surname>Diallo</surname></string-name>, <string-name><given-names>Pierre</given-names> <surname>Formenty</surname></string-name>, <string-name><given-names>Christophe</given-names> <surname>Fraser</surname></string-name>, <string-name><given-names>George F</given-names> <surname>Gao</surname></string-name>, <string-name><given-names>Robert F</given-names> <surname>Garry</surname></string-name>, <string-name><given-names>Ian</given-names> <surname>Goodfellow</surname></string-name>, <string-name><given-names>Stephan</given-names> <surname>G&#x00FC;nther</surname></string-name>, <string-name><given-names>Christian T</given-names> <surname>Happi</surname></string-name>, <string-name><given-names>Edward C</given-names> <surname>Holmes</surname></string-name>, <string-name><given-names>Brima</given-names> <surname>Kargbo</surname></string-name>, <string-name><given-names>Sakoba</given-names> <surname>Ke&#x00EF;ta</surname></string-name>, <string-name><given-names>Paul</given-names> <surname>Kellam</surname></string-name>, <string-name><given-names>Marion P G</given-names> <surname>Koopmans</surname></string-name>, <string-name><given-names>Jens H</given-names> <surname>Kuhn</surname></string-name>, <string-name><given-names>Nicholas J</given-names> <surname>Loman</surname></string-name>, <string-name><given-names>N&#x2019;faly</given-names> <surname>Magassouba</surname></string-name>, <string-name><given-names>Dhamari</given-names> <surname>Naidoo</surname></string-name>, <string-name><given-names>Stuart T</given-names> <surname>Nichol</surname></string-name>, <string-name><given-names>Tolbert</given-names> <surname>Nyenswah</surname></string-name>, <string-name><given-names>Gustavo</given-names> <surname>Palacios</surname></string-name>, <string-name><given-names>Oliver G</given-names> <surname>Pybus</surname></string-name>, <string-name><given-names>Pardis C</given-names> <surname>Sabeti</surname></string-name>, <string-name><given-names>Amadou</given-names> <surname>Sall</surname></string-name>, <string-name><given-names>Ute</given-names> <surname>Str&#x00F6;her</surname></string-name>, <string-name><given-names>Isatta</given-names> <surname>Wurie</surname></string-name>, <string-name><given-names>Marc A</given-names> <surname>Suchard</surname></string-name>, <string-name><given-names>Philippe</given-names> <surname>Lemey</surname></string-name>, and <string-name><given-names>Andrew</given-names> <surname>Rambaut</surname></string-name>. <article-title>Virus genomes reveal factors that spread and sustained the ebola epidemic</article-title>. <source>Nature</source>, <volume>544</volume>(<issue>7650</issue>):<fpage>309</fpage>&#x2013;<lpage>315</lpage>, <collab>April</collab> <year>2017</year>. ISSN 0028-0836, 1476-4687. doi: <pub-id pub-id-type="doi">10.1038/nature22040.</pub-id></mixed-citation></ref>
<ref id="c38"><label>38</label><mixed-citation publication-type="journal"><string-name><given-names>Morgan N</given-names> <surname>Price</surname></string-name>, <string-name><given-names>Paramvir S</given-names> <surname>Dehal</surname></string-name>, and <string-name><given-names>Adam P</given-names> <surname>Arkin</surname></string-name>. <article-title>FastTree 2 &#x2013; approximately Maximum-Likelihood trees for large alignments</article-title>. <source>PLoS One</source>, <volume>5</volume>(<issue>3</issue>):<fpage>e9490</fpage>, <collab>March</collab> <year>2010</year>.</mixed-citation></ref>
<ref id="c39"><label>39</label><mixed-citation publication-type="journal"><string-name><given-names>Leland</given-names> <surname>McInnes</surname></string-name> and <string-name><given-names>John</given-names> <surname>Healy</surname></string-name>. <source>UMAP: Uniform manifold approximation and projection for dimension reduction</source>. February <year>2018</year>.</mixed-citation></ref>
<ref id="c40"><label>40</label><mixed-citation publication-type="journal"><string-name><given-names>Alex</given-names> <surname>Diaz-Papkovich</surname></string-name>, <string-name><given-names>Luke</given-names> <surname>Anderson-Trocme</surname></string-name>, and <string-name><given-names>Simon</given-names> <surname>Gravel</surname></string-name>. <source>Revealing multi-scale population structure in large cohorts</source>. September <year>2018</year>.</mixed-citation></ref>
<ref id="c41"><label>41</label><mixed-citation publication-type="journal"><string-name><given-names>Alboukadel</given-names> <surname>Kassambara</surname></string-name>. <source>Practical Guide to Cluster Analysis in R: Unsupervised Machine Learning</source>. <collab>STHDA</collab>, August <year>2017</year>.</mixed-citation></ref>
<ref id="c42"><label>42</label><mixed-citation publication-type="journal"><string-name><given-names>Emily K</given-names> <surname>Latch</surname></string-name>, <string-name><given-names>Guha</given-names> <surname>Dharmarajan</surname></string-name>, <string-name><given-names>Jeffrey C</given-names> <surname>Glaubitz</surname></string-name>, and <string-name><given-names>Olin E</given-names> <surname>Rhodes</surname></string-name>. <article-title>Relative performance of bayesian clustering software for inferringpopulation substructure and individual assignment at low levels of population differentiation</article-title>. <source>Conserv. Genet.</source>, <volume>7</volume>(<issue>2</issue>):<fpage>295</fpage>&#x2013;<lpage>302</lpage>, <collab>April</collab> <year>2006</year>.</mixed-citation></ref>
<ref id="c43"><label>43</label><mixed-citation publication-type="journal"><string-name><given-names>Ji</given-names> <surname>Zhang</surname></string-name>, <string-name><given-names>Jani</given-names> <surname>Halkilahti</surname></string-name>, <string-name><given-names>Marja-Liisa</given-names> <surname>H&#x00E4;nninen</surname></string-name>, and <string-name><given-names>Mirko</given-names> <surname>Rossi</surname></string-name>. <article-title>Refinement of wholegenome multilocus sequence typing analysis by addressing gene paralogy</article-title>. <source>J. Clin. Microbiol.</source>, <volume>53</volume>(<issue>5</issue>):<fpage>1765</fpage>&#x2013;<lpage>1767</lpage>, <collab>May</collab> <year>2015</year>.</mixed-citation></ref>
<ref id="c44"><label>44</label><mixed-citation publication-type="journal"><string-name><given-names>John A</given-names> <surname>Lees</surname></string-name>, <string-name><given-names>Simon R</given-names> <surname>Harris</surname></string-name>, <string-name><given-names>Gerry</given-names> <surname>Tonkin-Hill</surname></string-name>, <string-name><given-names>Rebecca A</given-names> <surname>Gladstone</surname></string-name>, <string-name><given-names>Stephanie</given-names> <surname>Lo</surname></string-name>, <string-name><given-names>Jeffrey N</given-names> <surname>Weiser</surname></string-name>, <string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name>, <string-name><given-names>Stephen D</given-names> <surname>Bentley</surname></string-name>, and <string-name><given-names>Nicholas J</given-names> <surname>Croucher</surname></string-name>. <source>Fast and flexible bacterial genomic epidemiology with PopPUNK</source>. July <year>2018</year>.</mixed-citation></ref>
<ref id="c45"><label>45</label><mixed-citation publication-type="journal"><string-name><given-names>Zoubin</given-names> <surname>Ghahramani Katherine A</surname></string-name>. <article-title>Heller. Randomized algorithms for fast bayesian hierarchical clustering</article-title>. <source>citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.60.298</source>, <year>2005</year>.</mixed-citation></ref>
<ref id="c46"><label>46</label><mixed-citation publication-type="journal"><string-name><given-names>Zhirong</given-names> <surname>Yang</surname></string-name>, <string-name><given-names>Jukka</given-names> <surname>Corander</surname></string-name>, and <string-name><given-names>Erkki</given-names> <surname>Oja</surname></string-name>. <article-title>Low-Rank doubly stochastic matrix decomposition for cluster analysis</article-title>. <source>J. Mach. Learn. Res.</source>, <volume>17</volume>(<issue>187</issue>):<fpage>1</fpage>&#x2013;<lpage>25</lpage>, <year>2016</year>.</mixed-citation></ref>
</ref-list>
<sec id="s6">
<title>Supplementary Figures</title>
<table-wrap id="tblS1" position="float">
<label>Supplementary Table S1:</label>
<caption><title>Parameters used to simulate genetic population structure using scrm (<xref ref-type="bibr" rid="c27">27</xref>)</title></caption>
<graphic xlink:href="454355_tblS1.tif"/>
</table-wrap>
<table-wrap id="tblS2" position="float">
<label>Supplementary Table S2:</label>
<caption><title>The datasets used in the comparison of different clustering methods. The HIV and pneumococcal datasets were only compared with k-means and fastbaps as they are too large for other model based methods.</title></caption>
<graphic xlink:href="454355_tblS2.tif"/>
</table-wrap>
<fig id="figS1" position="float">
<label>Supplementary Figure 1:</label>
<caption><p>A UMAP plot of Pneumococcal isolates coloured and numbered by their inferred clustering using k-means with the number of underlying clusters found using the elbow method (<italic>k</italic> = 48).</p></caption>
<graphic xlink:href="454355_figS1.tif"/>
</fig>
<fig id="figS2" position="float">
<label>Supplementary Figure 2:</label>
<caption><p>A UMAP plot of Pneumococcal isolates coloured and numbered by their inferred clustering using k-means with the number of underlying clusters matching that found using fastbaps (<italic>k</italic> &#x003D; 79)</p></caption>
<graphic xlink:href="454355_figS2.tif"/>
</fig>
<fig id="figS3" position="float">
<label>Supplementary Figure 3:</label>
<caption><p>A UMAP plot of HIV isolates coloured by their inferred clustering using k-means with the number of underlying clusters matching that found using fastbaps (<italic>k</italic> = 193)</p></caption>
<graphic xlink:href="454355_figS3.tif"/>
</fig>
<fig id="figS4" position="float">
<label>Supplementary Figure 4:</label>
<caption><p>A UMAP plot of HIV isolates coloured and numbered by their inferred clustering using fastbaps with the optimised BAPS prior (<italic>k</italic> = 193)</p></caption>
<graphic xlink:href="454355_figS4.tif"/>
</fig>
<fig id="figS5" position="float">
<label>Supplementary Figure 5:</label>
<caption><p>A UMAP plot of HIV isolates coloured and numbered by their inferred clustering using k-means with the number of underlying clusters found using the elbow method (<italic>k</italic> = 21)</p></caption>
<graphic xlink:href="454355_figS5.tif"/>
</fig>
<fig id="figS6" position="float">
<label>Supplementary Figure 6:</label>
<caption><p>The MCMC chains for each run of the STRUCTURE algorithm on the simulated datasets</p></caption>
<graphic xlink:href="454355_figS6.tif"/>
</fig>
</sec>
</back>
</article>