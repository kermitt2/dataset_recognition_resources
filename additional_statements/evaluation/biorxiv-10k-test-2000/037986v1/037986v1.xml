<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">BIORXIV</journal-id>
<journal-title-group>
<journal-title>bioRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/037986</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="author-type">
<subject>Regular Article</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>Confirmatory Results</subject>
</subj-group>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Pathology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>On Post-Acquisition Motion Compensation for Prostate Perfusion Analysis</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name><surname>Wollny</surname><given-names>Gert</given-names></name>
</contrib>
<contrib contrib-type="author">
<name><surname>Casanova</surname><given-names>Isabel</given-names></name>
</contrib>
<contrib contrib-type="author">
<name><surname>Ledesma-Carbayo</surname><given-names>Mar&#x00ED;a-J.</given-names></name>
</contrib>
<contrib contrib-type="author">
<name><surname>Santos</surname><given-names>Andr&#x00E9;s</given-names></name>
</contrib>
</contrib-group>
<author-notes>
<fn><p>This work was executed at the Group of Biomedical Imaging Technologies, Department of Electronic Engineering, ETSIT, Universidad Politecnica de Madrid, Spain, and with the support of Ciber BBN, Spain. Contact: <email>gw.fossdev@gmail.com</email></p></fn>
</author-notes>
<pub-date pub-type="epub">
<year>2016</year>
</pub-date>
<elocation-id>037986</elocation-id>
<history>
<date date-type="received">
<day>26</day>
<month>1</month>
<year>2016</year>
</date>
<date date-type="accepted">
<day>26</day>
<month>1</month>
<year>2016</year>
</date>
</history>
<permissions>
<copyright-statement>&#x00A9; 2016, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2016</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="037986.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract><title>Abstract</title>
<p>Dynamic Contrast enhance magnetic resonance imaging has been established as an accurate method to detect and localize prostate cancer. Time series of three-dimensional datasets of the prostate are acquired and used to obtain per-voxel signal-intensity vs. time curves. These are then used to differentiate cancerous from non-cancerous tissue. However, rectal peristalsis and patient movement may result in spatial-mismatching of the serial datasets and therefore, incorrect enhancement curves. In this work, we discuss and test four methods based on image registration to compensate for these movements. These methods include a serial approach that uses the registration of consecutive images and the accumulation of the obtained transformations, an all-to one registration approach, an approach that first aligns a sub-set of images that are already closely aligned, and then uses synthetic references to register the remaining images, and an approach that uses <italic>independent component analysis</italic> (ICA) to create synthetic references and register the images to these. We conclude that the method based on ICA does not provide a viable approach for motion compensation in prostate perfusion imaging, and that the serial approach fails when motion artifacts are present in the series. The other two approaches provide qualitatively pleasing results.</p>
</abstract>
<counts>
<page-count count="5"/>
</counts>
</article-meta>
</front>
<body>
<sec id="s1"><label>I.</label><title>Preliminary Remark</title>
<p>This work is a partial replication of Casanova [<xref ref-type="bibr" rid="c1">1</xref>] that has been done in 2011. Note that on one hand, the redistribution of the data used is restricted because of privacy laws, and on the other hand, that the authors no longer have access to this data. Also note that the implementation of the ICA-based motion compensation method [<xref ref-type="bibr" rid="c2">2</xref>] used in this work has since been changed in [<xref ref-type="bibr" rid="c3">3</xref>] to follow [<xref ref-type="bibr" rid="c4">4</xref>]. Nevertheless, since the claims made in the paper are only of a qualitative nature, it should still be possible to replicate the results.</p>
</sec>
<sec id="s2"><label>II.</label><title>Introduction</title>
<p>Prostate cancer (PCa) is currently the most frequently diagnosed non-cutaneous cancer and the second most important reason for cancer mortality in men. With an early diagnosis a cure can often be achieved. Dynamic Contrast enhance magnetic resonance imaging (DCE-MRI) has been established as an accurate method in the detection and localization of PCa. DCE-MRI is performed by obtaining repeated, fast T1- weighted images before and up to a few minutes after intravenous injection of a gadolinium containing contrast agent. Three-dimensional datasets of the prostate are acquired every few seconds that allows obtaining a per-voxel signal-intensity vs. time curve. Based on this image series, different pharmacokinetic parameters are modeled and used to differentiate between cancerous and non-cancerous tissue.</p>
<p>However, because of the rectal peristalsis and because patients may move during acquisition, movement may be present in the image series resulting in incorrect enhancement curves and pharmacokinetic parameters. Hence, in order to achieve a proper diagnosis, these movements must be corrected for before making a diagnosis. In this work we present and discuss approaches that compensate for this movement and enable a more reliable and automatic analysis perfusion data.</p>
<sec id="s2a"><label>A.</label><title>State of the art</title>
<p>Only a few methods have been published that focuse on motion compensation of prostate perfusion images series. Breathing motion compensation in myocardial perfusion imaging, on the other hand, is a widely discussed topic. In both cases, motion compensation phases a similar challenge: A local movement in an image series needs to be compensated for and the images exhibit a local intensity change over time stemming from the perfusion of a contrast agent. However, certain differences between the two types of perfusion also have to be considered: In myocardial perfusion, where the acquisitions times are lower, usually only a movement of the heart and the surrounding tissue is present, but not a movement of the whole body as it can be seen in prostate perfusion series. On the other hand, the intensity changes induced by the perfusion process poses a larger challenge in myocardial perfusion, since the change is a lot stronger when the contrast agent passes through the left and right heart ventricle. In prostate perfusion images, only the contrast enhancement of the prostate needs to be taken into account.</p>
<p>All methods to compensate motion in image series that we will disscuss are based on image registration. Image registration aims at transforming a study image <italic>S</italic> with respect to a reference image <italic>R</italic>, so that structures at the same coordinates in both images finally represent the same object. Most modern registration approaches use measures that are directly based on the voxel intensities to describe correspondence between the structures in both images. Considering that the rectal peristalsis movement is only a local phenomena, any motion compensation algorithm should allow local, and hence, nonlinear transformations as compared to linear and hence global transformations. If only rigid transformations are allowed, then a region of interest around the prostate must be extracted in order to allow the proper compensation of movement that occurs only locally.</p>
<p>One of the main challenges in voxel based image registration is the establishment of a proper mapping of voxel intensities to tissues that allows to map corresponding anatomical structures in the images correctly onto each other. Since in perfusion imaging these intensities change locally over time, the following general approaches for motion compensation may be considered: Either one registers images from different perfusion phases onto each other and takes the intensity change into account by using a voxel similarity measure that accounts for differences in the tissue-intensity mapping, or one establishes a method to create motion-free synthetic image that exhibit a similar tissue-intensity mapping as its corresponding original image and can, therefore, serve as references in image registration. In such a setting the difficulties of dealing with varying tissue-intensity mappings can be avoided.</p>
<p>In the first approach, image from different time points of the perfusion series, are be registered directly. For example, L udemann et al. [<xref ref-type="bibr" rid="c5">5</xref>] used <italic>normalized mutual information</italic> and Breeuwer et al. [<xref ref-type="bibr" rid="c6">6</xref>] relied on <italic>cross correlation</italic> (CC) to achive motion compensation in perfusion image series. However, these statistical measures still expect a globally consistent material-intensity mapping but the intensity change due to perfusion happens locally, and because of the cancer perfusion may happen at different rates in different areas of the prostate the statistics may not model the intensity-tissue relation properly. To reduce the impact of the intensity change one may also register only images of the series that are in direct temporal succession and then accumulate the obtained transformations to achieve full motion compensation with respect to a reference frame [<xref ref-type="bibr" rid="c7">7</xref>], [<xref ref-type="bibr" rid="c8">8</xref>]. However, with this method small registration errors may accumulate and if one registration fails, e.g. because an erroneous frame was recorded due to the patient movement, then it is impossible to achieve a motion compensation for the full series.</p>
<p>The alternative to registering images from different perfusion phases &#x2013; the creation of synthetic references &#x2013; was, for example, presented by Milles et al. [<xref ref-type="bibr" rid="c9">9</xref>]. They used a three component <italic>independent component analysis</italic> to obtain feature images and a mixing matrix of a myocardial perfusion series. By recombining these images, motion-free synthetic references were obtained that exhibit similar intensities like the original images making it possible to optimize the <italic>sum of squared differences</italic> (SSD) cost measure to achieve registration. While their approach only made use of linear registration its extension to non-linear registration is straightforward.</p>
<p>Another approach that uses synthetic references was presented by Li et al. [<xref ref-type="bibr" rid="c10">10</xref>]. In their work they use prior knowledge to estimate a <italic>pseudo ground truth</italic> (PGT) as a reference for non-linear registration to reduce motion. Running this two-step scheme of PGT estimation and image registration in a multi-pass fashion eventually lead to full motion compensation. Amongst other properties the PGT estimation assumes that in the optimal case of motion compensation the time-intensity curves are quite smooth and hence their second order derivatives low. However, because of the noise present in the images the creation this smoothness is not well reflected when the time-intensity curve is evaluated pixel wise. Therefore, the generation of a PGT by also smoothing over time may overcompensate resulting in reference images that do not present the level of detail required for proper motion compensation. The method was later extended to guide registration by a segmentation of the left heart ventricle [<xref ref-type="bibr" rid="c11">11</xref>] making the algorithm less generic, i.e. not directly applicable to motion compensation in prostate perfusion date.</p>
<p>The approach of Wollny et al. [<xref ref-type="bibr" rid="c12">12</xref>] can be seen as a hybrid to the use of complex registration criteria and the creation of synthetic references. First, they selected a subset of images distributed over the whole series that had a high similarity pointing to images that are already well aligned, and these images were then registered to one global reference optimizing a image similarity criterion based on <italic>normalized gradient fields</italic> (NGF). Then, linear interpolation was used to create synthetic references corresponding to their time index and the corresponding images were registered to these images by optimizing the SSD. This method was also applied to prostate perfusion images [<xref ref-type="bibr" rid="c13">13</xref>].</p>
<p>Finally, methods for motion compensation in myocardial perfusion have been proposed that require a segmentation of the left heart ventricle. These methods usually rely on prior knowledge of the heart anatomy that obviously can not be applied to prostate images and are, therefore, not considered here.</p>
</sec>
<sec id="s2b"><label>B.</label><title>Our contribution</title>
<p>In this paper we will analyze the applicability of a subset of the methods described above to motion compensation in prostate perfusion imaging. We present results of motion compensation achieved by running serial registrations, all-to-one registrations, the use of pre-aligned subsets, and the use of ICA. In this work, we only put the focus on an qualitative analysis ofthe registration analysis based on visual inspection of time-profiles and videos. In addition, we provide a free and open source implementation of all the tested methods [<xref ref-type="bibr" rid="c3">3</xref>].</p>
</sec>
</sec>
<sec id="s3"><label>III.</label><title>Methods</title>
<sec id="s3a"><label>A.</label><title>Non-linear registration</title>
<p>Given a <italic>d</italic>-dimensional domain &#x03A9; &#x2282; &#x211D;<sup><italic>d</italic></sup> and a space of images <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="037986_inline1.gif"/></alternatives></inline-formula>, and given a study image <italic>S</italic> &#x2208; <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="037986_inline2.gif"/></alternatives></inline-formula> and a reference image <italic>R</italic> &#x2208; <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="037986_inline3.gif"/></alternatives></inline-formula>, registration aims at transforming the study image <italic>S</italic> with respect to the reference image <italic>R</italic>, so that structures at the same coordinates in both images represent the same object. In practice, this is achieved by finding a transformation <italic>T</italic><sub>reg</sub> &#x2208; <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="037986_inline4.gif"/></alternatives></inline-formula> that minimizes a given cost function <italic>F</italic><sub>cost</sub>: <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="037986_inline5.gif"/></alternatives></inline-formula> &#x00D7; <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="037986_inline6.gif"/></alternatives></inline-formula> &#x2192; &#x211D;, while constraining the transformation through the joint minimization of an energy term <italic>E</italic>: <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="037986_inline7.gif"/></alternatives></inline-formula> &#x2192; &#x211D;:</p>
<disp-formula id="eqn1"><alternatives><graphic xlink:href="037986_eqn1.gif"/></alternatives></disp-formula>
<p>The cost function <italic>F</italic><sub>cost</sub> accounts for the mapping of similar structures. <italic>E(T)</italic> ensures topology preservation, which is necessary to maintain structural integrity in the study image, and it thus introduces a smoothness constraint on the transformation <italic>T</italic>. The parameter <italic>&#x03BA;</italic> is a weighting factor that balances registration accuracy and transformation smoothness.</p>
<p>In nonrigid registration, the transformation <italic>T</italic> needs only to be neighborhood preserving, a restriction that is enforced by the selection of a proper term <italic>E.</italic> In our application, the cost function <italic>F</italic> is derived from a so-called voxel-similarity measure that takes into account the intensities of the whole image domain. As a consequence, the driving force of the registration is calculated directly from the given image data.</p>
<p>Specifically, we employ two image similarity measures: SSD
<disp-formula id="eqn2"><alternatives><graphic xlink:href="037986_eqn2.gif"/></alternatives></disp-formula>
and the formulation of NGF that was given in [<xref ref-type="bibr" rid="c12">12</xref>],
<disp-formula id="eqn3"><alternatives><graphic xlink:href="037986_eqn3.gif"/></alternatives></disp-formula>
with <italic>d</italic> the number of image dimensions</p>
<disp-formula id="eqn4"><alternatives><graphic xlink:href="037986_eqn4.gif"/></alternatives></disp-formula>
<p>SSD is used when study and reference image exhibit similar intensity distributions &#x2013; i.e. when synthetic references are used, and NGF is used otherwise. Here, NGF has an advantage over statistical measures like MI or CC, since it is a truly local similarity measure that can accommodate local intensity change. In addition it is fairly easy to implement and as a low computational cost.</p>
<p>The transformation space <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="037986_inline8.gif"/></alternatives></inline-formula> we use is restricted to transformations that can be described by a B-splines based model [<xref ref-type="bibr" rid="c14">14</xref>], and we base the regularization on the separate norms of the second derivative of each of the deformation components [<xref ref-type="bibr" rid="c15">15</xref>]. The balance between smoothness of the resulting transformation and the amount of non-rigidly that allows for the registration of smaller features can be fine tuned by selecting the B-spline coefficient rate <italic>c</italic><sub>rate</sub> and the weighting factor &#x03BA;. For both parameters, higher values result in smoother transformations that preserve the per-voxel volume better but come at the cost of a reduced ability to register small features.</p>
</sec>
<sec id="s3b"><label>B.</label><title>Motion compensation schemes</title>
<p>The following motion compensation schemes were considered and implemented by using the a freely available toolkit for gray scale image processing [<xref ref-type="bibr" rid="c3">3</xref>]:</p>
<p><list list-type="simple">
<list-item><label>a)</label><p><italic><bold>Serial</bold></italic>:: Here, only images in temporal succession are registered and then the transformations are applied accumulated. As registration criterion we used a weighted combination of NGF and SSD as proposed in [<xref ref-type="bibr" rid="c8">8</xref>].</p></list-item>
<list-item><label>b)</label><p><italic><bold>AllToOne</bold></italic>:: With this method we register all images to one global reference by using NGF as registration criterion.</p></list-item>
<list-item><label>c)</label><p><italic><bold>PreAlign</bold></italic>:: The algorithm implements the method proposed in [<xref ref-type="bibr" rid="c12">12</xref>] where first a pre-aligned subset of images is estimated. Then, these images are registered non-linearly to a reference picked out of the same subset. Finally, by linearly combining these pre-aligned images synthetic references are created and the remaining images are registered to their synthetic counterparts by optimizing SSD.</p></list-item>
<list-item><label>d)</label><p><italic><bold>ICARefs</bold></italic>:: Here we took Milles et al. [<xref ref-type="bibr" rid="c9">9</xref>] ICA based approach as a blue print and extended by non-linear registration and an alternative method to select the number of independent components as described in [<xref ref-type="bibr" rid="c2">2</xref>]. Other then the above algorithms, this algorithm is run in a multi-pass scheme.</p></list-item>
</list>
</p>
</sec>
</sec>
<sec id="s4"><label>IV.</label><title>Experiments</title>
<sec id="s4a"><label>A.</label><title>Material and Parameters</title>
<fig id="fig1" position="float" orientation="portrait" fig-type="figure"><label>Figure 1.</label>
<caption><p>Upper row: example frames of slice ten of patient B. Lower row: the corresponding profiles at the locations indicated in <xref ref-type="fig" rid="fig2">Fig 2</xref>, left. Note the motion artifact in the third image which occurs approximately in the middle of the acquisition of the perfusion series as can also be seen in the time-profiles.</p></caption>
<graphic xlink:href="037986_fig1.tif"/>
</fig>
<p>Two data sets were acquired from two patients with biopsy proved prostate cancer. For image acquisition a 3T MRI was used in conjunction with a pelvic phased-array coil and an endorectal coil. In order to suppress peristalsis, 40 mg of butylscopolamine was administered intramuscular directly before the MRI scan. The 3D T1-weighted spoiled gradient echo images were acquired directly before and during an intravenous bolus injection of 15 ml paramagnetic gadolinium chelate with an injection rate of 2.5 ml/second followed by a 15 ml saline flush. The series have a temporal resolution of 3 seconds. In one case 110 frames exhibiting perfusion were acquired (<xref ref-type="fig" rid="fig2">Fig. 2</xref>), in the other case 84 frames (<xref ref-type="fig" rid="fig2">Fig. 2</xref>). The spacial resolution of the images were 1.8mm x 1.8mm x 3mm the images had a size of 128 x 128 x 18 voxels each.</p>
<fig id="fig2" position="float" orientation="portrait" fig-type="figure"><label>Figure 2.</label>
<caption><p>Example frame of the tenth slice ten of patient A that indicates the location of the horizontal and vertical profiles used to assess the quality of the motion compensation (left) and corresponding time-profiles (middle and right).</p></caption>
<graphic xlink:href="037986_fig2.tif"/>
</fig>
<p>On both series the motion compensation algorithms described above were executed and the obtained results were qualitatively rated by visually observing videos as well as horizontal and vertical profiles through the time-series stack (see <xref ref-type="fig" rid="fig2">Fig 2</xref>, left). The spacial location of these profiles corresponds to row and column number 64 of the tenth axial slice of the data sets.</p>
<p>For the algorithms <italic>Serial</italic>, <italic>AllToOne</italic>, and <italic>PreAlign</italic> the same registration parameters <italic>&#x03BA;</italic> &#x003D; 5 and <italic>c</italic><sub>rate</sub> &#x003D; 16 voxels were used, and registration was run by using three multi-resolution levels. Since <italic>ICARefs</italic> is a multi-pass algorithm we used 2 passed and we selected <italic>&#x03BA;</italic> &#x003D;10 and <italic>c</italic><sub>rate</sub> &#x003D; 32 in the first pass and reduced these values by the factor of <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="037986_inline9.gif"/></alternatives></inline-formula> in the second pass. For <italic>Serial</italic> a combined weighted registration criterions of SSD (0.5) and NGF (1.0) was used. In all other case the respective registration criterions were weighted by a factor of 1.0. <italic>PreAlign</italic> has an automatic method for selecting the all-over reference frame. To make comparison of the results easier this frame was then also used as reference with <italic>Serial</italic> and <italic>AllToOne. ICARefs</italic> neither requires the input nor evaluates a specific reference frame.</p>
<p>In all cases we used the rank-1 method of a shifted limited-memory variable-metric algorithm [<xref ref-type="bibr" rid="c16">16</xref>] for optimization and the breaking condition were set to an x-tolerance of 0.001, a relative tolerance of the criterion of 0.001, and a maximum of 300 iteration. Optimisation stopped when one of these criteria was fulfilled. All registrations were executed on a AMD Phenom II X6 1035T processor (2.6GHz), Gentoo/Linux 64 bit. The software was compiled with GNU g&#x002B;&#x002B; (Gentoo 4.5.2), and optimization flags <italic>-O2-march&#x003D;native-mtune&#x003D;native - funroll-loops -ftree-vectorize.</italic></p>
</sec>
</sec>
<sec id="s5"><label>V.</label><title>Results</title>
<p>The per-frame run-time of the used motion compensation schemes was <italic>Serial</italic>&#x003D;14.5s, <italic>AllToOne</italic>&#x003D;13.1s, <italic>PreAlign</italic>&#x003D;17.8s, and <italic>ICARefs</italic>&#x003D;12.0s. With minor restrictions for <italic>PreAlign</italic> where first a subset of the images has to registered, all registrations can be run in parallel resulting in a near linear speedup when multiple CPUs are utilized.</p>
<p>The methods <italic>Serial</italic>, <italic>AllToOne</italic>, and <italic>PreAlign</italic> all provided comparable good results for patient A (<xref ref-type="fig" rid="fig3">Fig. 3</xref>).</p>
<fig id="fig3" position="float" orientation="portrait" fig-type="figure"><label>Figure 3.</label>
<caption><p>Time-intensity profiles after motion compensation Patient A, horizontal (upper row) and vertical (lower row) profiles of slice ten. From left to right <italic>Serial</italic>, <italic>AllToOne</italic>, and <italic>PreAlign</italic> all provide good motion compensation for this patient.</p></caption>
<graphic xlink:href="037986_fig3.tif"/>
</fig>
<p>Since the series of patient B one frame contained a strong motion artifact (<xref ref-type="fig" rid="fig1">Fig. 1</xref>, upper row, middle) it was not possible to achieve motion compensation by using <italic>Serial</italic>. With the reference frame located before the frame containing motion and because of the accumulation of the transformations used by this method the information in all frames located after the frame containing the motion artifact are clobbered (<xref ref-type="fig" rid="fig4">Fig. 4</xref>).</p>
<p><italic>AllToOne</italic>, and <italic>PreAlign</italic> again resulted in comparable registration results (<xref ref-type="fig" rid="fig5">Fig. 5</xref>), with <italic>PreAlign</italic> reducing the motion at the image boundaries better. This difference between the algorithms can be attributed to the use of different registration criterions. While <italic>PreAlign</italic> used NGF only for some key frames, <italic>PreAlign</italic> relies on this criterion for all image registrations. However, with NGF only gradients contribute to the all-over cost value and, therefore, more local minima may be present in the cost function. With SSD on the other hand, all pixels contribute to the cost value resulting in less local minima and better registration results.</p>
<fig id="fig4" position="float" orientation="portrait" fig-type="figure"><label>Figure 4.</label>
<caption><p>Time-intensity profiles after motion compensation using <italic>Serial</italic>, Patient B. The reference frame is located before the frame exhibiting strong motion and it is clearly visible that no motion compensation could be achieved for the frames after this frame.</p></caption>
<graphic xlink:href="037986_fig4.tif"/>
</fig>
<fig id="fig5" position="float" orientation="portrait" fig-type="figure"><label>Figure 5.</label>
<caption><p>Time-intensity profiles after motion compensation <italic>AllToOne</italic> (upper row), and <italic>PreAlign</italic> (lower row). Generally, a good registration is achieved for both methods, but applying <italic>AllToOne</italic> results in more residual movement close to the image boundaries.</p></caption>
<graphic xlink:href="037986_fig5.tif"/>
</fig>
<fig id="fig6" position="float" orientation="portrait" fig-type="figure"><label>Figure 6.</label>
<caption><p>Mixing curves obtained for a four component ICA for Patent B. Note the jumps in the curves <italic>motion</italic> and <italic>perfusion&#x002B;motion</italic> that relate to the motion component that is fully retained by the ICA. Also note the spike in the curve labeled <italic>error frame</italic> that shows how a four component ICA singles out the frame with the motion artifact as seen in <xref ref-type="fig" rid="fig1">Fig. 1</xref>.</p></caption>
<graphic xlink:href="037986_fig6.tif"/>
</fig>
<p>With <italic>ICARefs</italic> it was not possible to achieve motion compensation for neither of both data sets. This is because the <italic>independent component analysis</italic>(ICA) retains the motion (see <xref ref-type="fig" rid="fig6">Fig. 6</xref>), which is also the reason for the low registration time per frame: since the synthetic references that are very similar to the original images registration is achieved very fast. From <xref ref-type="fig" rid="fig6">Fig. 6</xref> it is also evident that the motion is not separated into one single <italic>independent component</italic>(IC) which makes it impossible to eliminate the motion in the reference images by just removing the corresponding IC from the reference image creation. Note however, that ICA makes it possible to easily identify the frames where strong patient movement actually happens and it also provides information about the intensity change induced by the perfusion. Both types of information could prove helpful when devising new algorithms for motion compensation.</p>
</sec>
<sec id="s6"><label>VI.</label><title>Conclusion</title>
<p>Out of the tested methods <italic>Serial</italic> motion compensation can be achieved, but only if the images of the perfusion series are free of artifacts, and <italic>ICARefs</italic> motion patterns that relocate the whole imaged body are can not be compensated for.</p>
<p><italic>AllToOne</italic> and <italic>PreAlign</italic>, on the other hand, proved to be usable for motion compensation of prostate perfusion image series, even when some frames are acquired with strong motion artifacts. Because <italic>PreAlign</italic> needs to evaluate the prealigned subset, <italic>AllToOne</italic> requires less computational time.</p>
<p>Judging based on the visual inspection of the results <italic>PreAlign</italic> provides better results then <italic>AllToOne</italic> &#x2013; most likely, because for most registrations <italic>PreAlign</italic> uses SSD a registration criterion that has less local minimal then the NGF based measure that is always used with <italic>AllToOne</italic>. In addition, <italic>PreAlign</italic> can be run fully automated, with <italic>AllToOne</italic> one has at least to check that the indicated global reference frame is not actually a frame that was recorded with strong artifacts.</p>
<p>When using <italic>PreAlign</italic> for motion compensation in myocardial perfusion, Wollny et al. [<xref ref-type="bibr" rid="c12">12</xref>] reported difficulties in the creation of synthetic references because the linear interpolation used to create synthetic references was not always able to model the strong intensity changes induced by the contrast agent passing through the left and right heart ventricle. In prostate imaging the intensity changes observed are not as intense, and hence the creation of synthetic references does not suffer from this problem.</p>
<p>Future work will include the quantitative confirmation of above results by running a thorough validation based on the comparison of manually obtained time &#x2013; intensity curves with automatically obtained ones. Finally, one may consider the use of information that can be drawn from an ICA to improve above algorithms.</p>
</sec>
</body>
<back>
<ack><label>VII.</label><title>Acknowledgment</title>
<p>The authors would like to thank Thomas Hambrock from the Department of Radiology, Radboud University Nijmegen Medical Centre, Nijmegen, The Netherlands for providing the data and medical background.</p>
</ack>
<ref-list><title>References</title>
<ref id="c1"><label>[1]</label><mixed-citation publication-type="other"><string-name><given-names>I.</given-names> <surname>Casanova</surname></string-name>, &#x201C;<article-title>Desarollo de m&#x00E9;tdos para la compencaci&#x00F3;n del movimiento de la pr&#x00F3;stata en estudios de perfusion mediante reconancia magn&#x00E9;etica nuclear</article-title>,&#x201D; <source>Master&#x2019;s thesis, ETSI de Telecomunicaci&#x00F3;n, UPM, Madrid, Espa&#x00F1;a</source>, <year>2009</year>.</mixed-citation></ref>
<ref id="c2"><label>[2]</label><mixed-citation publication-type="book"><string-name><given-names>G.</given-names> <surname>Wollny</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Kellman</surname></string-name>, and <string-name><given-names>M.-J. L.</given-names> <surname>Andr&#x00E9;s Santos</surname></string-name>, &#x201C;<chapter-title>Nonrigid motion compensation of free breathing acquired myocardial perfusion data</chapter-title>,&#x201D; in <source>Bildverarbeitung fur die Medizin 2011</source>, ser. Informatik aktuell, <string-name><given-names>H.</given-names> <surname>Handels</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Horsch</surname></string-name>, A. and Lehmann, and <string-name><given-names>H. P.</given-names> <surname>Meinzer</surname></string-name>, Eds., <publisher-name>Berlin Heidelberg</publisher-name>, <year>2011</year>.</mixed-citation></ref>
<ref id="c3"><label>[3]</label><mixed-citation publication-type="journal"><string-name><given-names>G.</given-names> <surname>Wollny</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Hublin</surname></string-name>, <string-name><surname>M.-J.</surname> <given-names>Ledesma-Carbayo</given-names></string-name>, <string-name><given-names>M.</given-names> <surname>Skinner</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Kellman</surname></string-name>, and <string-name><given-names>T.</given-names> <surname>Hierl</surname></string-name>, &#x201C;<article-title>MIA - A Free and Open Source Software for Gray Scale Medical Image Analysis</article-title>,&#x201D; <source>Source Code for Biology and Medicine</source>, vol. <volume>8</volume>:<fpage>20</fpage>, <year>2013</year>.</mixed-citation></ref>
<ref id="c4"><label>[4]</label><mixed-citation publication-type="journal"><string-name><given-names>G.</given-names> <surname>Wollny</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Kellman</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Santos</surname></string-name>, and <string-name><surname>M.-J.</surname> <given-names>Ledesma-Carbayo</given-names></string-name>, &#x201C;<article-title>Automatic Motion Compensation of Free Breathing acquired Myocardial Perfusion Data by using Independent Component Analysis</article-title>,&#x201D; <source>Medical Image Analysis</source>, vol. <volume>16</volume>, no. <issue>5</issue>, pp. <fpage>1015</fpage>&#x2013;<lpage>1028</lpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c5"><label>[5]</label><mixed-citation publication-type="website"><string-name><given-names>L.</given-names> <surname>Ludemann</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Prochnow</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Rohlfing</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Franiel</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Warmuth</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Taupitz</surname></string-name>, <string-name><given-names>H.</given-names> <surname>Rehbein</surname></string-name>, and <string-name><given-names>D.</given-names> <surname>Beyersdorff</surname></string-name>, &#x201C;<article-title>Simultaneous quantification of perfusion and permeability in the prostate using dynamic contrast-enhanced magnetic resonance imaging with an inversion-prepared dual-contrast sequence</article-title>,&#x201D; <source>Annals of Biomedical Engineering</source>, vol. <volume>37</volume>, pp. <fpage>749</fpage>&#x2013;<lpage>762</lpage>, <year>2009</year>, <pub-id pub-id-type="doi">10.1007/s10439&#x2013;009-9645-x</pub-id>. [Online]. Available: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1007/s10439&#x2013;009-9645-x">http://dx.doi.org/10.1007/s10439&#x2013;009-9645-x</ext-link></mixed-citation></ref>
<ref id="c6"><label>[6]</label><mixed-citation publication-type="confproc"><string-name><given-names>M.</given-names> <surname>Breeuwer</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Spreeuwers</surname></string-name>, and <string-name><given-names>M.</given-names> <surname>Quist</surname></string-name>, &#x201C;<article-title>Automatic quantitative analysis of cardiac MR perfusion images</article-title>,&#x201D; in <conf-name>Proceedings of the SPIE &#x2013; The International Society for Optical Engineering</conf-name>, vol. <volume>4322</volume>(<issue>1&#x2013;3</issue>), <year>2001</year>, pp. <fpage>733</fpage>&#x2013;<lpage>742</lpage>.</mixed-citation></ref>
<ref id="c7"><label>[7]</label><mixed-citation publication-type="book"><string-name><given-names>H.</given-names> <surname>Xue</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Zuehlsdorff</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Kellman</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Arai</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Nielles-Vallespin</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Chefdhotel</surname></string-name>, <string-name><given-names>C. H.</given-names> <surname>Lorenz</surname></string-name>, and <string-name><given-names>J.</given-names> <surname>Guehring</surname></string-name>, &#x201C;<chapter-title>Unsupervised Inline Analysis of Cardiac Perfusion MRI</chapter-title>,&#x201D; in <source>Medical Image Computing and Computer-Assisted Intervention MICCAI 2009</source>, ser. LNCS, vol. <volume>5762/2009</volume>. <publisher-loc>Berlin, Heidelberg</publisher-loc>: <publisher-name>Springer-Verlag</publisher-name>, <year>2009</year>, pp. <fpage>741</fpage>&#x2013;<lpage>749</lpage>.</mixed-citation></ref>
<ref id="c8"><label>[8]</label><mixed-citation publication-type="other"><string-name><given-names>G.</given-names> <surname>Wollny</surname></string-name>, <string-name><given-names>M. J.</given-names> <surname>Ledesma-Carbayo</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Kellman</surname></string-name>, and <string-name><given-names>A.</given-names> <surname>Santos</surname></string-name>, <article-title>New Developments in Biomedical Engineering</article-title>. In-<source>Tech, 2010, ch. On breathing motion compensation in myocardial perfusion imaging</source>, pp. <fpage>235</fpage>&#x2013;<lpage>247</lpage>.</mixed-citation></ref>
<ref id="c9"><label>[9]</label><mixed-citation publication-type="confproc"><string-name><given-names>J.</given-names> <surname>Milles</surname></string-name>, <string-name><given-names>R.</given-names> <surname>van der Geest</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Jerosch-Herold</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Reiber</surname></string-name>, and <string-name><given-names>B.</given-names> <surname>Lelieveldt</surname></string-name>, &#x201C;<article-title>Fully Automated Motion Correction in First-Pass Myocardial Perfusion MR Image Sequences</article-title>,&#x201D; <conf-name>IEEE Trans. Med Imag</conf-name>., vol. <volume>27</volume>, no. <issue>11</issue>, pp. <fpage>1611</fpage>&#x2013;<lpage>1621</lpage>, <year>2008</year>.</mixed-citation></ref>
<ref id="c10"><label>[10]</label><mixed-citation publication-type="other"><string-name><given-names>C.</given-names> <surname>Li</surname></string-name> and <string-name><given-names>Y.</given-names> <surname>Sun</surname></string-name>, &#x201C;<article-title>Nonrigid Registration of Myocardial Perfusion MRI Using Pseudo Ground Truth</article-title>,&#x201D; in <source>Medical Image Computing and Computer-Assisted Intervention MICCAI 2009</source>, <volume>2009</volume>, pp. <fpage>165</fpage>&#x2013;<lpage>172</lpage>.</mixed-citation></ref>
<ref id="c11"><label>[11]</label><mixed-citation publication-type="website"><string-name><given-names>C.</given-names> <surname>Li</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Sun</surname></string-name>, and <string-name><given-names>P.</given-names> <surname>Chai</surname></string-name>, &#x201C;<article-title>Pseudo ground truth based nonrigid registration of myocardial perfusion mri</article-title>,&#x201D; <source>Medical Image Analysis</source>, vol. In Press, Corrected Proof, pp. &#x2013;, <year>2011</year>. [Online]. Available: <ext-link ext-link-type="uri" xlink:href="http://www.sciencedirect.com/science/article/pii/S1361841511000235">http://www.sciencedirect.com/science/article/pii/S1361841511000235</ext-link></mixed-citation></ref>
<ref id="c12"><label>[12]</label><mixed-citation publication-type="confproc"><string-name><given-names>G.</given-names> <surname>Wollny</surname></string-name>, <string-name><given-names>M. J.</given-names> <surname>Ledesma-Carbayo</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Kellman</surname></string-name>, and <string-name><given-names>A.</given-names> <surname>Santos</surname></string-name>, &#x201C;<article-title>Exploiting Quasiperiodicity in Motion Correction of Free-Breathing Myocardial Perfusion MRI</article-title>,&#x201D; <conf-name>IEEE Trans. Med Imag</conf-name>., vol. <volume>29</volume>, no. <issue>8</issue>, pp. <fpage>1516</fpage>&#x2013;<lpage>1527</lpage>, <year>2010</year>.</mixed-citation></ref>
<ref id="c13"><label>[13]</label><mixed-citation publication-type="book"><string-name><given-names>G.</given-names> <surname>Wollny</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Casanova</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Hambrock</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Santos</surname></string-name>, and <string-name><surname>M. J.</surname> <given-names>Ledesma-Carbayo</given-names></string-name>, &#x201C;<chapter-title>Non-rigid motion compensation in mr prostate perfusion imaging</chapter-title>,&#x201D; in <source>The 18th Joined Annual Meeting of the ISMRM-ESMRM</source>, <publisher-name>Stockholm</publisher-name>, <publisher-name>Sweden</publisher-name>, <year>2010</year>.</mixed-citation></ref>
<ref id="c14"><label>[14]</label><mixed-citation publication-type="confproc"><string-name><surname>J.</surname> <given-names>Kybic</given-names></string-name> and <string-name><given-names>M.</given-names> <surname>Unser</surname></string-name>, &#x201C;<article-title>Fast Parametric Elastic Image Registration</article-title>,&#x201D; <conf-name>IEEE Trans. Image Process</conf-name>., vol. <volume>12</volume>, no. <issue>11</issue>, pp. <fpage>1427</fpage>&#x2013;<lpage>1442</lpage>, <year>2003</year>.</mixed-citation></ref>
<ref id="c15"><label>[15]</label><mixed-citation publication-type="confproc"><string-name><given-names>T.</given-names> <surname>Rohlfing</surname></string-name>, <string-name><given-names>C. R. M.</given-names> <surname>Jr.</surname></string-name>, <string-name><given-names>D. A.</given-names> <surname>Bluemke</surname></string-name>, and <string-name><given-names>M. A.</given-names> <surname>Jacobs</surname></string-name>, &#x201C;<article-title>Volume-Preserving Nonrigid Registration of MR Breast Images Using Free-Form Deformation with an Incompressibility Constraint</article-title>,&#x201D; <conf-name>IEEE Transactions on Medical Imaging</conf-name>, vol. <volume>22</volume>, pp. <fpage>730</fpage>&#x2013;<lpage>741</lpage>, <year>2003</year>.</mixed-citation></ref>
<ref id="c16"><label>[16]</label><mixed-citation publication-type="journal"><string-name><given-names>J.</given-names> <surname>Vlcek</surname></string-name> and <string-name><given-names>L.</given-names> <surname>Luksan</surname></string-name>, &#x201C;<article-title>Shifted limited-memory variable metric methods for large-scale unconstrained minimization</article-title>,&#x201D; <source>J. Computational Appl. Math.</source>, no. <volume>186</volume>, pp. <fpage>365</fpage>&#x2013;<lpage>390</lpage>, <year>2006</year>.</mixed-citation></ref>
</ref-list>
</back>
</article>