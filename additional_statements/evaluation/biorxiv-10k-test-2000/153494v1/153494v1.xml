<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">BIORXIV</journal-id>
<journal-title-group>
<journal-title>bioRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/153494</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="author-type">
<subject>Regular Article</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>New Results</subject>
</subj-group>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Evolutionary Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>TreeTime: maximum likelihood phylodynamic analysis</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name><surname>Sagulenko</surname> <given-names>Pavel</given-names></name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name><surname>Puller</surname> <given-names>Vadim</given-names></name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2525-1407</contrib-id>
<name><surname>Neher</surname> <given-names>Richard A.</given-names></name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Max Planck Institute for Developmental Biology</institution>, 72076 T&#x00FC;bingen, <country>Germany</country></aff>
<aff id="a2"><label>2</label><institution>Biozentrum, University of Basel</institution>, <country>Switzerland</country></aff>
</contrib-group>
<pub-date pub-type="epub">
<year>2017</year>
</pub-date>
<elocation-id>153494</elocation-id>
<history>
<date date-type="received">
<day>21</day>
<month>6</month>
<year>2017</year>
</date>
<date date-type="rev-recd">
<day>21</day>
<month>6</month>
<year>2017</year>
</date>
<date date-type="accepted">
<day>21</day>
<month>6</month>
<year>2017</year>
</date>
</history><permissions><copyright-statement>&#x00A9; 2017, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2017</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/">
<license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license></permissions>
<self-uri xlink:href="153494.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract><p>Mutations that accumulate in the genome of replicating biological organisms can be used to infer their evolutionary history. In case of measurably evolving organisms genomes often reveal their detailed spatio-temporal spread. Such phylodynamic analyses are particularly useful to understand the epidemiology of rapidly evolving viral pathogens. The volume of genome sequences available for different pathogens, however, have increased dramatically over the last couple of years and traditional methods for phylodynamic analysis scale poorly with growing data sets. Here, we present TreeTime, a python based framework for phylodynamic analysis using an approximate Maximum Likelihood approach. TreeTime can estimate ancestral states, infer evolution models, reroot trees to maximize temporal signals, estimate molecular clock phylogenies and population size histories. The run time of TreeTime scales linearly with data set size.</p></abstract>
<counts>
<page-count count="9"/>
</counts>
</article-meta>
</front>
<body>
<p>Phylogenetics uses differences between homologous sequences to infer the history of the sample and learn about the evolutionary processes that gave rise to the observed diversity. In absence of recombination, this history is a tree along which sequences descend from ancestors with modification. In general, the reconstruction of phylogenetic trees is a computationally difficult problem but efficient heuristics often produce reliable reconstructions in polynomial time (<xref ref-type="bibr" rid="c6">Felsenstein, 2004</xref>; <xref ref-type="bibr" rid="c18">Price <italic>et al.</italic>, 2010</xref>; <xref ref-type="bibr" rid="c23">Stamatakis, 2014</xref>). Such heuristics become indispensible for large data sets of hundreds or thousands of sequences.</p>
<p>In addition to tree building, many research questions require parameter inference and hypothesis testing (<xref ref-type="bibr" rid="c4">Drummond <italic>et al.</italic>, 2012</xref>; <xref ref-type="bibr" rid="c17">Pond and Muse, 2005</xref>). Again, exact inference and testing with large data sets is computationally expensive since it requires high-dimensional optimization of complex likelihood functions or extensive sampling of the posterior. Efficient heuristics are needed to cope with the growing data sets available today.</p>
<p>Phylogenetic tree reconstruction relies on substitutions that accumulated between the common ancestor and the sequences in the sample. <xref ref-type="bibr" rid="c33">Zuckerkandl and Pauling (1965)</xref> hypothesized that changes in protein sequences accumulate linearly and that the number of differences between homologous sequences can be used as a <italic>molecular clock</italic> to date the divergence between sequences. The molecular clock has since been used to date the divergence of ancient proteins billions of years ago as well as the spread of RNA viruses on time scales less than a year (<xref ref-type="bibr" rid="c12">Langley and Fitch, 1974</xref>; <xref ref-type="bibr" rid="c20">Rambaut, 2000</xref>; <xref ref-type="bibr" rid="c22">Sanderson, 2003</xref>; <xref ref-type="bibr" rid="c31">Yoder and Yang, 2000</xref>). Beyond dating of individual divergence events of the time of the common ancestor, algorithms have been developed to infer a tree where branch lengths correspond directly to elapsed time and each node is placed such that its position reflects its known or inferred date. Such trees are known as time trees, molecular clock phylogenies, or time stamped phylogenies. Furthermore, it became evident that substitution rates can vary between different parts of the tree and between sites along a sequence and several refinements of the original molecular clock tree have been developed. For a recent review of the evolution of methods for time tree estimation see (<xref ref-type="bibr" rid="c11">Kumar and Hedges, 2016</xref>).</p>
<p>In addition to questions regarding natural history, time trees are useful to study epidemiology and pathogen evolution (<xref ref-type="bibr" rid="c7">Gardy <italic>et al.</italic>, 2015</xref>). Time trees of &#x2018;measurably evolving&#x2019; pathogens can be used to date cross-species transmissions, introductions into geographic regions, and the time course of pathogen population sizes. In outbreak scenarios such as the recent Ebola virus or Zika virus outbreaks, rapid near real-time analysis of large numbers of viral genomes are necessary and can assist epidemiological analysis and containment efforts (<xref ref-type="bibr" rid="c7">Gardy <italic>et al.</italic>, 2015</xref>).</p>
<p>BEAST is one of most sophisticated tools for time tree estimation (<xref ref-type="bibr" rid="c4">Drummond <italic>et al.</italic>, 2012</xref>). BEAST samples many possible histories to evaluate posterior distributions of divergence times, evolutionary rates, and many other parameters. BEAST implements a large number of different phylogenetic and phylogeographic models. The sampling of trees, however, results in run-times of days to weeks for moderately large data sets of a few hundred sequences. On the other end of the spectrum are much simpler distance based tools that infer time scaled phylogenies orders of magnitudes faster (<xref ref-type="bibr" rid="c2">Britton <italic>et al.</italic>, 2007</xref>; <xref ref-type="bibr" rid="c25">Tamura <italic>et al.</italic>, 2012</xref>; <xref ref-type="bibr" rid="c27">To <italic>et al.</italic>, 2016</xref>).</p>
<p>We developed a new tool called TreeTime that combines efficient heuristics with probabilistic sequence based inference. TreeTime infers maximum likelihood timetrees of a few thousand tips with within a few minutes. TreeTime was designed for applications in molecular epidemiology and analysis of rapidly evolving heterochronous viral sequences (<xref ref-type="bibr" rid="c28">Volz <italic>et al.</italic>, 2013</xref>). It is already in use as an integral component of the real-time time outbreak tracking tool-kit nextstrain (<xref ref-type="bibr" rid="c15">Neher and Bedford, 2015</xref>). The main applications of TreeTime are ancestral state inference, evolutionary model inference, and time tree estimation. We discuss the core algorithms briefly below.</p>
<sec id="s1">
<title>Algorithms and implementation</title>
<p>TreeTime&#x2019;s overaching strategy is to find an approximate maximum-likelihood configuration by iterative optimization of simpler subproblems similar in spirit to <italic>sequential quadratic programming</italic> or <italic>expectation maximization</italic>. Iteration is used on multiple levels, for example by iterating optimization of branch length, ancestral sequences, parameters of the relaxed clock, or coalescent models. Such an iterative procedure typically converges quickly when the branch lengths of the tree are short such that ancestral state inference has little ambiguity.</p>
<p>Maximum-likelihood assignments of sequence characters or node positions can be done such that the likelihood of a global state where all properties are specified jointly is maximal, such that the likelihood of local state after marginalization over all other unknown states is maximal. On a tree, both of these optimal assignments can be calculated in linear time (<xref ref-type="bibr" rid="c6">Felsenstein, 2004</xref>; <xref ref-type="bibr" rid="c19">Pupko <italic>et al.</italic>, 2000</xref>) and TreeTime implements both marginal and joint ancestral reconstructions for ancestral states and node dates.</p>
</sec>
<sec id="s2">
<title>Iterative branch length optimization</title>
<p>In general, optimizing the branch length of a tree is a complicated computational problem with 2<italic>N</italic> &#x2212; 3 free parameters and a likelihood function that requires &#x1D4AA;(<italic>N</italic>) steps to evaluate. However, when branch length are &#x226A; 1, a joint optimization of branch length and ancestral sequences can be achieved by iteratively inferring branch length and ancestral sequences since corrections due to recurrent substitutions are neglibile. Given a tree topology and the branch length, the maximum likelihood ancestral sequences can be inferred in linear time (<xref ref-type="bibr" rid="c6">Felsenstein, 2004</xref>; <xref ref-type="bibr" rid="c19">Pupko <italic>et al.</italic>, 2000</xref>). Likewise, maximum likelihood branch length given the parent and offspring sequences are easy to optimize. We use this iterative optimization scheme to rapidly optimize branch length and ancestral sequences. For more divergent sequences, however, integration over subleading states of internal nodes make a substantial contribution and the iterative optimization will underestimate the branch lengths. In this case, treetime can use branch length provided in the input tree.</p>
</sec>
<sec id="s3">
<title>Maximum likelihood inference of divergence times</title>
<p>For a fixed tree topology and known ancestral sequences, the branch length corresponding to the maximum likelihood molecular clock phylogeny can be computed in linear time using dynamic programming or message passing techniques (<xref ref-type="bibr" rid="c13">M&#x00E9;zard and Montanari, 2009</xref>). This approach is similar to <xref ref-type="bibr" rid="c20">Rambaut (2000)</xref>, but the dynamic programming technique avoids computationally expensive numerical optimization of the branch lengths.</p>
<p>In analogy to maximum likelihood inference of ancestral sequence inference, the algorithm proceeds via a post-order tree transversal propagating the maximum likelihood assignments of subtrees towards the root, and a pre-order transversal selecting the optimal subtree given the constraints from above. Specifically, to calculate the joint maximum likelihood sub-tree, we calculate in post-order for each node <italic>n</italic><disp-formula id="eqn1"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn1.gif"/></alternatives></disp-formula>
the likelihood that the node sits at position <italic>t</italic> given all constraints of its children. <italic>C</italic>(<italic>t</italic>) are contraints imposed on the node, while the product runs over all children <italic>c</italic> of node <italic>n</italic> and multiplies the integrated constraints of all subtending trees. These constraints are propagated along the branches of the tree via<disp-formula id="eqn2"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn2.gif"/></alternatives></disp-formula>
where <italic>b</italic>(<italic>&#x03C4;</italic>) is the likelihood that the branch leading to the focal node n has length <italic>&#x03C4;</italic>. Intuitively, <italic>C<sub>n</sub></italic>(<italic>t<sub>p</sub></italic>) specifies the distribution of the location <italic>t<sub>p</sub></italic> of the parent of node <italic>n</italic>, given the constraints from its tips and the substitutions that accumulated on the branch to the parent node.</p>
<p>During the post-order transversal, the branch length <italic>&#x03C4;</italic>(<italic>t<sub>p</sub></italic>) maximizing <xref ref-type="disp-formula" rid="eqn3">Eq. 3</xref> for <italic>t<sub>p</sub></italic> are tabulated and saved for the back-trace. Once the post-order transversal arrives at the root, the root is assigned the time argmax<italic><sub>t</sub>C</italic>(<italic>t</italic>) &#x03A0;<italic><sub>c</sub> C<sub>c</sub></italic>(<italic>t</italic>).</p>
<p>The post-order transversal is followed by a pre-order back-trace, during which the branch length of each internal node is assigned to the <italic>&#x03C4;</italic>(<italic>t<sub>p</sub></italic>) conditional on the parental position <italic>t<sub>p</sub></italic>. To accelerate the optimization, TreeTime tabulates the branch length likelihood and the subtree likelihoods and creates linear interpolators of their logarithms.</p>
<p>The above algorithm assigns each node to the time that maximizes the joint likelihood of all branch lengths in analogy to the ancestral state reconstruction algorithm by <xref ref-type="bibr" rid="c19">Pupko <italic>et al.</italic> (2000)</xref>. The marginally optimal time of each internal node, i.e., the time after integration over all other unconstrained nodes, can be determined in a similar manner by replacing the max in <xref ref-type="disp-formula" rid="eqn3">Eq. 3</xref> by an integral over <italic>&#x03C4;</italic>.<disp-formula id="eqn3"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn3.gif"/></alternatives></disp-formula>
where H&#x2032; is the analog of H multiplying the <italic>C</italic>&#x2032; of all children. The marginal distribution of the time of a node is then given by<disp-formula id="eqn4"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn4.gif"/></alternatives></disp-formula>
where <italic>Z<sub>n</sub></italic> is a normalization factor. Note that the contribution of node <italic>n</italic> to <italic>H<sub>p</sub></italic> is removed by dividing by it. TreeTime allows to compute joint and marginal maximum likelihood timings.</p>
<p>The result of the marginal reconstruction is a probability distribution of the node time, given the tree, ancestral sequence assignment, and the evolutionary model while the unknowns times of other nodes are traced out. From this distribution, arbitrary confidence intervals of node timing can be computed in a straight-forward manner.</p>
<p>The algorithm described above can be used for any continuous character on the tree. In <xref ref-type="disp-formula" rid="eqn3">Eq. 3</xref>, <italic>b<sub>n</sub></italic> (<italic>&#x03C4;</italic>) can be replaced by and transmission function that depends either on the branch or properties of the child and parent node. We will use an analogous algorithm below to estimate parameters of relaxed molecular clock models.</p>
</sec>
<sec id="s4">
<title>Efficient search for the optimal root</title>
<p>The fraction of variance in root-to-tip distance explained by a linear regression on sampling date is given by<disp-formula id="eqn5"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn5.gif"/></alternatives></disp-formula>
where the sum runs over all tips <italic>i</italic> of the tree and <italic>t<sub>i</sub></italic> and <italic>d<sub>i</sub></italic> are the sampling date and the distance from the root to node <italic>i</italic>, respectively. The angular brackets denote the sample average. The regression and <italic>r</italic><sup>2</sup> depend on the choice of root via the <italic>d<sub>i</sub></italic>. In absence of an outgroup, the root is often chosen to maximize <italic>r</italic><sup>2</sup> or minimize the squared residuals of a linear fit to the root-to-tip distance. Programs such as TempEst (Ram-baut <italic>et al.</italic>, 2016) and LSD (<xref ref-type="bibr" rid="c27">To <italic>et al.</italic>, 2016</xref>) allow to search for the root that maximizes this correlation and TreeTime has implemented similar functionality.</p>
<p>This search for the optimal root can be achieved in linear time in the number of sequences <italic>N</italic> by first calculating for each internal node <italic>n</italic><disp-formula id="eqn6"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn6.gif"/></alternatives></disp-formula>
for each internal node <italic>n</italic>. Here, the sum runs over all tips <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline15.gif"/></alternatives></inline-formula> of node <italic>n</italic> while <italic>t<sub>i</sub></italic> and <italic>d<sub>n</sub></italic><sub>,<italic>i</italic></sub> are the sampling date and the distance of tip <italic>i</italic> from node <italic>n</italic>, respectively. The quantities <italic>&#x03B8;<sub>n</sub></italic>, <italic>&#x03B3;<sub>n</sub></italic> and <italic>&#x03B4;<sub>n</sub></italic> can be calculated recursively from the quantities of the children during one post-order transversal such that the entire calculation requires linear time, see appendix. Once those quantities are calculated, the corresponding quantities &#x0398;<italic><sub>n</sub></italic>, &#x0393;<italic><sub>n</sub></italic>, and &#x0394;<italic><sub>n</sub></italic> where the sum runs over all tips can be calculated in one pre-order transversal.</p>
<p>Hence <italic>r</italic><sup>2</sup> for each internal node on the tree can be calculated in two tree transversals and the optimal choice determined in linear time. The mean squared residual can be calculated analogously.</p>
<p>In general, the optimal position of the root will not be an internal node, but a position between two nodes on a branch of the tree. Such optimal position on internal branches of the tree can be determined from the quantities calculated above by solving a quadratic equation without any numerical optimization. Details of the required algebra are given in the appendix.</p>
</sec>
<sec id="s5">
<title>Resolving polytomies</title>
<p>Phylogenetic trees of many very similar sequences are often poorly resolved and contain multifurcating nodes also known as polytomies. Tree building software often randomly resolves these polytomies into a series of bifurcations. However, the order of bifurcations will often be inconsistent with the temporal structure of the tree resulting in poor approximations. To overcome this problem, TreeTime can prune all branches of length zero and resolve the resulting polytomies in a manner consistent with the sampling dates. For each pair of nodes, TreeTime calculates by how much the likelihood would increase when grouping this pair of nodes into a clade of size two. The polytomy is then resolved iteratively by always grouping pairs corresponding to the highest gain.</p>
</sec>
<sec id="s6">
<title>Coalescent priors</title>
<p>The genealogical tree of individuals within a species depends on the size of the population, its geographic structure, and fitness variation in the population (<xref ref-type="bibr" rid="c10">Kingman, 1982</xref>; <xref ref-type="bibr" rid="c14">Neher, 2013</xref>; <xref ref-type="bibr" rid="c16">Nordborg, 1997</xref>). In the simplest case of a panmictic population without fitness variation, the genealogies are described by a Kingman coalescent (<xref ref-type="bibr" rid="c10">Kingman, 1982</xref>), possibly with a population size that changes over time. Within the Kingman coalescent, any two lineages merge at random with a rate <italic>&#x03BB;</italic>(<italic>t</italic>) that depends on the population size <italic>N</italic>(<italic>t</italic>) and the current number of lineages <italic>k</italic>(<italic>t</italic>).<disp-formula id="eqn7"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn7.gif"/></alternatives></disp-formula></p>
<p>The rate at which a given lineage merges with any of the other lineages is <italic>&#x03BA;</italic>(<italic>t</italic>) &#x003D; (<italic>k</italic>(<italic>t</italic>) &#x2212; 1)/2<italic>T<sub>c</sub></italic>(<italic>t</italic>). Here, the population size <italic>N</italic>(<italic>t</italic>) defines a time scale measured in units of generation time and we will more generally refer to this time scale by <italic>T<sub>c</sub></italic>(<italic>t</italic>) and measure it in units of the inverse clock rate.</p>
<p>The contribution of a branch between time points <italic>t</italic><sub>0</sub> (child) and <italic>t</italic><sub>1</sub> (parent) in the tree to the likelihood is then given by<disp-formula id="eqn8"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn8.gif"/></alternatives></disp-formula>
where a merger at time <italic>t</italic> contributes with rate <italic>&#x03BB;</italic> (<italic>t</italic>)</p>
<p>TreeTime adds the contribution of each branch to the coalescent likelihood the branch likelihood object, which are then parameterized by the starting and end point of the branch, <italic>b<sub>n</sub></italic>(<italic>t<sub>n</sub></italic>, <italic>t<sub>n</sub></italic> &#x002B; <italic>&#x03C4;</italic>). The total coalescent likelihood given a tree can be evaluated in one tree transversal such that <italic>T<sub>c</sub></italic> can be optimized efficiently. In addition to a constant <italic>T<sub>c</sub></italic>, TreeTime can model <italic>T<sub>c</sub></italic> as a piecewise linear function. Such piecewise functions are known as &#x201C;skyline&#x201D; (<xref ref-type="bibr" rid="c24">Strimmer and Pybus, 2001</xref>) and can be optimized by treetime as well.</p>
</sec>
<sec id="s7">
<title>Relaxed clocks</title>
<p>Substitution rates can vary across the tree and models that assume constant clock rates may give inaccurate inference. Models that allow for clock-rate variation have been proposed (<xref ref-type="bibr" rid="c3">Drummond <italic>et al.</italic>, 2006</xref>; <xref ref-type="bibr" rid="c8">Hasegawa <italic>et al.</italic>, 1989</xref>; <xref ref-type="bibr" rid="c31">Yoder and Yang, 2000</xref>). These models typically regularize the clock-rate through a prior and penalize rapid changes of the rate by coupling the rate along branches &#x2013; known as autocorrelated or local molecular clock (<xref ref-type="bibr" rid="c1">Aris-Brosou <italic>et al.</italic>, 2002</xref>; <xref ref-type="bibr" rid="c26">Thorne <italic>et al.</italic>, 1998</xref>). TreeTime implements an autocorrelated molecular with a normal prior on variation in clock rates. The choice of the normal prior allows for an exact and linear time solution for the rate variation given the tree using the same forward/backward trace algorithm used for the inference of internal nodes.</p>
</sec>
<sec id="s8">
<title>Inference of time reversible substitution models</title>
<p>Large phylogenies typically contain 100s of substitutions and thus provide enough information to infer substitution models from the data. TreeTime implements an iterative algorithm to infer general time reversible substitution models (<xref ref-type="bibr" rid="c6">Felsenstein, 2004</xref>) parameterized by equilibrium state frequencies <italic>&#x03C0;<sub>i</sub></italic> and a symmetric substitution matrix <italic>W<sub>ij</sub></italic>. The instantaneous rate from state <italic>j</italic> &#x2192; <italic>i</italic> is <italic>Q<sub>ij</sub></italic> &#x003D; <italic>&#x03C0;<sub>i</sub>W<sub>ij</sub></italic>. The model is inferred by first counting the time spend in different states across the tree <italic>T<sub>i</sub></italic> and the number of substitutions between <italic>n<sub>ij</sub></italic> in a joint maximum likelihood assignment using a simple substitution model. Then, <italic>&#x03C0;</italic> and <italic>W</italic> are determined by iterating<disp-formula id="eqn9"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn9.gif"/></alternatives></disp-formula><disp-formula id="eqn10"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn10.gif"/></alternatives></disp-formula>
where <italic>p<sub>c</sub></italic> is a small pseudo-count driving the estimate towards a flat Jukes-Cantor model in absence of data, and <italic>m<sub>i</sub></italic> are the number times state <italic>i</italic> is observed in the sequence of the root. In each iteration, the <italic>&#x03C0;</italic> is normalized to one, the diagonal of <italic>W<sub>ij</sub></italic> is set to <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline1.gif"/></alternatives></inline-formula>, and <italic>W<sub>ij</sub></italic> is rescaled such that the total expected substitution rate <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline2.gif"/></alternatives></inline-formula> equals one. The rescaling of <italic>&#x03C0;</italic> and <italic>W<sub>ij</sub></italic> can be absorbed into an overall rate <italic>&#x03BC;</italic>. This algorithm typically converges in a few iterations.</p>
</sec>
<sec id="s9">
<title>Implementation</title>
<p>TreeTime is implemented in python and uses the packages numpy and scipy for optimization, linear algebra, and interpolation (<xref ref-type="bibr" rid="c9">Jones <italic>et al.</italic>, 2001&#x2013;2017</xref>; <xref ref-type="bibr" rid="c29">van der Walt <italic>et al.</italic>, 2011</xref>). Computationally costly operations are cast into array operations executed by numpy when ever possible. Tree-Time is organized as a hierarchy of classes. <monospace>TreeAnc</monospace> performs maximum likelihood inference of ancestral sequences, <monospace>ClockTree</monospace> infers a time scaled phylogeny given a tree topology, <monospace>TreeTime</monospace> adds an additional layer of functionality including rerooting, polytomy resolution, coalescent models, and relaxed clocks. The substitution model is implemented as a general time reversible model in the class <monospace>GTR</monospace>.</p>
<p>This structure allows treetime to be used in a modular fashion in python based phylogenetic analysis pipelines. In addition, scripts can be called from the command line to perform standard tasks such as ancestral character inference, rerooting of trees, and time tree estimation.</p>
</sec>
<sec id="s10">
<title>Availability</title>
<p>TreeTime is published under an MIT license and available <monospace>atgithub.com/neherlab/treetime</monospace>.</p></sec>
<sec id="s11">
<title>Validation and performance</title>
<p>To assess the accuracy of date reconstructions of treetime and to compare its performance to existing tools such as BEAST and LST (<xref ref-type="bibr" rid="c4">Drummond <italic>et al.</italic>, 2012</xref>; <xref ref-type="bibr" rid="c27">To <italic>et al.</italic>, 2016</xref>), we generated toy data using the FFPopSim forward simulation library (<xref ref-type="bibr" rid="c32">Zanini and Neher, 2012</xref>). We simulated population of size <italic>N</italic> &#x003D; 100 and used a range evolutionary rates <italic>&#x03BC;</italic> &#x003D; 10<sup>&#x2212;5</sup>,&#x2026;,0.002 resulting in expected genetic diversity from 0.001 to 0.2. Sequences were sampled every 10, 20, or 50 generations. The length of the simulated sequences was <italic>L</italic> &#x003D; 1000.</p>
<p><xref ref-type="fig" rid="fig1">Fig. 1</xref> shows the error in the estimates of the clock rate for TreeTime, LSD, and BEAST as a function of the evolutionary rate. TreeTime and LSD estimates of the clock rate are very accurate for small rates but tend to underestimate the rates at when diversity exceeds a few percent. This is expected, as maximum likelihood inference underestimates branch lengths. BEAST tends to overestimate small rates and is accurate when branches become long. By sampling trees, BEAST does not suffer from the atypical maximum likelihood assignments.
<fig id="fig1" position="float" orientation="portrait" fig-type="figure"><label>FIG. 1</label><caption><p>Estimation of the evolutionary rate from simulated data by TreeTime, LSD, and BEAST. TreeTime and LSD (after tree reconstruction using FastTree) underestimate the rate when branch length are long. BEAST tends to overestimate the rate at small rates. The error bars denote &#x00B1; one standard deviation.</p></caption><graphic xlink:href="153494_fig1.tif"/></fig>
<fig id="fig2" position="float" orientation="portrait" fig-type="figure"><label>FIG. 2</label><caption><p>Estimation of TMRCA from simulated data by TreeTime, LSD, and BEAST. All three programs estimate the time of the MRCA with 10&#x0025; accuracy, except for the very long branches when TreeTime tends to overestimate the age of the root. Error bars show one standard deviation.</p></caption><graphic xlink:href="153494_fig2.tif"/></fig></p>
<p>In a similar manner, TreeTime, LSD, and BEAST estimate the time of the most recent common ancestor to within 10&#x0025; accuracy (relative to the coalescence time) across the range of simulated data.</p>
<p>We also ran TreeTime on simulated data provided by <xref ref-type="bibr" rid="c27">To <italic>et al.</italic> (2016)</xref> and compared it to the results reported by <xref ref-type="bibr" rid="c27">To <italic>et al.</italic> (2016)</xref> for LSD, BEAST and a number of other methods. <xref ref-type="fig" rid="fig3">Fig. 3</xref> compares the accuracy of <italic>T<sub>MRCA</sub></italic> and clock rate estimates, showing that TreeTime achieves similar or better accuracy than other methods.
<fig id="fig3" position="float" orientation="portrait" fig-type="figure"><label>FIG. 3</label><caption>
<title>LSD test data.</title><p>TreeTime has comparable or better accuracy as BEAST (BSMC), LSD (LD, QPD), or root-to-tip regression (RTT) when run on simulated data provided by (<xref ref-type="bibr" rid="c27">To <italic>et al.</italic>, 2016</xref>). Both panel use the tree set 750_3_25, the top and bottom panel show runs on alignments generated with a strict and relaxed molecular clock, respectively.</p></caption><graphic xlink:href="153494_fig3.tif"/></fig></p>
<sec id="s11a"><label>a.</label>
<title>Coalescent model inference</title>
<p>Population bottlenecks, selective sweeps, or population structure, affect the rate of coalescence in an often time variable way. BEAST can infer a history of effective population size (inverse coalescent rate) from a tree &#x2013; often known as skyline. TreeTime can do a similar inference by maximizing the coalescence likelihood with respect to the pivots of a piecewise line approximation of the coalescence rate history <italic>T<sub>c</sub></italic>(<italic>t</italic>). To test the power and accuracy of this inference, we simulated sinusoidal population size histories of different amplitude and period, uniformly sampled sequences through time, and used these data to estimate the coalescent rate history. Comparisons of true and estimated histories are shown in <xref ref-type="fig" rid="fig4">Fig. 4</xref>.
<fig id="fig4" position="float" orientation="portrait" fig-type="figure"><label>FIG. 4</label><caption><p>Reconstruction of fluctuating population sizes by TreeTime. The graph shows simulated population size trajectories (dashed lines) and the inference by TreeTime as solid lines of the same color. Different lines vary in the bottleneck sizes of 10&#x0025;(red), 20&#x0025;(green) and 50&#x0025;(blue) of the average population size. The top panel shows data for fluctuations with period 0.5<italic>N</italic>, the bottom panel 2<italic>N</italic>. The average population size is <italic>N</italic> &#x003D; 300.</p></caption><graphic xlink:href="153494_fig4.tif"/></fig></p>
</sec>
</sec>
<sec id="s12">
<title>Influenza phylogenies</title>
<p>Dense sampling of influenza A virus sequences over many decades makes this virus an ideal test case to evalualate the sensitivity of time tree estimation to sampling depth. We estimated the clock rate and the time of the most recent common ancestor of influenza A H3N2 HA sequences sampled from 2011 to 2013 for sets of sequences varying from 30 to 3000, see <xref ref-type="fig" rid="fig5">Fig. 5</xref>. TreeTime estimates are stable across this range, while estimates by LSD tend to drift with lower rates and older MRCAs for larger samples. Estimates by BEAST are generally concordant with TreeTime.
<fig id="fig5" position="float" orientation="portrait" fig-type="figure"><label>FIG. 5</label><caption><p>Variation of the estimate of the rate of evolution of H3N2 and the for different sensities of sampling.</p></caption><graphic xlink:href="153494_fig5.tif"/></fig></p>
<p>Next, we tested how accurately TreeTime infers dates of tips when only a fraction of tips have dates assigned. Every tip in TreeTime can either be assigned a precise date, an interval within which the date is assumed to be uniformly distributed, or no constraint at all. TreeTime will then determine the probability distribution of the date of the node based on the distribution of the ancestor and the substitutions that occurred since the ancestor. We tested the accuracy at which missing dates can be inferred in an influenza phylogeny by erasing date information of a fraction (5&#x0025; to 95&#x0025;) of all nodes, see <xref ref-type="fig" rid="fig6">Fig. 6</xref>.
<fig id="fig6" position="float" orientation="portrait" fig-type="figure"><label>FIG. 6</label><caption><p>Tip dating and sensitivity to missing information. A) The inter-quartile range of the error of estimated tip dates decreases from 0.7 years to 0.5 years as the fraction of known dates increases from 5&#x0025; to 90&#x0025; (see inset).</p></caption><graphic xlink:href="153494_fig6.tif"/></fig></p>
<p>In summary, on data sets with short branches but fairly unambiguous topologies, timetrees inferred by TreeTime have similar accuracy to those inferred by BEAST but results are obtained in a fraction of the time.</p>
</sec>
<sec id="s13">
<title>Analysis of the 2014-2015 Ebola Virus outbreak</title>
<p>In 2014, West Africa experienced the largest known outbreak of Ebola Virus (EBOV) in humans. The genomic epidemiology has been studied intensively by multiple groups (<xref ref-type="bibr" rid="c5">Dudas <italic>et al.</italic>, 2017</xref>). Here, we reanalyzed a subset of 350 EBOV sequences sampled throughout the outbreak from 2014-2016. Due to the dense sampling, the maximum likelihood phylogeny has many unresolved nodes and TreeTime was used to resolve polytomies using temporal information. After automatic rooting and GTR model inference, TreeTime produced the timetree shown in <xref ref-type="fig" rid="fig7">Fig. 7</xref>. The GTR model inferred from the tree was<disp-formula id="eqn11"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn11.gif"/></alternatives></disp-formula>
<fig id="fig7" position="float" orientation="portrait" fig-type="figure"><label>FIG. 7</label><caption>
<title>EBOV phylodynamic analysis.</title><p>The top panel shows a molecular clock phylogeny of EBOV sequences obtained over from 2014-2016 in West Africa. The lower panel shows the estimate of the coalescent population size along with its confidence intervals. The estimate suggest an exponential increase until late 2014 followed by a gradual decrease leading to almost complete eradication by 2016. Ebola case counts, as reported by the <xref ref-type="bibr" rid="c30">WHO (2016)</xref> agree quantitatively with the estimate.</p></caption><graphic xlink:href="153494_fig7.tif"/></fig></p>
<p>TreeTime ran 4min on a regular laptop to complete this analysis. In addition to inferring a time tree, TreeTime estimated the time course of the coalescent population size shown im the lower panel of <xref ref-type="fig" rid="fig7">Fig. 7</xref>. The estimated population size closely mirrors the case counts reported by the WHO throughout this period.</p>
</sec>
<sec id="s14">
<title>Discussion</title>
<p>TreeTime was developed with large heterochronous viral sequence alignments in mind and we have used TreeTime as the core component of the nextstrain real-time phylogenetics pipeline (<xref ref-type="bibr" rid="c15">Neher and Bedford, 2015</xref>). TreeTime tries to strike a useful compromise between inflexible but fast heuristics and computationally expensive Bayesian approaches that require extensive sampling of treespace. The overarching algorithmic strategy is iterative optimization of efficiently solvable subproblems to arrive at a consistent approximation of the global optimum. While this strategy is approximate and often assumes short branch length, it converges fast for many applications and trees with thousands of tips can be analyzed in a few minutes.</p>
<p>Rapid and efficient analysis methods are of increasing importance as data sets are increasing in size. During the recent outbreaks of EBOV and Zika virus, hundreds of sequences were generated and need to be analyzed in near real time to inform containment efforts. Similarly, the GISRS network for surveillance of seasonal influenza virus sequences hundreds of viral genomes per month. Timely analysis of these data with Bayesian methods such as BEAST is infeasible. Tree-Time addresses this need.</p>
<p>Compared to other methods recently developed for rapid estimations of timetrees (<xref ref-type="bibr" rid="c2">Britton <italic>et al.</italic>, 2007</xref>; <xref ref-type="bibr" rid="c25">Tamura <italic>et al.</italic>, 2012</xref>; <xref ref-type="bibr" rid="c27">To <italic>et al.</italic>, 2016</xref>), treetime uses probablistic models of evolution, allows inference of ancestral characters, and coalescent models. In TreeTime, every node of the tree can be given a strict or probabilistic date constraint. This higher model complexity results in longer run times, but the scaling of run times remains linear in the size of the data set and alignments with thousands of sequences can be analyzed routinely. The timetree inference and dating is typically faster than the estimation of the tree topology.</p>
<p>TreeTime can be used in a number of different ways. The core TreeTime algorithms and classes can be used larger phylogenetic analysis in python scripts. This is most flexible way to use TreeTime and all the different analysis steps can be combined in custom ways with user specified parameters. In addition, we provide command-line scripts for typical recurring tasks such as ancestral state reconstruction, rerooting to maximize temporal order, and time tree inference. We also implemented a web-server that allows exploration and analysis of heterochronous alignments in the browser without the need to use the command-line.</p>
<p>TreeTime was tested predominantly on mildly diverged sequences from viruses. The iterative optimization procedures are not expected to be accurate for trees were the many sites are saturated. In such scenarios with extensive uncertainty of ancestral states and tree topology, convergence of the iterative steps can not by guaranteed. While in many cases TreeTime might still give approximate branch length and ancestral assignments and timetree estimates, these need to be checked for plausibility. In general global optimization and sampling of the posterior can not be avoided.</p></sec>
</body>
<back>
<ref-list>
<title>References</title>
<ref id="c1"><mixed-citation publication-type="other"><string-name><surname>Aris-Brosou</surname>, <given-names>S.</given-names></string-name>, <string-name><given-names>Z.</given-names> <surname>Yang</surname></string-name>, and <string-name><given-names>J.</given-names> <surname>Huelsenbeck</surname></string-name>, <year>2002</year>, <article-title>Systematic Biology</article-title> <volume>51</volume>(<issue>5</issue>), <fpage>703</fpage>, ISSN <issn>1063-5157</issn>.</mixed-citation></ref>
<ref id="c2"><mixed-citation publication-type="journal"><string-name><surname>Britton</surname>, <given-names>T.</given-names></string-name>, <string-name><given-names>C. L.</given-names> <surname>Anderson</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Jacquet</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Lundqvist</surname></string-name>, and <string-name><given-names>K.</given-names> <surname>Bremer</surname></string-name>, <year>2007</year>, <source>Syst. Biol</source>. <volume>56</volume>(<issue>5</issue>), <fpage>741</fpage>.</mixed-citation></ref>
<ref id="c3"><mixed-citation publication-type="journal"><string-name><surname>Drummond</surname>, <given-names>A. J.</given-names></string-name>, <string-name><given-names>S. Y. W.</given-names> <surname>Ho</surname></string-name>, <string-name><given-names>M. J.</given-names> <surname>Phillips</surname></string-name>, and <string-name><given-names>A.</given-names> <surname>Rambaut</surname></string-name>, <year>2006</year>, <source>PLOS Biol</source> <volume>4</volume>(<issue>5</issue>), <fpage>e88</fpage>.</mixed-citation></ref>
<ref id="c4"><mixed-citation publication-type="journal"><string-name><surname>Drummond</surname>, <given-names>A. J.</given-names></string-name>, <string-name><given-names>M. A.</given-names> <surname>Suchard</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Xie</surname></string-name>, and <string-name><given-names>A.</given-names> <surname>Rambaut</surname></string-name>, <year>2012</year>, <source>Mol Biol Evol</source> <volume>29</volume>(<issue>8</issue>), <fpage>1969</fpage>.</mixed-citation></ref>
<ref id="c5"><mixed-citation publication-type="journal"><string-name><surname>Dudas</surname>, <given-names>G.</given-names></string-name>, <string-name><given-names>L. M.</given-names> <surname>Carvalho</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Bedford</surname></string-name>, <string-name><given-names>A. J.</given-names> <surname>Tatem</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Baele</surname></string-name>, <string-name><given-names>N. R.</given-names> <surname>Faria</surname></string-name>, <string-name><given-names>D. J.</given-names> <surname>Park</surname></string-name>, <string-name><given-names>J. T.</given-names> <surname>Ladner</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Arias</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Asogun</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Bielejec</surname></string-name>, <string-name><given-names>S. L.</given-names> <surname>Caddy</surname></string-name>, <etal>et al.</etal>, <year>2017</year>, <source>Nature</source> <volume>544</volume>(<issue>7650</issue>), <fpage>309</fpage>, ISSN <issn>0028-0836</issn>.</mixed-citation></ref>
<ref id="c6"><mixed-citation publication-type="book"><string-name><surname>Felsenstein</surname>, <given-names>J.</given-names></string-name>, <year>2004</year>, <source>Inferring Phylogenies</source> (<publisher-name>Sinauer Associates</publisher-name>).</mixed-citation></ref>
<ref id="c7"><mixed-citation publication-type="journal"><string-name><surname>Gardy</surname>, <given-names>J.</given-names></string-name>, <string-name><given-names>N. J.</given-names> <surname>Loman</surname></string-name>, and <string-name><given-names>A.</given-names> <surname>Rambaut</surname></string-name>, <year>2015</year>, <source>Genome Biology</source> <volume>16</volume>, <fpage>155</fpage>.</mixed-citation></ref>
<ref id="c8"><mixed-citation publication-type="journal"><string-name><surname>Hasegawa</surname>, <given-names>M.</given-names></string-name>, <string-name><given-names>H.</given-names> <surname>Kishino</surname></string-name>, and <string-name><given-names>T.-a.</given-names> <surname>Yano</surname></string-name>, <year>1989</year>, <source>Journal of Human Evolution</source> <volume>18</volume>(<issue>5</issue>), <fpage>461</fpage>, ISSN <issn>0047-2484</issn>.</mixed-citation></ref>
<ref id="c9"><mixed-citation publication-type="website"><string-name><surname>Jones</surname>, <given-names>E.</given-names></string-name>, <string-name><given-names>T.</given-names> <surname>Oliphant</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Peterson</surname></string-name>, <etal>et al.</etal>, <year>2001&#x2013;2017</year>, <source>SciPy: Open source scientific tools for Python</source>, [Online; accessed 2017-01-12], URL <ext-link ext-link-type="uri" xlink:href="http://www.scipy.org/">http://www.scipy.org/</ext-link>.</mixed-citation></ref>
<ref id="c10"><mixed-citation publication-type="journal"><string-name><surname>Kingman</surname>, <given-names>J. F. C.</given-names></string-name>, <year>1982</year>, <source>Stochastic Processes and their Applications</source> <volume>13</volume>(<issue>3</issue>), <fpage>235</fpage>, ISSN <issn>0304-4149</issn>.</mixed-citation></ref>
<ref id="c11"><mixed-citation publication-type="journal"><string-name><surname>Kumar</surname>, <given-names>S.</given-names></string-name>, and <string-name><given-names>S. B.</given-names> <surname>Hedges</surname></string-name>, <year>2016</year>, <source>Mol Biol Evol</source> <volume>33</volume>(<issue>4</issue>), <fpage>863</fpage>.</mixed-citation></ref>
<ref id="c12"><mixed-citation publication-type="journal"><string-name><surname>Langley</surname>, <given-names>C. H.</given-names></string-name>, and <string-name><given-names>W. M.</given-names> <surname>Fitch</surname></string-name>, <year>1974</year>, <source>J Mol Evol</source> <volume>3</volume>(<issue>3</issue>), <fpage>161</fpage>, ISSN <issn>0022-2844,1432-1432</issn>.</mixed-citation></ref>
<ref id="c13"><mixed-citation publication-type="book"><string-name><surname>M&#x2019;ezard</surname>, <given-names>M.</given-names></string-name>, and <string-name><given-names>A.</given-names> <surname>Montanari</surname></string-name>, <year>2009</year>, <source>Information, Physics, and Computation</source> (<publisher-name>OUP Oxford</publisher-name>), ISBN 978-0-19-857083-7, googleBooks-ID: jhCM7i0a6UUC.</mixed-citation></ref>
<ref id="c14"><mixed-citation publication-type="journal"><string-name><surname>Neher</surname>, <given-names>R. A.</given-names></string-name>, <year>2013</year>, <source>Annual Review of Ecology, Evolution, and Systematics</source> <volume>44</volume>(<issue>1</issue>), <fpage>195</fpage>.</mixed-citation></ref>
<ref id="c15"><mixed-citation publication-type="journal"><string-name><surname>Neher</surname>, <given-names>R. A.</given-names></string-name>, and <string-name><given-names>T.</given-names> <surname>Bedford</surname></string-name>, <year>2015</year>, <source>Bioinformatics</source> <volume>31</volume>(<issue>21</issue>), <fpage>3546</fpage>.</mixed-citation></ref>
<ref id="c16"><mixed-citation publication-type="journal"><string-name><surname>Nordborg</surname>, <given-names>M.</given-names></string-name>, <year>1997</year>, <source>Genetics</source> <volume>146</volume>(<issue>4</issue>), <fpage>1501</fpage>, ISSN <issn>0016-6731, 1943-2631</issn>.</mixed-citation></ref>
<ref id="c17"><mixed-citation publication-type="book"><string-name><surname>Pond</surname>, <given-names>S. L. K.</given-names></string-name>, and <string-name><given-names>S. V.</given-names> <surname>Muse</surname></string-name>, <year>2005</year>, in <source>Statistical methods in molecular evolution</source> (<publisher-name>Springer</publisher-name>), pp. <fpage>125</fpage>&#x2013;<lpage>181</lpage>.</mixed-citation></ref>
<ref id="c18"><mixed-citation publication-type="journal"><string-name><surname>Price</surname>, <given-names>M. N.</given-names></string-name>, <string-name><given-names>P. S.</given-names> <surname>Dehal</surname></string-name>, and <string-name><given-names>A. P.</given-names> <surname>Arkin</surname></string-name>, <year>2010</year>, <source>PLoS ONE</source> <volume>5</volume>(<issue>3</issue>), <fpage>e9490</fpage>, ISSN <issn>1932-6203</issn>.</mixed-citation></ref>
<ref id="c19"><mixed-citation publication-type="journal"><string-name><surname>Pupko</surname>, <given-names>T.</given-names></string-name>, <string-name><given-names>I.</given-names> <surname>Pe</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Shamir</surname></string-name>, and <string-name><given-names>D.</given-names> <surname>Graur</surname></string-name>, <year>2000</year>, <source>Mol Biol Evol</source> <volume>17</volume>(<issue>6</issue>), <fpage>890</fpage>.</mixed-citation></ref>
<ref id="c20"><mixed-citation publication-type="journal"><string-name><surname>Rambaut</surname>, <given-names>A.</given-names></string-name>, <year>2000</year>, <source>Bioinformatics (Oxford, England)</source> <volume>16</volume>(<issue>4</issue>), <fpage>395</fpage>, ISSN <issn>1367-4803</issn>.</mixed-citation></ref>
<ref id="c21"><mixed-citation publication-type="journal"><string-name><surname>Rambaut</surname>, <given-names>A.</given-names></string-name>, <string-name><given-names>T. T.</given-names> <surname>Lam</surname></string-name>, <string-name><given-names>L. M.</given-names> <surname>Carvalho</surname></string-name>, and <string-name><given-names>O. G.</given-names> <surname>Pybus</surname></string-name>, <year>2016</year>, <source>Virus Evolution</source> <volume>2</volume>(<issue>1</issue>), <fpage>vew007</fpage>.</mixed-citation></ref>
<ref id="c22"><mixed-citation publication-type="journal"><string-name><surname>Sanderson</surname>, <given-names>M. J.</given-names></string-name>, <year>2003</year>, <source>Bioinformatics</source> <volume>19</volume>(<issue>2</issue>), <fpage>301</fpage>.</mixed-citation></ref>
<ref id="c23"><mixed-citation publication-type="journal"><string-name><surname>Stamatakis</surname>, <given-names>A.</given-names></string-name>, <year>2014</year>, <source>Bioinformatics</source> <volume>30</volume>(<issue>9</issue>), <fpage>1312</fpage>, ISSN <issn>1367-4803</issn>.</mixed-citation></ref>
<ref id="c24"><mixed-citation publication-type="journal"><string-name><surname>Strimmer</surname>, <given-names>K.</given-names></string-name>, and <string-name><given-names>O. G.</given-names> <surname>Pybus</surname></string-name>, <year>2001</year>, <source>Molecular Biology and Evolution</source> <volume>18</volume>(<issue>12</issue>), <fpage>2298</fpage>, ISSN <issn>0737-4038</issn>.</mixed-citation></ref>
<ref id="c25"><mixed-citation publication-type="journal"><string-name><surname>Tamura</surname>, <given-names>K.</given-names></string-name>, <string-name><given-names>F. U.</given-names> <surname>Battistuzzi</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Billing-Ross</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Murillo</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Filipski</surname></string-name>, and <string-name><given-names>S.</given-names> <surname>Kumar</surname></string-name>, <year>2012</year>, <source>PNAS</source> <volume>109</volume>(<issue>47</issue>), <fpage>19333</fpage>.</mixed-citation></ref>
<ref id="c26"><mixed-citation publication-type="journal"><string-name><surname>Thorne</surname>, <given-names>J. L.</given-names></string-name>, <string-name><given-names>H.</given-names> <surname>Kishino</surname></string-name>, and <string-name><given-names>I. S.</given-names> <surname>Painter</surname></string-name>, <year>1998</year>, <source>Molecular Biology and Evolution</source> <volume>15</volume>(<issue>12</issue>), <fpage>1647</fpage>, ISSN <issn>0737-4038</issn>.</mixed-citation></ref>
<ref id="c27"><mixed-citation publication-type="journal"><string-name><surname>To</surname>, <given-names>T.-H.</given-names></string-name>, <string-name><given-names>M.</given-names> <surname>Jung</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Lycett</surname></string-name>, and <string-name><given-names>O.</given-names> <surname>Gascuel</surname></string-name>, <year>2016</year>, <source>Syst. Biol</source>. <volume>65</volume>(<issue>1</issue>), <fpage>82</fpage>.</mixed-citation></ref>
<ref id="c28"><mixed-citation publication-type="journal"><string-name><surname>Volz</surname>, <given-names>E. M.</given-names></string-name>, <string-name><given-names>K.</given-names> <surname>Koelle</surname></string-name>, and <string-name><given-names>T.</given-names> <surname>Bedford</surname></string-name>, <year>2013</year>, <source>PLOS Computational Biology</source> <volume>9</volume>(<issue>3</issue>), <fpage>e1002947</fpage>, ISSN <issn>1553-7358</issn>.</mixed-citation></ref>
<ref id="c29"><mixed-citation publication-type="journal"><string-name><surname>van der Walt</surname>, <given-names>S.</given-names></string-name>, <string-name><given-names>S.</given-names> <surname>Colbert</surname></string-name>, and <string-name><given-names>G.</given-names> <surname>Varoquaux</surname></string-name>, <year>2011</year>, <source>Computing in Science Engineering</source> <volume>13</volume>(<issue>2</issue>), <fpage>22</fpage>.</mixed-citation></ref>
<ref id="c30"><mixed-citation publication-type="website"><collab>WHO</collab>, <year>2016</year>, <source>2014 Ebola outbreak in West Africa &#x2013; case counts</source>, URL <ext-link ext-link-type="uri" xlink:href="http://https://www.cdc.gov/vhf/ebola/csv/graph1-cumulative-reported-cases-all.xlsx">https://www.cdc.gov/vhf/ebola/csv/graph1-cumulative-reported-cases-all.xlsx</ext-link>.</mixed-citation></ref>
<ref id="c31"><mixed-citation publication-type="journal"><string-name><surname>Yoder</surname>, <given-names>A. D.</given-names></string-name>, and <string-name><given-names>Z.</given-names> <surname>Yang</surname></string-name>, <year>2000</year>, <source>Mol Biol Evol</source> <volume>17</volume>(<issue>7</issue>), <fpage>1081</fpage>.</mixed-citation></ref>
<ref id="c32"><mixed-citation publication-type="journal"><string-name><surname>Zanini</surname>, <given-names>F.</given-names></string-name>, and <string-name><given-names>R. A.</given-names> <surname>Neher</surname></string-name>, <year>2012</year>, <source>Bioinformatics</source> <volume>28</volume>(<issue>24</issue>), <fpage>3332</fpage>, ISSN <issn>1367-4811 1367-4803</issn>.</mixed-citation></ref>
<ref id="c33"><mixed-citation publication-type="other"><string-name><surname>Zuckerkandl</surname>, <given-names>E.</given-names></string-name>, and <string-name><given-names>L.</given-names> <surname>Pauling</surname></string-name>, <year>1965</year>.</mixed-citation></ref>
</ref-list>
<app-group>
<app id="app1">
<label>APPENDIX</label>
<title>Finding the optimal root in linear time</title>
<p>To calculate the correlation between the root-to-tip distances and tip dates via equation 5, one first needs to calculate the means and (co)variances of tip dates and root-to-tip distances. For a tree with <italic>N</italic> tips, this requires &#x1D4AA;(<italic>N</italic>) operations and calculating it for all internal nodes would therefore require &#x1D4AA;(<italic>N</italic><sup>2</sup>)operations. The same covariances are needed to calculate the regression parameters and the residuals. However, its is possible to calculate the quantities for every node at once, reducing the total number of operations to &#x1D4AA;(<italic>N</italic>).</p>
<p>The speed-up is possible through recursively calculating sums and averages on the tree. We denote the set of tips that descend of node <italic>n</italic> by &#x1D4DB;. We will need the number tips <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline7.gif"/></alternatives></inline-formula>, the sum of their sampling times <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline8.gif"/></alternatives></inline-formula>, the sum of their distances <italic>d<sub>n,i</sub></italic> from node <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline9.gif"/></alternatives></inline-formula> and the analogous higher order quantities <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline10.gif"/></alternatives></inline-formula> and <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline11.gif"/></alternatives></inline-formula>.</p>
<p>First, assign <italic>M<sub>n</sub></italic> &#x003D; 1, <italic>&#x03C4;<sub>n</sub></italic> &#x003D; <italic>t<sub>n</sub></italic>, <italic>&#x03B8;<sub>n</sub></italic> &#x003D; 0, <italic>&#x03B3;<sub>n</sub></italic> &#x003D; 0 and <italic>&#x03B4;<sub>n</sub></italic> &#x003D; 0 for all tips of the tree. Then, in one post-order transversal over internal nodes, we can calculate these quantities by summing the following expressions over the children &#x1D49E;<italic>n</italic> of node <italic>n</italic>.<disp-formula id="eqn12"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn12.gif"/></alternatives></disp-formula><disp-formula id="eqn13"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn13.gif"/></alternatives></disp-formula></p>
<p>To calculate the covariances at a particular node <italic>n</italic>, we need to sum over all terminal nodes rather than only tips that descend from the node. We denote the corresponding quantities by capital letters. The sums of the sampling dates and their squares are of course straightforward to evalulate, the remaining quantities that depend on the choice of the focal node <italic>n</italic> can be calculated in one pre-order transversal. Let <italic>p</italic> denote the parent node of node <italic>n</italic><disp-formula id="eqn14"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn14.gif"/></alternatives></disp-formula><disp-formula id="eqn15"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn15.gif"/></alternatives></disp-formula></p>
<p>Note, that the order in which these calculations are performed matters. The first line, calculating &#x0398;<italic><sub>n</sub></italic> adjusts the parent value &#x0398;<italic><sub>p</sub></italic> for the fact that the branch leading to node <italic>n</italic> is transversed by <italic>N</italic> &#x2212; <italic>M<sub>n</sub></italic> path instead of <italic>M<sub>n</sub></italic> if the root is shifted from p to n. Similarly, &#x0393;<italic><sub>n</sub></italic> is calculated from &#x0393;<italic><sub>p</sub></italic> by adjusting with the difference of sum of times of subtending and complementary nodes. The corresponding expression for the sum of squared root-to-tip distances is slightly more complicated but still follows from elementary algebra.</p>
<p>With these quantities at hand, the regression, residuals, and <italic>r</italic><sup>2</sup> can be straightforwardly calculated from the means and covariances given by<disp-formula id="eqn16"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn16.gif"/></alternatives></disp-formula><disp-formula id="eqn17"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn17.gif"/></alternatives></disp-formula></p>
<p>In genernal, the optimal root is not going to coincide with a preexisting node but will be placed somewhere along a branch. When placing the root at a position <italic>&#x03F5;</italic> &#x2208; [0, 1] along the branch, the corresponding &#x0398;<italic><sub>n</sub></italic>(<italic>&#x03F5;</italic>), &#x0393;<italic><sub>n</sub></italic>(<italic>&#x03F5;</italic>), &#x0394;<italic><sub>n</sub></italic>(<italic>&#x03F5;</italic>) are obtained by substitution <italic>&#x03F5;l<sub>c</sub></italic> for <italic>l<sub>c</sub></italic> in equation 14. The fraction of variance explained by a root-to-tip regression with a root placed at position a on a branch then has the generic form<disp-formula id="eqn18"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_eqn18.gif"/></alternatives></disp-formula>
where the coefficients can be obtained by sustituting the expressions for &#x0398;<italic><sub>n</sub></italic>(<italic>&#x03F5;</italic>), &#x0393;<italic><sub>n</sub></italic>(<italic>&#x03F5;</italic>), and &#x0394;<italic><sub>n</sub></italic>(<italic>&#x03F5;</italic>). The condition for a maximum <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline12.gif"/></alternatives></inline-formula> results in an quadratic equation for <italic>&#x03F5;</italic>. Hence, the optimal position of the root can be calculated with a number of operations that increases linearly in the size of the tree.</p>
<p>The slope of the root-to-tip regression or clock rate in then simply <inline-formula><alternatives><inline-graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="153494_inline13.gif"/></alternatives></inline-formula>, where <italic>d<sub>i</sub></italic> are evaluated with respect to the optimal root.</p>
</app>
</app-group>
</back>
</article>